'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[23],{1263:function(t,E,a){t=a(0);var c=a(15),b=a(80),e=a(824),f=a(83),d=a(187),h=a(8),m=a(209),l=a(66),w=a(40),n=a(188),x=a(109),r=a(283),u=a(1),v=a(11),B=a(100),z=a(13),A=a(282),y=a(21),D=a(346);class I{constructor(J,L,P){this.zGa=J;this.lk=L;this.CFc=P}}Object(t.a)(I,"UserActivityLocation",null,[]);var M=a(986),T=a(60);const S=(J,L,P,aa,U,K=null)=>{K=J.Oa(1,K);return T.g(J,"GetVersionHistoryHighlightActivitiesData",
K,L,P,aa,U,4)};var H=a(763),C=a(55);a.d(E,"a",function(){return G});class G{constructor(J,L,P,aa){this.authorColor=this.O2=this.jfa=null;this.O8a=!1;this.w2a=-1;this.g8c=0;this.sJa=100;this.a6=-1;this.s3d=null;this.zqb=h.a.y3j;this.NLe=h.a.z3j;this.xFb=!1;this.hh=U=>{(U=r.a(U)?null:U.Result)?U.OperationWaitingForFileDownload?20>this.g8c?(this.sJa*=2,C.Task.delay(this.sJa).continueWith(()=>{this.I0d()})):(this.SEc(),c.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):
U.ActivityList?(this.initialize(U.ActivityList,U.VersionAuthors),u.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.mQa():this.mOb(!0),this.s3d.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.s3d.Bc.toString()}`)):(this.SEc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.sJa*=2,C.Task.delay(this.sJa).continueWith(()=>
{this.I0d()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.Dza=()=>{this.SEc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.uvd=U=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${U.MessageId}`);switch(U.MessageId){case M.a.iterateNext:this.iterateNext();this.a6=(this.a6+1)%this.$O.length;
this.DMb(M.a.setCurrentChangeCount,this.a6+1);break;case M.a.$xa:this.$xa();this.a6=0>this.a6?0:this.a6;this.a6=(this.a6+this.$O.length-1)%this.$O.length;this.DMb(M.a.setCurrentChangeCount,this.a6+1);break;case M.a.eQb:this.mOb(U.Values.ToggleValue)}};this.h8g=(U,K)=>this.A5b(U.lk,K.lk);this.f8g=(U,K)=>this.A5b(U.lk,K);this.Pc=()=>{u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.XlOnlineVHRemovingDeselectOnSelectionChanged",!1)||this.x8b()};this.Kn=()=>{this.x8b()};this.Th=()=>{this.x8b()};
c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=J;this.ariaLiveNotifier=aa;this.gridView=y.h(this.$);this.gridView.ha.hH(this.Pc);this.gridView.FC(this.Kn);this.gridView.Vb.Zk(this.Th);this.JZj();this.xFb=u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.XlOnlineVHNewIterationAlgorithm",!1);L&&(this.s3d=J.Kb.Cc("UserAction","VersionHistoryDiffManagerStopWatch"),this.I0d());if(this.Cs=P)J=b.a.nba(this.$.ya.VersionHistoryActionUrl)||H.a.r$,J!==H.a.r$&&
this.Cs.CGa(J),this.Cs.vo(M.a.iterateNext),this.Cs.vo(M.a.$xa),this.Cs.vo(M.a.eQb),this.Cs.em(M.a.iterateNext,this.uvd),this.Cs.em(M.a.$xa,this.uvd),this.Cs.em(M.a.eQb,this.uvd)}get yhb(){return this.O2}get xMb(){return-1===this.w2a?null:this.$O[this.w2a]}get $O(){this.O8a||(this.jfa.sort(this.h8g),this.O8a=!0);return this.jfa}dispose(){this.ARa();this.jfa=this.O2=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.kG(this.Pc),this.gridView.aE(this.Kn),this.gridView.Vb&&this.gridView.Vb.Uk(this.Th),
this.Cs&&(this.Cs.jpa(M.a.$xa),this.Cs.jpa(M.a.iterateNext),this.Cs.jpa(M.a.eQb)))}initialize(J,L){J?(this.ARa(),this.w2a=-1,this.jfa=[],this.O8a=!1,this.O2={},this.authorColor={},this.BFi(L),this.O7c(J)):c.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}I0d(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.g8c.toString()} --${this.sJa.toString()}`);this.g8c++;this.$.userOperationManager.Ic(new n.a(537,
0,(J,L,P)=>S(this.$.pa.xa,A.b(J,this.hh),A.a(L,this.Dza),P,null),80),null)}mOb(J){const L=this.O2;for(let aa in L){var P=aa;const U=L[aa];U?U.oOb(J):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+P+"view was Null")}}ARa(){const J=this.O2;for(let P in J){var L=P;const aa=J[P];aa?aa.CMd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+L+"view was Null")}this.jfa=this.O2=null}H2f(J){let L;if(this.xFb)L=J?this.l6e(this.a6):
this.o7e(this.a6),J=this.$O[L];else if(!({iff:L,Hlg:J}=this.vZh(J,this.w2a)).returnValue)return;c.ULS.shipAssertTag(537150402,0,!!J,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.x8b();if(J.zGa.toString()in this.O2){this.O2[J.zGa.toString()].ptj(J.lk);var P=w.D(J.lk);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(z.a.instance.mb(158),L+1,this.$O.length,P.Hw(!1),J.CFc.DisplayName));
this.w2a=L}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${J.zGa.toString()} view not present in views dictionary`)}DMb(J,L){if(u.EwaSettings.oa(297))if(this.Cs){var P={};P.count=L;J=new e.a(J);J.Values=P;this.Cs.send(J)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}vZh(J,
L){let P,aa=!1;P=null;let U=0;for(;!aa&&U<this.$O.length;){L=J?this.l6e(L):this.o7e(L);P=this.$O[L];const K=Object(f.a)(B.a,this.$.va.getItemByName(P.lk.SheetName));if(!K)return c.ULS.shipAssertTag(537150369,0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,iff:L,Hlg:P};K.visible&&(aa=!0);U++}return{returnValue:aa,iff:L,Hlg:P}}l6e(J){return this.xFb||-1!==J?(J+1)%this.$O.length:this.g6e()}o7e(J){this.xFb&&
-1===J?J=0:-1===J&&(J=this.g6e());return J=(J+this.$O.length-1)%this.$O.length}O7c(J){this.Yhh(J);this.t7c()}J5h(J,L){const P=[];if(!J.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),P;for(const aa of J.RangeList)if(!aa||!this.$.va.Rk(aa.SheetName))c.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name "+aa.SheetName);else if(!this.xFb||this.$.va.getItemByName(aa.SheetName).visible)J=
new I(0,aa,L),P.push(J);return P}Yhh(J){for(const L of J)if(!L||x.e(L.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const P of L.LocationList)if(P)switch(P.Type){case 0:this.jfa.push(...this.J5h(P,L.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}t7c(){var J=
{};const L=new d.a,P=[];for(const aa of this.jfa){L.contains(aa.CFc)||L.add(aa.CFc);if(0!==aa.zGa)continue;const U=new D.a(w.D(aa.lk),l.d(this.$.va.getItemByName(aa.lk.SheetName))),K=G.Vzc(U);K in J||P.push(U);J[K]=this.oRh(aa.CFc)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.jfa.length}, Highlightable activities: ${P.length},Total userlist in activities : ${this.jfa.length}, Total userlist from pane: ${P.length} `);this.SEc();
0<P.length&&(J=new (a(1367).RangeVersionHistoryHighlightView)(this.$,P,J,this.zqb),this.O2["0"]=J)}SEc(){const J=this.jfa?this.$O.length:0;this.DMb(M.a.setCurrentChangeCount,0);this.DMb(M.a.setTotalChangesCount,J)}mQa(){this.DMb(M.a.mQa,0)}BFi(J){if(J)for(let U=0;U<J.length;++U)if(u.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&!J[U].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");
else{var L=J[U].EmailAddress;var P=J[U].UserName;var aa=null;if(J[U].LoginName){const K=J[U].LoginName.split("|");3===K.length&&(aa=K[2])}aa?this.authorColor[aa]=J[U].InitialsColor:L?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[L]=J[U].InitialsColor):P?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[P]=J[U].InitialsColor):c.ULS.sendTraceTag(537150359,
0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}JZj(){if(this.$.ya.VersionHistoryHighlightsSettings){var J=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings):null;for(let P=0;P<J.length;P++){var L=J[P];const aa=
L.key?L.key:L.Key?L.Key:"";L=L.value?L.value:L.Value?L.Value:"";"DefaultColor"===aa?this.NLe=L:"InitialTint"===aa?this.zqb=L:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}oRh(J){if(J.Email in this.authorColor)return this.authorColor[J.Email];if(J.DisplayName in this.authorColor)return this.authorColor[J.DisplayName];
c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.NLe}A5b(J,L){var P=Object(f.a)(B.a,this.$.va.getItemByName(J.SheetName));const aa=Object(f.a)(B.a,this.$.va.getItemByName(L.SheetName));return P&&aa?(P=(P=v.HelperMethods.GB(P.index,aa.index))||v.HelperMethods.GB(J.FirstRow,L.FirstRow))||v.HelperMethods.GB(J.FirstColumn,L.FirstColumn):(c.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),
0)}g6e(){var J=w.m(this.gridView.ha.ra.activeRange,this.$.va.na);if(!J)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;J=v.HelperMethods.ow(new m.a(this.$O),0,this.$O.length,J,this.f8g);0>J&&(J=~J);return J%this.$O.length}x8b(){if(this.xMb){if(!(this.xMb.zGa.toString()in this.O2)){c.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.xMb.zGa.toString()} view not present in views dictionary`);
return}this.O2[this.xMb.zGa.toString()].Qlh(this.xMb.lk)}this.w2a=-1}iterateNext(){this.H2f(!0)}$xa(){this.H2f(!1)}static Vzc(J){return`${J.range}${J.sheetId}`}}Object(t.a)(G,"VersionHistoryHighlightManager",null,[289,3])},1367:function(t,E,a){a.r(E);t=a(0);var c=a(15),b=a(8);class e{}e.yzh="ewa-vhr-rectinnerborder";Object(t.a)(e,"CssClassNames",null,[]);var f=a(66),d=a(40),h=a(199),m=a(21),l=a(346),w=a(1263);a.d(E,"RangeVersionHistoryHighlightView",function(){return n});class n{constructor(x,r,u,
v){this.kkb=null;this.$=x;this.JDg=r;this.uTa=u;this.vTa={};this.zqb=v;this.Bhi()}get FF(){return[n.j5]}get qb(){return this.kkb||(this.kkb=m.h(this.$).qb)}oOb(x){x?this.qb.Tn(this.FF):this.qb.Zg(this.FF)}CMd(){this.oOb(!1);this.qb.fTa(new l.a(null,f.d(this.$.na)),this.FF)}ptj(x){if(this.uTa){var r=new l.a(d.D(x),f.d(this.$.va.getItemByName(x.SheetName))),u=w.a.Vzc(r);if(u in this.uTa)if(u in this.vTa){r=h.a.yp(this.uTa[u]);u=this.vTa[u];for(let v in u)u[v].style.backgroundColor=`rgba(${r.r},${r.g},${r.b},${b.a.A3j})`;
m.h(this.$).ha.Ta.yH(null);m.h(this.$).J$e(x,60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+u);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+u)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}Qlh(x){x=
new l.a(d.D(x),f.d(this.$.va.getItemByName(x.SheetName)));var r=w.a.Vzc(x);if(r in this.vTa)if(r in this.uTa){x=h.a.yp(this.uTa[r]);r=this.vTa[r];for(let u in r)r[u].style.backgroundColor=`rgba(${x.r},${x.g},${x.b},${this.zqb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+r);else c.ULS.sendTraceTag(537150425,0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+r)}Bhi(){this.qb.qx(this.JDg,
[n.j5],!1,(x,r)=>{if(x&&x.range&&x.sheetId&&r){var u=new l.a(x.range,x.sheetId);u=w.a.Vzc(u);u in this.vTa||(this.vTa[u]={});this.vTa[u][x.paneType.toString()]=r;u in this.uTa?(x=this.uTa[u],u=h.a.yp(x),r.style.borderColor=x,r.style.backgroundColor=`rgba(${u.r},${u.g},${u.b},${this.zqb})`,x=document.createElement("div"),x.className=e.yzh,r.appendChild(x)):c.ULS.sendTraceTag(537150419,0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+u)}else c.ULS.shipAssertTag(537150423,
0,!!x,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!x||!!x.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!x||!!x.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,0,!!r,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}n.j5=23;Object(t.a)(n,"RangeVersionHistoryHighlightView",null,[319])},1432:function(t,
E,a){a.r(E);var c=a(9),b=a(0),e=a(4),f=a(222),d=a(15),h=a(114),m=a(145),l=a(41);class w extends h.a{constructor(Lb,pc,Ha,Bb,bc){super(Lb,pc);this.executionContext=null;this.retryCount=0;this.EXi=tc=>{({CPd:tc}=this.SUj(tc)).returnValue?tc.Success?(m.c(2138207060,!0),d.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):(m.c(2138207060,!1),d.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${tc.Output}`),
this.jh(this.kK)):(m.c(2138207060,!1),this.jh(this.kK));(tc=this.executionContext.activityState[w.oyd])&&tc();this.Kp();this.executionContext.XM()};this.DXi=()=>{if(0<this.retryCount)d.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.v_f();else{d.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");m.c(2138207060,!1);this.jh(this.kK);
var tc=this.executionContext.activityState[w.oyd];tc&&tc();this.Kp();this.executionContext.XM()}};this.kK=Ha;this.E3=Bb;this.baseUrl=bc}execute(Lb){this.executionContext=Lb;this.retryCount=3;this.v_f();return 1}v_f(){var Lb=this.executionContext.activityState[w.Xtc];const pc=`${this.baseUrl}${"restoreversion.ashx"}`,Ha={};Ha.VersionId=this.executionContext.activityState[w.Nmg];Ha.QuerySignature=Lb;Lb=l.c(Ha);this.E3.Om(pc,2,Lb,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.EXi,this.DXi,
null)}SUj(Lb){let pc;pc=null;Lb=Lb?Lb.data?Lb.data.fe:null:null;return Lb&&Lb.length?({Gt:pc}=l.d(Lb)).returnValue?{returnValue:!0,CPd:pc}:(d.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,CPd:pc}):(d.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),{returnValue:!1,CPd:pc})}}w.Nmg="RVAvi";w.Xtc="RVAqs";w.oyd=
"RVlvrt";Object(b.a)(w,"RestoreVersionActivity",h.a,[]);var n=a(6);class x extends f.a{constructor(Lb,pc,Ha){super();this.activityName=Lb;this.cK=pc;this.kK=Ha;this.Fb()}create(){this.ob(new w(this.activityName,this.cK,this.kK,e.AFrameworkApplication.zd,e.AFrameworkApplication.ta.Pa.m0))}static la(Lb){Lb.da.Ga(320,new x(n.a.FPd,n.a.gj,n.a.GPd))}}Object(b.a)(x,"RestoreVersionActivityFactory",f.a,[]);class r extends h.a{constructor(Lb,pc){super(Lb,pc)}execute(Lb){(0,Lb.activityState[r.V$f])(()=>{this.Kp();
Lb.XM()});return 1}}r.V$f="RVEAssea";Object(b.a)(r,"RestoreVersionErrorActivity",h.a,[]);class u extends f.a{constructor(Lb,pc){super();this.activityName=Lb;this.cK=pc;this.Fb()}create(){this.ob(new r(this.activityName,this.cK))}static la(Lb){Lb.da.Ga(321,new u(n.a.GPd,n.a.gj))}}Object(b.a)(u,"RestoreVersionErrorActivityFactory",f.a,[]);var v=a(80),B=a(695),z=a(48),A=a(37),y=a(184),D=a(375),I=a(55);class M{constructor(Lb,pc){this.$=Lb;this.D3j=pc}nc(){return e.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(d.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(Lb,pc){d.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");Lb=!1;switch(pc.command){case -1112508866:D.a(this.$)&&this.$.da.Aa(423).SAc(!1),Lb=this.D3j.nJj()}d.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${Lb}.`);return Lb?I.Task.Ra(Lb):y.a(pc.command)}yc(Lb,pc){return-1112508866===pc.command&&this.$.isVersionHistoryEnabled()}Lc(){return!1}}
Object(b.a)(M,"VersionHistoryCommandHandler",null,[219]);var T=a(7),S=a(253),H=a(164),C=a(386);class G{static addAppPLTEventToLog(Lb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(Lb)}catch(pc){}}static setIsPageLoadForFirstTime(Lb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(Lb)}catch(pc){}}}Object(b.a)(G,"VersionHistoryLogConnector",null,[]);var J=a(27),L=a(824),P=a(1241),aa=a(154),U=a(92),K=a(29),Y=a(1),na=a(44),W=a(251),X=a(986),Aa=
a(260),Q=a(248),fa=a(12);class Ca{constructor(Lb){this.Zw=Lb}di(){Aa.a(this.Zw.$).oB(this.he)||Aa.a(this.Zw.$).di(this)}q8(){Aa.a(this.Zw.$).oB(this.he)&&Aa.a(this.Zw.$).aA(this)}get he(){return Q.a.Kmg}get mc(){return document.querySelector('[id="vhHeader"]')}get Hf(){return!0}nh(Lb){return fa.DOMElementExtensions.Af(this.mc,Lb)}qj(){this.Zw.$.frame.Le.vk(this.Zw.$.frame.Le.pF)}dk(){}kg(Lb,pc){pc||this.Zw.CQb.then(Ha=>{Ha.enterHeaderFocusTrapZone();return null});return!pc}}Object(b.a)(Ca,"VersionHistoryHeader",
null,[66]);class ia{constructor(Lb){this.Zw=Lb}di(){Aa.a(this.Zw.$).oB(this.he)||Aa.a(this.Zw.$).di(this)}q8(){Aa.a(this.Zw.$).oB(this.he)&&Aa.a(this.Zw.$).aA(this)}get he(){return Q.a.Lmg}get mc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get Hf(){return!0}nh(Lb){return fa.DOMElementExtensions.Af(this.mc,Lb)}qj(){this.Zw.$.frame.Le.vk(this.Zw.$.frame.Le.pF)}dk(){}kg(Lb,pc){pc||this.Zw.CQb.then(Ha=>{Ha.enterFocusTrapZone();return null});return!pc}}Object(b.a)(ia,"VersionHistoryPane",
null,[66]);class Ra{constructor(Lb){this.Zw=Lb}di(){Aa.a(this.Zw.$).oB(this.he)||Aa.a(this.Zw.$).di(this)}q8(){Aa.a(this.Zw.$).oB(this.he)&&Aa.a(this.Zw.$).aA(this)}get he(){return Q.a.Mmg}get mc(){return document.querySelector('[id="vhViewer"]')}get Hf(){return!0}nh(Lb){return fa.DOMElementExtensions.Af(this.mc,Lb)}qj(){this.Zw.$.frame.Le.vk(this.Zw.$.frame.Le.pF)}dk(){}kg(Lb,pc){pc||this.Zw.CQb.then(Ha=>{Ha.enterViewerFocusTrapZone();return null});return!pc}}Object(b.a)(Ra,"VersionHistoryViewer",
null,[66]);var Ya=a(143),Ga=a(254),da=a(70),Z=a(426),ha=a(763);class Wa{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(b.a)(Wa,"AppBootSettings",null,[]);class ca{constructor(){this.rootDiv=this.appBootSettings=null}}Object(b.a)(ca,"AppVersionControllerFactoryParameters",null,[]);class ja{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=null}}Object(b.a)(ja,"OnVersionSelectedParams",null,[]);class ua{constructor(){this.appName=
0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=!1;this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}
Object(b.a)(ua,"AppSettings",null,[]);class Za{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(b.a)(Za,"ControllerFactoryParameters",null,[]);var Pa;(function(Lb){Lb[Lb.none=0]="none";Lb[Lb.vhUnknown=1]="vhUnknown";Lb[Lb.vhFailedToLoadVersionList=100]="vhFailedToLoadVersionList";Lb[Lb.vhFailedToGetDownloadToken=101]="vhFailedToGetDownloadToken";Lb[Lb.vhFailedToParseVersionList=102]="vhFailedToParseVersionList";
Lb[Lb.vhFetchFailed=103]="vhFetchFailed";Lb[Lb.vhVersioningNotEnabled=104]="vhVersioningNotEnabled";Lb[Lb.vhFileNotFound=105]="vhFileNotFound";Lb[Lb.vhVersionTooOld=106]="vhVersionTooOld";Lb[Lb.vhFetchException=107]="vhFetchException";Lb[Lb.vhServiceUnavailable=108]="vhServiceUnavailable";Lb[Lb.vhBadGateway=109]="vhBadGateway";Lb[Lb.vhUnauthorized=110]="vhUnauthorized";Lb[Lb.vhInternalServerError=111]="vhInternalServerError";Lb[Lb.vhEmptyVersionMetadatas=112]="vhEmptyVersionMetadatas";Lb[Lb.vhFailedHostDownload=
113]="vhFailedHostDownload";Lb[Lb.vhFailedToAddDownloadToVersionStore=114]="vhFailedToAddDownloadToVersionStore";Lb[Lb.vhFailedToCacheParts=115]="vhFailedToCacheParts";Lb[Lb.vhFailedToDownloadVersionMetadata=116]="vhFailedToDownloadVersionMetadata";Lb[Lb.vhFailedToDownloadParts=117]="vhFailedToDownloadParts";Lb[Lb.vhInvalidDocID=118]="vhInvalidDocID";Lb[Lb.vhMissingDocID=119]="vhMissingDocID";Lb[Lb.vhNullDocID=120]="vhNullDocID";Lb[Lb.vhNullHashedDocID=121]="vhNullHashedDocID";Lb[Lb.vhNullGetDownloadAccessTokenRequest=
122]="vhNullGetDownloadAccessTokenRequest";Lb[Lb.vhFailedToDownloadVersionFromHost=123]="vhFailedToDownloadVersionFromHost";Lb[Lb.vhNullResponseFromFetch=124]="vhNullResponseFromFetch";Lb[Lb.vhGetTipVersionException=125]="vhGetTipVersionException";Lb[Lb.vhGetVersionsException=126]="vhGetVersionsException";Lb[Lb.vhGetDownloadTokenException=127]="vhGetDownloadTokenException";Lb[Lb.vhFetchRetryException=128]="vhFetchRetryException";Lb[Lb.vhNullResponseFromRequestVersionHistory=129]="vhNullResponseFromRequestVersionHistory";
Lb[Lb.vhNullResponseFromRequestDownloadToken=130]="vhNullResponseFromRequestDownloadToken";Lb[Lb.vhXhrJsonParseFailed=131]="vhXhrJsonParseFailed";Lb[Lb.vhXhrException=132]="vhXhrException";Lb[Lb.vhNullResponseFromXhr=133]="vhNullResponseFromXhr";Lb[Lb.vhFileGone=134]="vhFileGone";Lb[Lb.vhNullRevisionIDs=135]="vhNullRevisionIDs";Lb[Lb.vhRequestDeleteVersionsException=136]="vhRequestDeleteVersionsException";Lb[Lb.vhNullResponseFromRequestDeleteVersions=137]="vhNullResponseFromRequestDeleteVersions";
Lb[Lb.vhVersionInfoFromTipVersionException=138]="vhVersionInfoFromTipVersionException"})(Pa||(Pa={}));Object(b.b)("VersionHistoryFullAppErrorCode",Pa);var ka=a(304);class ra{constructor(Lb){this.baseVersionInfo=this.a4=this.upa=this.xl=this.ewaAccessibilityManager=this.CQb=null;this.kMd=this.Eyf=!1;this.eLe=!0;this.dialog=this.accessTokenExpirationManager=this.eC=this.LZe=this.dE=this.v3d=this.t3d=this.u3d=null;this.nIf=pc=>{d.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");
if(this.aGj()){var Ha=bc=>{m.c(2138207060,!1);this.xl.setRestoreFailedAtServer(bc)};this.dE&&this.dE.startTimer(ra.ifg);var Bb=()=>{this.dE.endTimer(ra.ifg);this.kCe(this.dE)};this.xl.setRestoreInProgress();na.a(this.$).Ns(new W.a(n.a.ky,5,()=>{const bc=da.a(this.$).hd.activityState;bc[Ga.a.Jq]=n.a.aFe;bc[Ya.a.PY]=!0;bc[Ya.a.VT]=0;bc[w.Nmg]=pc;bc[w.Xtc]=e.AFrameworkApplication.Hi;bc[w.oyd]=Bb;bc[r.V$f]=Ha;Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",
!1)&&(bc[ka.a.dGd]=!0)}))}else m.c(2138207060,!1)};this.TKf=pc=>{this.CQb.then(Ha=>{Ha.enterFocusTrapZone();return null});d.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.dE.endTimer(ra.b_d);this.dE.incrementCounter(ra.Qah);d.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.dE.getTimerDuration(ra.b_d)}`);this.fnj(pc.containerDiv);pc.versions&&0<pc.versions.length&&(this.LZe=ra.AF(pc.versions[pc.versions.length-
1]));this.a4&&this.upa&&this.sRd(this.a4);d.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=pc=>{d.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${ra.AF(pc.currentVersion)}, LastSelected:${ra.AF(this.a4)}`);this.dE.incrementCounter(ra.Pah);this.a4=pc.currentVersion;this.baseVersionInfo=pc.baseVersion;this.Eyf=pc.noBaseToCompareTo;this.upa&&this.W2j()&&(this.sRd(pc.currentVersion),d.ULS.sendTraceTag(537150344,
0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.SCf=pc=>{d.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===pc||void 0===pc?0:pc.versionSelected)?ra.AF(pc.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===pc||void 0===pc?0:pc.updatedVersions)?pc.updatedVersions.length:0}, LastSelected:${ra.AF(this.a4)}`);this.dE.incrementCounter(ra.Oah);if(this.baseVersionInfo){if((null===pc||void 0===pc?0:pc.updatedVersions)&&
2<=pc.updatedVersions.length){let Ha=null,Bb=null;const bc=ra.AF(this.a4),tc=ra.AF(this.baseVersionInfo);for(const Zc of pc.updatedVersions)if(pc=ra.AF(Zc),bc===pc?Ha=Zc:tc===pc&&(Bb=Zc),Ha&&Bb)break;Ha&&Bb?(this.a4=Ha,this.baseVersionInfo=Bb,d.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${ra.AF(this.a4)}, RevisionID[N-1]: ${ra.AF(this.baseVersionInfo)}.`),this.sRd(this.a4)):d.ULS.sendTraceTag(537150306,
0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${bc}, RevisionID[N-1]: ${tc}.`)}else d.ULS.sendTraceTag(537150305,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");d.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else d.ULS.sendTraceTag(537150336,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};
this.QBf=()=>{d.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");this.p6g();const pc=new U.a(1470556788,0,this.$.Hc,0,null);this.$.Ka.Lb(pc)};this.EIf=pc=>{d.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let Ha=new U.a(-1244760097,0,this.$.Hc,0,null);this.$.me.get(51)&&(d.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),Ha=new U.a(-309686558,0,this.$.Hc,0,null));m.c(1604651619,!0);
this.$.Ka.Lb(Ha,{["FileDownloadUrl"]:pc})};this.TCf=pc=>{d.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");if(!Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.$Fj())pc=new S.QueryStringBuilder(pc),pc.oj("fn",e.AFrameworkApplication.fileName),d.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+pc.toString().length),8===this.$.frame.F$a(pc.toString(),!0)?(d.ULS.sendTraceTag(587830283,0,10,
"VersionHistoryPaneActor:OnDownloadVersion failed"),m.c(1316171850,!1)):m.c(1316171850,!0)};this.wAf=pc=>{this.xl.setFullAppErrorCode(pc);Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&this.xl.setViewerError(!0)};this.Hxe=pc=>{const Ha=document.getElementById(ra.YWe);!Ha||this.eC&&!pc||(d.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.eC=new X.a(Ha.contentWindow,v.a.nba(this.$.ya.VersionHistoryActionUrl)||
ha.a.r$),this.eC.em(H.a.HVa,this.yJb),this.eC.em(H.a.IVa,this.yJb),this.eC.vo(X.a.setCurrentChangeCount),this.eC.vo(X.a.setTotalChangesCount),Y.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.eC.vo(X.a.mQa),this.eC.em(X.a.setCurrentChangeCount,this.yJb),this.eC.em(X.a.setTotalChangesCount,this.yJb),Y.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.eC.em(X.a.mQa,this.yJb))};this.fEf=pc=>{if(Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes"))pc=
Pa[pc]?Pa[pc]:"None";else switch(pc){case 101:pc="VHFailedToGetDownloadToken";break;case 100:pc="VHFailedToLoadVersionList";break;case 104:pc="VHVersioningNotEnabled";break;case 105:pc="VHFileNotFound";break;case 106:pc="VHVersionTooOld";break;default:pc="None"}this.dE.addEvent("OnFullAppError",pc);d.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${pc}`)};this.EFd=pc=>{this.eLe=pc;d.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${pc.toString()}`);this.PRd(X.a.eQb,
{["ToggleValue"]:pc})};this.yFf=pc=>{d.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${pc}`);m.c(1488635506,!0);const Ha={};pc?this.PRd(X.a.iterateNext,Ha):this.PRd(X.a.$xa,Ha)};this.yJb=pc=>{switch(pc.MessageId){case H.a.HVa:d.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");Y.EwaSettings.oa(394)&&this.xl.setVersionLoadComplete();break;case H.a.IVa:d.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");
break;case X.a.setCurrentChangeCount:pc=pc.Values.count;d.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${pc}`);this.xl.setCurrentChangeCount(pc);break;case X.a.setTotalChangesCount:pc=pc.Values.count;d.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${pc}`);this.xl.setTotalChangesCount(pc);break;case X.a.mQa:this.EFd(this.eLe);break;default:d.ULS.sendTraceTag(537150286,
0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${pc.MessageId}`)}};this.$=Lb;this.lac=this.$.Eb+ra.PDh;this.jMd=!1;Y.EwaSettings.oa(362)&&this.cih();Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.$.da.fb(38,pc=>{this.accessTokenExpirationManager=pc;this.kQa=this.kQa.bind(this);this.accessTokenExpirationManager.$ob(this.kQa)});this.tDb="";this.jwd=0;this.perfTelemetryInfos=[]}kQa(){null!=this.xl&&(this.xl.updateDocId(e.AFrameworkApplication.Hi),
d.ULS.sendTraceTag(509699330,0,50,"VersionHistoryPaneActor:onTokenRefreshed completed Successfully"))}dispose(){Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.accessTokenExpirationManager.Pvc(this.kQa);this.MDe()}G5i(){this.$.da.fb(15,Lb=>{this.ewaAccessibilityManager=Lb;this.ewaAccessibilityManager.mode=2})}cih(){this.u3d=new ia(this);this.t3d=new Ca(this);this.v3d=new Ra(this)}nJj(){d.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");
e.AFrameworkApplication.ZN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");e.AFrameworkApplication.ZN("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");e.AFrameworkApplication.ZN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryRestoreSkipCoauthCheck");e.AFrameworkApplication.Hs("8492a557;72ff4572");this.dE=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.dE.startTimer(ra.hfg);
if(!this.xl&&(Z.a(()=>{this.xl=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(T.a)(new Za,{ulsLogger:new C.a,docId:e.AFrameworkApplication.Hi,appSettings:Object(T.a)(new ua,{appName:120,userSessionId:e.AFrameworkApplication.userSessionId,wdEnableSaveACopy:Y.EwaSettings.oa(332),wdEnableDownloadTokens:Y.EwaSettings.oa(327),wacCluster:e.AFrameworkApplication.zd.vP,uiLocale:e.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:Y.EwaSettings.oa(299)&&this.$.isEditMode,wdEnableIterator:Y.EwaSettings.oa(296)&&
Y.EwaSettings.oa(297),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:Y.EwaSettings.oa(394),disableSaveACopy:this.ZUd(),wdEnableShowVersionChanges:Y.EwaSettings.oa(296)&&Y.EwaSettings.oa(298),disabledChangeGates:this.$.ya.VHSDisabledChangeGates,wdEnableSaveACopyOverFlowMenu:Y.EwaSettings.oa(502),isRtl:e.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),
!this.xl))return d.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),m.c(429638140,!1),!1;this.oJj();this.dE.endTimer(ra.hfg);this.dE.startTimer(ra.kfg);d.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");m.c(429638140,!0);return!0}oJj(){var Lb;this.Pfj();if(!document.getElementById(this.lac)){const pc=document.createElement("div");pc.id=this.lac;pc.style.width=
"100%";pc.style.zIndex="998";pc.style.display="block";pc.style.position="absolute";if(e.AFrameworkApplication.ta.Pa.Pe){const Ha=(null===(Lb=document.getElementById("HeaderRegion"))||void 0===Lb?void 0:Lb.offsetHeight)||0;pc.style.top=Ha+"px";pc.style.bottom="0px";pc.style.height=`calc(100vh - ${Ha}px)`}else pc.style.height="100%";this.$.ur.insertBefore(pc,this.$.ur.firstChild);this.CQb=this.xl.createVersionHistoryDialog(pc)}document.getElementById(this.lac).style.display="block";this.ZLd();this.dE.startTimer(ra.b_d);
this.xl.getVersions("")}ZLd(){Y.EwaSettings.oa(362)&&(this.u3d.di(),this.t3d.di(),this.v3d.di(),this.G5i())}s1d(){Y.EwaSettings.oa(362)&&(this.u3d.q8(),this.t3d.q8(),this.v3d.q8(),this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=0))}Pfj(){this.xl.getVersionsReadyEvent().addListener(this.TKf);this.xl.getVersionSelectedEvent().addListener(this.onVersionSelected);this.xl.getCloseSelectedEvent().addListener(this.QBf);this.xl.getFullAppErrorEvent().addListener(this.fEf);this.xl.getIteratorSelectedEvent().addListener(this.yFf);
this.xl.getShowVersionChangesToggledEvent().addListener(this.EFd);Y.EwaSettings.oa(327)&&(this.xl.getDownloadTokenReadyEvent().addListener(this.SCf),this.jMd=!0);Y.EwaSettings.oa(332)&&(this.xl.getSaveACopySelectedEvent().addListener(this.EIf),this.xl.getDownloadVersionSelectedEvent().addListener(this.TCf));Y.EwaSettings.oa(299)&&this.$.isEditMode&&(this.xl.getRestoreVersionSelectedEvent().addListener(this.nIf),this.kMd=!0)}Qfj(){this.upa.getAppErrorEvent().addListener(this.wAf)}gk(){this.xl.getVersionsReadyEvent().removeListener(this.TKf);
this.xl.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.xl.getCloseSelectedEvent().removeListener(this.QBf);this.xl.getFullAppErrorEvent().removeListener(this.fEf);this.xl.getIteratorSelectedEvent().removeListener(this.yFf);this.xl.getShowVersionChangesToggledEvent().removeListener(this.EFd);Y.EwaSettings.oa(332)&&(this.xl.getSaveACopySelectedEvent().removeListener(this.EIf),this.xl.getDownloadVersionSelectedEvent().removeListener(this.TCf));this.jMd&&(this.xl.getDownloadTokenReadyEvent().removeListener(this.SCf),
this.jMd=!1);this.kMd&&(this.xl.getRestoreVersionSelectedEvent().removeListener(this.nIf),this.kMd=!1);this.upa&&this.upa.getAppErrorEvent().removeListener(this.wAf)}PDj(){return this.ZUd()||!e.AFrameworkApplication.LZ}$Fj(){return this.PDj()?(d.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),m.c(1316171850,!1),!1):!0}aGj(){let Lb=!0;if(Y.EwaSettings.oa(562)&&!this.$.JN)return d.ULS.sendTraceTag(537150350,0,15,"VersionHistoryPaneActor:ShouldTriggerRestore - Skipping coauth check with status "+
this.$.ea.amIAlone.toString()),!0;if(!this.$.ea.amIAlone&&!Y.EwaSettings.oa(295)){this.YAi();this.xl.setCoauthRestoreError();Lb=!1;const pc=new U.a(-729359593,0,this.$.Hc,0,null);this.$.Ka.Lb(pc)}this.$.JN&&(d.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),Lb&&(Lb=!1,this.mJj()));return Lb}mJj(){var Lb=K.a.dd(1,0,1894,1893,0,-1603358883,"RestoreVersionUnsavedChangesError");Lb=this.dialog||new aa.ErrorDialog(this.$,Lb);Lb.initialize();
Lb.vg()}W2j(){d.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?ra.AF(this.baseVersionInfo):""}`);if(ra.AF(this.a4)===this.LZe)return d.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(Y.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.Eyf)return d.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),
!0;if(!this.baseVersionInfo)return d.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const Lb=ra.KTh(this.baseVersionInfo);d.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${Lb?Lb.length:0}`);return Lb?!0:(d.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}ZUd(){return!this.$.nla}p6g(){document.getElementById(this.lac).style.display="none";const Lb=new U.a(-1423792966,0,
this.$.Hc,0,null);this.$.Ka.Lb(Lb);this.MDe()}MDe(){this.dE&&(this.dE.endTimer(ra.kfg),this.kCe(this.dE),this.dE=null);this.gk();this.s1d();this.perfTelemetryInfos&&(d.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(Lb=>JSON.stringify(Lb)).toString()),this.perfTelemetryInfos=null);this.eC&&(this.eC.jpa(H.a.HVa),this.eC.jpa(H.a.IVa),this.eC.jpa(X.a.setCurrentChangeCount),this.eC.jpa(X.a.setTotalChangesCount),Y.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.eC.jpa(X.a.mQa),this.eC.dispose(),this.eC=null)}fnj(Lb){try{this.upa?(G.setIsPageLoadForFirstTime(!1),Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&!document.getElementById(ra.YWe)&&(this.upa.resetContainer(Lb),this.Hxe(!0))):(G.setIsPageLoadForFirstTime(!0),Z.a(()=>{const pc=new Wa;pc.ulsLogger=new C.a;pc.actionUrl=this.$.ya.VersionHistoryActionUrl;pc.hideEmbedFooter=!0;pc.useFetch=Y.EwaSettings.oa(389)&&!J.a.Lw;this.upa=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(T.a)(new ca,
{appBootSettings:pc,rootDiv:Lb}))})),this.Qfj()}catch(pc){d.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${pc}`)}}sRd(Lb){d.ULS.sendTraceTag(537150298,0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${ra.AF(Lb)}, LastSelected:${this.tDb}`);if(Lb)if(ra.AF(Lb).length){var pc=(new Date).getTime();if(ra.AF(Lb)===this.tDb&&1E3>pc-this.jwd)d.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");
else{ra.AF(Lb)!==this.tDb&&(d.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.xl.setTotalChangesCount(-1),this.xl.setCurrentChangeCount(-1));var Ha=excelVersionHistory.FactoryGlobal.getTelemetryCollector();Ha.addEvent("SelectVersion",ra.AF(Lb));try{this.y5j(Ha);this.jwd=pc;this.tDb=ra.AF(Lb);const Bb=new ja;Bb.selectedVersionInfo=this.a4;Bb.baseVersionInfo=this.baseVersionInfo;Bb.telemetryCollector=Ha;this.upa.onVersionSelectedWithParams(Bb);
this.xl&&Y.EwaSettings.oa(332)&&this.xl.setDisableSaveACopy(this.ZUd());this.Hxe(!1)}catch(Bb){this.jwd=0,this.tDb="",Ha.addEvent("Exception",Bb.toString()),d.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${Bb}`)}finally{d.ULS.sendTraceTag(537150292,0,50,Ha?Ha.getJsonForLogging():"")}}}else d.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else d.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}y5j(Lb){for(const pc of this.perfTelemetryInfos){const Ha=
pc.TelemetryEventKey?pc.TelemetryEventKey:pc.telemetryEventKey?pc.telemetryEventKey:"",Bb=pc.TelemetryEventData?pc.TelemetryEventData:pc.telemetryEventData?pc.telemetryEventData:"";Ha&&Bb&&Lb.addEvent(Ha,Bb)}this.perfTelemetryInfos.length=0}kCe(Lb){d.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${Lb?Lb.getJsonForLogging():""} `)}YAi(){const Lb=this.$.ea.Wm,pc={};let Ha=null;for(const Bb of Lb)Bb.UserEmail&&(pc[Bb.UserEmail]=Bb.UserEmail in pc?pc[Bb.UserEmail]+
1:1),Bb.User.UserID===this.$.ea.clientId&&(Ha=Bb.UserEmail);d.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${Lb.length}, TotalAuthorsAsYourself ${Ha?pc[Ha]:-1}`)}PRd(Lb,pc){d.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${Lb}`);if(this.eC){Lb=new L.a(Lb);Lb.Values[P.a.d8c]=this.$.ya.UserSessionId;if(pc)for(let Ha in pc)Lb.Values[Ha]=pc[Ha];this.eC.send(Lb)}else d.ULS.sendTraceTag(537150284,
0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static AF(Lb){return Lb?Lb.RevisionID?Lb.RevisionID:Lb.revisionID?Lb.revisionID:"":""}static KTh(Lb){return Lb?Lb.DownloadUrl?Lb.DownloadUrl:Lb.downloadUrl?Lb.downloadUrl:"":""}}ra.PDh="_excelVersionHistoryOverlay";ra.YWe="vhs_frame";ra.hfg="TimeTakenShowVersionHistoryDialogAction";ra.kfg="TimeTillVersionHistoryDialogWasOpenMs";ra.b_d="TimeTakenGetVersionsToOnVersionsReady";ra.Pah="CountOnVersionSelectedCalledinOneVHSession";
ra.Qah="CountOnVersionsReadyCalledinOneVHSession";ra.Oah="CountOnDownloadTokenReadyCalledinOneVHSession";ra.ifg="TimeTakenVersionRestore";Object(b.a)(ra,"VersionHistoryPaneActor",null,[3]);var ba=a(185);class Ua extends B.a{constructor(Lb){super(Lb)}ld(){const Lb=this.hAi(),pc=z.GetServiceTaskFactory.Na(this.$.da,21,137,this.Ya);A.TaskExtensions.za(A.TaskExtensions.Ed([Lb,pc],this.ka,3),()=>{var Ha=pc.result;const Bb=v.a.nba(this.$.ya.VersionHistoryActionUrl);Bb!==ha.a.r$&&Ha.CGa(Bb);Ha=new ra(this.$);
this.Zc([new M(this.$,Ha)])},this.ka,3)}hAi(){const Lb=z.GetServiceTaskFactory.mka(this.$.da,283,284,this.Ya).then(pc=>pc.kn.loadScript("excelVersionHistory"),pc=>{d.ULS.sendTraceTag(537150412,0,10,`versionHistoryManagerFactory: Dynamic Script Loading failed due to exception. ${pc}`);return Promise.reject(pc)});return ba.c(Lb)}static la(Lb){B.a.Nd(304,new Ua(Lb))}}Object(b.a)(Ua,"VersionHistoryCommandHandlerFactory",B.a,[]);var Ka=a(1263),Oa=a(698);class ib extends f.a{constructor(Lb){super();this.$=
Lb;this.Fb()}create(){const Lb=z.GetServiceTaskFactory.Na(this.$.da,211,212,this.Ya),pc=z.GetServiceTaskFactory.Na(this.$.da,21,137,this.Ya);A.TaskExtensions.za(A.TaskExtensions.Ed([Lb,pc],this.$.ka),()=>{const Ha=Object(Oa.a)(this.$.da,305,()=>new Ka.a(this.$,!0,pc.result,Lb.result));this.ob(Ha)},this.$.ka,3)}static la(Lb){Lb.da.Ga(306,new ib(Lb))}}Object(b.a)(ib,"VersionHistoryHighlightManagerFactory",f.a,[]);var La=a(513),db=a(5),Ab=a(161),Mb=a(13);class pb extends h.a{constructor(Lb,pc,Ha){super(Lb,
pc);this.lineageManager=Ha}execute(Lb){this.lineageManager.lineageHidePreviousHistory();return super.execute(Lb)}}Object(b.a)(pb,"LineageClearHistoryConfirmedActivity",h.a,[]);var Qb=a(17),xb=a(141);class pa{constructor(Lb,pc){this.$=Lb;this.lineageManager=pc;Lb=[new Qb.a(n.a.Xwd,1038647878,0,0,2238),new Qb.a(n.a.idle,1038647878,0,1)];da.a(this.$).MLd(new xb.a(n.a.Wwd,n.a.idle,Lb),new pb(n.a.Xwd,n.a.idle,pc))}nc(){return!1}executeCommand(Lb,pc,Ha){Lb=!1;switch(pc.command){case 1834994092:9===pc.We&&
this.JOj();this.PGj(pc,Ha);Lb=!0;break;case -409942531:this.RGj(),Lb=!0}return Lb?I.Task.Ra(!0):y.a(pc.command)}yc(Lb,pc){return 1834994092===pc.command||-409942531===pc.command}Lc(){return!1}PGj(Lb,pc){d.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${pc.MenuItemId||Lb.We}`);this.lineageManager.t$f(19===Lb.We&&!!pc.MenuItemId,pc.MenuItemId,Lb.We,pc)}JOj(){const Lb=db.a.ouc;Lb!==Ab.a(this.$).Qn.fA&&Ab.a(this.$).Qn.activateRibbonTab(Lb)}RGj(){na.a(this.$).Ns(new W.a(n.a.Wwd,
5,()=>{const Lb=da.a(this.$).hd,pc=K.a.dd(3,1,2235,2236,2237,1038647878,"LineageConfirmClearHistory");pc.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";pc.HelpDescription=Mb.a.instance.ga(1315);Lb.qr([pc])}))}}Object(b.a)(pa,"LineageActivityCommandHandler",null,[219]);class Ma extends B.a{constructor(Lb){super(Lb)}ld(){A.TaskExtensions.za(z.GetServiceTaskFactory.Na(this.$.da,366,367,this.Ya),Lb=>{this.Zc([new pa(this.$,Lb.result)])},this.ka,3)}static la(Lb){B.a.Nd(363,new Ma(Lb))}}Object(b.a)(Ma,
"LineageActivityCommandHandlerFactory",B.a,[]);class ya{constructor(Lb){this.RTa=!0;ya.dif()?ya.zli()?this.RTa=!1:ya.nif()?(d.ULS.sendTraceTag(526434368,0,50,`LineageCatchUpExperimentManager is running in hybrid mode. TUI exhausted: ${!Lb}`),this.RTa=Lb):this.RTa=!1:this.RTa=!0}a8a(){return!this.RTa}static nif(){return ya.dif()&&Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationTeachingUXTreatmentToControl",!1)}static dif(){return Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationSummaryStringTreatment",
!1)}static zli(){return Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)}}Object(b.a)(ya,"LineageCatchUpExperimentManager",null,[491]);class Ea extends f.a{constructor(Lb){super();this.$=Lb;this.Fb()}create(){ya.nif()?A.TaskExtensions.za(z.GetServiceTaskFactory.Na(this.$.da,456,457,this.Ya),Lb=>{A.TaskExtensions.za(Lb.result.mFj(),pc=>{this.VIe(pc.result)},this.$.ka,3)},this.$.ka,3):this.VIe(!0)}VIe(Lb){this.ob(this.$.da.Aa(458)||this.$.da.Ga(458,new ya(Lb)))}static la(Lb){Lb.da.Ga(459,
new Ea(Lb))}}Object(b.a)(Ea,"LineageCatchUpExperimentManagerFactory",f.a,[]);var Na=a(420),kb=a(33),lb=a(82),oa=a(147),Ba=a(120);class sa{}Object(b.a)(sa,"LineageClientParams",null,[]);class qb{}Object(b.a)(qb,"LineageFilter",null,[]);var Jb=a(66),Yb=a(76),jb=a(131),ab=a(40),vb=a(188),Da=a(116),Fa=a(109),nb=a(283),Ta=a(282),V=a(21),va=a(132),wb=a(60);const fc=(Lb,pc,Ha,Bb,bc,tc,Zc,wd=null)=>{wd=Lb.Oa(1,wd);wd.clientParams=pc;wd.lineageFilter=Ha;return wb.g(Lb,"LineageOpenPaneOrChangeFilter",wd,Bb,
bc,tc,Zc,0)},Fc=(Lb,pc,Ha,Bb,bc,tc,Zc=null)=>{Zc=Lb.Oa(1,Zc);Zc.fetchFromBelow=pc;return wb.g(Lb,"LineageLoadMore",Zc,Ha,Bb,bc,tc,0)},Qa=(Lb,pc,Ha,Bb,bc,tc=null)=>{tc=Lb.Oa(1,tc);return wb.g(Lb,"LineageRefreshView",tc,pc,Ha,Bb,bc,0)},la=(Lb,pc,Ha,Bb,bc,tc=null)=>{tc=Lb.Oa(1,tc);return wb.g(Lb,"LineageUpdateView",tc,pc,Ha,Bb,bc,0)},hb=(Lb,pc,Ha,Bb,bc,tc=null)=>{tc=Lb.Oa(1,tc);return wb.g(Lb,"LineageClosePane",tc,pc,Ha,Bb,bc,0)},Kb=(Lb,pc,Ha,Bb,bc,tc=null)=>{tc=Lb.Oa(1,tc);return wb.g(Lb,"LineageHidePreviousHistory",
tc,pc,Ha,Bb,bc,0)},dc=(Lb,pc,Ha,Bb,bc,tc=null)=>{tc=Lb.Oa(1,tc);return wb.g(Lb,"LineageLoadInGridBlueDots",tc,pc,Ha,Bb,bc,0)};var sb=a(51),bb=a(347);class Ob{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(b.a)(Ob,"LineageActivitiesResponseDTO",
null,[]);class gc extends Ob{constructor(){super();this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(b.a)(gc,"LineageActivitiesUpdateResponseDTO",Ob,[]);class mb{constructor(){this.shouldShowBlueDot=this.onDisplayInGridHighlightsChanged=this.areInGridHighlightsEnabled=this.areInGridHighlightsAvailable=this.onDegradedCardGiveFeedbackButtonClicked=this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=
this.onCardSelected=this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(b.a)(mb,"LineageAppCallbacks",null,[]);class Nb{constructor(){this.imageUrl=this.email=this.displayName=this.provider=this.id=null}}Object(b.a)(Nb,"LineageAuthorDTO",null,[]);class ic{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(b.a)(ic,
"LineageControllerFactoryParams",null,[]);class gb{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(b.a)(gb,"LineageSharedRangeDTO",null,[]);class Eb{constructor(){this.sheetName=this.rangeList=null}}Object(b.a)(Eb,"LineageSheetMultiRangeDTO",null,[]);class Lc{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=
this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(b.a)(Lc,"LineageUserActivityDTO",null,[]);class Ec{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(b.a)(Ec,"LineageValueChangeDTO",null,[]);var Cb;(function(Lb){Lb[Lb.default=0]="default";Lb[Lb.D48X48=1]="D48X48";Lb[Lb.D64X64=2]="D64X64";Lb[Lb.D96X96=3]="D96X96";Lb[Lb.D120X120=4]="D120X120";Lb[Lb.D240X240=5]="D240X240";Lb[Lb.D360X360=6]="D360X360";Lb[Lb.D432X432=7]="D432X432";
Lb[Lb.D504X504=8]="D504X504";Lb[Lb.D648X648=9]="D648X648"})(Cb||(Cb={}));Object(b.b)("ProfilePhotoDimension",Cb);const eb=(Lb,pc)=>{let Ha=[];for(const Nd of Lb){Lb=Nd;var Bb=pc,bc=Object(T.a),tc=new Lc,Zc=Number.parseLocale(Lb.UserActivity.Id),wd=Lb.Uid,Ld=Lb.UserActivity.Type;var ae=Lb.UserActivity.Person;var ne=Bb;if(ae){var xe=null;e.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(xe=ne.Uta(ae.Email,ae.Provider,e.AFrameworkApplication.Hi,Cb.default));ae=Object(T.a)(new Nb,
{id:ae.Id,provider:ae.Provider,displayName:ae.DisplayName,email:ae.Email,imageUrl:xe})}else ae=null;ne=Lb.SheetName;xe=new Date(Lb.UserActivity.DisplayTimestamp);var Fe=Lb.DisplayLocation,Ke=Lb.LineageValueChangeList;var Ja=[];for(const le of Ke)Ke=Object(T.a)(new Ec,{hasNewValue:le.HasNewValue,hasOldValue:le.HasOldValue,newValue:le.HasNewValue?le.NewValue:null,oldValue:le.HasOldValue?le.OldValue:null,cellLocation:le.CellLocation}),Ja.push(Ke);Ke=Lb.IsBulkEditOverFlow;a:{var Gb=Lb.UserActivity.LocationList;
var xc=Lb.UserActivity.Type;if(!Gb){d.ULS.sendTraceTag(512259102,0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");xc=null;break a}if(!Gb.length){d.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");xc=null;break a}var Tc=[],td=[];let le="";21===xc?td.push(Gb[0]):td=Gb;for(const me of td)switch(me.Type){case 1:break;case 2:le=me.SheetName;break;case 0:Gb=me;if(!Gb.RangeList){d.ULS.sendTraceTag(512259099,0,50,
"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");break}le=Gb.RangeList[0].SheetName;td=[];21===xc?td.push(Gb.RangeList[0]):td=Gb.RangeList;for(const df of td)Gb=Object(T.a)(new gb,{firstCol:df.FirstColumn,firstRow:df.FirstRow,lastRow:df.LastRow,lastCol:df.LastColumn}),Tc.push(Gb);break;default:d.ULS.sendTraceTag(512259098,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",me.Type)}xc=Object(T.a)(new Eb,{sheetName:le,rangeList:Tc})}Bb=(Tc=
Lb.NestedActivityList)?eb(Tc,Bb):null;Lb=bc(tc,{activityId:Zc,activityGuid:wd,activityType:Ld,author:ae,sheetName:ne,displayTimestamp:xe,gridLocation:Fe,valueChanges:Ja,isBulkEditOverflow:Ke,rangeHighlightLocation:xc,nestedActivityList:Bb,degradedCardTypeBits:Lb.DegradedCardTypeBits});25===Lb.activityType?(bc=[],Sb(Lb,bc),Ha=[...Ha,...bc]):Ha.push(Lb)}return Ha},Sb=(Lb,pc)=>{25===Lb.activityType?Lb.nestedActivityList.forEach(Ha=>{Ha&&Sb(Ha,pc)}):pc.push(Lb)};class ld{constructor(Lb,pc,Ha,Bb,bc){this.g4a=
this.UF=null;this.JE=this.$wd=0;this.MGb=()=>{this.U7&&(this.U7.stop(),this.U7=null);this.fOb.start();this.UF.createLineageTaskPane(this.Vwd,this.g4a,this.activityGuid)};this.lineageOpenPaneOrChangeFilterRequest=(tc,Zc)=>{this.fOb.stop();va.b(this.$).vd(jb.a.cVi,{});this.LWd();const wd=Object(T.a)(new sa,{ClientViewCapacity:tc.clientViewCapacity});let Ld=null;Zc&&(Ld=Object(T.a)(new qb,{FilterSheetMultiRange:this.zTj(Zc.filterSheetMultiRange)}));const ae=ne=>{ne=Da.a.Oe(ne.data);d.ULS.sendTraceTag(537155481,
0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${K.a.sc(ne)}]`)};this.$.userOperationManager.Ic(new vb.a(1010,0,(ne,xe,Fe)=>fc(this.$.pa.xa,wd,Ld,Ta.b(ne,this.Eid("LineageOpenPaneOrChangeFilter")),Ta.a(xe,ae),Fe,null),80),null)};this.lineageLoadMoreRequest=tc=>{va.b(this.$).vd(jb.a.bVi,{});const Zc=wd=>{wd=Da.a.Oe(wd.data);d.ULS.sendTraceTag(537155480,0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${K.a.sc(wd)}]`)};this.$.userOperationManager.Ic(new vb.a(1011,
0,(wd,Ld,ae)=>Fc(this.$.pa.xa,tc,Ta.b(wd,this.Eid("LineageLoadMore")),Ta.a(Ld,Zc),ae,null),80),null)};this.lineageRefreshViewRequest=()=>{va.b(this.$).vd(jb.a.dVi,{});const tc=Zc=>{Zc=Da.a.Oe(Zc.data);d.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${K.a.sc(Zc)}]`)};this.$.userOperationManager.Ic(new vb.a(1012,0,(Zc,wd,Ld)=>Qa(this.$.pa.xa,Ta.b(Zc,this.Eid("LineageRefreshView")),Ta.a(wd,tc),Ld,null),80),null)};this.lineageUpdateViewRequest=()=>{la(this.$.pa.xa,
tc=>{if(tc=nb.a(tc)?null:tc.Result){var Zc={["CountOfUpdatedActivities"]:tc.LineageActivitiesResponse.ActivityList.length};va.b(this.$).vd(jb.a.eVi,Zc);tc=Object(T.a)(new gc,{activityList:Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?eb(tc.LineageActivitiesResponse.ActivityList,this.eAa):this.uJd(tc.LineageActivitiesResponse.ActivityList),latestActivityId:tc.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:tc.LineageActivitiesResponse.FirstSearchedActivityId,
serverMessageCode:tc.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(tc.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:tc.HasNewActivities,filterSheetMultiRange:this.pTj(tc.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:tc.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:tc.LineageActivitiesResponse.ServerLastActivityId,showLoadPrevious:tc.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:tc.LineageActivitiesResponse.EolCorrelationId,
eolDateHideHistory:new Date(tc.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.Sxb(tc.LineageActivitiesResponse.EolPersonHideHistory)});this.UF.onLineageActivitiesUpdateResponse(tc)}else d.ULS.shipAssertTag(537155475,0,!!tc,"LineageManager.LineageUpdateView returned null response.")},tc=>{tc=Da.a.Oe(tc.data);d.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${K.a.sc(tc)}]`)},null,null)};this.areInGridHighlightsAvailable=()=>
this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();this.onDisplayInGridHighlightsChanged=tc=>{this.blueDotManager&&this.blueDotManager.kyj(tc)};this.onCardSelected=(tc,Zc)=>{if(tc=tc.rangeHighlightLocation){if(Zc){let wd;if(({range:wd}=ab.Z(Zc,Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7236999_passEwaSheetsInLineageManager")?this.$.va:null)).returnValue){this.ydf(tc.sheetName,
this.O5a([ab.j(wd)]));return}d.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+Zc+" is not valid.")}tc.rangeList.length?this.ydf(tc.sheetName,tc.rangeList):this.vci(tc.sheetName)}};this.onLearnMoreLinkClicked=()=>{const tc=new U.a(-859308420,Yb.a.Db,this.$.Hc,12,null);this.$.Ka.Lb(tc,{[Yb.a.ng]:"HelpID=XLO_LineageTS",["InputMethod"]:Yb.a.Db,[Yb.a.Kc]:db.a.IV,["ShouldCanvasTakeFocus"]:!0})};this.onVersionHistoryButtonClicked=tc=>{this.$.Ka.Lb(new U.a(-1112508866,tc,this.$.Hc,
12,null))};this.onDegradedCardGiveFeedbackButtonClicked=()=>{const tc={};tc[db.a.LQ]="LineageDegradedCard";this.$.Xc(802602464,0,12,tc)};this.isFeatureEnabled=tc=>{switch(tc){case "FlattenListInLineageManager":return Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager");default:return!1}};this.Bf=()=>{const tc=this.$.ea.Lo.LineageVersion;tc!==this.$wd&&(d.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${tc}, this.lineageVersion: ${this.$wd}`),
this.$wd=tc,this.Hdj())};this.Tc=(tc,Zc)=>{this.UF&&!this.lineageTaskPane.qjc&&Zc.XH&&(d.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};this.Ro=()=>{this.UF&&!this.lineageTaskPane.qjc&&(d.ULS.sendTraceTag(587220562,0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.ND=()=>{const tc=this.S5a();this.UF.onFilterableSheetListChange(tc)};this.Aza=()=>{const tc=this.S5a();this.UF.onFilterableSheetListChange(tc)};
this.trc=()=>{const tc=this.S5a();this.UF.onFilterableSheetListChange(tc)};this.onPaneClosed=()=>{this.UF.onPaneClosed();hb(this.$.pa.xa,null,tc=>{tc=Da.a.Oe(tc.data);d.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${K.a.sc(tc)}]`)},null,null)};this.onRangeFilterInputEnabled=tc=>{tc?this.gridView.ha.bU(this.Pc):this.gridView.ha.iS(this.Pc)};this.Pc=()=>{var tc=ab.q(this.gridView.ha.ra.activeRange,this.$);tc=Object(T.a)(new Eb,{rangeList:this.O5a(tc.Ranges),
sheetName:tc.SheetName});this.UF.onSelectedRangeUpdated(tc)};this.tryParseRangeInfo=tc=>{let Zc;if(({sheetName:Zc,range:tc}=ab.Z(tc,this.$.va)).returnValue){Zc||(Zc=this.$.va.na.sheetName);const wd=[];wd.push(tc);tc=ab.u(Zc,null,wd);return Object(T.a)(new Eb,{rangeList:this.O5a(tc.Ranges),sheetName:tc.SheetName})}return null};this.Uz=()=>{const tc=this.JE!==this.$.ea.ye;this.UF&&this.lineageTaskPane.isVisible&&tc&&(this.JE=this.$.ea.ye,this.UF.onRefreshRequired())};this.$=Lb;pc.Ga(366,this);this.blueDotManager=
Bb;this.gridView=V.h(this.$);this.lineageTaskPane=Ha;this.Vwd=this.lineageTaskPane.cN();this.batchSize=50;this.U7=bc;this.fOb=this.$.Kb.Qg("UserAction","LineagePaneLoadingShimmerStopWatch");this.eAa=lb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Xgi();this.YIg()}dispose(){this.Kgj();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.JO(this.onPaneClosed),this.lineageTaskPane.lG(this.Uz),this.lineageTaskPane=null);this.fOb=this.eAa=this.g4a=this.Vwd=this.UF=null}t$f(Lb,
pc,Ha,Bb){this.activityGuid=null;if(this.lineageTaskPane.isVisible){if(9===Ha){d.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");return}if(!Lb&&16!==Ha&&18!==Ha&&30!==Ha){this.lineageTaskPane.h4c();return}}kb.a.gd(this.$)||(this.fOb.start(),this.U7&&(sb.b().BC(this.fOb.id,this.U7.id,"actions","actions"),this.U7.stop(),this.U7=null));this.lineageTaskPane.qjc||d.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${Lb?
pc:Ha}`);this.JE=this.$.ea.ye;this.g4a=null;Lb?(Lb=ab.r(this.gridView.ha.ra.selectedRanges,this.$),this.g4a=Object(T.a)(new Eb,{rangeList:pc.toString()===db.a.N9f?this.O5a(Lb.Ranges):null,sheetName:Lb.SheetName})):Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&30===Ha&&this.I6i(Bb);kb.a.gd(this.$)&&this.lineageTaskPane.qjc?this.lineageTaskPane.Eyj(this.MGb):this.UF.createLineageTaskPane(this.Vwd,this.g4a,this.activityGuid);this.lineageTaskPane.wg(!0);
this.$.Xc(-71295319,-1,0,null)}I6i(Lb){if(Lb){var pc=Lb.sheetName,Ha=Lb.gridLocation;Lb=Lb.activityGuid;if(pc&&Ha&&Lb){this.activityGuid=Lb;var Bb;({range:Bb}=ab.Z(Ha,this.$.va)).returnValue?this.g4a=Object(T.a)(new Eb,{rangeList:this.O5a([ab.j(Bb)]),sheetName:pc}):d.ULS.shipAssertTag(512266262,0,!1,"Blue dot sheetName/gridLocation is not valid.")}else d.ULS.shipAssertTag(509752709,0,!1,"Blue dot sheetName/gridLocation/activityGuid is not set.")}else d.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){const Lb=
{["paneVisible"]:this.lineageTaskPane.isVisible};oa.a.sendTelemetryEvent(Object(T.a)(new bb.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:Ba.a.Aj(Lb)}));this.$.userOperationManager.Ic(new vb.a(1018,0,(pc,Ha,Bb)=>Kb(this.$.pa.xa,pc,Ha,Bb,null),64),null);this.lineageTaskPane.isVisible||this.t$f(!1,null,4,void 0)}Xgi(){const Lb=Object(T.a)(new mb,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,
onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,onDegradedCardGiveFeedbackButtonClicked:this.onDegradedCardGiveFeedbackButtonClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,
onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged});Z.a(()=>{this.UF=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(T.a)(new ic,{clientBatchSize:this.batchSize,filterableSheetList:this.S5a(),uiCulture:this.$.ya.UICultureTag,dataCulture:this.$.ya.DataCultureTag,logger:new C.a,lineageAppCallbacks:Lb}))})}Eid(Lb){return pc=>{if(pc=nb.a(pc)?null:pc.Result){var Ha={["CountOfActivities"]:pc.ActivityList.length};Ha.WebRequestName=Lb;va.b(this.$).vd(jb.a.BSi,
Ha);pc=Object(T.a)(new Ob,{activityList:Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?eb(pc.ActivityList,this.eAa):this.uJd(pc.ActivityList),latestActivityId:pc.LastSearchedActivityId,oldestActivityId:pc.FirstSearchedActivityId,serverMessageCode:pc.LineageResponseCode,lastSearchedActivityTimestamp:new Date(pc.EcmaLastSearchedDate),serverFirstActivityId:pc.ServerFirstActivityId,serverLastActivityId:pc.ServerLastActivityId,showLoadPrevious:pc.ShowLoadPrevious,
eolCorrelationId:pc.EolCorrelationId,eolDateHideHistory:new Date(pc.EolDateHideHistory),eolPersonHideHistory:this.Sxb(pc.EolPersonHideHistory)});this.UF.onLineageActivitiesResponse(pc)}else d.ULS.shipAssertTag(537155477,0,!!pc,"LineageManager."+Lb+" returned null response.")}}pTj(Lb){return Fa.e(Lb.Ranges)&&!Lb.SheetName?null:Object(T.a)(new Eb,{rangeList:this.O5a(Lb.Ranges),sheetName:Lb.SheetName})}O5a(Lb){const pc=[];for(const Ha of Lb)Lb=Object(T.a)(new gb,{firstCol:Ha.FirstColumn,firstRow:Ha.FirstRow,
lastRow:Ha.LastRow,lastCol:Ha.LastColumn}),pc.push(Lb);return pc}zTj(Lb){if(!Lb)return null;const pc={};pc.Ranges=this.Djd(Lb.rangeList);pc.SheetName=Lb.sheetName;return pc}Djd(Lb){const pc=[];if(Fa.e(Lb))return pc;for(const Ha of Lb)Lb={},Lb.FirstColumn=Ha.firstCol,Lb.FirstRow=Ha.firstRow,Lb.LastRow=Ha.lastRow,Lb.LastColumn=Ha.lastCol,pc.push(Lb);return pc}vci(Lb){(Lb=this.$.va.getItemByName(Lb))&&Lb.visible&&Lb.activate(!0)}ydf(Lb,pc){const Ha=[];for(var Bb of pc)pc={},pc.FirstColumn=Bb.firstCol,
pc.FirstRow=Bb.firstRow,pc.LastRow=Bb.lastRow,pc.LastColumn=Bb.lastCol,Ha.push(ab.D(pc));Bb=Ha.length-1;pc=Ha[Bb].topLeft;V.h(this.$).Y4(Ha,Bb,Lb,null,pc,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}Hdj(){this.UF&&this.lineageTaskPane.isVisible&&(this.JE=this.$.ea.ye,this.UF.onRefreshRequired())}YIg(){this.lineageTaskPane.FM(this.onPaneClosed);this.lineageTaskPane.RE(this.Uz);this.$.ea.pu(this.Bf);this.$.ea.Xj(this.Tc);this.$.ea.EM(this.Ro);const Lb=this.$.va;Lb.VY(this.ND);
Lb.tha(this.trc);Lb.PGa(this.Aza);Lb.a_a(this.trc)}Kgj(){this.$.ea.Rv(this.Bf);this.gridView.ha.iS(this.Pc);this.$.ea.tk(this.Tc);this.$.ea.gS(this.Ro);const Lb=this.$.va;Lb.t7(this.ND);Lb.zna(this.trc);Lb.KRa(this.Aza);Lb.AKb(this.trc)}onStaleActivitiesDetected(){this.UF.onStaleActivitiesDetected()}S5a(){const Lb=this.$.va.items,pc=[];for(const Ha of Lb)Ha.visible&&!Jb.e(Ha)&&pc.push(Ha.sheetName);return pc}LWd(){if(Y.EwaSettings.oa(568)){var Lb=this.$.da.Aa(403);Lb&&Lb.disable();Lb=new U.a(-847286761,
Yb.a.Db,this.$.Hc,0,db.a.C0);this.$.Ka.Lb(Lb,{["InputMethod"]:Yb.a.Db,CalloutName:5})}}uJd(Lb){const pc=[];for(const Ha of Lb)Lb=Object(T.a)(new Lc,{activityId:Number.parseLocale(Ha.UserActivity.Id),activityGuid:Ha.Uid,activityType:Ha.UserActivity.Type,author:this.Sxb(Ha.UserActivity.Person),sheetName:Ha.SheetName,displayTimestamp:new Date(Ha.UserActivity.DisplayTimestamp),gridLocation:Ha.DisplayLocation,valueChanges:this.L8i(Ha.LineageValueChangeList),isBulkEditOverflow:Ha.IsBulkEditOverFlow,rangeHighlightLocation:this.y8i(Ha.UserActivity.LocationList,
Ha.UserActivity.Type),nestedActivityList:this.r8i(Ha.NestedActivityList),degradedCardTypeBits:Ha.DegradedCardTypeBits}),pc.push(Lb);return pc}y8i(Lb,pc){if(!Lb)return d.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!Lb.length)return d.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const Ha=[];var Bb=[];let bc="";21===pc?Bb.push(Lb[0]):Bb=Lb;for(const tc of Bb)switch(tc.Type){case 1:break;
case 2:bc=tc.SheetName;break;case 0:Lb=tc;if(!Lb.RangeList){d.ULS.sendTraceTag(537155465,0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}bc=Lb.RangeList[0].SheetName;Bb=[];21===pc?Bb.push(Lb.RangeList[0]):Bb=Lb.RangeList;for(const Zc of Bb)Lb=Object(T.a)(new gb,{firstCol:Zc.FirstColumn,firstRow:Zc.FirstRow,lastRow:Zc.LastRow,lastCol:Zc.LastColumn}),Ha.push(Lb);break;default:d.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(T.a)(new Eb,
{sheetName:bc,rangeList:Ha})}L8i(Lb){const pc=[];for(const Ha of Lb)Lb=Object(T.a)(new Ec,{hasNewValue:Ha.HasNewValue,hasOldValue:Ha.HasOldValue,newValue:Ha.HasNewValue?Ha.NewValue:null,oldValue:Ha.HasOldValue?Ha.OldValue:null,cellLocation:Ha.CellLocation}),pc.push(Lb);return pc}r8i(Lb){return Lb?this.uJd(Lb):null}Sxb(Lb){if(!Lb)return null;let pc=null;e.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(pc=this.eAa.Uta(Lb.Email,Lb.Provider,e.AFrameworkApplication.Hi,0));return Object(T.a)(new Nb,
{id:Lb.Id,provider:Lb.Provider,displayName:Lb.DisplayName,email:Lb.Email,imageUrl:pc})}}Object(b.a)(ld,"LineageManager",null,[484,3]);class bd extends f.a{constructor(Lb){super();this.U7=this.lineageTaskPane=null;this.$=Lb;this.Fb()}Erf(Lb,pc){A.TaskExtensions.za(Lb,()=>{this.ob(this.$.da.Aa(366)||new ld(this.$,this.$.da,this.lineageTaskPane,pc,this.U7))},this.$.ka,3)}create(){this.U7=this.$.Kb.Cc("UserAction","LineagePaneSeenStopwatch");this.U7.start();const Lb=z.GetServiceTaskFactory.Na(this.$.da,
365,364,this.Ya),pc=Na.a(this.$),Ha=z.GetServiceTaskFactory.Na(this.$.da,283,284,this.Ya);if(Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const Bb=z.GetServiceTaskFactory.Na(this.$.da,501,500,0);A.TaskExtensions.za(A.TaskExtensions.Ed([Lb,pc,Ha,Bb],this.$.ka),()=>{this.lineageTaskPane=Lb.result;kb.a.gd(this.$)||pc.result.IN(this.lineageTaskPane);this.Erf(ba.c(Ha.result.kn.loadScript("cellLineage")),Bb.result)},this.$.ka,3)}else A.TaskExtensions.za(A.TaskExtensions.Ed([Lb,
pc,Ha],this.$.ka),()=>{this.lineageTaskPane=Lb.result;kb.a.gd(this.$)||pc.result.IN(this.lineageTaskPane);this.Erf(ba.c(Ha.result.kn.loadScript("cellLineage")),null)},this.$.ka,3)}static la(Lb){Lb.da.Ga(367,new bd(Lb))}}Object(b.a)(bd,"LineageManagerFactory",f.a,[]);var ec=a(791),sc=a(224),Dc=a(14),Ud=a(108),Ed=a(261),$d=a(85),ve=a(238),ze=a(19),We=a(704);const md=db.a.GCc+"LineageActivityPaneTitle",$b=db.a.Tfb+"LineageActivityCloseButton";class $c extends ve.a{constructor(Lb,pc,Ha){super(Lb);this.MGb=
this.REe=this.Rd=null;this.Ysd=!0;this.yq=0;this.Vp=!1;this.xc=(Bb,bc)=>{bc.If||this.h4c()};this.rk=()=>{this.h4c();return!0};this.$=pc;this.taskPaneManager=Ha;this.$.xj(this.xc);Aa.a(this.$).di(this);kb.a.gd(this.$)&&(this.isVisible=!1)}WP(Lb){this.get_events().addHandler("LineageTaskPaneRemove",Lb)}hS(Lb){this.get_events().removeHandler("LineageTaskPaneRemove",Lb)}RE(Lb){this.addHandler("LineageTaskPaneVisibilityChanged",Lb)}lG(Lb){this.removeHandler("LineageTaskPaneVisibilityChanged",Lb)}FM(Lb){this.get_events().addHandler("LineageTaskPaneClose",
Lb)}JO(Lb){this.get_events().removeHandler("LineageTaskPaneClose",Lb)}get isVisible(){return super.isVisible}set isVisible(Lb){super.isVisible!==Lb&&(super.isVisible=Lb,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get qjc(){return this.Ysd}get Hf(){return this.isVisible}get kh(){return 15}get he(){return Q.a.mzi}get Ek(){return ze.a.YAh}get FN(){return Mb.a.instance.ga(1073)}get Lp(){return 300}get isResizable(){return!1}get mc(){return this.domElement}get height(){return this.taskPaneManager.iP.offsetHeight}get titleText(){return Mb.a.instance.ga(1290)}get $B(){return this.taskPaneManager.Eva(this.mc,
this.titleText,this.Lp,this.isResizable,()=>{this.isVisible=!0;this.MGb?this.MGb():d.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.Lp)}pq(){return this.Vp}Fs(){return this.Vp}VR(){}bR(){return!1}qj(){}dk(){}dispose(){this.$&&(this.$.tl(this.xc),Aa.a(this.$).aA(this));this.Rd&&(sc.a.instance.Ba(Dc.a.click,this.Rd,this.rk),Ud.KeyInputManager.instance.Xv(this.Rd,this.REe));this.Rd=this.taskPaneManager=
this.$=null;super.dispose()}kg(Lb,pc){if(!pc){Lb=fa.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!Lb)return!1;fa.DOMElementExtensions.setFocus(Lb)}return!pc}nh(Lb){return fa.DOMElementExtensions.Af(this.mc,Lb)}wg(Lb){this.Vp=Lb;const pc=this.taskPaneManager;if(this.isVisible=Lb)this.$.frame.Le.ek("LineagePane"),this.Ysd=!1;if(kb.a.gd(this.$))Lb?pc.a7("LineageTaskPane",this.$B):pc.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.nA();const Ha=!!this.taskPaneManager.ph&&
15===this.taskPaneManager.ph.taskPane.kh;Lb&&0<pc.ZB.length&&(!Ha||pc.isCollapsed)&&pc.oG(this,!0)}this.$.af()}cN(){var Lb=this.$.Eb;Lb=kb.a.gd(this.$)?this.domElement:document.getElementById(Lb+db.a.Zwd);var pc=this.tH();Lb.appendChild(pc);pc=We.b("div","LineagePaneBodyId","LineageActivityBody");Lb.appendChild(pc);this.Fyj();return pc}h4c(){this.$.frame.Le.ek(this.$.frame.Le.pF||Ed.AFrame.gU);this.Ysd=!0;this.wg(!1);this.raiseEvent("LineageTaskPaneClose")}Eyj(Lb){this.MGb=Lb}Fyj(){this.$.frame.Le.vk("LineagePane");
const Lb=this.$.frame.Le.Ci("LineagePane");Lb.parent=Ed.AFrame.gU;Lb.WN=!0}tH(){const Lb=We.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),pc=We.b("h1","LineagePaneTitleId",md);pc.innerText=this.titleText;this.Rd=ec.a.pb("LineagePaneCloseButtonId",$b,Mb.a.instance.ga(10),"ClosePaneGlyph_16x16x32",!1);this.Rd.classList.add(e.AFrameworkApplication.isRtl?db.a.Vaa:db.a.Waa);sc.a.instance.sa(Dc.a.click,this.Rd,this.rk);this.REe=Ud.KeyInputManager.instance.Qs(this.Rd,this.rk,$d.a.Kh);Lb.appendChild(pc);
Lb.appendChild(this.Rd);return Lb}static la(Lb,pc){const Ha=Lb.Eb;let Bb=document.getElementById(Ha+db.a.Zwd);Bb||(Bb=document.createElement("div"),Bb.id=Lb.Eb+db.a.Zwd,Bb.classList.add("LineageActivityPane"),kb.a.gd(Lb)||document.getElementById(Ha+db.a.IR).appendChild(Bb));return Lb.da.Aa(365)||Lb.da.Ga(365,new $c(Bb,Lb,pc))}}Object(b.a)($c,"LineageTaskPane",ve.a,[483,3,280,66]);class nd extends f.a{constructor(Lb){super();this.ih=this.yi=null;this.$=Lb;this.Fb()}get QD(){this.yi||(this.yi=A.TaskExtensions.za(Na.a(this.$),
Lb=>{this.ih=$c.la(this.$,Lb.result)},this.ka,3));return this.yi}create(){const Lb=z.GetServiceTaskFactory.create(this.$.da,203,this.ka,this.Ya),pc=z.GetServiceTaskFactory.create(this.$.da,155,this.ka,this.Ya);A.TaskExtensions.za(A.TaskExtensions.ts(A.TaskExtensions.Ed([Lb,pc],this.ka),()=>this.QD,this.ka),()=>{this.ob(this.ih)},this.ka,3)}dispose(){this.ih=this.yi=this.$=null;super.dispose()}static la(Lb){Lb.da.Ga(364,new nd(Lb))}}Object(b.a)(nd,"LineageTaskPaneFactory",f.a,[]);class Oc{constructor(Lb,
pc){this.Ctd=!1;this.Bf=()=>{this.Fgg()};this.$=Lb;Y.EwaSettings.oa(568)&&this.$.ea.L9a&&!Oc.Yyb&&(pc&&!pc.RTa||this.o3j(),Oc.Gbf?d.ULS.sendTraceTag(537155461,0,50,"LineageTeachingCalloutTriggerManager will not trigger WYWA waterline check as it was already checked in session"):pc&&!pc.RTa||this.v3j());d.ULS.sendTraceTag(537155460,0,50,"LineageTeachingCalloutTriggerManager is initialized.")}dispose(){this.IMd();this.$=null;d.ULS.sendTraceTag(537155459,0,50,"LineageTeachingCalloutTriggerManager is disposed.")}disable(){Oc.Yyb||
(Oc.Yyb=!0,d.ULS.sendTraceTag(578557781,0,50,"LineageTeachingCalloutTriggerManager.Disable as the pane was opened."));this.IMd()}v3j(){Y.EwaSettings.oa(564)&&!this.$.isAnonymousUser()&&wb.i(this.$.pa.xa,Lb=>{this.$?(Lb=Lb.Result,d.ULS.sendTraceTag(578557780,0,50,`CheckLineageWywaChanges service call succeeded, hasnewchanges = ${Lb}.`),Oc.Gbf=!0,Lb&&this.tQb(0)):d.ULS.sendTraceTag(537155458,0,50,"LineageTeachingCalloutTriggerManager.VerifyWaterlineTrigger ignoring server response as class is disposed.")},
()=>{d.ULS.sendTraceTag(537155457,0,10,"CheckLineageWywaChanges service call failed.")},null,null)}o3j(){Y.EwaSettings.oa(563)&&!this.Fgg()&&(this.$.ea.pu(this.Bf),this.Ctd=!0)}Fgg(){return this.$.ea&&this.$.ea.Lo&&this.$.ea.Lo.ShouldTriggerLineageCalloutOnMerge?(d.ULS.sendTraceTag(578557778,0,50,"LineageTeachingCalloutTriggerManager.TriggerLineageCalloutOnMerge"),this.tQb(1),!0):!1}tQb(Lb){Oc.Yyb?d.ULS.sendTraceTag(537155456,0,50,"LineageTeachingCalloutTriggerManager.TriggerCallout Will not trigger dialog as it was already shown in session"):
(Oc.Yyb=!0,d.ULS.sendTraceTag(578557776,0,50,`LineageTeachingCalloutTriggerManager.TriggerCallout triggering callout due to reason ${Lb}.`),this.IMd(),Y.EwaSettings.oa(449)&&(Lb=new U.a(-847286761,Yb.a.Db,this.$.Hc,0,db.a.C0),this.$.Ka.Lb(Lb,{["CalloutName"]:4})))}IMd(){this.Ctd&&(this.Ctd=!1,this.$.ea.Rv(this.Bf))}}Oc.Yyb=!1;Oc.Gbf=!1;Object(b.a)(Oc,"LineageTeachingCalloutTriggerManager",null,[482,3]);class Gd extends f.a{constructor(Lb){super();this.$=Lb;this.Fb()}create(){A.TaskExtensions.za(z.GetServiceTaskFactory.Na(this.$.da,
458,459,this.Ya),Lb=>{const pc=Lb.result;Lb=Object(Oa.a)(this.$.da,403,()=>new Oc(this.$,pc));this.ob(Lb)},this.$.ka,3)}static la(Lb){Lb.da.Ga(402,new Gd(Lb))}}Object(b.a)(Gd,"LineageTeachingCalloutTriggerManagerFactory",f.a,[]);var Qd=a(876),Ad=a(79);class Sd{constructor(Lb,pc){this.Ah=Lb;this.kv=pc}sX(Lb,pc,Ha,Bb=null){return this.iph(Lb,Bb,bc=>this.Ah.Kob(bc,2,Ha,pc,void 0,void 0,void 0,void 0,void 0,"2"))}iph(Lb,pc,Ha){const Bb=!!pc&&""!==pc;let bc=Lb;Bb&&(bc=v.a.YT(Lb,"perfTag",pc));const tc=
new Date;return Qd.a.then(Ha(bc),Zc=>{const wd=+new Date-+tc;if(!Zc||!Zc.Jg||!Zc.Jg.data)return Zc;Bb&&Zc.Jg.data.request&&this.suj(Zc.Jg.data.request.getResolvedUrl(),pc,wd);return Zc})}suj(Lb,pc,Ha){Lb=this.kv.G1h(Lb);if(Lb.count&&(Lb=Ad.last(Lb))){const Bb={Message:"Request durations for activities calls."};Bb.PerfTag=pc;Bb.CustomDuration=Ha;Bb.PerformanceDuration=Lb.duration;d.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(Bb))}}}Object(b.a)(Sd,"CatchUpNetworkingWrapper",null,[570]);var Ce=
a(244);class we extends Ce.a{constructor(Lb,pc){super(Lb,pc)}dba(){return 6}}Object(b.a)(we,"GetActivityFeedRequest",Ce.a,[]);class Td extends Ce.a{constructor(Lb,pc,Ha,Bb,bc,tc){super(Lb,pc);this.ItemIds=null;this.ActivityStatesToReset=this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=Ha;this.ActivityStatesToSet=Bb;this.ActivityStatesToReset=bc;this.ResetUnseenCount=tc}dba(){return 7}}Object(b.a)(Td,"UpdateActivityFeedStateRequest",Ce.a,[]);var he=a(388);class ee{constructor(Lb,pc,
Ha){this.Bge=Lb;this.vDa=pc;this.NDa=Ha}getActivityFeed(Lb){return Qd.a.then(this.NDa.execute(new we(this.vDa(),null),(pc,Ha,Bb)=>this.Bge.sX(pc,Ha,Bb,"ActivityFeed"),Lb),pc=>{if(!pc)return d.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!pc.Jg)return d.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;if(!pc.Jg.data)return d.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(!pc.Jg.data.fe)return d.ULS.sendTraceTag(572846940,
3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;pc=he.a.tJa(pc.Jg.data.fe);return pc?pc:(d.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}MXj(Lb,pc,Ha,Bb){return Qd.a.then(this.NDa.execute(new Td(this.vDa(),null,Lb,pc,Ha,Bb),(bc,tc,Zc)=>this.Bge.sX(bc,tc,Zc,"UpdateActivityFeedState"),null),bc=>{try{return bc.succeeded}catch(tc){return d.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception: "+tc.message),!1}})}}Object(b.a)(ee,
"CatchUpRequestHandler",null,[492]);var ge=a(468);class re{constructor(Lb){this.Pga=Lb;this.mfe=new ge.a}WAi(){this.KBi()}KBi(){if(this.Pga){var Lb=pc=>{this.mfe.contains("CatchUpChangesFeedback")||(this.mfe.add("CatchUpChangesFeedback"),pc.logActivity("CatchUpChangesFeedback",null))};this.Pga.execute(pc=>{window.setTimeout(()=>{Lb(pc)},2E4)})}else d.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(b.a)(re,"FloodgateEventLogger",null,[]);
var Be=a(187);class Oe{constructor(Lb){this.JBg=Lb}get duration(){return this.JBg.duration}}Object(b.a)(Oe,"PerformanceResourceTimingWrapper",null,[]);class gf{constructor(Lb){this.kv=Lb}G1h(Lb){const pc=new Be.a;if(!this.kv)return pc;Lb=this.kv.getEntriesByName(Lb,"resource");if(!Lb)return pc;for(const Ha of Lb)pc.add(new Oe(Ha));return pc}}Object(b.a)(gf,"PerformanceWrapper",null,[]);var af=a(249);class Ze{constructor(){this.$a=null}get name(){return"Common.App.CatchUpActivity"}Oh(Lb){this.$a=Lb;
this.$a.register(Sd,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").wc().Ac(()=>new Sd(e.AFrameworkApplication.zd,new gf(window.performance)));this.$a.register(ee,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").wc().Ac(()=>new ee(this.$a.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>e.AFrameworkApplication.Hi,new he.a));this.$a.register(re,"Common.App.CatchUpActivity.FloodgateEventLogger").wc().Ac(()=>
new re(this.$a.Rb("Common.ISystemInitiatedFeedback")))}init(){this.$a.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");this.$a.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){af.a.instance.vi(new Ze)}}Object(b.a)(Ze,"CatchUpActivityPackage",null,[4,5]);class Xa{constructor(Lb,pc){this.$=Lb;this.catchUpActivityManager=pc}nc(Lb,pc){return this.catchUpActivityManager?-876699925===pc?!this.catchUpActivityManager.cif:!1:!0}executeCommand(Lb,pc){Lb=!1;
switch(pc.command){case -876699925:Lb=this.catchUpActivityManager.l_i();break;case 950288339:return this.catchUpActivityManager.showHideInGridHighlights(),I.Task.Ra(!0)}return Lb?I.Task.Ra(!0):y.a(pc.command)}yc(Lb,pc){return Y.EwaSettings.oa(407)?-876699925===pc.command||950288339===pc.command:!1}Lc(){return!1}}Object(b.a)(Xa,"CatchUpActivityCommandHandler",null,[219]);class qa extends B.a{constructor(Lb){super(Lb)}ld(){this.$.da.fb(286,Lb=>{this.Zc([new Xa(this.$,Lb)])})}static la(Lb){B.a.Nd(285,
new qa(Lb))}}Object(b.a)(qa,"CatchUpActivityCommandHandlerFactory",B.a,[]);var xa=a(264),ob=a(520),Ib=a(89),Zb=a(83),zc=a(25);class Mc{constructor(Lb){this.Wh=Lb}doesContentExist(Lb){if(!Lb)return d.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(Lb.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!Lb.navigationId)return d.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),!1;const pc=
{};pc.NavigationId=atob(Lb.navigationId);return 32===this.Wh.$d(zc.a.IJa,2,pc);default:return!1}}}Object(b.a)(Mc,"CatchUpActivityContentManager",null,[485]);var hd=a(825),id=a(1238);class yd{constructor(Lb){this.IGb=()=>{switch(this.Fu.model.state){case 1:this.E$f(!0);break;case 0:this.oOb(!1);break;case 2:case 3:this.oOb(!0);break;default:d.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.Fu.model.state)}};this.ayg=
Lb;this.Fu.Lre(this.IGb);this.Dz=[]}get Fu(){return this.ayg}dispose(){this.Fu.yWf(this.IGb);this.Dz=null}byj(Lb){this.Dz.push(Lb)}s5g(){this.Dz.length=0}E$f(Lb){for(const pc of this.Dz){pc.className=hd.a.g2g;const Ha=document.getElementById(`${pc.id}-${db.a.pCe}`);fa.DOMElementExtensions.setVisible(Ha,Lb)}}oOb(Lb){for(const pc of this.Dz)pc&&(Lb?pc.className=2===this.Fu.model.state?hd.a.Maj:hd.a.Naj:this.E$f(!1))}}Object(b.a)(yd,"RangeCatchUpActivityView",null,[568,3]);var Yd=a(22);class cc extends id.a{constructor(Lb,
pc,Ha){super(Lb,pc,Ha);this.gridView=V.h(Lb);this.nna=pc}dispose(){this.gridView=null;super.dispose()}BLg(Lb){const pc=this.yhb[0];pc?pc.byj(Lb):d.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.nna.activityId)}Snj(){const Lb=this.yhb[0];Lb&&Lb.s5g()}KJg(Lb){this.nna.addRange(Lb)}ERh(){if(3!==this.nna.activityType)return null;d.ULS.shipAssertTag(537168003,0,1===this.nna.OOb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");
return ab.D(this.nna.OOb[0])}sMb(Lb){if(Lb){if(!this.nna)return;this.mBd(this.apj())}super.sMb(Lb)}O7c(){const Lb=this.t7c();this.yhb.push(Lb)}t7c(){return new yd(this)}mBd(Lb){Lb?Lb.SheetName?(this.gridView.ha.Ta.yH(null),this.gridView.focus(),this.gridView.J$e(Lb,3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):d.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):d.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}apj(){if(Fa.e(this.nna.OOb))return d.ULS.shipAssertTag(537167971,
0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var Lb=this.$.va.na;d.ULS.shipAssertTag(537167970,0,!!Lb,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");Lb=this.AUj(Lb.sheetName,this.nna.OOb);if(!Lb&&(Lb=this.n6h(this.nna.OOb),!Lb))return null;const pc={};pc.SheetName=Lb.SheetName;pc.FirstColumn=Lb.FirstColumn;pc.FirstRow=Lb.FirstRow;pc.LastColumn=Lb.FirstColumn;
pc.LastRow=Lb.FirstRow;return pc}n6h(Lb){if(Fa.e(Lb))return null;let pc=null;for(let Bb=0;Bb<Lb.length;Bb++){var Ha=Lb[Bb].SheetName;if(!Yd.a.equals(Ha,pc,!1)&&(pc=Ha,Ha=this.$.va.getItemByName(Ha),null===Ha||void 0===Ha?0:Ha.visible))return Lb[Bb]}return null}AUj(Lb,pc){if(pc)for(const Ha of pc)if(Yd.a.equals(Ha.SheetName,Lb,!1))return Ha;return null}}Object(b.a)(cc,"RangeCatchUpActivityHighlightController",id.a,[]);var Rc=a(78);class vd extends Rc.a{constructor(Lb,pc,Ha,Bb,bc){super();this.$=Lb;
this.$5d=pc;this.ssg=Ha;this.yC=Bb;this.state=bc?1:0}get type(){return this.yC}get activityId(){return this.$5d}get activityType(){return this.ssg}dispose(){this.$5d=null;super.dispose()}}Object(b.a)(vd,"CatchUpActivityHighlightModelBase",Rc.a,[]);class Zd extends vd{constructor(Lb,pc,Ha,Bb,bc,tc){super(Lb,pc,Ha,Bb,tc);this.ranges=bc;this.O8a=!1}get OOb(){this.O8a||(this.ranges.sort(Zd.A5b),this.O8a=!0);return this.ranges}addRange(Lb){for(const pc of Lb)this.ranges.push(pc)}dispose(){this.ranges=
null;super.dispose()}static A5b(Lb,pc){if(!Lb.SheetName||!pc.SheetName)return d.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const Ha=Lb.SheetName.localeCompare(pc.SheetName);return Ha?Ha:Lb.FirstColumn<pc.FirstColumn||Lb.FirstColumn===pc.FirstColumn&&Lb.FirstRow<pc.FirstRow?-1:Lb.FirstColumn===pc.FirstColumn&&Lb.FirstRow===pc.FirstRow?0:1}}Object(b.a)(Zd,"RangeCatchUpActivityHighlightModel",vd,[]);var pe=a(346);class Qe{constructor(){this.e5c=
[];this.GNb={};this.ppe={}}dispose(){this.ppe=this.GNb=this.e5c=null}LXf(Lb,pc){pc?V.h(Lb).qb.Tn([24]):V.h(Lb).qb.Zg([24])}Bch(Lb,pc,Ha,Bb){const bc={};for(const Zc of pc){if(!Zc||Fa.e(Zc.LocationList))continue;pc=[];const wd={},Ld=[];for(const ae of Zc.LocationList){if(!ae){d.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+Zc.Id);break}switch(ae.Type){case 0:var tc=ae;let ne;"0"in wd?(ne=wd["0"],ne.KJg(tc.RangeList)):
(ne=new cc(Lb,new Zd(Lb,Zc.Id,Zc.Type,0,tc.RangeList,Bb),Ha),pc.push(ne),wd["0"]=ne);for(const xe of tc.RangeList){tc=new pe.a(ab.D(xe),Jb.d(Lb.va.getItemByName(xe.SheetName)));if(this.Uzc(tc)in this.GNb)this.GNb[this.Uzc(tc)].push(ne);else{let Fe=[];Fe.push(ne);this.GNb[this.Uzc(tc)]=Fe}Ld.push(tc);this.e5c.push(tc)}break;default:d.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}d.ULS.shipAssertTag(537168011,
0,!(Zc.Id in bc),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+Zc.Id);this.ppe[Zc.Id]=Ld;bc[Zc.Id]=pc}this.Vdh(Lb,this.e5c,this.GNb,Bb);return bc}k5g(Lb){for(let pc in Lb){const Ha=Lb[pc];for(const Bb of Ha)Bb.Snj()}}Uzc(Lb){return`${Lb.range}-${Lb.sheetId}`}Vdh(Lb,pc,Ha,Bb){this.k5g(Ha);V.h(Lb).qb.qx(pc,[24],Bb,(bc,tc)=>{var Zc=new pe.a(bc.range,bc.sheetId);Zc=this.Uzc(Zc);const wd=Ha[Zc];if(wd)for(const Ld of wd)Ld.BLg(tc),bc.metadata=
Ld;else d.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+Zc)})}}Object(b.a)(Qe,"CatchUpHighlightControllersCreator",null,[]);class bf{constructor(){this.activityIds=this.container=this.target=null;this.isSticky=!1;this.dirHint=0;this.onHoverLeave=this.onHoverEnter=this.activityNavigationManager=null}}Object(b.a)(bf,"CreateIndicatorTooltipParameters",null,[]);class $e{constructor(){this.clearSticky=
!1}}Object(b.a)($e,"DismissIndicatorTooltipParameters",null,[]);class tf{constructor(){this.target=null;this.isSticky=!1}}Object(b.a)(tf,"UpdateIndicatorTooltipParameters",null,[]);class oe{constructor(Lb,pc){this.$=Lb;this.Wh=pc}navigateToActivity(Lb){if(Lb.fromSummaryString)return Lb=new U.a(1834994092,Yb.a.Db,this.$.Hc,18,null),this.$.Ka.Lb(Lb),this.hDa(1);Lb=Lb.activity;if(Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&Lb&&1===Lb.type){var pc=
new U.a(1834994092,Yb.a.Db,this.$.Hc,30,null);this.$.Ka.Lb(pc,{["activityGuid"]:Lb.activityId,["sheetName"]:Lb.location.region,["gridLocation"]:Lb.location.subregion[0]});return this.hDa(1)}if(!this.Fki(Lb))return this.hDa(4);if(!this.hui(Lb))return this.hDa(7);const Ha={};try{pc=window.self.atob(Lb.navigationId);if(!pc)return this.hDa(5);Ha.NavigationId=pc}catch(Bb){return d.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${Bb}`),this.hDa(5)}if(8===
this.Wh.$d(zc.a.IJa,2,Ha))return this.Wh.processAction(zc.a.R$a,2),this.hDa(2);Lb=32===this.Wh.$d(zc.a.I1a,2,Ha)?1:6;return this.hDa(Lb)}Fki(Lb){return Lb&&Lb.navigationId?!0:!1}hui(Lb){switch(Lb.type){case 3:case 4:case 6:case 7:case 9:case 8:return!0;case 10:return Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7212124_EnableTaskReplyNavigation")?!0:!1;default:return!1}}hDa(Lb){return Promise.resolve(Lb)}}Object(b.a)(oe,"CatchUpActivityNavigationManager",null,[486]);class jf{constructor(Lb,pc){this.k6b=
this.Mpa=null;this.Ked=!1;this.HSa=null;this.Lka={};this.lEa=null;this.vnd=!1;this.IGb=(Ha,Bb)=>{switch(Bb.state){case 0:case 1:3===Bb.bJd&&(this.Jbi(),this.HSa=null);break;case 2:break;case 3:this.q9c();this.HSa=Bb.activityId;this.SGj();break;default:d.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+Bb.state)}};this.am=()=>{this.bub()};this.Pc=()=>{this.bub()};this.Kn=()=>{this.bub()};this.Th=()=>{this.bub()};this.q_i=
()=>{this.U4b()};this.r_i=()=>{this.bEe();this.h_e=setTimeout(()=>{this.V2a()},200)};this.F9f=(Ha,Bb)=>{Bb.imi?(this.U4b(),this.V2a()):(this.nEe(),this.ved=setTimeout(()=>{this.U4b();this.V2a();const bc=this.PUj(Bb.DN);bc?(this.Mpa.createActivityIndicatorTooltip(Object(T.a)(new bf,{target:Bb.DN,container:bc,activityIds:[Bb.activityId],isSticky:!1,dirHint:this.gridView.rtl?12:9,activityNavigationManager:Y.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")?
this.a4b:void 0,onHoverEnter:this.q_i,onHoverLeave:this.r_i})),this.qgc=Bb.DN,d.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event."),this.Qic||(this.gridView.view.qt(this.qEc),this.gridView.pv(this.qEc),this.Qic=!0)):d.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null.")},150))};this.SDf=()=>{this.U4b();this.h_e=setTimeout(()=>{this.V2a()},200)};
this.qEc=()=>{this.Mpa?(this.CMa&&this.Mpa.updateActivityIndicatorTooltip(Object(T.a)(new tf,{target:this.CMa,isSticky:!0})),this.qgc&&this.Mpa.updateActivityIndicatorTooltip(Object(T.a)(new tf,{target:this.CMa,isSticky:!1}))):d.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=Lb;this.gridView=V.h(this.$);this.ha=this.gridView.ha;this.eb=this.gridView.Vb;this.ha.E0b(this.am);this.ha.hH(this.Pc);this.gridView.FC(this.Kn);
this.eb.Zk(this.Th);this.CMa=this.qgc=null;this.Qic=!1;this.ped={};this.a4b=new oe(this.$,e.AFrameworkApplication.ub);this.blueDotManager=pc}get qpe(){return this.Mpa}set qpe(Lb){this.Mpa=Lb}get excelCommentManager(){this.lEa||(this.lEa=this.$.da.Aa(65));return this.lEa}get X1a(){this.k6b||(this.k6b=new Qe);return this.k6b}set X1a(Lb){this.k6b=Lb}dispose(){this.ha.yvc(this.am);this.ha.kG(this.Pc);this.gridView.aE(this.Kn);this.eb.Uk(this.Th);this.NMe();this.ped=this.CMa=this.qgc=this.HSa=this.eb=
this.ha=this.gridView=null}V3f(Lb){const pc=this.Jpb();this.NMe();if(!Fa.e(Lb)){d.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:ProcessActivityPayloadHighlights().");if(this.Lka=this.X1a.Bch(this.$,Lb,this,pc)){Lb=this.Lka;for(let Ha in Lb){const Bb=Lb[Ha];for(const bc of Bb)this.VTg(bc)}}this.X1a.LXf(this.$,pc)}}mOb(){const Lb=this.Jpb();Lb&&this.vnd?d.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):
(Lb||this.bub(),this.X1a.LXf(this.$,Lb))}uci(Lb){if(this.Jpb())if(this.CMa&&this.V2a(),this.q9c(),Lb=this.Lka[Lb.activityId])for(const pc of Lb)pc.sMb(!0);else d.ULS.sendTraceTag(537168032,0,50,"CatchUpActivityHighlightManager.OnSelectHighlight - Controllers not found during select")}t5f(Lb){if(this.Ked!==Lb){var pc=this.Jpb();this.Ked=Lb;pc!==this.Jpb()&&this.mOb()}}NMe(){if(this.Lka){const Lb=this.Lka;for(let pc in Lb){const Ha=Lb[pc];for(const Bb of Ha)this.Lgj(Bb),Bb.dispose()}}this.Lka={};this.X1a.dispose();
this.X1a=null}SGj(){if(this.excelCommentManager){var Lb=this.Lka[this.HSa];Lb&&0<Lb.length&&3===Lb[0].model.activityType&&((Lb=Lb[0])?this.excelCommentManager.wHj(Lb.ERh()):d.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}Jbi(){this.excelCommentManager&&this.excelCommentManager.avb()}q9c(){if(this.HSa){const Lb=this.Lka[this.HSa];if(Lb){for(const pc of Lb)pc.sMb(!1);this.HSa=null}else d.ULS.sendTraceTag(537168028,
0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}bub(){this.q9c();this.V2a()}PUj(Lb){if(!Lb)return d.ULS.shipAssertTag(537168026,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;Lb=`${Lb.id}-${db.a.e2g}`;let pc=this.ped[Lb];if(!pc){if(!this.gridView.domElement)return d.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),null;pc=document.createElement("Div");
pc.className=hd.a.f2g;pc.id=Lb;this.gridView.domElement.appendChild(pc);this.ped[Lb]=pc}return pc}V2a(){this.Mpa&&(this.Mpa.dismissActivityIndicatorTooltips(Object(T.a)(new $e,{clearSticky:!0})),this.CMa=this.qgc=null,this.Qic&&!this.CMa&&(this.gridView.view.fr(this.qEc),this.gridView.Ny(this.qEc),this.Qic=!1))}VTg(Lb){Lb.Lre(this.IGb);Lb.fMg(this.F9f);Lb.eMg(this.SDf)}Lgj(Lb){Lb.yWf(this.IGb);Lb.Uhj(this.F9f);Lb.Thj(this.SDf)}nEe(){this.ved&&clearTimeout(this.ved)}bEe(){this.ved&&clearTimeout(this.h_e)}U4b(){this.nEe();
this.bEe()}Jpb(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&!this.Ked}}Object(b.a)(jf,"CatchUpActivityHighlightManager",null,[561,3]);var Hf=a(447);class Ne{}Object(b.a)(Ne,"GetRelevantActivitiesDataRequest",null,[]);class Xe{constructor(){this.activityFeedItemId=this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(b.a)(Xe,"Activity",null,[]);class Mf{constructor(){this.collectionId=
this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(b.a)(Mf,"ActivityFeedItem",null,[]);class Te{constructor(){this.activityFeedItems=null}}Object(b.a)(Te,"ActivityFeedPayload",null,[]);class cb{constructor(){this.lowWaterline=this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(b.a)(cb,"ActivityRequestPayload",null,[]);class Rb{constructor(){this.color=this.imageUrl=this.email=
this.givenName=this.displayName=this.provider=this.id=null}}Object(b.a)(Rb,"Person",null,[]);class uc extends Xe{constructor(){super();this.relationship=0}}Object(b.a)(uc,"TaskActivity",Xe,[]);const Kc=(Lb,pc,Ha,Bb,bc,tc=null)=>{tc=Lb.Oa(1,tc);return wb.g(Lb,"GetLineageWywaAuthors",tc,pc,Ha,Bb,bc,4)},pd=(Lb,pc,Ha,Bb,bc,tc,Zc=null)=>{Zc=Lb.Oa(1,Zc);Zc.getRelevantActivitiesDataRequest=pc;return wb.g(Lb,"GetRelevantActivitiesData",Zc,Ha,Bb,bc,tc,0)};class xd{constructor(Lb,pc,Ha=!1,Bb=null){this.S2d=
null;this.$=Lb;this.b4b=pc;this.mIb=lb.a.instance.resolve("Common.App.People.IPeopleColorUtils");this.eAa=lb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.a8a=Ha;this.blueDotManager=Bb}requestWYWAActivities(){return this.a8a?new Promise((Lb,pc)=>{Kc(this.$.pa.xa,Ha=>{var Bb;const bc=nb.a(Ha)?null:Ha.Result;Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?(Ha=null===(Bb=null===bc||void 0===bc?void 0:bc.WywaAuthors)||void 0===Bb?void 0:Bb.length,null!=
Ha&&0<Ha?this.$jg(tc=>{tc={activities:tc,actors:bc?this.dec(bc.WywaAuthors):null,hasMore:!1,highWaterline:xd.Qia,lowWaterline:xd.Qia,wywaWaterline:xd.Qia};Lb(tc)}):Lb(xd.Vtb)):(Bb=Object(T.a)(new cb,{activities:[],actors:bc?this.dec(bc.WywaAuthors):null,hasMore:!1,highWaterline:xd.Qia,lowWaterline:xd.Qia,wywaWaterline:xd.Qia}),Lb(Bb))},()=>{d.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");pc(null)},null,null)}):Promise.resolve(xd.Vtb)}requestActivities(){return Promise.resolve(xd.Vtb)}requestRelevantActivities(){if(!this.$.ea.Zb||
this.$.ea.w6a)return d.ULS.sendTraceTag(537168021,3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.Zb}, HasRaisedSessionEnded: ${this.$.ea.w6a}]`),Promise.resolve(xd.Vtb);const Lb=Object(T.a)(new Ne,{SetDaysBack:e.AFrameworkApplication.fa.ud("AppWaterlineOverrideDaysValue",0),SetTimestamp:e.AFrameworkApplication.fa.ud("AppWaterlineOverrideTimestampValue",0)});return new Promise((pc,Ha)=>{pd(this.$.pa.xa,Lb,Bb=>{let bc=
xd.Vtb;Bb?nb.a(Bb)?(Bb=K.a.sc(Bb.Errors),d.ULS.sendTraceTag(578353159,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${Bb}`)):bc=this.j1h(Bb.Result):d.ULS.sendTraceTag(537168020,3012,10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");pc(bc)},Bb=>{Bb=Da.a.Oe(Bb.data);Bb=K.a.sc(Bb);d.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${Bb}]`);Ha(null)},
null,null)})}requestActivityFeed(){return ba.b(this.getActivityFeed()).then(Lb=>Object(T.a)(new Te,{activityFeedItems:this.nTj(Lb)}))}updateActivityState(Lb){return Y.EwaSettings.oa(423)?Promise.resolve(!0):this.b4b?ba.b(this.b4b).then(pc=>{var Ha,Bb;return ba.b(pc.MXj(Lb.itemIds,null!==(Ha=Lb.activityStatesToSet)&&void 0!==Ha?Ha:0,null!==(Bb=Lb.activityStatesToReset)&&void 0!==Bb?Bb:0,Lb.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.b4b?Qd.a.WZd(this.b4b,Lb=>Lb.getActivityFeed(null)):
I.Task.Ra([])}j1h(Lb){if(!Lb)return d.ULS.sendTraceTag(537168018,3012,10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(T.a)(new cb,{activities:[]});const pc=this.ogg(Lb.NewActivities,2);Lb=this.ogg(Lb.OutstandingActivities,3);for(const Ha of Lb)pc.push(Ha);return Object(T.a)(new cb,{activities:pc})}ogg(Lb,pc=1){const Ha=[];if(!Lb||!Lb.length)return Ha;for(const Bb of Lb)Bb?(Lb=xd.uTj(Bb.Type),6===Lb||7===Lb||9===Lb||8===Lb?Ha.push(Object(T.a)(new uc,
{activityId:Bb.Id,type:Lb,displayTimestamp:new Date(Bb.DisplayTimestamp),navigationId:Bb.NavigationId,actors:this.dec(Bb.People),relevancy:pc,relationship:this.tTj(Bb.Relationship)})):Ha.push(Object(T.a)(new Xe,{activityId:Bb.Id,type:Lb,displayTimestamp:new Date(Bb.DisplayTimestamp),navigationId:Bb.NavigationId,actors:this.dec(Bb.People),relevancy:pc}))):d.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return Ha}tTj(Lb){switch(Lb){case 1:return 1;
case 2:return 2;case 3:return 3}d.ULS.sendTraceTag(537168016,0,10,"Unexpected Relationship.");return 1}nTj(Lb){const pc=[];for(const Ha of Lb)Lb=Object(T.a)(new Mf,{id:Ha.id,type:Ha.type,collectionId:Ha.collectionId,activityState:Ha.activityState,activityFeedItemPayload:Ha.activityFeedItemPayload,timestamp:Ha.timestamp}),pc.push(Lb);return pc}dec(Lb){const pc=[];if(!Lb||!Lb.length)return pc;for(const Ha of Lb)Ha&&pc.push(this.Sxb(Ha));return pc}Sxb(Lb){return Object(T.a)(new Rb,{id:Lb.Id,provider:Lb.Provider,
displayName:Lb.DisplayName,email:Lb.Email,imageUrl:this.eAa.Uta(Lb.Email,Lb.Provider,e.AFrameworkApplication.Hi,0),color:this.mIb.Qkd(new Hf.a(null,void 0,Lb.DisplayName),6)})}static uTj(Lb){switch(Lb){case 1:return 3;case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return d.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}c8i(Lb,pc){const Ha=Lb.map(Bb=>
({activityId:Bb.activityGuid,activityFeedItemId:null,type:1,actors:[{id:Bb.author.id,provider:Bb.author.provider,displayName:Bb.author.displayName,givenName:null,email:Bb.author.email,imageUrl:Bb.author.imageUrl,color:null}],location:{type:105,region:Bb.sheetName,subregion:[Bb.gridLocation]},displayTimestamp:Bb.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.S2d=Lb.map(Bb=>{var bc,tc;const Zc=null!==(tc=null===(bc=Bb.rangeHighlightLocation)||void 0===bc?void 0:
bc.rangeList.map(wd=>({Type:0,RangeList:[{SheetName:Bb.sheetName,FirstRow:wd.firstRow,LastRow:wd.lastRow,FirstColumn:wd.firstCol,LastColumn:wd.lastCol}]})))&&void 0!==tc?tc:[];return{Id:Bb.activityGuid,Type:null,Person:null,DisplayTimestamp:null,LocationList:Zc}});pc(Ha)}$jg(Lb){this.blueDotManager?this.blueDotManager.PHj().then(pc=>{this.c8i(pc,Lb)},()=>{}):d.ULS.shipAssertTag(509703879,3012,!1,"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}xd.Qia=
"<WywaWaterline>DefaultWaterline</WywaWaterline>";xd.Vtb=Object(T.a)(new cb,{activities:[],actors:[],hasMore:!1,highWaterline:xd.Qia,lowWaterline:xd.Qia,wywaWaterline:xd.Qia});Object(b.a)(xd,"CatchUpActivityRequestManager",null,[487]);class Rd{constructor(Lb){this.$=Lb}shouldShowEmptyExperienceButton(){return this.$.ea.L9a?!0:!1}onButtonClick(){const Lb={["InputMethod"]:Yb.a.Db};this.$.Ka.Lb(new U.a(1834994092,Yb.a.Db,this.$.Hc,16,null),Lb)}onInviteOthersButtonClick(){const Lb={["InputMethod"]:Yb.a.Db};
this.$.Ka.Lb(new U.a(869186573,Yb.a.Db,this.$.Hc,16,null),Lb)}getExplanationText(){const Lb=this.$.da.Aa(365);return Mb.a.instance.Ua(Lb&&Lb.isVisible?657:656)}getCommandName(){return Mb.a.instance.ga(443)}}Object(b.a)(Rd,"CatchUpEmptyExperienceBehaviorManager",null,[488]);const ke=Lb=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+Lb)};class fe{constructor(Lb,pc=null){this.$=Lb;this.flyoutRibbonButton=pc;Aa.a(this.$).di(this);this.hasFocus=
!1}dispose(){Aa.a(this.$).aA(this)}get mc(){return document.getElementById("catchUpFlyoutContainer")}get Hf(){return this.flyoutRibbonButton.Njf&&!this.hasFocus}get he(){return Q.a.C2c}kg(Lb,pc){if(pc)return!1;Lb=document.getElementById("flyoutItem0");if(!Lb)return d.ULS.sendTraceTag(537168009,3012,10,"Could not find firstItem in flyout when setting up focus"),!1;Lb.focus();this.Vnh(Lb);return!0}nh(Lb){return this.mc?fa.DOMElementExtensions.Af(this.mc,Lb):!1}qj(){this.hasFocus=!0}dk(){this.hasFocus=
!1}Vnh(Lb){if(Sys.Browser.agent===Sys.Browser.Firefox){var pc=document.createEvent("KeyboardEvent");pc.initKeyEvent(Dc.a.Pb,!0,!0,window.self,!1,!1,!1,!1,$d.a.ARb,0);Lb.dispatchEvent(pc)}else pc=document.createEvent("Events"),pc.initEvent(Dc.a.Pb,!0,!0),pc.keyCode=$d.a.ARb,pc.which=$d.a.ARb,Lb.dispatchEvent(pc)}}Object(b.a)(fe,"FlyoutFocus",null,[66,3]);var Ee=a(423);class nc{constructor(Lb){this.buttonClickedCallback=null;this.Hkb=this.gBb=!1;this.jJh=new Date;this.VZe=Lb}dispose(){this.Hkb=this.gBb=
!1}registerButtonClickedEvent(Lb){this.buttonClickedCallback&&d.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=Lb.buttonClickedCallback}onFlyoutInitialized(){this.gBb&&d.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const Lb=(new Date).getTime()-this.jJh.getTime();d.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${Lb}`);
m.c(zc.a.i2g,!0,m.e,0,0,Lb);this.gBb=!0;Ee.a.GJ&&Ee.a.GJ.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.gBb?this.buttonClickedCallback?this.buttonClickedCallback():d.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):d.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get Njf(){return this.Hkb}onFlyoutVisibilityChanged(Lb){this.Hkb!==
Lb.flyoutIsVisible&&(this.Hkb=Lb.flyoutIsVisible,Ee.a.GJ&&Ee.a.GJ.updateCommandUI(!0),this.Hkb||this.VZe&&this.VZe.WAi())}}Object(b.a)(nc,"FlyoutRibbonButton",null,[520]);var Sc=a(524);class zb{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=
null}}Object(b.a)(zb,"CatchUpConfiguration",null,[]);class Wb{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=null}}Object(b.a)(Wb,"SharedControllerFactoryParameters",null,[]);class yc{constructor(Lb,pc,Ha=null,Bb=null,bc=null){this.bIa=null;this.Ebf=!1;this.Bf=()=>
{this.eia.t5f(!0);this.Arb.$jg(()=>{this.eia.V3f(this.Arb.S2d);this.eia.t5f(!1)})};this.lLf=tc=>{Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!xa.a.sh(tc.wywaActivities)&&2!==tc.wywaActivities[0].type&&(this.eia.V3f(this.Arb.S2d),this.showHideInGridHighlights(),this.eia.uci(tc.wywaActivities[0]),this.$.ea.pu(this.Bf))};this.$=Lb;this.blueDotManager=bc;this.eia=new jf(this.$,this.blueDotManager);this.J7d=new Mc(e.AFrameworkApplication.ub,Y.EwaSettings.oa(423));Lb=ob.a.SRj(lb.a.instance.Rb("Common.App.CatchUpActivity.ICatchUpRequestHandler"));
this.irf=Bb;this.Arb=new xd(this.$,Lb,this.a8a(),this.blueDotManager);this.a4b=new oe(this.$,e.AFrameworkApplication.ub);this.emptyCatchUpBehaviorManager=new Rd(this.$);this.Dzi(tc=>{this.TNi(tc)},pc);this.DBi();pc=null;Ha||(pc=lb.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));this.flyoutRibbonButton=Ha||new nc(pc);this.flyoutFocus=new fe(this.$,this.flyoutRibbonButton)}get cif(){const Lb=this.flyoutRibbonButton.gBb;Lb&&!this.Ebf&&(d.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),
this.Ebf=!0);return Lb}get Sli(){return this.flyoutRibbonButton.Njf}dispose(){this.bIa&&this.bIa.getWywaEvent().removeListener(this.lLf);this.bIa=this.$=null;Ib.a.Ia(this.eia);this.flyoutRibbonButton=this.flyoutFocus=this.J7d=this.a4b=this.Arb=this.eia=null;this.$.ea.Rv(this.Bf)}l_i(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}showHideInGridHighlights(){this.eia.mOb()}DBi(){d.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.yhf()&&d.ULS.sendTraceTag(526718752,
3012,50,"ActivityFeedData is enabled")}Dzi(Lb,pc){ke("ScriptDownload");A.TaskExtensions.za(z.GetServiceTaskFactory.Na(this.$.da,283,284,pc),Ha=>{Lb(ba.c(Ha.result.kn.loadScript("catchUpActivity")))},this.$.da.ka,3)}a8a(){return!!this.irf&&this.irf.a8a()&&this.$.ea.L9a}yhf(){return Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}TNi(Lb){A.TaskExtensions.za(Lb,()=>{Z.a(()=>{this.bIa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(T.a)(new Wb,
{activityContentManager:Object(Zb.a)(485,this.J7d),activityNavigationManager:Object(Zb.a)(486,this.a4b),activityRequestManager:Object(Zb.a)(487,this.Arb),dataCulture:this.$.ya.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(Zb.a)(nc,this.flyoutRibbonButton),uiCulture:this.$.ya.UICultureTag,ulsLogger:new C.a,emptyCatchUpBehaviorManager:Object(Zb.a)(488,this.emptyCatchUpBehaviorManager)}))});this.eia.qpe=this.bIa.getActivityIndicatorTooltipManager();Sc.a(this.$);this.bIa.getWywaEvent().addListener(this.lLf);
ke("InitializeCatchUpApp");this.bIa.initialize(Object(T.a)(new zb,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.a8a(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.yhf()}))},this.$.ka,3)}}Object(b.a)(yc,"CatchUpActivityManager",null,[489,3]);class Uc extends f.a{constructor(Lb){super();this.$=Lb;this.Fb()}create(){let Lb=Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?z.GetServiceTaskFactory.Na(this.$.da,501,
500,1):I.Task.Ra(null),pc=z.GetServiceTaskFactory.Na(this.$.da,458,459,this.Ya);A.TaskExtensions.za(A.TaskExtensions.Ed([Lb,pc],this.$.ka),()=>{const Ha=pc.result,Bb=Lb.result,bc=Object(Oa.a)(this.$.da,286,()=>new yc(this.$,this.Ya,null,Ha,Bb));this.ob(bc)},this.$.ka,3)}static la(Lb){Lb.da.Ga(287,new Uc(Lb))}}Object(b.a)(Uc,"CatchUpActivityManagerFactory",f.a,[]);var fd=a(235),rb=a(156),Ub=a(163),oc=a(284);class Nc{constructor(Lb,pc){this.blueDotSettings=0;this.areInGridHighlightsAvailable=()=>!0;
this.areInGridHighlightsEnabled=()=>0===(this.blueDotSettings&1);this.kyj=Ha=>{d.ULS.sendTraceTag(509732679,0,50,"User toggled in grid highlights, new value {0}.",Ha);this.blueDotSettings=Ha?0:1;Ha=new U.a(950288339,0,2,12,null);this.$.Ka.Lb(Ha,{});this.s5j()};this.$=Lb;this.blueDotSettings=pc;this.eAa=lb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils")}dispose(){this.$=null}PHj(){return Object(Ub.a)(this,void 0,void 0,function*(){return new Promise(Lb=>{d.ULS.sendTraceTag(512234945,
0,50,"BlueDotManager::showInGridBlueDots");va.b(this.$).vd(jb.a.lineageLoadInGridBlueDots,{});const pc=Bb=>{Bb=Da.a.Oe(Bb.data);d.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${K.a.sc(Bb)}]`)},Ha=Bb=>{if(Bb=nb.a(Bb)?null:Bb.Result){var bc={["CountOfActivities"]:Bb.ActivityList.length};va.b(this.$).vd(jb.a.lzi,bc);Bb=eb(Bb.ActivityList,this.eAa);Lb(Bb)}else d.ULS.shipAssertTag(512234914,0,!!Bb,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};
this.$.userOperationManager.Ic(new vb.a(1024,0,(Bb,bc,tc)=>dc(this.$.pa.xa,Ta.b(Bb,Ha),Ta.a(bc,pc),tc,null),80),null)})})}s5j(){Y.EwaSettings.isChangeGateEnabled("OfficeVSO:7146345_bluedotroamingsetting")&&!Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1)&&oc.C(this.$.pa.xa,4,this.blueDotSettings.toString(),Lb=>{K.a.dg(Lb.Errors)?d.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${K.a.sc(Lb.Errors)}`):
Lb.Result||d.ULS.sendTraceTag(509732677,0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},(Lb,pc,Ha)=>{Lb=Da.a.Oe(Lb.data);d.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${Ha}. Errors: ${K.a.sc(Lb)}.`)},null,null)}}Object(b.a)(Nc,"BlueDotManager",null,[481,3]);class ud extends f.a{constructor(Lb){super();this.xcc=null;this.ORi=pc=>{pc=Da.a.Oe(pc.data);d.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${K.a.sc(pc)}.`)};
this.$=Lb;this.Fb()}create(){this.xcc||(this.xcc=this.CPh());this.xcc.continueWith(()=>{this.ob(Object(Oa.a)(this.$.da,501,()=>new Nc(this.$,this.xcc.result)))})}static la(Lb){Lb.da.Ga(500,new ud(Lb))}CPh(){if(Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1))return fd.a.Ra(0);let Lb=new rb.a;Object(oc.w)(this.$.pa.xa,4,pc=>{this.PRi(pc,Lb)},pc=>{this.ORi(pc);Lb.setResult(1)},null,null);return Lb.task}PRi(Lb,pc){K.a.dg(Lb.Errors)?(d.ULS.sendTraceTag(509732675,
0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${K.a.sc(Lb.Errors)}`),pc.setResult(1)):null==Lb.Result?pc.setResult(0):(Lb=parseInt(Lb.Result,10),d.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Lb}`),pc.setResult(Lb))}}Object(b.a)(ud,"BlueDotManagerFactory",f.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");
Type.registerNamespace("_Ewa");c.a.Fa(Ua.la);c.a.Fa(ib.la);c.a.Fa(u.la);c.a.Fa(x.la);La.a.Ni('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Fa(Lb=>{nd.la(Lb);bd.la(Lb);Ea.la(Lb);Gd.la(Lb);Ma.la(Lb)})})();Type.registerNamespace("Common.App.CatchUpActivity");Ze.main();(()=>{c.a.Fa(Lb=>{ke("Begin");Uc.la(Lb);qa.la(Lb)})})();(()=>{c.a.Fa(Lb=>{ud.la(Lb)})})()},986:function(t,E,a){a.d(E,"a",function(){return e});t=a(0);var c=a(164);E=a(1241);var b=a(763);class e extends E.a{constructor(f,d){super(f,d);d!==b.a.r$&&this.CGa(d);this.lha(e.iterateNext);this.lha(e.$xa);this.gXc(c.a.HVa);this.gXc(c.a.IVa)}}e.iterateNext="IterateNext";e.$xa=
"IteratePrevious";e.eQb="ToggleShowChanges";e.setCurrentChangeCount="SetCurrentChangeCount";e.setTotalChangesCount="SetTotalChangesCount";e.mQa="OnVHDiffReady";Object(t.a)(e,"VersionHistoryMessenger",E.a,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.catchup.js.map/9be5987b6f2e12cd4e5812b632da61b4/EwaDSEsNext.catchup.js.map