'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1231:function(t,E,a){t=a(0);var c=a(948),b=a(4);class e{}Object(t.a)(e,"LokiTokenResult",null,[]);class f{constructor(n){this.$Wb=n}Gid(){const n=this.kYh();return n?f.Rsd?new Promise((x,r)=>{this.$Wb.continueWith(()=>{this.$Wb.rh||this.$Wb.Of?r(Error.create("Error downloading auth library")):this.$Wb.result.YL("Loki",n).then(u=>{u=b.AFrameworkApplication.fa.qa("ForceLokiFallbackToACLPTokenIsEnabled")?this.nYh():
u.IsSuccess&&u.Token?Object.assign(new e,{isSuccess:!0,token:u.Token,errorMessage:null}):Object.assign(new e,{isSuccess:!1,token:null,errorMessage:JSON.stringify(u)});x(u);return u})})}):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.G1e())}))}nYh(){const n=
b.AFrameworkApplication.fa.Xa("LokiUserDataSignature")||"";return Object.assign(new e,{isSuccess:!0,token:n,errorMessage:null})}kYh(){let n=null;const x=c.a.vcc();2===x?n=b.AFrameworkApplication.fa.Xa("LokiAADAppId"):1===x&&(n=b.AFrameworkApplication.fa.Xa("LokiMSAAppId"));return n}static get Rsd(){return b.AFrameworkApplication.fa.qa("IsO365CommercialHost")||b.AFrameworkApplication.fa.qa("IsO365ConsumerHost")}}Object(t.a)(f,"LokiTokenManager",null,[850]);var d=a(249),h=a(82),m=a(520);class l{get name(){return"Common.App.LivePersonaUtils"}init(){h.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}Oh(n){n.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").wc().Ac(()=>new f(m.a.xq(n.Rb("Common.App.OAuth.IOAuthManager"))))}static main(){d.a.instance.vi(new l)}}Object(t.a)(l,"LivePersonaUtilsPackage",null,[4,5]);a.d(E,"a",function(){return w});const w=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");l.main()}},1254:function(t,E,a){var c=a(9);t=a(0);var b=a(82),e=a(222),f=a(7),d=a(15),h=a(767);class m{constructor(x){this.oAuthManager=x}YL(x,r){return this.oAuthManager?
this.oAuthManager.YL(x,r).then(u=>{u.IsSuccess||d.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+u.ErrorMessage+" Error code: "+u.ErrorCode+" App name: "+x);return Object(f.a)(new h.a,{IsSuccess:u.IsSuccess,Token:u.Token,ErrorCode:u.ErrorCode,ErrorMessage:u.ErrorMessage})}):(d.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(f.a)(new h.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}kNa(){return this.oAuthManager?
this.oAuthManager.kNa():null}}Object(t.a)(m,"OAuthManagerWrapper",null,[736]);var l=a(698);class w extends e.a{constructor(x){super();this.$=x;this.Fb()}create(){this.ob(Object(l.a)(this.$.da,349,()=>new m(b.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static la(x){x.da.Ga(350,new w(x))}}Object(t.a)(w,"OAuthManagerFactory",e.a,[]);a.d(E,"a",function(){return n});const n=()=>{c.a.Fa(x=>{w.la(x)})}},1280:function(t,E,a){t=a(0);var c=a(15),b=a(843),e=a(925),f=a(4),d=a(98),h=a(732),m=a(249),
l=a(41),w=a(39),n=a(27),x=a(111),r=a(82),u=a(189);class v{get name(){return"Common.App.OAuth.OAuthPackage"}Oh(z){z.register(733,"Common.App.OAuth.IOAuthManager").wc().Ac(()=>new b.OAuthManager)}init(){const z=r.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.HVj(z)}HVj(z){const A=f.AFrameworkApplication.fa.Xa("FileSource");if(f.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.qa("IsO365CommercialHost")||"WopiTest"===A){var y=h.a.Eah;if(y&&y.IsEnabled){var D=
y.Application,I=h.a.authority;if(void 0!==D&&null!==D&&D.length&&void 0!==I&&null!==I&&I.length){var M=e.a[z.dT],T=n.a.IHa,S=z.Ev();try{var H=new Map;void 0!==H&&null!==H?(H.set("SupportStatus",M),H.set("Browser",T),H.set("AuthStrategy",S)):H=null}catch(G){H=null}d.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",H);var C=w.a.Ud();z.YL("Core",D).then(G=>{const J=Math.floor(w.a.Ud()-C);M=e.a[z.dT];T=n.a.IHa;S=z.Ev();c.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
J,G.IsSuccess,M,G.ErrorCode,A,T,S);H&&(H.set("SupportStatus",M),H.set("Browser",T),H.set("AuthStrategy",S));var L=Object.assign(new u.a,{durationMs:J,extendedProperties:H});if(G.IsSuccess){if(d.Health.instance.recordKpiSuccess("WacCorePFT",L),L=y.Endpoint){var P=w.a.Ud();f.AFrameworkApplication.zd.Kob(L,1,null,{["Authorization"]:"Bearer "+G.Token},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(aa=>{var U=Math.floor(w.a.Ud()-P),K=null;aa.rh?aa="Canceled":aa.Of?aa="Faulted":(K=
aa.result,aa=K.succeeded?"Completed":"Failed");U={["TaskResult"]:aa,["BrowserTokenDurationMS"]:J,["BrowserValidationDurationMS"]:U};K&&(U.HttpStatus=K.Jg.data.httpStatus,K.succeeded&&(K=l.a(K.Jg.data.fe),U.ServerValidationDurationMS=K.ElapsedMilliseconds,U.ServerValidationResult=K.ValidatedToken,U.KMSI=K.KMSI,U.Scopes=K.Scopes,U.TokenExpirationS=Math.floor(parseInt(K.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===aa?50:15,x.a.toJSON(U))})}}else d.Health.instance.recordKpiFailure("WacCorePFT",
G.ErrorCode,!1,!1,L)}).catch(G=>{var J=Math.floor(w.a.Ud()-C);J=Object.assign(new u.a,{durationMs:J,extendedProperties:H});d.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+G.toString(),!1,!1,J)})}}}}dispose(){}static main(){m.a.instance.vi(new v)}static cfj(){m.a.instance.vi(new v,0,!0)}}Object(t.a)(v,"OAuthPackage",null,[4,5]);a.d(E,"a",function(){return B});const B=z=>{Type.registerNamespace("Common.App.OAuth");z?v.cfj():v.main()}},1468:function(t,E,a){a.r(E);t=a(1280);E=a(1231);
a=a(1254);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(t.a)();Object(E.a)();Object(a.a)()},843:function(t,E,a){a.r(E);t=a(0);var c=a(15),b=a(1402),e=a(925),f;(function(X){X[X.external=0]="external";X[X.msa=1]="msa";X[X.aad=2]="aad"})(f||(f={}));Object(t.b)("AuthorityType",f);class d{}Object(t.a)(d,"OAuthResult",null,[]);class h{constructor(X){this.FAg=X}initialize(){return Promise.resolve(0)}zmc(){return Promise.resolve(0)}YL(){c.ULS.sendTraceTag(574239257,
3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new d,{IsSuccess:!0,Token:this.FAg}))}RDc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}oCc(){return!1}lyb(){return"MockAuthTokenStrategy"}}Object(t.a)(h,"MockAuthTokenStrategy",null,[861]);var m=a(948);class l{static get(X,Aa,Q){if(!Q)return X;let fa=
0;return Promise.race([X,new Promise(Ca=>{fa=window.setTimeout(()=>{Ca(Aa)},Q)})]).then(Ca=>{window.clearTimeout(fa);return Promise.resolve(Ca)}).catch(()=>{window.clearTimeout(fa);return Promise.resolve(Aa)})}}Object(t.a)(l,"PromiseWithTimeout",null,[]);var w=a(4),n=a(732);class x{constructor(X,Aa,Q,fa,Ca){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=X;this.scope=Aa;this.silentLogin=Q;this.options=fa;this.correlationId=Ca}}Object(t.a)(x,"TokenRequestParameters",
null,[431]);var r=a(27),u=a(82);class v{constructor(){this.noe=null;let X=w.AFrameworkApplication.fa.Xa(w.AFrameworkApplication.o8),Aa=w.AFrameworkApplication.fa.Xa(w.AFrameworkApplication.Ohg);this.aZa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",X&&""!==X?X:"Unspecified",Aa&&""!==Aa?Aa:"Unspecified")}initialize(){return new Promise(X=>{u.a.instance.Rb("Common.App.WopiIdentity.IWopiIdentity").execute(Aa=>{this.noe=Aa;X(0)})})}Ci(X){const Aa=["HTTPS:","API:"];let Q=
!1;const fa=X.toLocaleUpperCase();for(const Ca of Aa)if(fa.startsWith(Ca)){Q=!0;break}return Q||this.Xoi(X)?X+"/.default":X}Xoi(X){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(X)}zmc(){return Promise.resolve(0)}YL(X,Aa,Q,fa,Ca,ia,Ra){if(r.a.Vxa){Ca=n.a.i4j;if(!Ca)return Aa=Object.assign(new d,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(Aa);if(!Array.contains(Ca,X))return Aa=Object.assign(new d,
{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+X}),Promise.resolve(Aa)}X=this.Ci(Q);Q=new x(Q,X,!fa,null,w.AFrameworkApplication.userSessionId);return this.noe.getAccessToken(Q,Aa,Ra).then(Ya=>Object.assign(new d,{IsSuccess:!0,Token:Ya.accessToken}),Ya=>Object.assign(new d,{IsSuccess:!1,ErrorCode:Ya}))}RDc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}oCc(){return!1}lyb(){return this.aZa}}
Object(t.a)(v,"ParentFrameTokenStrategy",null,[861]);var B=a(84),z=a(851),A=a(187);class y{constructor(){this.reject=this.resolve=null;this.startTime=0;this.yQf=this.uye=null}}Object(t.a)(y,"PromiseWrapper",null,[]);class D{constructor(X=0){this.kC=0;this.hmb=!1;this.Nm=new A.a;this._timeout=X}enqueue(X){return new Promise((Aa,Q)=>{this.Nm.add(Object.assign(new y,{yQf:X,resolve:Aa,reject:Q}));this.process()})}process(){if(this.hmb||this.kC===this.Nm.count)return!1;const X=this.Nm.ma(this.kC++);try{this.hmb=
!0,X.yQf().then(Aa=>{this.hmb=!1;this.c5c(X,Aa,null,!0)}).catch(Aa=>{this.hmb=!1;this.c5c(X,null,Aa,!1)})}catch(Aa){this.hmb=!1,this.c5c(X,null,Aa,!1)}return!0}c5c(X,Aa,Q,fa){if(fa){const Ca=()=>{X.resolve(Aa);this.process()};0<this._timeout?window.setTimeout(()=>{Ca()},this._timeout):Ca()}else{const Ca=()=>{X.reject(Q);this.process()};0<this._timeout?window.setTimeout(()=>{Ca()},this._timeout):Ca()}}}Object(t.a)(D,"PromiseQueue",null,[]);class I{constructor(){this.correlationId=this.resolve=null}}
Object(t.a)(I,"ResolveWithCorrelation",null,[]);var M=a(83),T=a(146),S=a(824),H=a(164);class C extends T.a{constructor(X,Aa,Q,fa,Ca,ia){super(!1,!1,!0);this.K9d=this.b2=null;this.GY=X;this.hCg=Q;this.cw=fa;this.UFg=Ca;this.JEa=ia;this.mt=document.createElement("iframe");this.mt.id="SharedAuthInteractiveFrame";this.mt.setAttribute("name","SharedAuthInteractiveFrame");this.mt.setAttribute("title","SharedAuthInteractiveFrame");this.mt.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.mt.style.border="0";this.mt.style.height="48px";this.mt.style.width="190px";$addHandler(this.mt,"error",Object(B.a)(this,this.RYi,"onSharedAuthFrameError"));X=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",this.GY,Aa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",w.AFrameworkApplication.userType);this.mt.src=X;this.Pvg=new Promise(Ra=>{this.K9d=Ra});this.L9d=!1}EAc(){this.b2={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.hCg,
["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:w.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(B.a)(this,this.zdh,"createFrame"),["resolveDialogStyles"]:this.K9d}};this.Tb=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(B.a)(this,this.CCj,"sharedAuthConsentDialogHandler"),this.b2)}gFc(X=!1,Aa=!1,Q=5){this.b2&&this.b2.bodyControls&&(X!==Object(M.a)(Object,this.b2.bodyControls).frameLoaded&&(Object(M.a)(Object,this.b2.bodyControls).frameLoaded=X),Aa!==Object(M.a)(Object,
this.b2.bodyControls).frameLoadSuccess&&(Object(M.a)(Object,this.b2.bodyControls).frameLoadSuccess=Aa),Q!==this.b2.dialogButtonsOption&&(this.b2.dialogButtonsOption=null,this.Tb=Q),this.update(this.b2))}WIj(X,Aa){const Q=new S.a(H.a.GCj);Q.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,["rtl"]:w.AFrameworkApplication.isRtl,["messageCorrelationId"]:X,["dialogStyles"]:Aa};this.cw.QSa(Q,this.mt.contentWindow,this.GY)}A_e(){this.gFc(!0,!1,6)}get Q7f(){return this.mt}get bnh(){return this.Pvg.then(X=>
{this.L9d=!0;return X})}get cnh(){return this.L9d}RYi(){this.A_e()}zdh(){return this.mt}CCj(X){0===X&&(this.UFg.reject(Object.assign(new d,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.JEa(null))}}Object(t.a)(C,"SharedAuthConsentDialog",T.a,[875]);var G=a(1241),J=a(98),L=a(135),P=a(39),aa=a(171),U=a(189);class K{constructor(){this.mt=null;this.oVb=0;this.rlb=this.pZa=this.hIc=this.JEa=this.yM=this.lne=null;this.cw=new G.a(null,null);this.aZa="SharedAuthTokenStrategy Unloaded";
this.GY=n.a.ECj;this.mle=n.a.DCj;this.v$d=n.a.enableConsoleLogging;this.fwg=w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.rEg=w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",!1);this.Cra={};this.Eyg=new D(1500)}lyb(){return this.aZa}initialize(){var {OAuthManager:X}=a(843);if("loadFrame"in this.Cra)return this.Cra.loadFrame.uye;if(!this.GY)return J.Health.instance.recordKpiFailure(X.kpiName,
"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);X=this.VBc("loadFrame");this.oVb=P.a.Ud();var Aa=this.GY+this.mle+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+w.AFrameworkApplication.userSessionId+"&WacUserType="+w.AFrameworkApplication.userType;this.mt=document.createElement("iframe");this.ngi(this.mt);this.mt.style.cssText="height:0;width:0;display:none;";
this.mt.id="SharedAuthFrame";this.mt.setAttribute("name","SharedAuthFrame");this.mt.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.mt.setAttribute("title","SharedAuthFrame");this.mt.src=Aa;document.body.appendChild(this.mt);Aa=P.a.Ud()-this.oVb;c.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",Aa,this.mt.src);return X}zmc(X){this.hIc=X;const Aa=new S.a(H.a.T7f);Aa.Values=this.Wxe(X);
X=this.VBc("initFrame");this.cw.QSa(Aa,this.mt.contentWindow,this.GY);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return X}YL(X,Aa,Q,fa,Ca,ia){const Ra=new S.a(H.a.HCj),Ya=this.P7e();Ra.Values=this.ihg(X,Aa,Q,fa,Ca,ia,Ya);X=this.VBc(Ya);fa&&w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.Eyg.enqueue(()=>new Promise(Ga=>{this.YUj(ia,Ra,Ga,Ya)})):(this.cw.QSa(Ra,this.mt.contentWindow,
this.GY),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",Aa));return X}YUj(X,Aa,Q,fa){const Ca=this.Cra[fa];Ca&&(this.pZa=Aa,this.JEa=Object.assign(new I,{resolve:Q,correlationId:fa}),this.yM=new C(this.GY,this.mle,X,this.cw,Ca,Q),this.yM.EAc())}P7e(){return aa.a.create().toString()}ihg(X,Aa,Q,fa,Ca,ia,Ra){const Ya={};Ya.appName=X;Ya.appId=Aa;Ya.target=Q;Ya.withPopup=fa;Ya.claims=Ca;Ya.promptMessage=ia;Ya.messageCorrelationId=Ra;return Ya}ngi(X){$addHandler(X,
"load",Object(B.a)(this,this.VTi,"onIFrameLoaded"));$addHandler(X,"error",Object(B.a)(this,this.mqc,"onIFrameError"));this.cw.CGa(this.GY);this.cw.vo(H.a.W7f);this.cw.em(H.a.W7f,Object(B.a)(this,this.iYi,"onScriptLoaded"));this.cw.vo(H.a.V7f);this.cw.em(H.a.V7f,Object(B.a)(this,this.hYi,"onScriptInitialized"));this.cw.vo(H.a.R7f);this.cw.em(H.a.R7f,Object(B.a)(this,this.wTi,"onGetTokenResponse"));this.cw.vo(H.a.X7f);this.cw.em(H.a.X7f,Object(B.a)(this,this.oVi,"onLoginResponse"));this.cw.vo(H.a.U7f);
this.cw.em(H.a.U7f,Object(B.a)(this,this.rUi,"onInteractiveFlowReady"));this.cw.vo(H.a.S7f);this.cw.em(H.a.S7f,Object(B.a)(this,this.OTi,"onHideDialog"));this.cw.vo(H.a.P7f);this.cw.em(H.a.P7f,Object(B.a)(this,this.JOi,"onCloseDialog"))}VBc(X){const Aa=new y;Aa.startTime=P.a.Ud();const Q=new Promise((fa,Ca)=>{Aa.resolve=fa;Aa.reject=Ca});Aa.uye=Q;this.Cra[X]=Aa;return Q}VTi(){const X=P.a.Ud()-this.oVb;c.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",X)}mqc(X){const {OAuthManager:Aa}=
a(843),Q=P.a.Ud()-this.oVb,fa=Object.assign(new U.a,{durationMs:Q});J.Health.instance.recordKpiFailure(Aa.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,fa);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",Q,this.v$d?JSON.stringify(X):"")}iYi(X){const {OAuthManager:Aa}=a(843),Q=this.Cra.loadFrame;var fa=P.a.Ud()-Q.startTime,Ca=X.Values.AuthLibrary.toString();X=X.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",
X,Ca,fa);Ca&&(this.aZa="SharedAuthTokenStrategy "+Ca);Ca=Boolean.parse(X);Ca||(X=L.a.gs(),void 0!==X&&null!==X&&(X.set("AuthLibrary",this.lyb()),fa=Object.assign(new U.a,{durationMs:fa,extendedProperties:X}),J.Health.instance.recordKpiFailure(Aa.kpiName,"SharedAuthStrategyInitFailed",!1,!0,fa)));Q.resolve(Ca?0:1)}hYi(X){if(X.Values.interactive&&this.pZa&&this.pZa.Values.messageCorrelationId){const Q=this.pZa.Values.messageCorrelationId.toString();if(X.Values.interactive&&this.yM){this.yM.bnh.then(fa=>
{this.cw.QSa(this.pZa,this.yM.Q7f.contentWindow,this.GY);this.yM.WIj(Q,fa);this.yM.gFc(!0,!0);this.pZa=null});return}}X=this.Cra.initFrame;const Aa=P.a.Ud()-X.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",Aa);X.resolve(0)}wTi(X){if(X.Values.messageCorrelationId&&X.Values.messageCorrelationId.toString()){var Aa=X.Values.messageCorrelationId.toString(),Q=this.Cra[Aa];if(Q){var fa=P.a.Ud()-Q.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",
fa);X.Values.isSuccess&&X.Values.isSuccess?Q.resolve(X.Values.response):Q.reject(X.Values.response);this.xhg(Aa)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}rUi(){if(this.yM.cnh)this.yM.A_e();else if(this.hIc&&this.yM){const X=new S.a(H.a.T7f);X.Values=this.Wxe(this.hIc,!0);this.cw.QSa(X,
this.yM.Q7f.contentWindow,this.GY)}}OTi(){this.yM&&this.yM.vzb()}JOi(X){X.Values.cancelled&&X.Values.cancelled&&X.Values.messageCorrelationId&&this.xhg(X.Values.messageCorrelationId.toString());this.yM&&this.yM.hide()}Wxe(X,Aa=!1){const Q={};Q.appIds=this.JOh();Q.upn=X.loginHint;Q.authority=X.authority;Q.authorityType=Object(b.a)(f,X.authorityType);Q.tenantId=X.tenantId;Q.correlationId=w.AFrameworkApplication.userSessionId;Q.enableConsoleLogging=this.v$d;Q.enablePopupFlash=this.fwg;Q.skipUpnCheck=
this.rEg;Q.interactive=Aa;return Q}JOh(){const X=[],Aa=n.a.DZc;for(let Q in Aa)Array.add(X,Aa[Q]);return X}RDc(X,Aa,Q,fa,Ca,ia){const Ra=new S.a(H.a.FCj),Ya=this.P7e();Ra.Values=this.ihg(X,Aa,Q,fa,Ca,ia,Ya);this.lne=Ra;X=this.VBc(Ya);c.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",Aa);this.GGj();return X}oCc(){return!0}GGj(){this.rlb||(this.rlb=new z.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,
null),this.rlb.id=16,this.rlb.Ksd=!1,this.rlb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.cw.QSa(this.lne,this.mt.contentWindow,this.GY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}oVi(X){if(X.Values.messageCorrelationId&&X.Values.messageCorrelationId.toString()){var Aa=
this.Cra[X.Values.messageCorrelationId.toString()];if(Aa){var Q=P.a.Ud()-Aa.startTime;c.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Q);X.Values.isSuccess&&X.Values.isSuccess?Aa.resolve(X.Values.response):Aa.reject(X.Values.response)}else c.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}xhg(X){this.JEa&&
this.JEa.correlationId===X&&(this.JEa.resolve(null),this.JEa=null)}}Object(t.a)(K,"SharedAuthTokenStrategy",null,[861]);class Y{constructor(X){this.ASc=X;this.aZa="UnsupportedAuthTokenStrategy Reason="+e.a[this.ASc]}initialize(){return Promise.resolve(0)}zmc(){return Promise.resolve(0)}YL(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:e.a[this.ASc],ErrorMessage:"Unable to get a token. Reason: ["+e.a[this.ASc]+"]"}))}RDc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,
ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}oCc(){return!1}lyb(){return this.aZa}}Object(t.a)(Y,"UnsupportedAuthTokenStrategy",null,[861]);var na=a(717);a.d(E,"OAuthManager",function(){return W});class W{constructor(X=null){this.dT=0;this.BP=null;this.PCg=0;const Aa=P.a.Ud();this.uyg=this.smh(X).then(Q=>Q?this.Fei():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",
this.Ev(),Math.floor(P.a.Ud()-Aa)),Q=L.a.gs(),void 0!==Q&&null!==Q&&(Q.set("AuthLibrary",this.Ev()),Q=Object.assign(new U.a,{durationMs:Math.floor(P.a.Ud()-Aa),extendedProperties:Q}),J.Health.instance.recordKpiFailure(W.kpiName,"StrategyPickFailed",!1,!0,Q)),Promise.resolve(1))).then(Q=>0!==Q?Promise.resolve(Q):this.Bzi())}tmh(){var X=n.a.bIi;X&&0<X.length?(this.dT=1,this.BP=new h(X)):w.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||w.AFrameworkApplication.fa.qa("IsO365CommercialHost")?w.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(this.dT=2,this.BP=new Y(this.dT)):(X=m.a.getAuthContext().loginHint)&&X.length?n.a.Azb?(this.dT=1,this.BP=new v):(this.dT=1,this.BP=new K):(this.dT=3,this.BP=new Y(this.dT)):(this.dT=4,this.BP=new Y(this.dT))}Ev(){return this.BP?this.BP.lyb()||"Unknown":"None"}smh(X=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const Aa=P.a.Ud();return w.AFrameworkApplication.fa.Shd().then(Q=>{Q?(this.tmh(),X&&(this.BP=X),c.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
n.a.clientVersion,n.a.appVersion,n.a.mph,this.Ev(),Math.floor(P.a.Ud()-Aa))):c.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(P.a.Ud()-Aa));return Promise.resolve(Q)},()=>{c.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(P.a.Ud()-Aa));return Promise.resolve(!1)})}Fei(){c.ULS.sendTraceTag(573390991,
3E3,50,"Initializing {0}",this.Ev());const X=P.a.Ud();return l.get(this.BP.initialize(),2,n.a.HJd).then(Aa=>{if(0===Aa)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.Ev(),Math.floor(P.a.Ud()-X));else if(1===Aa){c.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.Ev(),Math.floor(P.a.Ud()-X));var Q=L.a.gs();void 0!==Q&&null!==Q&&(Q.set("AuthLibrary",this.Ev()),Q=Object.assign(new U.a,{durationMs:Math.floor(P.a.Ud()-
X),extendedProperties:Q}),J.Health.instance.recordKpiFailure(W.kpiName,"StrategyInitFailed",!1,!0,Q))}else 2===Aa&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.Ev(),Math.floor(P.a.Ud()-X)),Q=L.a.gs(),void 0!==Q&&null!==Q&&(Q.set("AuthLibrary",this.Ev()),Q=Object.assign(new U.a,{durationMs:Math.floor(P.a.Ud()-X),extendedProperties:Q}),J.Health.instance.recordKpiFailure(W.kpiName,"StrategyInitTimedOut",!1,!0,Q)));
return Promise.resolve(Aa)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.Ev(),Math.floor(P.a.Ud()-X));return Promise.resolve(1)})}Bzi(){c.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.Ev());const X=P.a.Ud();return l.get(this.BP.zmc(m.a.getAuthContext()),2,n.a.HJd).then(Aa=>{if(0===Aa)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.Ev(),Math.floor(P.a.Ud()-X));else if(1===Aa){c.ULS.sendTraceTag(562128583,
3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.Ev(),Math.floor(P.a.Ud()-X));var Q=L.a.gs();void 0!==Q&&null!==Q&&(Q.set("AuthLibrary",this.Ev()),Q=Object.assign(new U.a,{durationMs:Math.floor(P.a.Ud()-X),extendedProperties:Q}),J.Health.instance.recordKpiFailure(W.kpiName,"StrategyLoadFailed",!1,!0,Q))}else 2===Aa&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.Ev(),Math.floor(P.a.Ud()-
X)),Q=L.a.gs(),void 0!==Q&&null!==Q&&(Q.set("AuthLibrary",this.Ev()),Q=Object.assign(new U.a,{durationMs:Math.floor(P.a.Ud()-X),extendedProperties:Q}),J.Health.instance.recordKpiFailure(W.kpiName,"StrategyLoadTimedOut",!1,!0,Q)));return Promise.resolve(Aa)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.Ev(),Math.floor(P.a.Ud()-X));return Promise.resolve(1)})}YL(X,Aa,Q=null){return this.PDc(X,Aa,!1,null,"",Q)}jhg(X,Aa,Q,
fa,Ca=null){return this.PDc(X,Aa,!0,Q,fa,Ca)}PDc(X,Aa,Q,fa,Ca,ia,Ra=0){Ra+=1;c.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",X,this.wSa(X,Aa),this.Ev(),Ra);var Ya=L.a.gs();void 0!==Ya&&null!==Ya&&(Ya.set("AuthLibrary",this.Ev()),Ya.set("AppName",X),Ya.set("Target",this.wSa(X,Aa)),J.Health.instance.recordKpiUsage(W.kpiName,0,"WacOAuthFC",Ya));if(!n.a.isEnabled){var Ga;return this.Jxd((Ga=new d,Ga.IsSuccess=!1,Ga.Token=
null,Ga.ErrorCode="NotEnabled",Ga.ErrorMessage="OAuthManager is disabled.",Ga),X)}const da=n.a.DZc[X];if(void 0===da||null===da){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",X);var Z;return this.Jxd((Z=new d,Z.IsSuccess=!1,Z.Token=null,Z.ErrorCode="DisallowedApp",Z.ErrorMessage="Disallowed appName: "+X,Z),X)}const ha=P.a.Ud(),Wa=this;Ya=this.uyg.then(Za=>Wa.oki(X,da,Aa,Q,fa,Ca,ia,Za));Ga=Q?0:n.a.HJd;let ca;
Z=(ca=new d,ca.IsSuccess=!1,ca.Token=null,ca.ErrorCode="authTokenStrategy_timeout",ca.ErrorMessage="Auth Strategy timed out after ["+Ga+"] ms when fetching token",ca);let ja=this,ua=this;return l.get(Ya,Z,Ga).then(Za=>Ra<=W.IGi&&(Za.ErrorCode===W.qfg||Za.ErrorCode===W.BNj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Ra,Math.floor(P.a.Ud()-ha)),ja.PDc(X,Aa,Q,fa,Ca,ia,Ra)):Za.ErrorCode===W.Sof&&!Q&&(c.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",
Ra,W.yQe),W.nsh&&ja.BP.oCc()&&ja.BP.RDc(X,da,Aa,Q,fa,Ca).then(Pa=>Promise.resolve(ja.Rmc(Pa,X,Aa,da,ha))).catch(()=>{let Pa;const ka=(Pa=new d,Pa.IsSuccess=!1,Pa.Token=null,Pa.ErrorCode="authTokenStrategy_failure",Pa.ErrorMessage="LoginPopup failed, GetToken could not be called",Pa);return Promise.resolve(ja.Rmc(ka,X,Aa,da,ha))}),W.yQe)?ja.PDc(X,Aa,!0,fa,Ca,ia,Ra):Promise.resolve(ja.Rmc(Za,X,Aa,da,ha))).catch(()=>{let Za;const Pa=(Za=new d,Za.IsSuccess=!1,Za.Token=null,Za.ErrorCode="authTokenStrategy_failure",
Za.ErrorMessage="Auth Strategy failed with an unknown error",Za);return Promise.resolve(ua.Rmc(Pa,X,Aa,da,ha))})}oki(X,Aa,Q,fa,Ca,ia,Ra,Ya){return 1===Ya||2===Ya?this.Jxd(Object.assign(new d,{IsSuccess:!1,Token:null,ErrorCode:1===Ya?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),X):this.BP.YL(X,Aa,Q,fa,Ca,ia,Ra).then(Ga=>Promise.resolve(this.Jyf(Ga,!0,X))).catch(Ga=>Promise.resolve(this.Jyf(Ga,!1,X)))}Rmc(X,Aa,Q,fa,Ca){const ia={};Ca=P.a.Ud()-Ca;ia.IsSuccess=X.IsSuccess;
ia.ErrorCode=X.IsSuccess?"Success":X.ErrorCode||"";ia.ErrorMessage=X.IsSuccess?"Success":this.wSa(Aa,X.ErrorMessage||"");ia.Target=this.wSa(Aa,Q||"");ia.TimeInMS=Math.floor(Ca);ia.AuthLibrary=this.Ev();ia.AppName=Aa;ia.AuthorityType=Object(b.a)(f,m.a.vcc());ia.UserType=this.V5h(m.a.getAuthContext());ia.IsAuthSupportedInSession=e.a[this.dT];ia.RequestCount=++this.PCg;ia.AppId=fa;c.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(ia));X.IsSuccess||(Q=L.a.gs(),void 0!==Q&&null!==Q&&(Q.set("AppName",
Aa),Q.set("AuthLibrary",this.Ev()),Q.set("ErrorCode",X.ErrorCode),Q.set("ErrorMessage",this.wSa(Aa,X.ErrorMessage)),Aa=Object.assign(new U.a,{durationMs:Ca,extendedProperties:Q}),J.Health.instance.recordKpiFailure(W.kpiName,"TryGetTokenFailure",!1,!0,Aa)));return X}Jxd(X,Aa){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",Aa,this.wSa(Aa,X.ErrorMessage));const Q=L.a.gs();void 0!==Q&&null!==Q&&(Q.set("AppName",Aa),Q.set("AuthLibrary",
this.Ev()),Q.set("ErrorCode",X.ErrorCode),Q.set("ErrorMessage",this.wSa(Aa,X.ErrorMessage)),Aa=Object.assign(new U.a,{extendedProperties:Q}),J.Health.instance.recordKpiFailure(W.kpiName,"FailureBeforeGetToken",!1,!0,Aa));return Promise.resolve(X)}Sjf(X){return X===na.a.aDc}wSa(X,Aa){return this.Sjf(X)&&Aa?"REDACTED":Aa}V5h(X){return w.AFrameworkApplication.fa.qa("IsAnonymousUser")?"anonymous":!X.loginHint||1>X.loginHint.length?"empty":-1<X.loginHint.indexOf("guest#")?"guest":-1<X.loginHint.indexOf("ext#")?
"external":0>X.upn.indexOf("@")?"no-at":"supported"}kNa(){return 1===this.dT}Jyf(X,Aa,Q){let fa=null,Ca=null,ia=null,Ra=null;X?X.ErrorCode||X.ErrorMessage?(Ca=X.ErrorCode?X.ErrorCode:W.$We,ia=X.ErrorMessage?X.ErrorMessage:"No message"):X.Token?Aa?fa=X.Token:(Ca=W.Yfj,ia="A rejected promise returned a token."):(Ca=W.$We,ia=JSON.stringify(X)):(Ca=W.vKi,ia="No result came from Auth Token Strategy");X&&X.Telemetry&&!this.Sjf(Q)&&(Ra=X.Telemetry,c.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Ra)));
if(Ca===W.mIi||Ca===W.mSj)Ca=W.qfg,ia="Auth Library Timed Out";Ca===W.JUg&&-1<ia.indexOf(W.NGg)&&(Ca=W.Sof);if(Ca||ia)fa=null;return Object.assign(new d,{IsSuccess:!!fa,Token:fa,ErrorCode:Ca,ErrorMessage:ia,Telemetry:Ra})}static get yQe(){return w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get nsh(){return w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}W.mSj=
"token_renewal_error";W.$We="Exception";W.vKi="NoResult";W.Yfj="RejectToken";W.mIi="monitor_window_timeout";W.qfg="Timeout";W.BNj="authTokenStrategy_timeout";W.JUg="login_required";W.NGg="AADSTS50058";W.Sof="Cookies Disabled";W.kpiName="OAuthManager";W.IGi=2;Object(t.a)(W,"OAuthManager",null,[733])},925:function(t,E,a){a.d(E,"a",function(){return c});t=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";b[b.userUnsupportedNoLoginHint=
3]="userUnsupportedNoLoginHint";b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(t.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/92b4e926c0e2b2b813823638f23c0445/EwaDSEsNext.oauth.js.map