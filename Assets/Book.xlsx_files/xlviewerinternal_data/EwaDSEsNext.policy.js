'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[59],{1438:function(t,E,a){a.r(E);var c=a(0),b=a(15),e=a(84),f=a(851),d=a(187),h=a(554);class m{constructor($b,$c,nd=null){this.id=$b.Id;nd||(nd="");this.tcj=nd;this.sensitivityLabel=$b}}Object(c.a)(m,"AutoPolicyLabelData",null,[]);class l{constructor($b,$c){this.LM=$b;this.displayName=$c}}Object(c.a)(l,"PolicyLabelRequestState",null,[]);var w=a(146),n=a(4),x=a(152),r=a(14),u=a(45),v=a(30);class B{static get Ivd(){return B.Rwi}}
B.Rwi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(c.a)(B,"JustificationDialogHtml",null,[]);class z extends w.a{constructor($b,$c){super(!1,!1,z.$u);this.Vqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.OXb=null;this.MXb=!1;this.BYb=$b;this.qE=$c;this.og=this.mYg();this.Tb=1;this.Ee=z.id;this.qc(1,CommonUIStrings.l_DialogChange);this.JL(1,!1);this.a1(0)}pWd(){if(z.$u)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(e.a)(this,this.uSf,"reactJustificationDialogHandler"),this.D7e(this.MXb));else{const $b={};for(let $c=0;$c<this.Vqa.length;$c++)$b[z.bKd+$c]=!1;$b[z.NPb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.Qwi,"justificationDialogHandler"),$b);this.sej();u.a.addHandler($get(z.NPb),r.a.input,Object(e.a)(this,this.aQj,"textAreaHandler"))}}validate(){if(z.$u)return this.omg(this.OXb);const $b=$get(z.NPb);return $b.disabled?!0:this.omg($b.value)}omg($b){const $c=
2>$b.length,nd=500<$b.length,Oc=RegExp("[{|}|;|\\\\]").test($b);$b=""===v.a.dvc($b);return!$c&&!nd&&!Oc&&!$b}Qwi($b,$c){let nd="";if(1===$b)for(let Oc=0;Oc<this.Vqa.length;Oc++)if($c[z.bKd+Oc]){nd=Oc===this.Vqa.length-1?$c[z.NPb]:this.Vqa[Oc];break}this.qE($b,this.BYb,nd)}uSf($b){let $c="";1===$b&&this.OXb&&($c=this.OXb);this.qE($b,this.BYb,$c)}KUi($b){this.OXb=$b;$b=this.validate();this.MXb!==$b&&(this.MXb=$b,this.kVa(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.uSf,"reactJustificationDialogHandler"),
this.D7e(this.MXb)))}D7e($b){return{["id"]:this.Ee,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!$b},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(e.a)(this,this.KUi,"onJustificationUpdated")}}aQj($b){$b.target&&this.JL(1,this.validate())}mYg(){return w.a.jq(z.Ivd,n.AFrameworkApplication.sB,x.getImageClass(z.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.Vqa[0],this.Vqa[1],this.Vqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}sej(){const $b=document.getElementsByName(z.szi);for(let $c=0;$c<$b.length;$c++)u.a.addHandler($b[$c],
r.a.focus,Object(e.a)(this,this.aRf,"radioButtonFocusHandler")),u.a.addHandler($b[$c],r.a.click,Object(e.a)(this,this.aRf,"radioButtonFocusHandler"))}aRf($b){if($b=$b.target){$b.checked=!0;var $c=$get(z.NPb);$b.id===z.bKd+(this.Vqa.length-1)?($c.disabled=!1,Sys.UI.DomElement.setVisible($c,!0),$c.focus()):($c.disabled=!0,$b.focus());this.JL(1,this.validate())}}static get $u(){return n.AFrameworkApplication.ta.Pa.Lv&&n.AFrameworkApplication.ta.Pa.ytd}}z.Ivd=B.Ivd;z.szi="ListRadioBox";z.bKd="radiobox";
z.NPb="txtJustification";z.iconName="Info_32x32x32";z.id="JustificationDialog";Object(c.a)(z,"JustificationDialog",w.a,[]);class A extends w.a{constructor($b,$c,nd){super(!1,!1,!0);if($b&&nd){var Oc={["id"]:"MandatoryLabellingDialog"};this.Ovg=nd;this.DPc=$c;if(!n.AFrameworkApplication.fa.qa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.DPc&&""!==this.DPc)Oc.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.DPc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};$c={["sections"]:[],["shouldAutoOpen"]:!1};Array.add($c.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:$b});Oc.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:$c};$b={["id"]:"MandatoryLabellingDialog",["bodyControls"]:Oc};Oc.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
Oc.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(e.a)(this,this.yFi,"mandatoryLabellingDialogHandler"),$b)}else b.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}yFi($b,$c){1===$b&&$c.selectedLabel&&($b=$c.selectedLabel,""!==$b&&this.Ovg($b))}}Object(c.a)(A,"MandatoryLabellingDialog",w.a,[]);class y{constructor(){this.Lkb=!!n.AFrameworkApplication.ta&&
n.AFrameworkApplication.ta.Pa.Lv}Deh($b,$c,nd){this.Lkb&&new A($b,$c,nd)}static get instance(){return y.Ma||(y.Ma=new y)}}y.Ma=null;Object(c.a)(y,"MandatoryLabellingDialogFactory",null,[360]);class D{}D.cNj="sbProtectForm14";D.eNj="SBStatusBarMarkAsReadOnly14";D.Dyi="Info_16x16x32";D.Lrb="QuickSearchCompletedToday_16x16x32";D.BKd="CommonControlCheckboxCheck_16";D.Dfg="On";D.visible="Visible";D.bJh="ImageIsVisible";D.vG="SourceControlId";D.menuItemId="MenuItemId";D.menu="Menu";D.CZc="AppLockId";D.value=
"Value";D.ti="LabelText";D.alt="Alt";D.Mef="Image16by16";D.T6a="Image16by16Class";D.bNj="SBProtectForm_16";D.dNj="SBStatusBarMarkAsReadOnly_16";D.icon="Icon";D.iconColor="IconColor";D.customTooltip="CustomTooltip";D.Pbj="MipTagDynamicFillWithOutline_20";D.Qbj="MipTagLockDynamicFillWithOutline_20";D.Obj="MipTagErrorOutline_20";D.Rbj="MipTagQuestionOutline_20";D.o0d="transparent";D.TVj="UILocation";Object(c.a)(D,"PolicyConstants",null,[]);class I extends w.a{constructor($b,$c,nd){super(!1,!1,I.$u);
this.BYb=$b;this.NXa=$c;this.qE=nd;this.Tb=1;this.Ee=I.id;this.a1(1);this.a1(0)}OWd(){const $b={["id"]:"UserDefinedPermissionsDialog"};I.$u&&this.initializeAndShow("Defined Permissions",Object(e.a)(this,this.A1j,"userDefinedPermissionsDialogHandler"),$b)}A1j($b){1!==$b&&this.qE($b,this.BYb,"",this.NXa)}static get $u(){return n.AFrameworkApplication.ta.Pa.Lv&&n.AFrameworkApplication.ta.Pa.ytd}}I.id="UserDefinedPermissionsDialog";Object(c.a)(I,"UserDefinedPermissionsDialog",w.a,[]);var M=a(591),T=a(378),
S=a(316),H=a(567),C=a(98),G=a(145),J=a(562),L=a(559),P=a(137),aa=a(431),U=a(133),K=a(87),Y=a(201),na=a(333),W=a(82),X=a(106),Aa=a(25),Q=a(72),fa=a(55);class Ca{constructor($b,$c,nd,Oc){this.dPc=this.ePc=null;this.Xce=this.vOc=this.OOc=this.Okb=this.bee=this.Bfe=this.sKc=!1;this.FWa=this.Hfa=this.Aga=this.Upa=this.NXa=this.jt=this.B9=this.mf=null;this.hvg=this.lIc=0;this.X$d=this.LOc=this.xIc=null;this.La=$b;this.df=$c;this.nb=nd;this.eh=Oc;this.ylb={};this.Aie={};this.Cfe={};this.yAb=nd.qa("WacApplyManualPolicyLabelIsEnabled");
this.eh.value.jte(Object(e.a)(this,this.rJd,"processAutoSensitivityLabel"));this.eh.value.GYc(Object(e.a)(this,this.rJd,"processAutoSensitivityLabel"));this.eh.value.Q0b(Object(e.a)(this,this.E_i,"onUpdateLabelInfo"));n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.SNg(Object(e.a)(this,this.Bdj,"refreshDocumentPolicyLabelsOnModeChange"));nd.qa("SupportsPolicies")&&nd.Xa("AppliedPolicyId")&&(this.ePc=nd.Xa("IrmPolicyTitle"),this.dPc=nd.Xa("IrmPolicyDescription"));this.jSc=nd.qa("ProtectedFile");
this.utg=this.nb.ud("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.vtg=this.nb.ud("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get l8a(){return n.AFrameworkApplication.l8a||!!this.LOc&&this.LOc()}Hg(){this.La.Nb(Aa.a.ALf,X.a.frame,Object(e.a)(this,this.vOe,"documentLabelPaneHandler"));this.La.Me(Aa.a.jcb,X.a.frame,Object(e.a)(this,this.jcb,"queryPolicyLabel"),96);this.La.Nb(Aa.a.SUa,X.a.frame,Object(e.a)(this,this.SUa,"toggleSensitivity"));this.La.Nb(Aa.a.Uza,X.a.frame,Object(e.a)(this,
this.Uza,"populateSensitivityFlyout"));this.La.Nb(Aa.a.setSensitivity,X.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.La.Me(Aa.a.kcb,X.a.frame,Object(e.a)(this,this.kcb,"querySensitivity"),96);this.La.Nb(Aa.a.j7,X.a.frame,Object(e.a)(this,this.j7,"querySensitivityToggleButton"));this.La.Nb(Aa.a.i7,X.a.frame,Object(e.a)(this,this.i7,"querySensitivitySubFlyout"));this.Znb(Aa.a.SUa)||this.La.ieb(Aa.a.SUa,4);this.Znb(Aa.a.Uza)||this.La.ieb(Aa.a.Uza,4);this.Znb(Aa.a.setSensitivity)||
this.La.ieb(Aa.a.setSensitivity,4);this.Znb(Aa.a.j7)||this.La.ieb(Aa.a.j7,4);this.Znb(Aa.a.i7)||this.La.ieb(Aa.a.i7,4);this.df.updateCommandUI();n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&P.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.eh.value.djj(Object(e.a)(this,this.oUf,"registerActionsHandler"))}oUf(){this.Hg()}JQb(){this.La.$D(Aa.a.ALf,
X.a.frame,Object(e.a)(this,this.vOe,"documentLabelPaneHandler"));this.La.$D(Aa.a.jcb,X.a.frame,Object(e.a)(this,this.jcb,"queryPolicyLabel"));this.La.$D(Aa.a.SUa,X.a.frame,Object(e.a)(this,this.SUa,"toggleSensitivity"));this.La.$D(Aa.a.Uza,X.a.frame,Object(e.a)(this,this.Uza,"populateSensitivityFlyout"));this.La.$D(Aa.a.setSensitivity,X.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.La.$D(Aa.a.kcb,X.a.frame,Object(e.a)(this,this.kcb,"querySensitivity"));this.La.$D(Aa.a.j7,X.a.frame,
Object(e.a)(this,this.j7,"querySensitivityToggleButton"));this.La.$D(Aa.a.i7,X.a.frame,Object(e.a)(this,this.i7,"querySensitivitySubFlyout"))}SUa(){return 32}A1e($b){const $c="mandatoryLabelling_"+$b.Id;this.Cfe[$c]=$b.Id;return{["type"]:"AppToggleButtonProps",["id"]:$c,["label"]:$b.DisplayName,["hideLabel"]:!1,["customTooltip"]:$b.Tooltip}}kOa(){return this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}sYh(){const $b=[],$c=this.B9;for(let Oc in $c){var nd=$c[Oc];const Gd=
this.jt[Oc];if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!Gd||!Gd.Enabled||Gd.HasUserDefinedPermissions)continue}else if(!Gd||!Gd.Enabled)continue;if(nd.count){const Qd={["sections"]:[],["shouldAutoOpen"]:!1},Ad={["id"]:"mandatoryLabelling_flyoutMenuSection_"+Gd.Id,["controls"]:[]};for(let Sd of nd){nd=this.jt[Sd];if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!nd||!nd.Enabled||
nd.HasUserDefinedPermissions)continue}else if(!nd||!nd.Enabled)continue;Array.add(Ad.controls,this.A1e(nd))}Array.add(Qd.sections,Ad);Array.add($b,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+Gd.Id,["label"]:Gd.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:Qd})}else Array.add($b,this.A1e(Gd))}return $b}Uza($b,$c,nd,Oc,Gd){if(1===nd||!this.eh.value.Fha(!0))return 32;Gd.MenuItems=Object.assign(new J.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});
Array.add(Gd.MenuItems.MenuSectionList,this.Fc(!this.isReactRibbonEnabled()));this.mf.CustomUrl&&Array.add(Gd.MenuItems.MenuSectionList,this.seh(this.isReactRibbonEnabled()?this.mf.CustomUrl:v.a.Xe(this.mf.CustomUrl)));this.isReactRibbonEnabled()||(Gd.PopulationXML=S.q(Gd.MenuItems));return 32}kcb($b,$c,nd,Oc,Gd){if(1===nd||!Gd||!this.yAb)return 32;this.mf=this.eh.value.nn;if(this.eh.value.Fha(!0)&&(Gd[D.visible]=!0,this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",
!1)?this.bee||(G.a("MipLabelsAvailable"),this.bee=!0):G.a("MipLabelsAvailable"),this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.mf&&this.mf.AreLabelsAvailable&&($b=W.a.instance.Rb("Common.ISystemInitiatedFeedback")))){const Qd=Ca.sh(this.mf.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";$b.execute(Ad=>{Ad.logActivity(Qd,null)})}return 32}j7($b,$c,nd,Oc,Gd){if(1===nd||!Gd)return 32;let Qd,Ad;Gd[D.Dfg]=
!!(Qd=Gd[D.menuItemId])&&!!(Ad=this.ylb[Qd])&&Ad===this.mf.AppliedPolicyId;return 32}i7($b,$c,nd,Oc,Gd){if(1===nd||!Gd)return 32;let Qd,Ad,Sd;$b=!!(Qd=Gd[D.vG])&&!!(Ad=this.ylb[Qd])&&!!(Sd=this.B9[Ad])&&Sd.contains(this.mf.AppliedPolicyId);Gd[D.bJh]=$b;Gd[D.Dfg]=$b;return 32}setSensitivity($b,$c,nd,Oc,Gd){if(1===nd||!Gd)return 32;$b=this.ylb[Gd[D.vG]];$c=this.UVj(Gd[D.TVj]);nd=new Q.a;nd.name="SensitivityPickerLocation";nd.int64=$c;G.a("SensitivityPickerUsage",void 0,void 0,[nd]);return this.hoa($b,
Gd,2)}Aic(){return!!n.AFrameworkApplication.ta&&1===n.AFrameworkApplication.ta.mode}Bdj(){this.vOc&&!this.Aic()&&(this.vOc=!1,this.eh.value.Adj())}wgg(){this.mf.DefaultLabelId&&this.mf.MandatoryLabelingEnforced?this.sKc||this.Aic()?this.mf.AppliedPolicyId?this.ebd(""):(this.eh.value.Bsi(this.eh.value.xDb)||this.Aic())&&this.SQe():this.R4f():this.mf.DefaultLabelId?this.R4f():this.mf.MandatoryLabelingEnforced&&(this.mf.AppliedPolicyId?this.ebd(""):this.SQe())}dlf(){return this.mf.MandatoryLabelingEnforced?
this.mf&&this.mf.AreLabelsAvailable?this.nb.qa("TestOverrideIsReactDialogEnabled")||this.df&&this.df.Pa&&this.df.Pa.Lv?!0:(b.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(b.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(b.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)}SQe(){!this.dlf()||n.AFrameworkApplication.G5||this.Bfe||
(this.Bfe=n.AFrameworkApplication.G5=!0,b.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.eh.value.tRf("",1),this.eh.value.zXc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,()=>{this.wFi()}))}ebd($b){this.dlf()&&n.AFrameworkApplication.G5&&(n.AFrameworkApplication.G5=!1,b.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),
this.eh.value.JMd(),this.eh.value.tRf($b,2))}wFi(){y.instance.Deh(this.sYh(),this.mf.CustomUrl,Object(e.a)(this,this.xFi,"mandatoryLabellingDialogCallback"))}xFi($b){this.ebd(this.Cfe[$b])}oye(){return this.nb.qa("CoAuthForProtectedFilesEnabled")&&this.nb.qa("SupportsOfficeClientCoauthoring")&&this.nb.qa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.X$d&&this.l8a}hoa($b,$c,nd,Oc=null){this.eh.value.waj(nd);let Gd=32,Qd=!1,Ad=!0;const Sd=2===nd||8===nd||16===nd,Ce=$b===this.mf.AppliedPolicyId;
if(this.xIc&&this.xIc($b,Sd))b.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",nd),this.df.updateCommandUI();else if($c&&D.CZc in $c&&this.eh.value.Iyj($c[D.CZc]),$b)if(this.eh.value.hnf()||this.oye()&&this.OOc)b.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",nd),this.df.updateCommandUI(),Sd&&this.E1b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,
CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.nb.qa("HasDocumentEditRights"))if(this.eh.value.u1g($b))if(!this.kOa()&&this.jt[$b]&&this.jt[$b].HasUserDefinedPermissions&&!Ce)b.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",nd),1!==nd&&4!==nd&&this.JQg();else if(Sd&&this.mf.MandatoryLabelingEnforced&&Ce)b.ULS.sendTraceTag(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",
nd),this.E1b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Sd&&this.nb.qa("WacLabelingJustificationDialogIsEnabled")&&this.mf.RequiredDowngradeJustification&&(Ce||this.jt[$b].RequiredDowngradeJustification)&&(this.kOa()?!this.Xce&&!Oc:!this.NXa))return b.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",nd),this.pWd($b),Gd;if(this.kOa()&&this.jt[$b].HasUserDefinedPermissions&&
!Ce)return b.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",nd),this.OWd($b,Oc),Gd;if(this.oye()&&!this.X$d())this.lIc<this.utg?(b.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.lIc,nd),this.OOc=!0,this.lIc++,fa.Task.delay(this.vtg).continueWith(()=>{this.OOc=!1;this.hoa($b,$c,nd)})):(b.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",
nd),Qd=1!==nd,Ad=!1,Gd=8);else{if(this.iri($b)&&(b.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",nd),1===nd||8===nd||4===nd))return Gd;b.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",nd);this.setPolicyLabel(Ce?"":$b,this.kOa()?Oc:this.NXa,"",nd);return Gd}}else b.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",
nd),this.df.updateCommandUI(),Sd&&this.E1b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else b.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",nd),this.df.updateCommandUI(),Sd&&this.E1b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else b.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",
nd),this.df.updateCommandUI(),Qd=Sd,Ad=!1,Gd=8;this.eh.value.qKd(0,nd,Qd,Ad);return Gd}H_a($b,$c,nd=null,Oc=!1){C.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.nb.qa("SupportsOfficeClientCoauthoring")&&this.nb.qa("CoAuthForProtectedFilesIsEnabled")?(this.Okb=!1,(this.mf=this.eh.value.nn)&&!this.mf.AppliedPolicyId?this.Okb=!0:this.mf&&this.mf.PolicyLabelAssignmentMethod&&(this.Okb=Y.e(this.mf.PolicyLabelAssignmentMethod)===Y.e("standard"))):this.Okb=Oc;$b=
Ca.sh($b)?null:this.jt[$b];($c=Ca.sh($c)?null:this.jt[$c])?this.Aga=new m($c,!0,nd):(this.eh.value.Tda(29),this.Hfa=null);$b?this.Upa=new m($b,!1):this.FWa=null;this.rJd(null,null);return 32}GSg($b){""!==this.mf.AppliedPolicyId?this.eh.value.qKd(14,16,!0):this.hoa($b,null,16)}G5f(){this.jt={};if(this.mf=this.eh.value.nn)for(const $b of this.mf.SensitivityLabels)this.jt[$b.Id]=$b}iri($b){if(this.B9&&$b in this.B9){$b=this.B9[$b];for(let $c of $b)if(($b=this.jt[$c])&&$b.Enabled)return!0}return!1}n6f(){this.B9=
{};if(this.mf=this.eh.value.nn){for(const $b of this.mf.SensitivityLabels)$b.ParentId||(this.B9[$b.Id]=new d.a);for(const $b of this.mf.SensitivityLabels)$b.ParentId&&$b.ParentId in this.B9&&this.B9[$b.ParentId].add($b.Id)}}PQf(){if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.mf=this.eh.value.nn;const $b=this.yAb&&this.isReactRibbonEnabled()&&this.eh.value.Fha();Ca.QRa($b)}else this.yAb&&this.isReactRibbonEnabled()?(this.mf=this.eh.value.nn,this.eh.value.Fha()?
(Ca.QRa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):Ca.QRa(!1)):Ca.QRa(!1)}Zdj($b){this.xIc=$b}Nej($b){this.LOc=$b}R4f(){if(this.nb.qa("WacApplyDefaultPolicyLabelIsEnabled"))if(this.Aic())this.vOc=!0;else if(!this.sKc)if(this.sKc=!0,this.mf=this.eh.value.nn,this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)){if(this.mf&&this.mf.DefaultLabelId)if(!this.mf.AppliedPolicyId)b.ULS.sendTraceTag(509732190,306,50,
"Default labeling triggered. DefaultLabelType: {0}",this.mf.DefaultLabelType),this.hoa(this.mf.DefaultLabelId,null,1);else if(h.a.ak().equals(this.mf.DefaultLabelType,"documentLibraryDefault")){const $b=this.jt[this.mf.AppliedPolicyId],$c=this.jt[this.mf.DefaultLabelId];this.mf.AppliedPolicyId!==this.mf.DefaultLabelId&&h.a.ak().equals(this.mf.PolicyLabelAssignmentMethod,"standard")&&$b.Order<$c.Order&&(b.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.mf.DefaultLabelType),
this.hoa(this.mf.DefaultLabelId,null,1))}}else this.mf&&this.mf.DefaultLabelId&&!this.mf.AppliedPolicyId&&(b.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.mf.DefaultLabelId),this.hoa(this.mf.DefaultLabelId,null,1))}rJd(){if(!this.eh.value.hnf()){var $b=this.jt[this.mf.AppliedPolicyId];this.Okb&&this.Upa&&this.FWa!==this.Upa.id&&(!$b||$b.Order<this.Upa.sensitivityLabel.Order)&&($b=this.hoa(this.Upa.id,{},4),32!==$b?b.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+
$b):(this.FWa=this.Upa.id,this.Hfa&&($b=this.jt[this.Hfa])&&$b.Order<=this.Upa.sensitivityLabel.Order&&(this.eh.value.Tda(29),this.Hfa=null)));$b=this.jt[this.eh.value.nn.AppliedPolicyId];if(this.Aga&&this.Hfa!==this.Aga.id&&(!$b||$b.Order<this.Aga.sensitivityLabel.Order)){const $c=this.Aga.id;this.eh.value.Tda(29);this.eh.value.f0b(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.ljd(this.Aga.sensitivityLabel))+" "+this.Aga.tcj,CommonUIStrings.l_PolicyLabelRecommendationButton,
()=>{this.hoa($c,{},8)});this.Hfa=this.Aga.id}this.Aga=this.Upa=null}}setPolicyLabel($b,$c,nd,Oc=2){this.kOa()?$c&&(this.Xce=!0):this.NXa=$c;this.eh.value.setPolicyLabel($b);this.df.updateCommandUI();nd=new l(Oc,this.ljd(this.jt[$b]));this.eh.value.tTd($b,this.kOa()?$c:this.NXa,nd)}r$g($b,$c,nd,Oc){1===$b&&this.setPolicyLabel($c,Oc,nd)}q$g($b,$c,nd){1===$b?this.kOa()?this.hoa($c,null,2,nd):this.setPolicyLabel($c===this.mf.AppliedPolicyId?"":$c,nd,""):this.df.updateCommandUI()}pWd($b){(new z($b,Object(e.a)(this,
this.q$g,"continueToSetPolicyLabelFromJustificationDialog"))).pWd()}OWd($b,$c){(new I($b,$c,Object(e.a)(this,this.r$g,"continueToSetPolicyLabelFromUDPDialog"))).OWd()}E1b($b="",$c=""){const nd=new U.StandardDialog;nd.Lt=n.AFrameworkApplication.FAb;nd.Tb=0;nd.qc(1,CommonUIStrings.l_DialogClose);nd.CX($b,$c,null)}wWg($b){1===$b&&this.eh.value.Aaj()}JQg(){const $b=new U.StandardDialog;$b.Lt=n.AFrameworkApplication.FAb;$b.Tb=1;$b.qc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);$b.qc(0,CommonUIStrings.l_DialogClose);
$b.CX(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(e.a)(this,this.wWg,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.df&&!!this.df.Pa&&this.df.Pa.Pi}jkc(){return this.df&&this.df.Pa?this.df.Pa.jkc:!1}vOe(){return 32}jcb($b,$c,nd,Oc,Gd){if(1===nd)return 32;this.mf=this.eh.value.nn;if(!this.mf||!Gd)return 32;Gd[D.value]="";Gd[D.ti]="";Gd[D.alt]=null;Gd[D.Mef]=null;Gd[D.T6a]=null;Gd[D.customTooltip]="";Gd[D.visible]=
!1;Gd[D.iconColor]="";nd=$c=$b=Gd[D.icon]="";if(!this.mf.AreLabelsAvailable){if(!this.ePc)return 32;$b=this.ePc;nd=D.o0d;this.dPc&&($c=this.dPc)}else if(this.mf.AppliedPolicyId){Oc=null;for(const Qd of this.mf.SensitivityLabels)if(Qd.Id.toLowerCase()===this.mf.AppliedPolicyId.toLowerCase()){Oc=Qd;break}Oc&&($b=this.ljd(Oc),$c=Oc.Tooltip,this.jSc=n.AFrameworkApplication.protectedFile=Oc.IsEndpointProtectionEnabled,nd=this.A2e(Oc))}this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",
!1)?($b?(Gd[D.value]=$b,Gd[D.ti]=$b,Gd[D.customTooltip]=$c,this.P5f(nd,this.jSc,Gd)):this.nb.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?(Gd[D.iconColor]=D.o0d,this.mf.MandatoryLabelingEnforced?(Gd[D.value]=Gd[D.ti]=HeaderStrings.SelectASensitivityLabel,Gd[D.icon]=D.Obj):(Gd[D.value]=Gd[D.ti]=HeaderStrings.NoSensitivityLabel,Gd[D.icon]=D.Rbj)):(Gd[D.iconColor]="#000000",this.mf.MandatoryLabelingEnforced?(Gd[D.value]=Gd[D.ti]=HeaderStrings.SelectASensitivityLabel,
Gd[D.icon]="MipTagErrorDynamicColor_20"):(Gd[D.value]=Gd[D.ti]=HeaderStrings.NoSensitivityLabel,Gd[D.icon]="MipTagQuestionDynamicColor_20")),Gd[D.visible]=!0):$b&&(Gd[D.value]=$b,Gd[D.ti]=$b,this.jkc()?Gd[D.customTooltip]=$c:Gd[D.alt]=$c,this.P5f(nd,this.jSc,Gd),Gd[D.visible]=!0);return 32}ljd($b){return $b?this.jt?$b.ParentId&&this.jt[$b.ParentId]?this.jt[$b.ParentId].DisplayName+"\\"+$b.DisplayName:$b.DisplayName:(b.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),
$b.DisplayName):""}P5f($b,$c,nd){this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(nd[D.icon]=this.m9e($c),nd[D.iconColor]=this.n9e($b)):this.jkc()?nd[D.icon]=$c?D.bNj:D.dNj:(nd[D.Mef]=n.AFrameworkApplication.sB,nd[D.T6a]=$c?x.getImageClass(D.cNj):x.getImageClass(D.eNj))}seh($b){const $c=this.eD("LearnMoreSection",!0);$b=Object.assign(new T.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:$b,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",
Image16by16:n.AFrameworkApplication.sB,Image16by16Class:x.getImageClass(D.Dyi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add($c.ControlList,$b);return $c}CKe($b,$c,nd=!1){let Oc;Oc="Toggle_"+$b.Id;Oc="Sensitivity_"+Oc;const Gd=$b.DisplayName,Qd=$b.Tooltip;var Ad=$b.Id===this.mf.AppliedPolicyId,Sd=nd?v.a.Xe(Oc):Oc;this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Ad=this.A2e($b),$c=Object.assign(new aa.a,{Id:Sd,ExternalId:Sd,LabelText:nd?
v.a.Xe(Gd):Gd,Command:"2935633379",MenuItemId:Sd,QueryCommand:"991261903",Visible:!0,Alt:nd?v.a.Xe(Qd):Qd,AriaLabel:K.a.j2b,IconColor:this.n9e(Ad),KeyTip:$c}),$c.ExternalImageId=this.m9e($b.IsEndpointProtectionEnabled)):(Sd=Object.assign(new M.a,{Id:Sd,ExternalId:Sd,LabelText:nd?v.a.Xe(Gd):Gd,Command:"2935633379",MenuItemId:Sd,QueryCommand:"991261903",CheckedImage:n.AFrameworkApplication.sB,Visible:!0,Alt:nd?v.a.Xe(Qd):Qd,IsChecked:Ad,AriaLabel:K.a.j2b,KeyTip:$c}),this.isReactRibbonEnabled()?(Sd.CheckedImageClass=
x.getImageClass(D.BKd),Sd.ExternalImageId=D.BKd):Sd.CheckedImageClass=x.getImageClass(D.Lrb),$c=Sd);Sd=Oc;this.ylb[Sd]=$b.Id;this.Aie[$b.Id]=Sd;return $c}eD($b,$c=!1){return Object.assign(new L.a,{Title:"",Id:$b,DisplayMode:D.menu,ShowMenuSectionSeparator:$c,ControlsId:"Ctrl_"+$b,ControlList:[]})}uhh($b,$c,nd,Oc){$b=Ca.IXf()?this.eD($b+"Sub"):this.eD($c+"Sub");$c=1;for(let Gd of nd)(nd=this.jt[Gd])&&nd.Enabled&&(Array.add($b.ControlList,this.CKe(nd,$c.toString(),Oc)),$c++);return $b}Fc($b=!1){const $c=
this.eD("SensitivitySection");let nd=1;const Oc=this.B9;for(let Qd in Oc){const Ad=Oc[Qd],Sd=this.jt[Qd];if(Sd&&Sd.Enabled){if(Ad.count){const Ce="Sensitivity_"+Sd.Name;var Gd=$b?v.a.Xe(Ce):Ce;Gd=Ca.IXf()?"Label"+this.hvg++:Gd;const we=Object.assign(new H.a,{Id:Gd,ExternalId:Gd,LabelText:$b?v.a.Xe(Sd.DisplayName):Sd.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new J.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,
AriaLabel:K.a.j2b,KeyTip:nd.toString(),Alt:$b?v.a.Xe(Sd.Tooltip):Sd.Tooltip});this.isReactRibbonEnabled()?we.ExternalImageId=D.BKd:(we.Image16by16=n.AFrameworkApplication.sB,we.Image16by16Class=x.getImageClass(D.Lrb));Array.add(we.Menu.MenuSectionList,this.uhh(Gd,Ce,Ad,$b));Array.add($c.ControlList,we);this.ylb[we.Id]=Sd.Id;this.Aie[Sd.Id]=we.Id}else Array.add($c.ControlList,this.CKe(Sd,nd.toString(),$b));nd++}}return $c}Znb($b){return!!this.La.J4($b)&&!!this.La.J4($b).flags&&!!this.La.J4($b).flags.length}E_i($b,
$c){$c.onSuccess&&this.jt&&($b=this.jt[this.eh.value.nn.AppliedPolicyId])&&(this.Hfa&&($c=this.jt[this.Hfa])&&$c.Order<=$b.Order&&(this.eh.value.Tda(29),this.Hfa=null),this.FWa&&this.FWa!==$b.Id&&(this.eh.value.Tda(28),this.FWa=null))}m9e($b){return $b?D.Qbj:D.Pbj}n9e($b){return $b?$b:D.o0d}A2e($b){if($b.Color||!$b.ParentId)return $b.Color;const $c=this.jt[$b.ParentId];return $c?$c.Color:$b.Color}UVj($b){switch($b){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}static IXf(){if(null!=
Ca.dYb)return Ca.dYb;n.AFrameworkApplication.uya("ce2ai523-t;6f627846-c");Ca.dYb=n.AFrameworkApplication.fa?n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.WordOnline.RenameCLPControlIds",!1):!1;return Ca.dYb}static QRa($b){n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||($b?(na.a.wCd("ribbon","sensitivity"),na.a.qCd("ribbon","sensitivity")):na.a.vCd("ribbon","sensitivity"));n.AFrameworkApplication.fa&&
n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&P.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!$b))}static sh($b){return $b&&$b.length?!1:!0}}Ca.dYb=null;Object(c.a)(Ca,"PolicyActor",null,[288]);var ia=a(641),Ra=a(97),Ya;(function($b){$b[$b.unknown=0]="unknown";$b[$b.boot=1]="boot";$b[$b.refresh=2]="refresh";$b[$b.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Ya||(Ya={}));Object(c.b)("GetPolicyLabelsReason",
Ya);class Ga extends Sys.EventArgs{constructor($b,$c,nd,Oc,Gd,Qd){super();this.Xqb=$b;this.title=$c;this.message=nd;this.buttonText=Oc;this.H$=Gd;this.XBb=Qd}}Object(c.a)(Ga,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class da extends Sys.EventArgs{constructor($b,$c,nd,Oc,Gd){super();this.Xqb=$b;this.title=$c;this.message=nd;this.buttonText=Oc;this.H$=Gd}}Object(c.a)(da,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Z;(function($b){$b[$b.none=0]="none";$b[$b.reasonDefaultLabel=
1]="reasonDefaultLabel";$b[$b.reasonManual=2]="reasonManual";$b[$b.reasonAutomatic=4]="reasonAutomatic";$b[$b.reasonRecommended=8]="reasonRecommended";$b[$b.reasonMandatory=16]="reasonMandatory"})(Z||(Z={}));Object(c.b)("ApplyLabelFlags",Z);class ha extends Sys.EventArgs{constructor($b,$c,nd){super();this.dFe=$b;this.cFe=$c;this.existingLabelPriority=nd}}Object(c.a)(ha,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class Wa extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Wa,"GetPolicyLabelEventArgs",
Sys.EventArgs,[]);class ca extends Sys.EventArgs{constructor(){super()}}Object(c.a)(ca,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class ja{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=
!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}}Object(c.a)(ja,"GetPolicyLabelsData",null,[]);class ua extends Sys.EventArgs{constructor($b=!1){super();this.onSuccess=$b}}Object(c.a)(ua,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class Za extends Sys.EventArgs{constructor($b,$c){super();this.Iya=$b;this.jve=$c}}Object(c.a)(Za,"MandatoryLabellingAppHandlerEventArgs",
Sys.EventArgs,[]);class Pa extends Sys.EventArgs{constructor($b,$c,nd,Oc){super();this.title=$b;this.Xsc=$c;this.buttonText=nd;this.gBf=Oc}}Object(c.a)(Pa,"PolicyTipEventArgs",Sys.EventArgs,[]);class ka extends Sys.EventArgs{constructor($b,$c){super();this.Xqb=$b;this.XBb=$c}}Object(c.a)(ka,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ra extends Sys.EventArgs{constructor(){super()}}Object(c.a)(ra,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ba extends Sys.EventArgs{constructor($b,
$c){super();this.Wsc=$b;this.LM=$c}}Object(c.a)(ba,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class Ua extends Sys.EventArgs{constructor($b,$c,nd,Oc=null,Gd=null,Qd=null,Ad=null){super();this.errorType=$b;this.w$f=nd;this.title=Oc;this.message=Gd;this.buttonText=Qd;this.H$=Ad}}Object(c.a)(Ua,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Ka extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Ka,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class Oa extends Sys.EventArgs{constructor($b){super();
this.JEj=$b}}Object(c.a)(Oa,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var ib=a(107),La=a(103),db=a(41),Ab=a(80),Mb=a(39);class pb{constructor($b,$c,nd,Oc,Gd,Qd,Ad,Sd=null,Ce=null,we=!1,Td=null,he=null,ee=null,ge=null,re=!1,Be=null,Oe=null,gf=null,af=null,Ze=null,Xa=null){this.url=$b;this.l3j=$c;this.body=nd;this.headers=Oc;this.Web=Gd;this.priority=Qd;this.state=Ad;this.xng=Sd;this.KO=Ce;this.vR=we;this.g$i=Td;this.Quj=he;this.name=ee;this.RHb=ge;this.Ned=re;this.iMf=Be;this.zac=Oe;this.Jhc=
gf;this.Cdb=af;this.Eci=Ze;this.responseType=Xa}}Object(c.a)(pb,"ClientRequest",null,[]);var Qb=a(465),xb=a(264);class pa{static lxj($b,$c){if(!$b||!$c||$b.count!==$c.count)return!1;for(let nd of $b)if(!$c.contains(nd))return!1;return!0}static toArray($b){if(!$b)return null;const $c=Array($b.count);let nd=0;for(let Oc of $b)$c[nd]=Oc,nd++;return $c}}Object(c.a)(pa,"HashSetUtils",null,[]);var Ma=a(280),ya=a(189);class Ea{constructor($b,$c,nd,Oc=0,Gd=null){this.oKc=this.l$d=null;this.Qra=this.gkb=this.ikb=
0;this.D8="";this.PFa=this.eIc=this.wce=this.Qpa=this.QPc=null;this.Yce=!1;this.sDa=null;this.QMc=0;this.DXb=this.RFa=this.yEa=this.CXb=null;this.Za=new Ra.a;this.qNb=this.Uxb=this.Cx=null;this.GNc=!1;this.xDb=null;this.nb=$b;this.Ah=$c;this.Ch=nd;this.EWb=Oc;this.nn=new ja;this.zie=this.nb.Xa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.AP=Gd;this.yAb=$b.qa("WacApplyManualPolicyLabelIsEnabled");this.hic=$b.qa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=$b.qa("SupportsOfficeClientCoauthoring");
this.tti=!1;this.xzj=3E4;this.ke=La.a.instance;$b.qa("SupportsPolicies")&&G.a("MipSupportsPolicies");this.hic&&this.supportsOfficeClientCoauthoring&&G.a("MipSupportsOfficeClientCoauthoring")}get rqd(){return this.GNc}Xse($b){this.Za.addHandler("PolicyTipEvent",$b)}Q0b($b){this.Za.addHandler("LabelInfoUpdateEvent",$b)}djj($b){this.Za.removeHandler("LabelInfoUpdateEvent",$b)}jte($b){this.Za.addHandler("SetPolicyLabelEventKey",$b)}pkj($b){this.Za.removeHandler("SetPolicyLabelEventKey",$b)}GYc($b){this.Za.addHandler("SetPolicyLabelFailureEventKey",
$b)}okj($b){this.Za.removeHandler("SetPolicyLabelFailureEventKey",$b)}dNg($b){this.Za.addHandler("GetPolicyLabelEventKey",$b)}cNg($b){this.Za.addHandler("GetPolicyLabelFailureEventKey",$b)}aNg($b){this.Za.addHandler("GetAutoPolicyLabelEventKey",$b);this.rqd&&(b.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.fKd(new Wa(0)))}Jij($b){this.Za.removeHandler("GetAutoPolicyLabelEventKey",$b)}AMg($b){this.Za.addHandler("CreateAutoCLPSecurityNodesEventKey",
$b)}oij($b){this.Za.removeHandler("CreateAutoCLPSecurityNodesEventKey",$b)}sPg($b){this.Za.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",$b)}Ekj($b){this.Za.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",$b)}tPg($b){this.Za.addHandler("UpdateAutoCLPSITNodesEventKey",$b)}Fkj($b){this.Za.removeHandler("UpdateAutoCLPSITNodesEventKey",$b)}Fre($b){this.Za.addHandler("AddAutoPolicyBusinessBarEntryEventKey",$b)}Fhj($b){this.Za.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",$b)}Zse($b){this.Za.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",
$b)}Yjj($b){this.Za.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",$b)}Gre($b){this.Za.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",$b)}Hhj($b){this.Za.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",$b)}$se($b){this.Za.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",$b)}Zjj($b){this.Za.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",$b)}NNg($b){this.Za.addHandler("MandatoryLabellingAppHandlerEventKey",$b)}ojj($b){this.Za.removeHandler("MandatoryLabellingAppHandlerEventKey",
$b)}oPg($b){this.Za.addHandler("UDPLabelingAppHandlerEventKey",$b)}Bkj($b){this.Za.removeHandler("UDPLabelingAppHandlerEventKey",$b)}get Drd(){if(!this.l$d)return!1;for(const $b of this.l$d.g7j())if(!$b.Capabilities||!$b.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get Osi(){return!!this.Cx}P3g(){return this.wce?this.wce():!1}Vdj($b){this.eIc=$b}Ew(){return(new Date).getTime()}ihd(){this.Ch&&(this.CXb=this.Ch.Cc("WebServiceCall","Call Get Policy Endpoint On Server"));var $b=Ma.a.Eia(1,
1);this.nb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?($b=new pb(this.K5a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,$b),this.Ah.send($b).OLd(Object(e.a)(this,this.DCf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.CCf,"onDataLossPolicyFailureCallback"))):this.Ah.Om(this.K5a("datalosspolicy"),1,null,null,!0,2,Object(e.a)(this,this.DCf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.CCf,"onDataLossPolicyFailureCallback"),
null);this.ikb++;b.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.zie,this.ikb)}Adj(){this.hhd(this.D8,2,this.Qpa)}hhd($b,$c=0,nd=null,Oc=!1){C.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.whd(void 0,$c));this.Uxb=this.Ew();const Gd=this.Z6c($c);this.ddc($b,Gd,nd,Oc,$c);this.kOd(!0)}DCf($b){this.QNf();let $c="";({data:$c}=this.N0d($b)).returnValue&&(b.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),
this.ikb=0,this.Ch&&(this.DXb=this.Ch.Cc("Task","Parse and Handle Get Policy Response")),this.G2i($c),this.DXb&&(this.DXb.stop(),this.DXb=null))}CCf($b){this.QNf();this.ikb<=this.EWb?this.ihd():(b.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",$b?$b.data?$b.data.cSa:null:null),this.ikb=0)}hnf(){return 0<this.Qra}setPolicyLabel($b){this.nn.AppliedPolicyId=$b}tTd($b,$c,nd=null){const Oc=this.Wdh(nd);this.wzj($b,$c,Oc,nd)}vJf($b){this.RFa&&
(this.RFa.stop(),this.RFa=null);let $c,nd;({O2f:$c,u6f:nd}=this.u8e($b));const Oc=$b.data.state,Gd=Oc?Oc.LM:2;let Qd="";({data:Qd}=this.N0d($b)).returnValue?(b.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",Gd),this.Qra=0,this.Y2i(Qd,$c,nd,Oc)):this.QPd(Gd)}waj($b){C.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.whd($b));this.qNb=this.Ew();b.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");
this.Za.raiseEvent("SetPolicyLabelTriggeredEventKey",new Ka($b))}ZKi(){this.hic&&this.supportsOfficeClientCoauthoring&&this.Osi&&this.Cx.pea(12,null,!0)}uJf($b){this.RFa&&(this.RFa.stop(),this.RFa=null);let $c;({O2f:nd,u6f:$c}=this.u8e($b));if(this.Qra<=this.EWb)this.tTd(nd,$c);else{var nd=(nd=$b.data.state)?nd.LM:2;b.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",$b?$b.data?$b.data.cSa:null:null,nd);this.xDb="WACServerConnectionFailed";
this.Qra=0;this.QPd(nd)}}Bsi($b){if($b&&("LabelNotSupported"===$b||"LabelErrorRetryLater"===$b||"CoherencyFailure"===$b||"LabelIdNotFound"===$b||"LabelDisabled"===$b))return b.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",$b),!0;b.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",$b);return!1}u1g($b){if(!$b)return!1;let $c=null,nd=null;for(const Oc of this.nn.SensitivityLabels)Oc.Id===$b&&($c=Oc),Oc.Id===this.D8&&(nd=Oc);if(!$c)return!1;if(this.hic&&this.supportsOfficeClientCoauthoring){if(this.eIc&&
this.eIc()||this.Drd)return!0}else if(n.AFrameworkApplication.sz&&n.AFrameworkApplication.sz.Nwb||this.Qpa&&this.Qpa())return!0;return $c.IsEndpointProtectionEnabled===(!!nd&&nd.IsEndpointProtectionEnabled)}f0b($b,$c,nd,Oc,Gd){28===$b?this.cRf(new Ga($b,$c,nd,Oc,Gd,!1)):this.cRf(new Ga($b,$c,nd,Oc,Gd,!0))}Tda($b){28===$b?this.GRf(new ka($b,!1)):this.GRf(new ka($b,!0))}x$i($b,$c,nd){b.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.Za.raiseEvent("CreateAutoCLPSecurityNodesEventKey",
new ha($b,$c,nd))}Baj($b){b.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.Za.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ha(null,null,$b))}Caj($b,$c){b.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.Za.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ha($b,$c,null))}tRf($b,$c){b.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===$c?"Reading":"Edit")+" switch event.");this.Za.raiseEvent("MandatoryLabellingAppHandlerEventKey",
new Za($b,$c))}zXc($b,$c,nd,Oc,Gd){37===$b&&this.l$i(new da(37,$c,nd,Oc,Gd))}JMd(){this.paj(new ra)}Aaj(){b.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.Za.raiseEvent("UDPLabelingAppHandlerEventKey",new Oa(!0))}Fha($b=!1){const $c=!!this.nn&&this.nn.AreLabelsAvailable&&!!this.nn.SensitivityLabels&&0<this.nn.SensitivityLabels.length&&xb.a.any(this.nn.SensitivityLabels,nd=>!!nd&&nd.Enabled);$c||$b||Ca.QRa(!1);return $c}CEf($b){this.yEa&&(this.yEa.stop(),this.yEa=null);var $c=
"";this.kOd(!1);({data:$c}=this.N0d($b)).returnValue?(b.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.gkb=0,$c=this.P2i($c),$b=this.h7e($b.data),C.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.occ(void 0,$b,this.Uxb)),this.Uxb=null,$b=new Wa($b),this.M$i($b),this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?$c&&this.rDj()?this.rqd?this.VXj():(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",
!1)||this.Vsb(),this.fKd($b),this.GNc=!0):$c||this.duc():!this.rqd&&$c&&this.nb.qa("WacApplyManualPolicyLabelIsEnabled")&&this.Hwe()?(this.fKd($b),this.GNc=!0):$c||this.duc()):this.duc()}rDj(){if(!this.nb.qa("WacApplyManualPolicyLabelIsEnabled"))return b.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.Hwe())return!1;if(""===this.D8)return b.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),
!0;if(this.sDa===this.QMc)return b.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;b.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}Vsb(){this.bjg();b.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.PFa.count,this.sDa);const $b=pa.toArray(this.PFa);this.x$i($b,
$b,this.sDa)}VXj(){var $b=this.PFa;this.bjg();pa.lxj($b,this.PFa)||(b.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.PFa.count),$b=pa.toArray(this.PFa),this.Caj($b,$b));this.Yce&&(b.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.sDa),this.Baj(this.sDa))}bjg(){const $b=new ia.a(h.a.ak());for(const $c of this.nn.SensitivityLabels)if($c&&$c.AutoLabelingSensitiveTypeIds&&0<$c.AutoLabelingSensitiveTypeIds.length)for(const nd of $c.AutoLabelingSensitiveTypeIds)nd&&
$b.add(nd);this.PFa=$b}BEf($b){const $c=this.h7e($b.data);C.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.occ(void 0,$c,this.Uxb));this.Uxb=null;this.yEa&&(this.yEa.stop(),this.yEa=null);if(this.gkb<=this.EWb){if(this.nb.qa("SendHostAttributionInfoForPolicyLabelEnabled")){const nd=$b.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in nd&&nd[Ma.a.MQd]&&"HostAttributionInfo.ScenarioTypeParamName"in nd&&nd[Ma.a.NQd]){$b.data.request.get_headers();
$b.data.request.get_headers();$b=this.Z6c($c);this.ddc(this.D8,$b,this.Qpa,void 0,$c);return}}this.hhd(this.D8,$c,this.Qpa)}else b.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",$b?$b.data?$b.data.cSa:null:null),this.duc(),this.gkb=0,this.kOd(!1)}h7e($b){return $b.state?$b.state:0}K5a($b,$c=!1){let nd=String.format("{0}{1}?action={2}&{3}",this.nb.Xa("PolicyHandlerWebServiceBase")||n.AFrameworkApplication.ta.Pa.m0,this.zie,$b,n.AFrameworkApplication.Hi);
"setpolicylabel"===$b&&n.AFrameworkApplication.sz&&n.AFrameworkApplication.sz.Bjf&&(nd=Ab.a.Cl(nd,"sl","1"));$c&&(nd=Ab.a.Cl(nd,"cbd","1"));return nd}u8e($b){let $c,nd;$c=nd=null;$b&&$b.data&&$b.data.request&&$b.data.request.get_headers()&&($c=$b.data.request.get_headers()[Qb.a.P2f],nd=$b.data.request.get_headers()[Qb.a.v6f]);return{O2f:$c,u6f:nd}}N0d($b){$b=$b?$b.data?$b.data.fe:null:null;return $b&&$b.length&&!this.pti($b)?{returnValue:!0,data:$b}:(b.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),
{returnValue:!1,data:$b})}G2i($b){let $c;try{$c=db.b($b)}catch(nd){b.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if($c)if($c.IsPolicyTipAvailable)switch($c.IsPolicyTipAvailable.toLowerCase()){case "false":b.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":b.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.oKc=$c.NavigateUrl;this.wIj($c.GeneralText,
Object(e.a)(this,this.KPi,"onDataLossPolicyOverrideButtonClick"));break;default:b.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",$c.IsPolicyTipAvailable)}else b.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else b.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")}kah($b){switch($b){case "CoherencyFailure":return 1;
case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}Y2i($b,$c,nd,Oc){var Gd=Oc?Oc.LM:
2;let Qd=0,Ad="",Sd;if(({Gt:Sd}=db.d($b)).returnValue)if(Sd){Ad="Success";$b=this.Z6c(3);if(Sd.IsSuccessful){C.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.occ(Gd,void 0,this.qNb));this.xDb=this.qNb=null;b.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);2===Gd&&this.Tda(29);this.sAj($c,Gd);this.ZKi();this.Tda(28);Oc&&4===Gd&&this.f0b(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,
Oc.displayName),CommonUIStrings.l_DialogOk,()=>{});G.a("MipAppliedLabels",void 0,void 0,[Object.assign(new Q.a,{name:"SetPolicyLabelApplyFlag",string:Z[Gd]})]);this.ddc($c,$b,this.Qpa,void 0,3);return}b.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",Gd,Sd.FailureReason);this.xDb=Sd.FailureReason;this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ImproveSetLabelFailureErrMsg",
!1)?Qd=this.kah(Sd.FailureReason):"FileTooLarge"===Sd.FailureReason?Qd=7:"LabelNotSupported"===Sd.FailureReason?Qd=13:"LabelDisabled"===Sd.FailureReason?Qd=9:"MinorVersionLimitExceeded"===Sd.FailureReason&&(Qd=15);this.tti&&0<=Sd.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Oc=new ib.a(2,1,this.xzj,()=>{b.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.Qra);this.Qra<=this.EWb&&this.tTd($c,nd)}),
this.ke.Eg(Oc));this.hic&&this.supportsOfficeClientCoauthoring&&this.ddc(this.nn.AppliedPolicyId,$b,this.Qpa,!0,3)}else Ad="setPolicyLabelData null.",b.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);else Ad="TryDeserialize failed.",b.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);this.QPd(Gd,Qd);Gd=this.occ(Gd,void 0,this.qNb);this.qNb=null;
Gd.extendedProperties.set("SetPolicyLabelDataFailureReason",this.xDb);Gd.extendedProperties.set("SetPolicyLabelDataParseStatus",Ad.toString());C.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,Gd)}QPd($b,$c=0){const nd=2===$b||8===$b||16===$b;this.setPolicyLabel(this.D8);this.rRf(new ua);this.qKd($c,$b,nd,!1)}sAj($b,$c){this.setPolicyLabel(this.D8=$b);if(""===$b)n.AFrameworkApplication.protectedFile=!1,n.AFrameworkApplication.enableMacrosForProtectedFile=!1;else for(const nd of this.nn.SensitivityLabels)if(nd.Id===
$b){n.AFrameworkApplication.protectedFile=nd.IsEndpointProtectionEnabled;break}this.vaj(new ba($b,$c))}TZj(){for(const $b of this.nn.SensitivityLabels)$b&&$b.Enabled&&($b.Id===this.D8&&(this.Yce=this.sDa!==$b.Order,this.sDa=$b.Order),$b.Order>this.QMc&&(this.QMc=$b.Order))}P2i($b){if(!({Gt:$b}=db.d($b)).returnValue)return b.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!$b)return b.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),
!1;if(!$b.AreLabelsAvailable)return!1;this.nn=$b;this.D8=$b.AppliedPolicyId;this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.TZj();this.Fha()&&b.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");this.rRf(new ua(!0));return!0}Hwe(){if(!this.Fha())return b.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const $b of this.nn.SensitivityLabels)if($b&&
$b.AutoLabelingSensitiveTypeIds&&0<$b.AutoLabelingSensitiveTypeIds.length)return!0;b.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}rRf($b){b.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.Za.raiseEvent("LabelInfoUpdateEvent",$b)}M$i($b){b.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.Za.raiseEvent("GetPolicyLabelEventKey",$b)}duc(){Ca.QRa(!1);this.Za.raiseEvent("GetPolicyLabelFailureEventKey",
new ca)}fKd($b){this.AP&&this.AP.execute($c=>{$c=[$c.isFeatureEnabled("MsoClpSpTwo",!0),$c.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all($c).then(nd=>{xb.a.any(nd,Oc=>Oc)&&(b.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.Za.raiseEvent("GetAutoPolicyLabelEventKey",$b),this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.Vsb(),G.a("MipAutoClassificationEnabled"));return null})})}whd($b=null,$c=null){const nd=
new Map;nd.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=$b&&nd.set("ApplyLabelFlags",Z[$b]);null!=$c&&nd.set("GetPolicyLabelsReason",Ya[$c]);return nd}occ($b=null,$c=null,nd=null){const Oc=new ya.a;Oc.extendedProperties=this.whd($b,$c);null!=nd&&(Oc.durationMs=this.Ew()-nd);return Oc}vaj($b){b.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.Za.raiseEvent("SetPolicyLabelEventKey",$b)}cRf($b){b.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");
$b&&$b.XBb&&G.a("MipRecommendations");this.Za.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",$b)}GRf($b){b.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.Za.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",$b)}l$i($b){b.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.Za.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",$b)}paj($b){b.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");
this.Za.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",$b)}wIj($b,$c=null){b.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.Za.raiseEvent("PolicyTipEvent",new Pa(CommonUIStrings.l_PolicyBusinessBarTitle,$b,CommonUIStrings.l_PolicyOverrideButton,$c))}qKd($b,$c,nd,Oc=!0){b.ULS.sendTraceTag(42074656,306,Oc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",$c);Oc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let Gd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,
Qd=null,Ad=null;switch($b){case 2:Oc=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:Gd=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:Oc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:Oc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;
Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:Oc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:Oc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;Gd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;
break;case 15:Oc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,Gd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Qd=CommonUIStrings.l_LearnMore,Ad=()=>{this.yzj()}}$b=new Ua($b,$c,nd,Oc,Gd,Qd,Ad);this.Za.raiseEvent("SetPolicyLabelFailureEventKey",$b)}Iyj($b){this.QPc=$b}KPi(){this.oKc?(b.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),Mb.a.oV(this.oKc)):b.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}pti($b){if(!$b.startsWith("<")||
-1===$b.indexOf("Error")&&-1===$b.indexOf("Unavailable"))return!1;b.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0}QNf(){this.CXb&&(this.CXb.stop(),this.CXb=null)}QNh($b){if(!$b)return"manual";switch($b.LM){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";
default:return"manual"}}XOh($b){if(!$b)return"privileged";$b=$b.LM;let $c="privileged";if(4===$b||1===$b)$c="standard";return $c}ddc($b,$c,nd=null,Oc=!1,Gd=0){this.nb.qa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.D8=$b,this.Qpa=nd,this.Ch&&(this.yEa=this.Ch.Cc("WebServiceCall","Call Get Policy Endpoint On Server")),nd={},nd[Qb.a.vSg]=$b,this.nb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?($b=new pb(this.K5a("getpolicylabels",Oc),1,null,nd,!0,2,Gd,void 0,void 0,void 0,void 0,void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,$c),this.Ah.send($b).OLd(Object(e.a)(this,this.CEf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.BEf,"onGetPolicyLabelsFailureCallback"))):this.Ah.Om(this.K5a("getpolicylabels",Oc),1,null,nd,!0,2,Object(e.a)(this,this.CEf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.BEf,"onGetPolicyLabelsFailureCallback"),Gd,void 0,void 0,void 0,void 0,"22"),this.gkb++,b.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",
this.gkb))}wzj($b,$c,nd,Oc=null){if(this.yAb){this.Ch&&(this.RFa=this.Ch.Cc("WebServiceCall","Call Set Policy Endpoint On Server"));var Gd={};Gd[Qb.a.P2f]=$b;$c&&(Gd[Qb.a.v6f]=encodeURIComponent($c));this.QPc&&(Gd[Qb.a.MRg]=this.QPc);Oc?(Gd[Qb.a.s6f]=this.QNh(Oc),Gd[Qb.a.t6f]=this.XOh(Oc)):(Gd[Qb.a.s6f]="manual",Gd[Qb.a.t6f]="privileged");this.supportsOfficeClientCoauthoring&&this.nn&&(Gd[Qb.a.N4i]=this.nn.PolicyLabelVersionToken);this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",
!1)&&1===Oc.LM&&this.nn.DefaultLabelType&&(Gd[Qb.a.vzj]=this.nn.DefaultLabelType);this.nb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?($b=new pb(this.K5a("setpolicylabel",!0),1,null,Gd,!0,2,Oc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,nd),this.Ah.send($b).OLd(Object(e.a)(this,this.vJf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.uJf,"onSetPolicyLabelFailureCallback"))):this.Ah.Om(this.K5a("setpolicylabel",!0),1,null,Gd,!0,2,Object(e.a)(this,
this.vJf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.uJf,"onSetPolicyLabelFailureCallback"),Oc,void 0,void 0,void 0,void 0,"32");this.Qra++;b.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.Qra)}else b.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}yzj(){const $b=new U.StandardDialog,$c=this.nb.Xa("BreadcrumbFolderUrl");$c?($b.Tb=11,$b.qc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),
$b.qc(2,CommonUIStrings.l_DialogOk)):($b.Tb=0,$b.qc(1,CommonUIStrings.l_DialogOk));$b.wqe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");$b.Ogj();$b.CX(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,nd=>{1===nd&&$c&&Mb.a.kf($c,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}Z6c($b){switch($b){case 1:return Ma.a.Eia(1,
1);case 2:return Ma.a.Eia(7,1);case 3:return Ma.a.Eia(8,1);default:return Ma.a.Eia(7,0)}}Wdh($b=null){if(!$b)return Ma.a.Eia(8,0);switch($b.LM){case 1:case 16:return Ma.a.Eia(1,1);case 4:case 2:case 8:return Ma.a.Eia(8,1);default:return Ma.a.Eia(8,0)}}kOd($b){this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",$b)}}Object(c.a)(Ea,"PolicyManager",null,[259]);var Na=a(134),kb=a(249);class lb{constructor(){this.W1=
this.zra=this.$a=this.eh=null}get name(){return"Common.App.Policy"}init(){n.AFrameworkApplication.fa.qa("ShouldInitCommonPolicyPackage")&&(n.AFrameworkApplication.fa.qa("IsDataLossPreventionEnabledForUser")&&n.AFrameworkApplication.ta&&(this.eh=this.$a.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.eh.Xse(Object(e.a)(this,this.zWd,"showPolicyBusinessBar")),b.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),Na.a.get_instance().Zj(6,()=>{this.eh.ihd()})),n.AFrameworkApplication.fa.qa("WacLabelingPoliciesIsEnabled")&&
n.AFrameworkApplication.fa.qa("SupportsPolicies")?Na.a.get_instance().Zj(6,Object(e.a)(this,this.QMi,"onAfterRibbonBehaviorAttached")):Ca.QRa(!1))}dispose(){}Oh($b){$b.register(259,"Common.App.Policy.Contracts.IPolicyManager").wc().Ac(()=>new Ea(n.AFrameworkApplication.fa,n.AFrameworkApplication.zd,n.AFrameworkApplication.ta.kE,n.AFrameworkApplication.fa.ud("MaxGetPolicyRetries",1),$b.Rb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),n.AFrameworkApplication.ta.Pa.Ij));$b.register(Ca,
"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").wc().Ac(()=>new Ca(n.AFrameworkApplication.ub,n.AFrameworkApplication.ta,n.AFrameworkApplication.fa,$b.uPd("Common.App.Policy.Contracts.IPolicyManager")));this.$a=$b}QMi(){this.W1=this.$a.yg("CommonUI.BusinessBar");this.eh||(this.eh=this.$a.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.zra=this.$a.resolve("Common.App.Policy.PolicyActor");n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",
!1)&&P.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.eh.Q0b(Object(e.a)(this.zra,this.zra.oUf,"registerActionsHandler")):this.zra.Hg();this.eh.Q0b(Object(e.a)(this,this.a2d,"updateLabelInfo"));n.AFrameworkApplication.fa.qa("WacApplyManualPolicyLabelIsEnabled")&&(this.eh.GYc(Object(e.a)(this,this.y$h,"handleSetPolicyLabelFailure")),this.eh.Fre(Object(e.a)(this,this.f0b,"addAutoPolicyBusinessBarEntry")),this.eh.Zse(Object(e.a)(this,
this.Tda,"removeAutoPolicyBusinessBarEntry")),this.eh.Gre(Object(e.a)(this,this.zXc,"addMandatoryLabellingBusinessBarEntry")),this.eh.$se(Object(e.a)(this,this.JMd,"removeMandatoryLabellingBusinessBarEntry")))}a2d(){this.zra.n6f();this.zra.G5f();this.zra.PQf();const $b=this.eh.P3g();n.AFrameworkApplication.fa.qa("HasDocumentEditRights")&&!$b?this.zra.wgg():b.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",
n.AFrameworkApplication.fa.qa("HasDocumentEditRights"),$b);n.AFrameworkApplication.ta.updateCommandUI()}zWd($b,$c){this.f7e($c.title,$c.Xsc,38,$c.gBf,$c.buttonText);b.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}y$h($b,$c){$c.w$f&&(this.f7e($c.title,$c.message,21,null,null,$c.H$,$c.buttonText),b.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}Tda(){}f0b($b,
$c){this.W1&&(this.eh.Tda($c.Xqb),$b=new f.a($c.title,$c.message,null),$b.id=$c.Xqb,$b.closeable=!0,$b.image=3,$b.addButton($c.buttonText,$c.H$,$c.buttonText,!0),this.W1.KE($b,!1))}zXc($b,$c){this.W1&&($b=new f.a($c.title,$c.message,null),$b.id=$c.Xqb,$b.closeable=!1,$b.image=3,$b.addButton($c.buttonText,$c.H$,$c.buttonText,!1),this.W1.KE($b,!1))}JMd(){}f7e($b,$c,nd,Oc=null,Gd=null,Qd=null,Ad=null){$b=new f.a($b,$c,null);$b.id=nd;$b.closeable=!0;Oc&&$b.AJg(Gd,Oc);Qd&&$b.addButton(Ad,Qd,Ad)}static main(){kb.a.instance.vi(new lb)}}
Object(c.a)(lb,"PackageManager",null,[4,5]);var oa=a(9),Ba=a(553),sa=a(222),qb=a(48),Jb=a(37),Yb=a(83),jb=a(38),ab=a(174),vb=a(374),Da=a(188),Fa=a(92),nb=a(29),Ta=a(283),V=a(1),va=a(22),wb=a(282);class fc{constructor(){this.Wsc=this.H3f=null;this.LM=0}}Object(c.a)(fc,"ApplyPolicyContextParameters",null,[]);var Fc=a(7),Qa=a(694),la=a(563),hb=a(47),Kb=a(46);class dc{constructor(){this.jHa=this.annotationType=null;this.dNa=this.yy=!1}}Object(c.a)(dc,"AnnotationActivationOptions",null,[]);var sb=a(60);
const bb=($b,$c,nd,Oc,Gd,Qd,Ad=null)=>{Ad=$b.Oa(1,Ad);Ad.tenantId=$c;return sb.g($b,"GetPolicyLabelId",Ad,nd,Oc,Gd,Qd,4)},Ob=($b,$c,nd,Oc,Gd,Qd,Ad,Sd,Ce,we,Td=null)=>{Td=$b.Oa(41,Td);Td.labelsInfoJson=$c;Td.appliedLabelId=nd;Td.tenantId=Oc;Td.applyLabelFlag=Gd;Td.skipApplyOutcomes=Qd;return sb.g($b,"ApplyPolicyLabel",Td,Ad,Sd,Ce,we,0)},gc=($b,$c,nd,Oc,Gd,Qd,Ad=null)=>{Ad=$b.Oa(1,Ad);Ad.tenantId=$c;return sb.g($b,"GetPolicyApplicationMethod",Ad,nd,Oc,Gd,Qd,4)};var mb=a(725),Nb=a(700);class ic extends mb.a{constructor(){super();
this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Nb.a,{T_:ic.getTypeName(),B_:ic.Pd()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(ic,"LabellingAnnotation",mb.a,[]);var gb=a(716);class Eb extends gb.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new Nb.a,{T_:Eb.getTypeName(),B_:Eb.Pd()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static Pd(){return[]}}
Object(c.a)(Eb,"SecurityShared",gb.a,[]);class Lc extends Eb{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new Nb.a,{T_:Lc.getTypeName(),B_:Lc.Pd()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static Pd(){return["AugLoop_SecurityShared_SecurityShared"]}}Object(c.a)(Lc,"CLP",Eb,[]);class Ec extends mb.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Nb.a,{T_:Ec.getTypeName(),B_:Ec.Pd()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}
Object(c.a)(Ec,"LabellingAnnotation",mb.a,[]);var Cb=a(973),eb=a(868),Sb=a(975);class ld extends mb.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new Nb.a,{T_:ld.getTypeName(),B_:ld.Pd()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(ld,"LinkedDataTypeAnnotation",mb.a,[]);class bd extends jb.a{constructor($b,$c,nd,Oc,Gd){super();this.Nvf=3;this.QA=this.augmentationLoopManager=null;
this.b0a=!1;this.Xab=[];this.pqf=new Qa.a(la.a.zK());this.SId=0;this.XId=null;this.Vsb=(Qd,Ad)=>{Qd=Object(Fc.a)(new Cb.a,{parentPath:["session","doc","security"],items:[Object(Fc.a)(new eb.a,{id:"clp",body:Object(Fc.a)(new Lc,{existingLabelPriority:Ad.existingLabelPriority,partialDocSITs:Ad.dFe,fullDocSITs:Ad.cFe})})]});this.Xab.push(Qd);this.Yzb()};this.$ig=(Qd,Ad)=>{Qd=Object(Fc.a)(new Sb.a,{parentPath:["session","doc","security"],items:[Object(Fc.a)(new eb.a,{id:"clp",body:Object(Fc.a)(new Lc,
{existingLabelPriority:Ad.existingLabelPriority})})]});this.Xab.push(Qd);this.Yzb()};this.ajg=(Qd,Ad)=>{Qd=Object(Fc.a)(new Sb.a,{parentPath:["session","doc","security"],items:[Object(Fc.a)(new eb.a,{id:"clp",body:Object(Fc.a)(new Lc,{partialDocSITs:Ad.dFe,fullDocSITs:Ad.cFe})})]});this.Xab.push(Qd);this.Yzb()};this.JR=()=>{b.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)?this.Yzb():this.nff():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.Qjh())};this.bab=()=>{b.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");this.DMe();this.augmentationLoopManager=null};this.txi=(Qd,Ad)=>{var Sd,Ce,we,Td,he;b.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Ad.operationType)b.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");
else{var ee=Qd=null,ge=null;if(this.Thc()){var re=Ad.KM;if(!re){b.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Sd=re.automatic)||void 0===Sd?0:Sd.id)Qd=re.automatic.id;if(null===(Ce=re.recommended)||void 0===Ce?0:Ce.id)ee=re.recommended.id,re.recommended.policyTip&&(ge=re.recommended.policyTip)}else{Sd=Ad.KM;if(!Sd){b.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");
return}if(null===(we=null===(re=Sd.automatic)||void 0===re?void 0:re.sensitivityLabel)||void 0===we?0:we.id)Qd=Sd.automatic.sensitivityLabel.id;if(null===(he=null===(Td=Sd.recommended)||void 0===Td?void 0:Td.sensitivityLabel)||void 0===he?0:he.id)ee=Sd.recommended.sensitivityLabel.id,Sd.recommended.sensitivityLabel.policyTip&&(ge=Sd.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(Qd,ee,ge,1)}};this.pzi=(Qd,Ad)=>{b.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===Ad.operationType?b.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(Qd=Ad.KM)?(Qd=Qd.classificationId,this.applyPolicyLabel(Qd,Qd,null,2)):b.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.qVf=(Qd,Ad)=>{Ad?Ad.XBb&&this.businessBar.qH(41)?(this.businessBar.removeEntry(41),b.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!Ad.XBb&&this.businessBar.qH(40)&&(this.businessBar.removeEntry(40),b.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):b.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.K9f=(Qd,Ad)=>{Ad?Ad.XBb?(this.businessBar.KIj(Ad.title,Ad.message,Ad.buttonText,Sd=>{Ad.H$(Sd);this.businessBar.qH(41)&&this.businessBar.removeEntry(41)}),b.ULS.sendTraceTag(537154531,306,50,
"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.CGj(Ad.title,Ad.message,Ad.buttonText,Sd=>{Ad.H$(Sd);this.businessBar.qH(40)&&this.businessBar.removeEntry(40)}),b.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.EHd=$b;
this.policyManager=$c;this.$=nd;this.fa=Oc;this.businessBar=Gd;this.Bei();this.Xdj();this.disposed=!1}get Zb(){return!this.disposed&&this.$.ea.Zb}dispose(){this.disposed||(this.disposed=!0,this.Ilh(),this.DMe(),this.EHd=this.policyManager=this.augmentationLoopManager=null,super.dispose())}H_a($b,$c,nd,Oc,Gd=!1){b.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${Oc} with AutoLabelPresent: ${!!$b}, RecommendedLabelPresent: ${!!$c}, isStandard: ${Gd}.`);
this.Zb?this.EHd&&(this.v1g($c,Oc)?(this.XId=$c,this.SId=Oc,this.pqf.ia(Oc,$c)):$c=this.XId,$b=this.EHd.H_a($b,$c,nd,Gd),b.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${$b}.`)):b.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}v1g($b,$c){if(!this.policyManager.Fha())return b.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),
!1;const nd=this.policyManager.nn;let Oc;({value:Oc}=this.pqf.Ec(this.SId));let Gd=null,Qd=null,Ad=null;for(const Sd of nd.SensitivityLabels)Sd.Id===$b&&(Gd=Sd),Sd.Id===Oc&&(Qd=Sd),Sd.Id===this.XId&&(Ad=Sd);return Qd&&Qd.Id===$b?(b.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.qH(41)&&this.SId!==$c&&Ad&&(!Gd||Ad.Order>=Gd.Order)?(b.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0}Thc(){return V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}Qhf(){return V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}Xdj(){this.policyManager.Fre(this.K9f);this.policyManager.Zse(this.qVf);this.$.ea.UY(this.JR);this.Thc()&&this.Qhf()&&
(this.policyManager.AMg(this.Vsb),this.policyManager.sPg(this.$ig),this.policyManager.tPg(this.ajg))}Ilh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);this.policyManager.Fhj(this.K9f);this.policyManager.Yjj(this.qVf);this.$.ea.J0(this.JR);this.Thc()&&this.Qhf()&&(this.policyManager.oij(this.Vsb),this.policyManager.Ekj(this.$ig),this.policyManager.Fkj(this.ajg))}Bei(){this.QA=new Qa.a(la.a.zK());const $b=this.Thc()?ic.getTypeName():Ec.getTypeName();this.QA.add(1,Object(Fc.a)(new dc,
{annotationType:$b,jHa:this.txi,yy:!1,dNa:!1}));this.QA.add(2,Object(Fc.a)(new dc,{annotationType:ld.getTypeName(),jHa:this.pzi,yy:!1,dNa:!1}))}$cg(){for(let $b of this.Xab)this.augmentationLoopManager.submitOperation($b);this.Xab=[]}Sdj($b){if(!this.QA.kb($b))return b.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${$b}.`),!1;if(this.QA.ma($b).yy)return b.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${$b}.`),
!0;this.QA.ma($b).yy=!0;b.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${$b}.`);if(!this.$.isEditMode)return b.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.Yzb():this.nff();return!0}nff(){var $b=!1;for(let $c of this.QA)if($b=$c.value.yy||$b)break;
$b?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.E_b()):this.b0a?b.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.b0a=!0,$b=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${$b} milliseconds.`),
hb.a.instance.create(()=>{this.Dei()},$b,Kb.a.iye,!0,!0)):b.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}Yzb(){var $b=0<this.Xab.length;if(!$b)for(let $c of this.QA)if($b=$c.value.yy||$b)break;$b?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.E_b(),this.$cg()):this.b0a?b.ULS.sendTraceTag(537154626,
306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):(this.b0a=!0,$b=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${$b} milliseconds.`),hb.a.instance.create(()=>{this.Eei()},$b,Kb.a.iye,!0,!0)):b.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}Eei(){Jb.TaskExtensions.za(qb.GetServiceTaskFactory.Na(this.$.da,
328,327,1),$b=>{this.augmentationLoopManager=$b.result;this.b0a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.Xpe(this.bab),this.$.isEditMode?(this.E_b(),this.$cg()):b.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.ka,3)}Dei(){Jb.TaskExtensions.za(qb.GetServiceTaskFactory.Na(this.$.da,328,327,1),$b=>{this.augmentationLoopManager=$b.result;this.b0a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.Xpe(this.bab),this.$.isEditMode?this.E_b():b.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154593,
306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.ka,3)}DMe(){for(let $b of this.QA)$b.value.yy&&this.Hlh($b.key)}Hlh($b){this.QA.ma($b).dNa&&this.CLe($b);this.QA.ma($b).yy=!1;b.ULS.sendTraceTag(537154591,306,50,`AutoPolicyManager::DeregisterAnnotation completed for LabellingSource ${$b}.`)}E_b(){for(let $b of this.QA)$b.value.yy&&!$b.value.dNa&&this.activateAnnotation($b.key)}activateAnnotation($b){this.augmentationLoopManager.CZa(this.QA.ma($b).annotationType);
this.augmentationLoopManager.mha(this.QA.ma($b).annotationType,this.QA.ma($b).jHa);this.QA.ma($b).dNa=!0;b.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${$b}.`)}Qjh(){for(let $b of this.QA)$b.value.dNa&&this.CLe($b.key)}CLe($b){this.augmentationLoopManager.BRa(this.QA.ma($b).annotationType,this.QA.ma($b).jHa);this.QA.ma($b).dNa=!1;b.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${$b}.`)}applyPolicyLabel($b,
$c,nd,Oc){if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.H_a($b,$c,nd,Oc);else{b.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const Gd=Qd=>{this.H_a($b,$c,nd,Oc,0===Qd||1===Qd||4===Qd)};this.rjd(Gd,()=>{Gd(2)},this.Nvf)}}H_c($b,$c){let nd=null,Oc=null;if(!({sensitivityLabel:nd,mHa:Oc}=this.khg($b)).returnValue)return b.ULS.sendTraceTag(537154577,
306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Oc&&Oc.Order>=nd.Order)return b.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(nd.Id,nd.Id,null,$c);return!0}I_c($b,$c){$c=!1;let nd=null,Oc=null;if(!({sensitivityLabel:nd,mHa:Oc}=this.khg($b)).returnValue)return b.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),
{returnValue:!1,L7a:$c};if(Oc&&Oc.ParentId&&nd.ParentId&&Oc.ParentId===nd.ParentId)return b.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,L7a:$c};if(Oc&&Oc.Order>=nd.Order)return b.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,L7a:$c};if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),$b=this.policyManager.nn,$b=!$b.AppliedPolicyId||!$b.PolicyLabelAssignmentMethod||Y.e($b.PolicyLabelAssignmentMethod)===Y.e("standard"),this.Awe(nd.Id,$b);else{b.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const Gd=Qd=>{this.Awe(nd.Id,0===Qd||1===Qd||4===Qd)};this.rjd(Gd,()=>{Gd(2)},this.Nvf)}return{returnValue:!0,
L7a:$c}}rjd($b,$c,nd,Oc=0){if(this.Zb){var Gd=this.$.pa.xa.Wb();gc(this.$.pa.xa,this.$.ya.DocumentHostInfo.TenantId,Qd=>{this.N_h(Qd,$b)},()=>{this.M_h($b,$c,nd,Oc)},null,null,Gd)}else b.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}N_h($b,$c){b.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.Zb?!$b||Ta.a($b)?
b.ULS.sendTraceTag(537154567,306,15,$b?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):$c($b.Result):b.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}M_h($b,$c,nd,Oc){b.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");
this.Zb?Oc>=nd?(b.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),$c()):this.rjd($b,$c,nd,Oc+1):b.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}Awe($b,$c){$c?this.H_a($b,null,null,3,!0):this.H_a(null,$b,null,3,!1)}khg($b){let $c,nd;nd=$c=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:$c,mHa:nd};
if(!this.policyManager.Fha())return b.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:$c,mHa:nd};const Oc=this.policyManager.nn;if(!Oc)return b.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:$c,mHa:nd};if(xb.a.sh(Oc.SensitivityLabels))return b.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),
{returnValue:!1,sensitivityLabel:$c,mHa:nd};const Gd=Oc.AppliedPolicyId;for(const Qd of $b)for(const Ad of Oc.SensitivityLabels)Ad.Id===Qd&&(!$c||$c.Order<Ad.Order)&&($c=Ad),Ad.Id===Gd&&(nd=Ad);return $c?{returnValue:!0,sensitivityLabel:$c,mHa:nd}:(b.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:$c,mHa:nd})}}Object(c.a)(bd,"AutoPolicyManager",jb.a,[3]);var ec=a(154),sc=a(12),Dc=a(13);class Ud extends ec.ErrorDialog{constructor($b){super($b,
Ud.VQ($b))}wq(){super.wq();if(this.error.Appearance&1&&this.$.qd&2){const $b=this.getButton(0);sc.DOMElementExtensions.GSd($b.get_element(),Dc.a.instance.ga(1311));this.VP(()=>{0===this.returnValue&&this.$.qd&2&&(b.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),Jb.TaskExtensions.za(qb.GetServiceTaskFactory.Na(this.$.da,55,56,0),$c=>{$c.result.I5c()},this.$.ka,3))})}}static VQ($b){return $b.qd&2?nb.a.dd(3,1,0,1969,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
nb.a.dd(1,1,0,1970,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(c.a)(Ud,"BlockSenitivityLabelActionDialog",ec.ErrorDialog,[]);class Ed extends jb.a{constructor($b,$c,nd,Oc,Gd){super();this.statusBarManager=null;this.I0c=!1;this.B$=null;this.mFc=!1;this.Iya=this.XRd=null;this.Io=this.FHd=!1;this.UEa=this.rhe=this.kga=this.Bie=this.Zp=null;this.vQe=()=>{b.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const Qd=
this.qUf(1);b.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${Qd}.`)};this.zWd=(Qd,Ad)=>{Ad?(this.Zp=Ad.title,this.Bie=Ad.Xsc,this.kga=Ad.buttonText,this.rhe=Ad.gBf,this.I$.mh(27,null),b.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.W$f=(Qd,Ad)=>{const Sd=Object(Yb.a)(Ua,
Ad);Sd?Sd.w$f?(b.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${Sd.errorType}`),this.I$.SIj(Sd.title,Sd.message,Sd.buttonText,Ce=>{Sd.H$&&(this.I$.qH(54)&&this.I$.removeEntry(54),Sd.H$(Ce))})):b.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(b.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.I$.mh(48,
null))};this.a2d=(Qd,Ad)=>{this.f7&&(b.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.f7.n6f(),this.f7.G5f(),this.f7.PQf(),this.$.qd&64&&(Ad.onSuccess&&this.Iya?this.FSg():this.f7.wgg()));this.fa.qa("SupportsOfficeClientCoauthoring")&&(Qd=this.Ms.nn,this.UEa=Qd.AppliedPolicyId,"null"===this.labelId&&(this.UEa=""),this.mFc&&(Qd=Qd.PolicyLabelAssignmentMethod&&Y.e(Qd.PolicyLabelAssignmentMethod)===Y.e("standard")?4:2,this.applyPolicyLabel(this.labelId,Qd,!0,this.XRd)));
this.nXe();this.Rz()};this.AEf=()=>{this.FHd=!0;this.nXe()};this.tJf=(Qd,Ad)=>{b.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${n.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${Ad.LM}`);this.applyPolicyLabel(Ad.Wsc,Ad.LM,!1,null)};this.$Mi=(Qd,Ad)=>{this.UEa=Ad.Wsc;if(nb.a.Nq(Qd.Errors)){var Sd=nb.a.x4(Qd.Errors,[2045508683]);0<Sd.length&&(Qd.Errors=nb.a.QB(Qd.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),
this.$.ea.To(Qd.Errors));Sd=nb.a.x4(Qd.Errors,[2046680228]);0<Sd.length&&(4===Ad.LM||1===Ad.LM)&&(Qd.Errors=nb.a.QB(Qd.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.To(Qd.Errors));Sd=Qd=null;for(var Ce of this.Ms.nn.SensitivityLabels)va.a.equals(this.labelId,Ce.Id,!1)&&(Qd=Ce),va.a.equals(Ad.H3f,Ce.Id,!1)&&(Sd=Ce);Ce={};Ce.ApplyLabelFlag=Ad.LM;Qd?(Ce.currentLabel="Set",Ce.currentLabelEnabled=Qd.Enabled,Ce.currentLabelName=Qd.Name?"Set":"NotSet",Ce.currentLabelParentId=
Qd.ParentId?"Set":"NotSet"):Ce.currentLabel="NotSet";Sd?(Ce.serverLabel="Set",Ce.serverLabelEnabled=Sd.Enabled,Ce.serverLabelName=Sd.Name?"Set":"NotSet",Ce.serverLabelParentId=Sd.ParentId?"Set":"NotSet"):Ce.serverLabel="NotSet";b.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(Ce)}`)}};this.uWg=(Qd,Ad)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;const Sd=this.Ms.nn;if(!Sd)return b.ULS.sendTraceTag(537154502,
306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let Ce=null;for(const we of Sd.SensitivityLabels)va.a.equals(we.Id,Qd,!1)&&(Ce=we);return Ce&&this.gbi(Ce)?(b.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.FGj(Ad),!0):!1};this.tki=()=>{let Qd=!1;!this.$.ya.IsNewWorkbook||this.labelId&&this.labelId.length||(Qd=!0);b.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${Qd}`);
return Qd};this.Dvf=(Qd,Ad)=>{1===Ad.jve?this.$.isEditMode?(b.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ka.Lb(new Fa.a(-723527778,0,this.$.Hc,10,null))):b.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.Iya=Ad.Iya,this.$.ea.UY(this.vwe),this.$.Tgb(),b.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),this.$.Ka.Lb(new Fa.a(-8805455,0,this.$.Hc,10,null)))};
this.Dqe=(Qd,Ad)=>{Ad?(Qd=!!(this.$.qd&64),b.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${Qd}`),Qd&&(this.$.Tgb(),this.I$.aIj(Ad.title,Ad.message,Ad.buttonText,Sd=>{Ad.H$(Sd)}))):b.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.OVf=()=>{this.I$.qH(42)&&this.I$.removeEntry(42)};this.Lhg=(Qd,Ad)=>{Ad.JEj&&(b.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),
Jb.TaskExtensions.za(qb.GetServiceTaskFactory.Na(this.$.da,55,56,0),Sd=>{Sd.result.I5c()},this.$.ka,3))};this.vwe=()=>{this.Iya&&this.$.isEditMode?(this.$.ea.J0(this.vwe),this.kxb()):b.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.Iya} , edit mode : ${this.$.isEditMode}.`)};this.Fka=()=>{const Qd=this.$.ea.Lo;Qd&&!va.a.equals(Qd.AppliedPolicyLabelId,this.labelId,!1)&&(b.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),
b.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.qa("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&(this.mFc=!0,this.XRd=Qd.AppliedPolicyLabelId),this.UEa=Qd.AppliedPolicyLabelId,this.kxb())};this.Drd=()=>{let Qd=!0;if(!this.$.ea.amIAlone)for(const Ad of this.$.ea.Wm)if(!Ad.SupportsClientIsMipTrusted){Qd=!1;break}b.ULS.sendTraceTag(537154462,
306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${Qd}`);return Qd};this.GFf=()=>{b.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.mFc=!0;this.kxb()};this.$=Oc;this.Ms=$b;this.I$=nd;this.fa=Gd;this.Ms.Xse(this.zWd);this.f7=$c}initialize(){this.fa.qa("SupportsPolicies")?(this.UEa=this.fa.Xa("AppliedPolicyId"),this.f7.Hg(),this.$.da.fb(29,$b=>{this.statusBarManager=$b;$b.KJ(this)}),this.Rz(),va.a.sh(this.fa.Xa("HostUserId"))||
this.O4i(),this.f7.Zdj(this.uWg),this.f7.Nej(this.tki),this.Ms.Vdj(this.Drd),this.Io=V.EwaSettings.getBooleanFeatureGate(ab.a.TQa,!1)):V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&P.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!va.a.sh(this.fa.Xa("HostUserId"))&&V.EwaSettings.oa(165)&&this.$.ea.Mg.get(45)&&(b.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),
this.JTh())}Lq($b){this.addHandler("LabelInfoChangedKey",$b)}er($b){this.removeHandler("LabelInfoChangedKey",$b)}Fn(){return!0}ps($b,$c){if("QueryPolicyLabel"!==$b)return!1;if(this.toa())return $c.Visible=!1,!0;$c.Visible=!0;return 32===n.AFrameworkApplication.ub.$d(Aa.a.jcb,2,$c)}dispose(){this.statusBarManager&&(this.statusBarManager.iG(this),this.statusBarManager=null);this.f7.JQb();this.I0c=!1;this.Ms.okj(this.W$f);this.Ms.pkj(this.tJf);this.$.ea.Rv(this.Fka);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const $b=
this.$.da.Aa(292);$b&&$b.ejj(this.GFf)}this.Ms.Hhj(this.Dqe);this.Ms.Zjj(this.OVf);this.Ms.ojj(this.Dvf);this.Ms.Bkj(this.Lhg);V.EwaSettings.oa(274)&&this.Ms.Jij(this.vQe);this.B$&&(this.B$.dispose(),this.B$=null);super.dispose()}get title(){return this.Zp}get Xsc(){return this.Bie}get linkText(){return this.kga}get fVi(){return this.rhe}get labelId(){return this.UEa}H_c($b,$c){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.FHd)return b.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(xb.a.sh($b))return!1;this.B$||this.Ood();return this.B$.H_c($b,$c)}Rz(){this.raiseEvent("LabelInfoChangedKey")}JTh(){Na.a.get_instance().Zj(10,()=>{this.Ms.ihd()})}O4i(){Na.a.get_instance().Zj(10,()=>{this.Ms.Q0b(this.a2d);this.Ms.dNg(this.AEf);this.Ms.cNg(this.AEf);this.Ms.GYc(this.W$f);this.Ms.jte(this.tJf);this.$.ea.pu(this.Fka);this.Ms.Gre(this.Dqe);this.Ms.$se(this.OVf);
this.Ms.NNg(this.Dvf);this.Ms.oPg(this.Lhg);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const $b=this.$.da.Aa(292);$b&&$b.DNg(this.GFf)}V.EwaSettings.oa(274)&&(b.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),this.Ms.aNg(this.vQe));this.FFh()});this.$.yeb("sensitivity",!0)}FFh(){this.fa.qa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.kxb():this.QOh(this.$.ya.DocumentHostInfo.TenantId)}Ood(){this.B$=
new bd(this.f7,this.Ms,this.$,this.fa,this.I$)}qUf($b){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.B$||this.Ood();return this.B$.Sdj($b)}I_c($b,$c){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,L7a:!1};if(!this.FHd)return b.ULS.sendTraceTag(537154516,
306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,L7a:!0};this.B$||this.Ood();return this.B$.I_c($b,$c)}QOh($b){b.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${$b.length}`);const $c=this.$.pa.xa.Wb();bb(this.$.pa.xa,$b,nd=>{this.aOj(nd)},null,null,null,$c)}aOj($b){b.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");
$b&&!Ta.a($b)&&(this.UEa=$b.Result);this.kxb();this.labelId?b.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):b.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}kxb(){this.Ms.hhd(this.labelId,void 0,void 0,!1)}nXe(){if(!this.I0c){this.$.af();this.I0c=!0;this.I$.Waf();const $b={};$b.hasLabel=!!this.labelId&&0<this.labelId.length;$b.isProtectedFile=this.fa.qa("ProtectedFile");$b.SupportsPolicies=
this.fa.qa("SupportsPolicies");$b.AreLabelsAvailableForDisplay=this.Ms.Fha();$b.SupportsOfficeClientCoauthoring=this.fa.qa("SupportsOfficeClientCoauthoring");$b.IsAnonymousUser=this.fa.qa("IsAnonymousUser");b.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify($b)}`)}}FSg(){this.f7.GSg(this.Iya);this.Iya=null}gbi($b){for(const $c of $b.LabelActions)if(va.a.equals($c.Name,"ApplyWatermark",!1))return!0;return!1}FGj($b){$b?(new Ud(this.$)).vg():b.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel($b,
$c,nd,Oc){const Gd=db.c(this.Ms.nn);if(void 0===$b||null===$b)$b="";const Qd=new fc;Qd.Wsc=$b;Qd.H3f=Oc;Qd.LM=$c;const Ad=this.$.pa.xa;vb.a(this.$.userOperationManager,(Sd,Ce,we)=>Ob(Ad,Gd,$b,this.$.ya.DocumentHostInfo.TenantId,$c,nd,wb.b.call(null,this.$Mi,Sd),null,we,Qd),Sd=>new Da.a(222,0,Sd),null);this.mFc=!1;this.XRd=null}toa(){const $b=this.$.da.Aa(478);return this.Io&&$b?$b.Io():!1}}Object(c.a)(Ed,"PolicyManagerWrapper",jb.a,[214,215,429]);class $d extends sa.a{constructor($b){super();this.$=
$b;this.Fb()}create(){const $b=qb.GetServiceTaskFactory.Na(this.$.da,5,4,this.Ya),$c=n.AFrameworkApplication.zd,nd=n.AFrameworkApplication.fa;Jb.TaskExtensions.za($b,()=>{try{const Oc=new Ba.a(()=>new Ea(nd,$c,n.AFrameworkApplication.ta.kE,this.$.ya.MaxGetPolicyRetries,W.a.instance.Rb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),Gd=new Ba.a(()=>new Ca(n.AFrameworkApplication.ub,n.AFrameworkApplication.ta,n.AFrameworkApplication.fa,Oc));let Qd=this.$.da.Aa(274);Qd||(Qd=new Ed(Oc.value,
Gd.value,$b.result,this.$,n.AFrameworkApplication.fa),this.$.da.Ga(274,Qd),Qd.initialize());this.ob(Qd)}catch(Oc){throw b.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${Oc.toString()}]`),Oc;}},this.ka,3)}static la($b){$b.da.Ga(275,new $d($b))}}Object(c.a)($d,"PolicyManagerFactory",sa.a,[]);var ve=a(695),ze=a(184);class We{constructor($b){this.$=$b}nc(){return!1}executeCommand($b,$c,nd){switch($c.command){case Aa.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||
(nd[D.CZc]=this.$.workbookContext.ExclusiveLockId),$b=n.AFrameworkApplication.ub.$d(Aa.a.setSensitivity,2,nd),fa.Task.Ra(32===$b);case Aa.a.i7:return $b=n.AFrameworkApplication.ub.$d(Aa.a.i7,2,nd),fa.Task.Ra(32===$b);case Aa.a.j7:return $b=n.AFrameworkApplication.ub.$d(Aa.a.j7,2,nd),fa.Task.Ra(32===$b);default:return ze.a($c.command)}}yc($b,$c){switch($c.command){case Aa.a.setSensitivity:case Aa.a.i7:case Aa.a.j7:return!0;default:return!1}}Lc($b,$c,nd){switch($c){case "PopulateSensitivityFlyout":return 32===
n.AFrameworkApplication.ub.$d(Aa.a.Uza,2,nd);default:return!1}}}Object(c.a)(We,"SensitivityCommandHandler",null,[219]);class md extends ve.a{constructor($b){super($b)}ld(){this.Zc([new We(this.$)])}static la($b){ve.a.Nd(316,new md($b))}}Object(c.a)(md,"SensitivityCommandHandlerFactory",ve.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");lb.main();(()=>{oa.a.Fa($b=>{$d.la($b);md.la($b)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.policy.js.map/ac6a4d517a36555b0b7b307b78a1cf71/EwaDSEsNext.policy.js.map