'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[18],{1113:function(t,E,a){a.d(E,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1114:function(t,E,a){a.d(E,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1116:function(t,E,a){a.d(E,"a",function(){return b});var c=a(513);const b=()=>{c.a.Ni(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1117:function(t,E,a){a.d(E,"a",function(){return c});t=a(0);class c{}c.KGc="b-ring_Apc_Trans";c.Qog="cdn_static_resource_ewa_image";Object(t.a)(c,"ResourceHosts",null,[])},1139:function(t,E,a){var c=a(0),b=a(7),e=a(15),f=a(222),d=a(30),h=a(27),m=a(354),l=a(171),w=a(264),n=a(357),x=a(4),r=a(1),u=a(38),v=a(8),B=a(285),z=a(13);class A extends B.a{constructor(Xa){super(Xa);this.S5g=()=>{e.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};e.ULS.sendTraceTag(537167828,
0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");this.Tb=0;this.qc(1,z.a.instance.ga(2254));Xa=z.a.instance.ga(2252);const qa=this.vN();this.initializeAndShow(Xa,this.S5g,qa)}get pc(){return"ClipboardReadPermissionAskDialog"}vN(){const Xa={};Xa.id=this.pc;const qa=z.a.instance.ga(2253);Xa.DialogMessage=qa;return Xa}}Object(c.a)(A,"ClipboardReadPermissionAskDialog",B.a,[]);var y=a(51);const D=(Xa,qa,xa,ob,Ib)=>{const Zb=Xa.Stopwatch,zc={};zc.a=Ib;zc.e=Zb.id;zc.c="RearrangeRowColumn";
zc.b="mouse";zc.d=Xa.OperationId.toString();zc.f=xa.toString();zc.g=ob.toString();zc.h=qa.toString();zc.i=Xa.DragDropIsShiftKeyDown;zc.j=!0;zc.o=Zb.Bc;zc.q=!1;zc.r=Xa.CopyPasteTargetType.toString();zc.s=Xa.EncounteredDeploymentErrors;return zc};class I{constructor(Xa,qa){this.KLh=()=>{const xa={};xa.SourceItem=this.toString();return xa};this.sessionStateId=Xa;this.sessionId=qa;this.toJSON=this.KLh}njf(Xa){return Xa?this.sessionStateId===Xa.sessionStateId&&this.sessionId===Xa.sessionId:!1}isFromCurrentSession(Xa){return this.sessionId===
Xa.ya.UserSessionId}}Object(c.a)(I,"SourceItem",null,[]);class M extends I{constructor(Xa,qa,xa,ob,Ib){super(xa,ob);this.activeFloatingObjectControlId=Xa;this.sheetName=qa;this.type=Ib}isEqual(Xa){return Xa&&Object.getType(Xa)===M?this.njf(Xa)&&this.activeFloatingObjectControlId===Xa.activeFloatingObjectControlId&&this.sheetName===Xa.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(M,"ArtSourceItem",I,[]);var T;(function(Xa){Xa[Xa.valid=0]="valid";Xa[Xa.notPairwiseDisjoint=1]="notPairwiseDisjoint";
Xa[Xa.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";Xa[Xa.notValidForm=3]="notValidForm";Xa[Xa.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(T||(T={}));Object(c.b)("CopySourceValidationOptions",T);var S=a(40);class H extends I{constructor(Xa,qa,xa,ob,Ib){super(ob,Ib);e.ULS.shipAssertTag(537167645,0,!!qa&&0<qa.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=Xa;this.ranges=qa;this.sheetName=xa}isEqual(Xa){return Xa&&Object.getType(Xa)===
H?this.njf(Xa)&&S.Q(this.ranges,Xa.ranges)&&this.sheetName===Xa.sheetName:!1}toString(){return S.i(this.ranges,",",this.$,!1)}}Object(c.a)(H,"RangeSourceItem",I,[]);const C=Xa=>!!Xa&&Object.getType(Xa)===H;class G{}G.E1j="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(G,"ExpectedErrorNames",null,[]);class J{}J.plainText="text/plain";J.html="text/html";J.png="image/png";J.shadowWorkbook="data/shadow-workbook";J.Ypi="metadata/is-last-copy-was-external";J.kmi="metadata/is-last-copy-was-external-XLO-source";
J.o4g="metadata/chrome-extension-id";J.Nsb="copyId";J.ZPg="metadata/additional-signature-data-attributes";Object(c.a)(J,"ClipboardDataFormat",null,[]);const L=Xa=>Xa.clipboardItems&&(Xa=Xa.clipboardItems.getItem(J.Ypi))&&"1"===Xa?!0:!1,P=Xa=>L(Xa)&&!(void 0===Xa.clipboardItems||null===Xa.clipboardItems)&&!!Xa.clipboardItems.getItem(J.png)&&!Xa.clipboardItems.getItem(J.plainText),aa=Xa=>Xa.clipboardItems&&(Xa=Xa.clipboardItems.getItem(J.kmi))&&"1"===Xa?!0:!1,U=Xa=>Xa&&(Xa=Xa.getCachedMetadata(),null===
Xa||void 0===Xa?0:Xa.lastCopy)?Xa.lastCopy:null;var K=a(50),Y=a(21),na=a(34);class W{constructor(Xa,qa,xa,ob){this.$=Xa;this.originalDestinations=qa;this.uac=xa;this.Esg=ob;this.zCg=this.originalDestinations;this.vwg=this.uac;this.Uzg="PasteRecoveryUI"}get YPg(){return this.Esg}get Cyi(){return this.Uzg}get mdj(){return this.zCg}get IXe(){return this.vwg}lLa(){return W.x3i}zTh(){return this.uac&&1===this.uac.length?this.ATh(this.uac[0]):null}ATh(Xa){var qa=Y.h(this.$);const xa=qa.ib.Mi(Xa);var ob=
qa.fg(Xa,xa);qa=qa.rtl;if(!ob)return null;Xa=Y.h(this.$).Df(xa);const Ib=Xa.$m;if(!Ib.Fd(ob))return null;ob=Ib.He(ob);const Zb=ob.topLeft.y;var zc=ob.bottomRight.y;const Mc=qa?ob.bottomRight.x:ob.topLeft.x;ob=qa?ob.topLeft.x:ob.bottomRight.x;var hd=new K.a(ob+(qa?-81:81),zc+38+6);if(Ib.zia(hd))return this.J5a(Xa,Ib,xa,ob,zc,qa?12:-3,66);hd=new K.a(ob+(qa?-81:81),zc);if(Ib.zia(hd))return this.J5a(Xa,Ib,xa,ob,zc,qa?20:3,22);hd=new K.a(ob,zc+38+6);if(Ib.zia(hd))return this.J5a(Xa,Ib,xa,ob,zc,-81+(qa?
18:0),66);ob=new K.a(Mc+(qa?81:-81),zc);if(Ib.zia(ob))return this.J5a(Xa,Ib,xa,Mc,zc,-81+(qa?12:-6),22);zc=new K.a(Mc,Zb-38-6);return Ib.zia(zc)?this.J5a(Xa,Ib,xa,Mc,Zb,qa?15:0,16):this.J5a(Xa,Ib,xa,qa?Ib.topLeft.x:Ib.bottomRight.x,Ib.bottomRight.y,-81+(qa?15:-6),22)}J5a(Xa,qa,xa,ob,Ib,Zb,zc){var Mc=Y.h(this.$);const hd=Mc.rtl;Xa=Sys.UI.DomElement.getLocation(Xa.domElement);ob=new Sys.UI.Point(ob+(hd?0:Xa.x)-qa.topLeft.x,Ib+Xa.y-qa.topLeft.y);hd&&(Mc=Mc.view.visibleArea,ob.x=Mc.bottomRight.x-Mc.topLeft.x-
ob.x,2===xa||4===xa)&&(ob.x+=qa.bottomRight.x);ob=na.a(this.$).qka(ob);return new Sys.UI.Point(ob.x+Zb,ob.y+zc)}}W.x3i=["PasteRecoveryUI"];Object(c.a)(W,"PasteRecoveryUI",null,[867]);var X=a(76),Aa=a(174);class Q{}Q.GHg="ActiveSelection";Q.shadowWorkbook="ShadowWorkbook";Q.$pg="GVML";Q.plainText="PlainText";Q.html="Html";Q.bWg="Bitmap";Object(c.a)(Q,"PayloadType",null,[]);class fa{}fa.aKj="Slice6";Object(c.a)(fa,"SliceName",null,[]);class Ca{}Ca.IKi="NotCalled";Ca.success="Success";Ca.failed="Failed";
Object(c.a)(Ca,"SucceededPopulatingSystemClipboardOptions",null,[]);var ia=a(361);const Ra=(Xa,qa)=>Xa?qa&&qa.ya?Xa.sessionId!==qa.ya.UserSessionId:(e.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(e.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Ya=Xa=>{switch(Xa){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},Ga=Xa=>{if(!Xa)return"null";const qa=[];for(const xa of Xa.get())qa.push(`${xa.clipboardDataFormat}(${xa.data.length})`);
qa.sort();return qa.join(",")};var da;(function(Xa){Xa[Xa.valid=0]="valid";Xa[Xa.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";Xa[Xa.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";Xa[Xa.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";Xa[Xa.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";Xa[Xa.multipleDestinationsAreNotMultiplyOfSourceRange=
5]="multipleDestinationsAreNotMultiplyOfSourceRange";Xa[Xa.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";Xa[Xa.copySourceNotValid=7]="copySourceNotValid";Xa[Xa.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";Xa[Xa.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";Xa[Xa.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";Xa[Xa.unknown=100]="unknown"})(da||(da={}));Object(c.b)("PasteValidationOptions",
da);var Z=a(48),ha=a(138),Wa=a(37),ca=a(154),ja=a(348),ua=a(29),Za=a(320),Pa=a(11),ka=a(22),ra=a(124),ba=a(112),Ua=a(564),Ka=a(99),Oa=a(55),ib=a(185),La=a(66),db=a(346);class Ab extends Sys.EventArgs{constructor(Xa,qa,xa){super();this.command=Xa;this.destinationRange=qa;this.sourceRange=xa}}Object(c.a)(Ab,"PasteCSERenderedEventArgs",Sys.EventArgs,[]);class Mb extends u.a{constructor(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd=null){super();this.pasteShortcutManager=null;this.qif=r.EwaSettings.xb();this.Dxa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",
!1);this.Teg=null;this.J8a=!1;this.Dud=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");this.txa=r.EwaSettings.isChangeGateEnabled("OfficeVSO:7205979_DemoteDragDropNonEmptyRangeLogLevel");this.KEd=id=>{this.ADj(id)&&(this.fq.dgc(),e.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};this.oDi=(id,yd)=>{e.ULS.sendTraceTag(537167768,
0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${id}]. userPressedExtensionLink=${yd}`);this.gridView.focus()};this.$c=(id,yd)=>{yd.SN||yd.If||this.zr("OnWorkbookOpened",!1).catch(()=>{})};this.Gh=(id,yd)=>{id=U(this.YK);const Yd=this.fq.byb(id);Yd&&(yd.na&&yd.na.sheetName===Yd.sheetName&&Yd.isFromCurrentSession(this.$)?this.fq.xdf(Yd.ranges,id.commandParameters.commandType):this.fq.dgc())};this.sqc=(id,yd)=>{id=U(this.YK);(id=this.fq.byb(id))&&
yd.item&&yd.item.sheetName===id.sheetName&&id.isFromCurrentSession(this.$)&&this.zr("OnItemDeleting",!1).catch(()=>{})};this.mHb=(id,yd)=>{this.qif?this.Teg(id,yd):this.bKf()};this.QR=(id,yd)=>{1===yd.Kr&&yd.Sf.operation.flags&2&&this.zr("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=Xa;this.qg=xa;this.gridView=Y.h(Xa);this.fq=Ib;this.oii=Zb;this.YK=qa;this.n6b=ob;this.getStringifiedError=hd||copyPasteInfra.getStringifiedError;this.p9f=1===Mc;this.fed=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");
this.Oj();this.copyPasteShortcutDialogFactory=this.$.da.Aa(85);e.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");zc||(e.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),zc=Mb.Qkh);this.userHash=d.a.sw(zc);this.uHi="CultureTag: "+z.a.instance.Xtb+" HASH: ";this.YK.addMetadataChangeListener(Mb.Pwf,this.KEd);this.hGi=Aa.a.LEb;this.Nya=this.Dxa?
r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):v.a.Nya;(this.Io=r.EwaSettings.getBooleanFeatureGate(Aa.a.TQa,!1))&&Xa.da.fb(478,id=>{this.pasteShortcutManager=id});this.qif&&(this.Teg=Za.a(()=>{this.bKf()},1,this.$.ka,"CopyPasteInfrastructure.OnStartEditInternal",!0))}yOe(){var Xa=U(this.YK);return Xa?(Xa=Xa.sourceItem)&&!Xa.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),
!1):!0:!1}get pasteIndicationManager(){return this.$.da.Aa(373)}nOg(Xa){this.addHandler(Mb.IFd,Xa)}Fjj(Xa){this.removeHandler(Mb.IFd,Xa)}copy(Xa){Xa.stopwatch=this.$.Kb.Cc("UserAction",y.b().tj(Xa.ribbonCommandInfo.command)+"ClientSide");if(this.Io){const Zb=Z.GetServiceTaskFactory.Na(this.$.da,478,479,0);Wa.TaskExtensions.za(Zb,()=>{this.pasteShortcutManager=Zb.result},this.ka,3)}const qa=!!U(this.YK);r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Hz&&
(this.J8a=!1);this.zr("Copy/before/"+m.a[Xa.ribbonCommandInfo.method],!1,void 0,!0,Xa.copyPasteTargetType).catch(()=>{});var xa=-1985798686===Xa.ribbonCommandInfo.command;if(1===this.gridView.Ne&&(xa=this.fq.Eif(this.gridView.ha.ra.selectedRanges,xa),0!==xa)){const Zb=Mb.A$g(xa);this.Vza(Zb,T[xa],!1);return Promise.reject(!1)}Xa.userHash=this.userHash;Xa.id=l.a.create().toString();let ob=this,Ib=this;return this.n6b.onCopy(Xa).then(Zb=>{Zb.isAsyncCopy||Xa.stopwatch.stop();ob.pasteIndicationManager.UOe();
const zc=ia.d(Xa);e.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${zc}`);ob.iBi(Zb,qa);Zb=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===Xa.copyPasteTargetType:!0;!Xa.isFormatPainter&&ob.Io&&Zb&&(ob.pasteShortcutManager?ob.pasteShortcutManager.osh():e.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},Zb=>{let zc=!1,Mc="none",hd=Mb.Utb,id=!0,yd=-1,Yd=
Mb.copyErrorName+Mb.$Ja,cc=!1,Rc=null;if(Zb){Rc=Zb.copyContext;yd=Zb.reason;Yd+=Mb.tLa(Zb);Zb.message&&(hd=Zb.message);var vd=Mb.z$g(Zb);if(vd)if(3===vd.copyErrorName)zc=!0,hd=Mc="Async Copy canceled by the user.",id=!1;else if(ua.a.Nq(vd.ewaErrors))if(hd=Ib.kdc(vd.ewaErrors),ua.a.fh(vd.ewaErrors,Mb.operationSucceededWithAlert))cc=zc=!0;else if(ua.a.fh(vd.ewaErrors,Mb.pasteDataLimitHit)||ua.a.fh(vd.ewaErrors,Mb.copyThrottlingError))zc=!0;13===Zb.reason?(zc=!0,id=!1):11===Zb.reason&&(id=!1)}vd=Zb?
Ib.getStringifiedError(Zb):"null";zc?(vd=ia.d(Xa),e.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${id}, Friendly message: ${Mc}, Error Message: ${hd}, CommandParameters: ${vd}`)):e.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${id}, Error Message: ${vd}, CommandParameters: ${ia.d(Xa)}`);id&&Ib.zr("Copy/fail/"+m.a[Xa.ribbonCommandInfo.method],
!0,void 0,void 0,Xa.copyPasteTargetType).catch(()=>{});Ib.hBi(Xa,zc,hd,Yd,yd,cc,Rc);return Promise.reject(Zb)})}paste(Xa){Xa.stopwatch=this.$.Kb.Cc("UserAction",y.b().tj(Xa.ribbonCommandInfo.command)+"ClientSide");r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Hz&&(e.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.J8a=!1,Xa.clipboardPicklingApiDataFormatsToRead=[J.shadowWorkbook]);
Y.h(this.$).Eh&&Y.h(this.$).Eh.l1(this.bjd(Xa.ribbonCommandInfo.command),Xa.stopwatch.id);if(Xa.isPasteCommandFromRecoveryUI){var qa=this.$.da.Aa(406);var xa=this.fed?S.d(qa.Rlc):w.a.clone(qa.Rlc);qa=qa.Tvd;Xa.pasteRecoveryCachedClipboardItems=qa?qa[Mb.bNf]:null}else xa=this.fed?S.d(this.gridView.ha.ra.selectedRanges):w.a.clone(this.gridView.ha.ra.selectedRanges);Xa.originalDestinations=xa;Xa.expandDestinations=this.G1c(Xa.originalDestinations,Xa.commandType);if(this.T1c(Xa.commandType,Xa.expandDestinations)||
this.n1g())return Xa.userHash=this.userHash,Xa.id=l.a.create().toString(),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!h.a.Hz&&(Xa.clipboardReadPermissionPromptShown=!1,Xa.clipboardAsyncApiDataFormatsToRead=[J.plainText+"Async"],this.n6b.shouldShowClipboardReadPermissionDialog().then(ob=>{ob&&(Xa.clipboardReadPermissionPromptShown=!0,new A(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.n6b.onPaste(Xa).then(ob=>this.Sqc(ob,
Xa),ob=>this.$Gb(Xa,ob));this.$.Xc(927125067,X.a.Db,30,null);xa=S.i(Xa.expandDestinations,",",this.$,!1);e.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${xa}, CommandType: ${Xa.commandType}, copyPasteTargetType="${Xa.copyPasteTargetType}"`);return Promise.resolve(!0)}bjd(Xa){switch(Xa){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}n1g(){return!!Y.h(this.$).ha.Ta.activeFloatingObjectControlId&&
this.$.aq(null,!1,470)}oDb(){const Xa=U(this.YK);return Xa&&Xa.commandParameters?Xa.commandParameters.copyPasteTargetType:0}Xpi(){return!!U(this.YK)&&Ra(U(this.YK),this.$)}zr(Xa,qa,xa=!1,ob=!1,Ib=0){try{this.Io&&this.pasteShortcutManager&&this.pasteShortcutManager.T8b();let Zb=Ib;const zc=this.wxi();if(!ob&&2===zc)return e.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${qa}', isExplicit = '${xa}', isForce = '${ob}', Current CCP operation copyPasteTargetType = '${Ib}', LastCopyPasteTargetType = '${zc}'`),
Promise.reject(null);0===Zb&&(Zb=zc);const Mc=this.$.Kb.Cc("UserAction","ClearCopyState"),hd=Mc.id;e.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${qa}', isExplicit = '${xa}', isForce = '${ob}', Current CCP operation copyPasteTargetType = '${Ib}', LastCopyPasteTargetType = '${zc}'`);this.fq.dgc();this.xaj();return this.n6b.onCancelCopy(qa).then(()=>{qa&&r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.Hz&&(this.J8a=!1);Mc.stop();this.usf(Xa,hd,!0,xa,qa,"","",Mc.Bc,Zb);return Promise.resolve(!0)},id=>{var yd=id?this.getStringifiedError(id):"null";e.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${yd}`);Mc.stop();yd=Mb.D1g+Mb.$Ja;let Yd=Mb.Utb;id&&(yd+=Mb.tLa(id),id.message&&(Yd=id.message));this.usf(Xa,hd,!1,xa,qa,Yd,yd,Mc.Bc,Zb);return Promise.reject(id)})}catch(Zb){return Promise.reject(null)}}M3c(Xa,qa,
xa=!1,ob=!1,Ib=0){return ob||!r.EwaSettings.oa(614)||this.yOe()?this.zr(Xa,qa,xa,ob,Ib):(e.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}Vza(Xa,qa,xa){e.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${qa}`);const ob=new Ka.a;
ob.ia("reason",qa);Ua.a(ra.a.discontinuousSelectionBlocking,[xa?ba.a.q3i:ba.a.xah],!0,!0,!1,!1,ob);Xa=ua.a.dd(1,1,751,Xa,0,371863010,"DiscontinuousSelectionBlocking");r.EwaSettings.Lz()?new ja.a(this.$,Xa):(Xa=new ca.ErrorDialog(this.$,Xa),Xa.initialize(),Xa.vg())}wxi(){const Xa=U(this.YK);return Xa&&Xa.sourceItem?Object.getType(Xa.sourceItem)===M?2:1:0}dragDropCells(Xa,qa,xa,ob,Ib=!1){Xa.stopwatch=this.$.Kb.Cc("UserAction","DragDropClientSide");Xa.isDragDrop=!0;this.zr("DragDrop/before/"+m.a[Xa.ribbonCommandInfo.method],
!1,void 0,void 0,Xa.copyPasteTargetType).catch(()=>{});const Zb=Ib?2:1;let zc=0;zc=Ib?4:ob?256:128;const Mc={encounteredDeploymentErrors:!1};Mc.commandParameters=Xa;Xa.userHash=this.userHash;Xa.id=l.a.create().toString();return this.Dud?this.fq.pasteRange(Xa.ribbonCommandInfo,S.q(qa,this.$),S.q(xa,this.$),Zb,zc,[Xa.stopwatch],Mc,!1,()=>{e.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Xa.copyPasteTargetType}"`);this.Q9a(Xa,Zb,qa,xa,Mc)},hd=>
{const id=hd?this.getStringifiedError(hd):"null";this.txa||e.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${id}, copyPasteTargetType="${Xa.copyPasteTargetType}"`);this.mab(hd,Xa,Zb,qa,xa,Mc)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},hd=>Promise.reject(hd)):this.fq.pasteRange(Xa.ribbonCommandInfo,S.q(qa,this.$),S.q(xa,this.$),Zb,zc,[Xa.stopwatch],Mc,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Xa.copyPasteTargetType}"`);
this.gridView.ha.selectionType=-1;this.Q9a(Xa,Zb,qa,xa,Mc);return Promise.resolve(!0)},hd=>{const id=hd?this.getStringifiedError(hd):"null";this.txa||e.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${id}, copyPasteTargetType="${Xa.copyPasteTargetType}"`);this.mab(hd,Xa,Zb,qa,xa,Mc);return Promise.reject(hd)})}Rph(Xa,qa,xa,ob,Ib=!1){Xa.stopwatch=this.$.Kb.Cc("UserAction","DragDropReplaceClientSide");Xa.isDragDrop=!0;this.M3c("DragDropReplace/before/"+m.a[Xa.ribbonCommandInfo.method],
!1,void 0,void 0,Xa.copyPasteTargetType).catch(()=>{});const Zb=Ib?2:1;let zc=0;zc=Ib?4:ob?256:128;const Mc={encounteredDeploymentErrors:!1};Mc.commandParameters=Xa;r.EwaSettings.getBooleanFeatureGate(Aa.a.A9b,!1)&&(Xa.isDragInsert=!1);Xa.userHash=this.userHash;Xa.id=l.a.create().toString();return this.Dud?this.fq.pasteRange(Xa.ribbonCommandInfo,S.q(qa,this.$),S.q(xa,this.$),Zb,zc,[Xa.stopwatch],Mc,!1,()=>{e.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Xa.copyPasteTargetType}"`);
this.Q9a(Xa,Zb,qa,xa,Mc)},hd=>{const id=hd?this.getStringifiedError(hd):"null";this.txa||e.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${id}, copyPasteTargetType="${Xa.copyPasteTargetType}"`);return this.mab(hd,Xa,Zb,qa,xa,Mc)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},hd=>Promise.reject(hd)):this.fq.pasteRange(Xa.ribbonCommandInfo,S.q(qa,this.$),S.q(xa,this.$),Zb,zc,[Xa.stopwatch],Mc,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410073,
0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Xa.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.Q9a(Xa,Zb,qa,xa,Mc);return Promise.resolve(!0)},hd=>{const id=hd?this.getStringifiedError(hd):"null";this.txa||e.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${id}, copyPasteTargetType="${Xa.copyPasteTargetType}"`);this.mab(hd,Xa,Zb,qa,xa,Mc);return Promise.reject(hd)})}Qph(Xa,qa,xa,ob,Ib=!1){Xa.stopwatch=this.$.Kb.Cc("UserAction",
"DragDropInsertClientSide");this.M3c("DragDropInsert/before/"+m.a[Xa.ribbonCommandInfo.method],!1,void 0,void 0,Xa.copyPasteTargetType).catch(()=>{});const Zb=Ib?2:1,zc=S.K(this.G1c([xa],Zb));var Mc=this.$.ea.na.sheetName;const hd=this.$.ea.na.sheetName,id=S.v(qa,this.$);id.SheetName=Mc;Mc=S.v(zc,this.$);Mc.SheetName=hd;ob=zc.isRow||qa.isRow||ob?1:0;const yd={encounteredDeploymentErrors:!1};Xa.isDragInsert=!0;yd.commandParameters=Xa;Xa.userHash=this.userHash;Xa.id=l.a.create().toString();if(this.Dud)return Ib=
this.fq.$Oe(yd,id,Mc,Ib,ob,Xa.ribbonCommandInfo,()=>{e.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Xa.copyPasteTargetType}"`);this.Q9a(Xa,Zb,qa,xa,yd)},cc=>{const Rc=cc?this.getStringifiedError(cc):"null";this.txa||e.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${Rc}, copyPasteTargetType="${Xa.copyPasteTargetType}"`);this.mab(cc,Xa,Zb,qa,xa,yd)}),ib.c(Ib.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
cc=>Promise.reject(cc))).np(()=>!0);Ib=this.fq.$Oe(yd,id,Mc,Ib,ob,Xa.ribbonCommandInfo,null,null);let Yd=this;return ib.c(Ib.then(()=>{e.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Xa.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.Q9a(Xa,Zb,qa,xa,yd);return Promise.resolve(!0)},cc=>{const Rc=cc?Yd.getStringifiedError(cc):"null";this.txa||e.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${Rc}, copyPasteTargetType="${Xa.copyPasteTargetType}"`);
Yd.mab(cc,Xa,Zb,qa,xa,yd);return Promise.reject(cc)})).np(()=>!0)}qgf(Xa,qa){var xa=U(this.YK);if(!xa)return e.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Oa.Task.Ra(!1);if(!C(xa.sourceItem))return e.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Oa.Task.Ra(!1);var ob=xa.sourceItem;if(!ob)return e.ULS.shipAssertTag(537167810,0,!!ob,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Oa.Task.Ra(!1);
if(!ob.isFromCurrentSession(this.$))return e.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Oa.Task.Ra(!1);if(1<ob.ranges.length)return e.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.Vza(2186,"InsertCopiedCutCells",!0),Oa.Task.Ra(!1);xa=S.K(ob.ranges);var Ib=this.gridView.ha.ra.ed.clone();Xa=S.K(this.G1c([Ib],Xa));const Zb=this.kqf();ob=ob.sheetName;Ib=this.$.ea.na.sheetName;const zc=S.v(xa,
this.$);zc.SheetName=ob;const Mc=S.v(Xa,this.$);Mc.SheetName=Ib;return(Xa.gf||xa.gf?Oa.Task.Ra(0):Xa.isRow||xa.isRow?Oa.Task.Ra(1):this.oii.E6b(this.$,Y.h(this.$).rtl)).np(hd=>this.fq.executeInsertCopiedCutCellsOperation(zc,Mc,Zb,hd.result,qa,null,null)).continueWith(()=>{Zb?this.fq.dgc():this.zr("InsertCopiedCutCells/success/"+m.a[qa.method],!0)})}osd(){const Xa=U(this.YK),qa=this.gridView.ha.ra.Pg;return!!Xa&&C(Xa.sourceItem)&&qa&&1===Xa.sourceItem.ranges.length}kqf(){return this.lqf(-911352779)}Qlc(){return this.lqf(-1985798686)}T1c(Xa,
qa){var xa=new ha.a(this.$.va),ob=36===Xa;const Ib=xa.Qd(4);Xa=2===this.oDb()&&xa.Qd(1);ob=ob&&Ib;xa=!xa.li||!this.Qlc()||!ha.a.n9b(qa,Y.h(this.$));return ob||Xa||this.$.aq(qa,!0)&&xa}Xic(Xa,qa){return this.fq.Xic(Xa,qa)}dispose(){super.dispose();this.gk();this.YK.removeMetadataChangeListener(Mb.Pwf)}a$c(Xa,qa,xa,ob,Ib,Zb){if(!this.B5g(Xa.commandParameters.ribbonCommandInfo.command))return Xa.cseStatus=2,!1;if(Zb&&qa.Fd(ob))return Xa.cseStatus=4,!1;if(xa!==Ib)return Xa.cseStatus=6,!1;if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&
(ob.width%qa.width||ob.height%qa.height))return Xa.cseStatus=16,!1;if(r.EwaSettings.getBooleanFeatureGate(Aa.a.OKe,!1)){if(xa=qa,ob=ob.He(this.gridView.ui),qa=null===qa.He(this.gridView.ui),Ib=Xa.commandParameters.ribbonCommandInfo.command,qa&&1804571062!==Ib&&-185374993!==Ib||!ob)return Xa.cseStatus=7,!1}else if(xa=qa.He(this.gridView.ui),ob=ob.He(this.gridView.ui),!xa||!ob)return Xa.cseStatus=7,!1;qa=S.v(xa,this.$);qa=this.qg.v3i(this.gridView,qa,S.v(ob,this.$),Xa.commandParameters.ribbonCommandInfo.command,
Xa.commandParameters.stopwatch);1===qa&&(Zb&&(this.qg.E3c(xa,!1),this.qg.E3c(xa,!0)),Zb=new Ab(Xa.commandParameters.ribbonCommandInfo.command,ob,xa),Y.h(this.$).faj(Zb),this.pasteIndicationManager.fnd(Xa.commandParameters.id),this.byc(Xa.commandParameters.expandDestinations,Xa.commandParameters.isPasteCommandFromRecoveryUI),this.oEe("DoPasteClientEstimation/"+m.a[Xa.commandParameters.ribbonCommandInfo.method],Xa));Xa.cseStatus=qa;return 1===qa}mOf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,
!1,!1,this.oDi)}dtf(Xa,qa,xa,ob){Xa=D(Xa,qa,xa,ob,this.$.ya.UserSessionId);Xa.k=!0;y.b().Qe(45,Xa,!0)}XHf(Xa,qa,xa,ob,Ib){var Zb=!1,zc=!1,Mc=Mb.Utb,hd=Mb.WOe+Mb.$Ja;Xa&&(hd+=Mb.tLa(Xa),ua.a.Nq(Xa.ewaErrors)?(Mc=this.kdc(Xa.ewaErrors),ua.a.fh(Xa.ewaErrors,[-103190598])&&(Zb=!0)):Xa.message&&(Mc=Xa.message));zc||(zc=this.Ird(Xa));qa=D(qa,xa,ob,Ib,this.$.ya.UserSessionId);qa.k=!1;qa.l=zc;qa.n=Mc;qa.p=hd;qa.q=Zb;y.b().Qe(45,qa,!0);return Promise.reject(Xa)}B5g(Xa){switch(Xa){case 237279923:case 808159687:return r.EwaSettings.isChangeGateEnabled("OfficeVSO:7317055_PasteCse");
case -185374993:return!0;case 1804571062:return!0;default:return!1}}lqf(Xa){const qa=U(this.YK);if(!qa)return!1;const xa=qa.sourceItem;return xa&&!xa.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):qa.commandParameters.ribbonCommandInfo.command===Xa}ADj(Xa){return Xa&&Xa.lastCopy?Ra(Xa.lastCopy,this.$):!0}z3e(Xa,qa,xa,ob,Ib){const Zb={};Zb.a=this.$.ya.UserSessionId;Zb.e=Xa.stopwatch.id;
Zb.c=y.b().tj(Xa.ribbonCommandInfo.command);Zb.b=m.a[Xa.ribbonCommandInfo.method];Zb.d=Xa.id;Zb.f=xa.toString();Zb.g=ob.toString();Zb.h=qa.toString();Zb.o=Xa.stopwatch.Bc;Zb.q=!1;Zb.r=Xa.copyPasteTargetType.toString();Zb.s=Ib.encounteredDeploymentErrors;r.EwaSettings.getBooleanFeatureGate(Aa.a.A9b,!1)&&(Zb.i=Ib.commandParameters.dragDropIsShiftKeyDown,Zb.j=Ib.commandParameters.isDragInsert);return Zb}Q9a(Xa,qa,xa,ob,Ib){Xa=this.z3e(Xa,qa,xa,ob,Ib);Xa.k=!0;y.b().Qe(45,Xa,!0)}qBi(Xa,qa,xa,ob,Ib,Zb,
zc,Mc,hd){Xa=this.z3e(Xa,qa,xa,ob,hd);Xa.k=!1;Xa.l=Ib;Xa.n=Zb;Xa.p=zc;Xa.q=Mc;y.b().Qe(45,Xa,!0)}usf(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd){const id={};id.a=this.$.ya.UserSessionId;id.b=qa;id.c=Xa;id.f=xa;id.e=ob;id.d=Ib;id.g=Zb;id.h=zc;id.i=Mc;id.j=hd.toString();y.b().Qe(46,id,!0)}iBi(Xa,qa){Xa=this.W2e(Xa.commandParameters,Xa);Xa.l=!0;Xa.j=qa;y.b().Qe(43,Xa,!0)}hBi(Xa,qa,xa,ob,Ib,Zb,zc){Xa=this.W2e(Xa,zc);Xa.l=!1;Xa.m=qa;Xa.o=xa;Xa.y=ob;Xa.x=Ib;Xa.z=Zb;y.b().Qe(43,Xa,!0);e.ULS.sendTraceTag(537167776,0,15,
`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${Xa.y},ErrorReason=${Xa.x},IsExpectedError=${Xa.m},IsSucceededWithAlert=${Xa.z},ErrorMessage=${Xa.o}`)}W2e(Xa,qa){const xa={};xa.a=this.$.ya.UserSessionId;xa.f=Xa.stopwatch.id;xa.g=Xa.id;xa.c=y.b().tj(Xa.ribbonCommandInfo.command);xa.b=m.a[Xa.ribbonCommandInfo.method];xa.q=Xa.stopwatch.Bc;xa.bd=Mb.zcc();xa.bg=Xa.copyPasteHandlerName;xa.bj=void 0===Xa.ribbonCommandInfo.We||null===Xa.ribbonCommandInfo.We?null:n.a[Xa.ribbonCommandInfo.We];xa.bq=
Xa.uploadToClipService;xa.br=Xa.floatingObjectType;xa.s=Xa.copyPasteTargetType.toString();xa.bc=Ya(Xa.copyPasteTargetType);xa.z=!1;if(qa){xa.bk=qa.id;xa.bl=qa.serverRequestTimeInMs;qa.requestTelemetryData&&(xa.bm=qa.requestTelemetryData.EcsOperationDuration,xa.bn=qa.requestTelemetryData.EcsRequestDuration,xa.bo=qa.requestTelemetryData.WfeRequestDuration);xa.d=qa.sourceItem?qa.sourceItem.toString():null;xa.e=-1;if(C(qa.sourceItem)){xa.e=0;Xa=qa.sourceItem.ranges;for(const ob of Xa)xa.e+=ob.TC}xa.h=
qa.isAsyncCopy;xa.i=qa.isFromCache;xa.k=qa.isSelectionAllowed;xa.r=qa.plainTextPayloadSize;xa.u=qa.htmlPayloadSize;xa.v=qa.htmlSizeExceedsLimit;xa.w=qa.copyTotalSizeExceedsLimit;xa.t=qa.shadowWorkbookPayloadSize;xa.p=qa.clientSideCopyTime;xa.ba=qa.encounteredDeploymentErrors;xa.bb=qa.shadowWorkbookSizeExceedsLimit;xa.be=qa.syncClipboardItemsKeys;xa.bf=qa.asyncClipboardItemsKeys;xa.bh=this.JHe(qa.succeededPopulatingSystemClipboardSync);xa.bi=this.JHe(qa.succeededPopulatingSystemClipboardAsync)}return xa}byc(Xa,
qa=!1){if(!this.gridView.gb&&!this.gridView.ji){var xa=this.gridView.ha.ra,ob=!qa&&1===Xa.length&&S.Q(Xa,xa.selectedRanges),Ib=ob?xa.activeCell:Xa[0].topLeft;Xa[0].contains(Ib)||(e.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${xa.selectedRanges}, IndexOfActiveRange ${xa.Ds}, ActiveCell ${xa.activeCell}, calculatedDestinationRanges ${Xa}, keepThePreviousActiveCell ${ob}, newActiveCell ${Ib}, isPasteCommandFromRecoveryUI ${qa}`),Ib=Xa[0].topLeft);this.gridView.ha.rx(Xa,
0,Ib,0,void 0,"CopyPasteInfrastructure.SelectPastedRange")}}W6e(Xa,qa){const xa={};xa.a=this.$.ya.UserSessionId;xa.g=Xa.stopwatch.id;xa.t=Xa.stopwatch.Bc;xa.bz=!1;qa&&(xa.bv=qa.id,xa.bw=qa.serverRequestTimeInMs,xa.n=qa.commandParameters.clipboardFormatReadTimes,xa.o=qa.commandParameters.clipboardFormatReadStatus,xa.p=qa.commandParameters.clipboardReadPermissionPromptShown,xa.q=qa.commandParameters.asyncApiReadTimedOut,qa.requestTelemetryData&&(xa.cb=qa.requestTelemetryData.EcsOperationDuration,xa.cc=
qa.requestTelemetryData.EcsRequestDuration,xa.cd=qa.requestTelemetryData.WfeRequestDuration));xa.x=Xa.copyPasteTargetType.toString();xa.bl=Ya(Xa.copyPasteTargetType);xa.br=Xa.copyPasteHandlerName;xa.i=S.i(Xa.expandDestinations,",",this.$,!1);xa.h=S.i(Xa.originalDestinations,",",this.$,!1);xa.e=Xa.id;xa.d=Xa.commandType;xa.c=y.b().tj(Xa.ribbonCommandInfo.command);xa.b=m.a[Xa.ribbonCommandInfo.method];xa.bf=!1;xa.bg=!1;xa.bp=Mb.zcc();xa.bt=void 0===Xa.ribbonCommandInfo.We||null===Xa.ribbonCommandInfo.We?
null:n.a[Xa.ribbonCommandInfo.We];xa.cj=Xa.isPasteCommandFromEnterShortcut;if(xa.ca=Xa.isPasteCommandFromRecoveryUI)xa.cf=Xa.pasteRecoveryUndoStopwatch.id,xa.cg=Xa.pasteRecoveryUndoStopwatch.Bc;if(qa){if((Xa=qa.copyContextSnapshot)&&!qa.wasLastCopyExternal){xa.f=Xa.commandParameters.id;xa.j=Xa.sourceItem.toString();xa.k=-1;if(C(Xa.sourceItem)){xa.k=0;const ob=Xa.sourceItem.ranges;for(const Ib of ob)xa.k+=Ib.TC}xa.bg=1===Xa.commandParameters.commandType}else qa.clipboardItems?xa.f=qa.clipboardItems.getItem(J.Nsb):
e.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");xa.bz=qa.pasteRecoveryUIDisplayed;xa.ci=qa.cseStatus}else e.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return xa}BCi(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd){Xa=this.W6e(Xa,Mc);Xa.l=!1;Xa.m=qa;Xa.s=xa;Xa.bc=ob;Xa.be=Ib;Xa.bd=Zb;Xa.bf=zc;Mc?(Xa.y=L(Mc)||!Mc.copyContextSnapshot,Xa.bi=!Xa.y&&Ra(Mc.copyContextSnapshot,this.$),Xa.bj=Mc.shadowWorkbookSizeExceedsLimit,
Xa.v=Mc.shadowWorkbookPayloadSize,Xa.w=Mc.htmlPayloadSize,Xa.bq=Ga(Mc.clipboardItems),Xa.bb=Mc.activeSelectionType,Xa.bs=Mc.isSameSession,Xa.bn=Mc.payloadOrigin,Xa.bo=Mc.payloadType,Xa.bu=Mc.externalAppSource,Xa.bx=Mc.indicationDisplayScheduled,Xa.by=Mc.pasteIndicationDisplayStatus,Xa.ck=Mc.pasteDestinationHasMergedCells):Xa.bi=Ra(hd,this.$);y.b().Qe(44,Xa,!0);e.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${Xa.be},ErrorReason=${Xa.bd},IsExpectedError=${Xa.m},IsSucceededWithAlert=${Xa.bf},ErrorMessage=${Xa.s}`)}CCi(Xa){const qa=
this.W6e(Xa.commandParameters,Xa);qa.y=Xa.wasLastCopyExternal;qa.l=!0;qa.u=Xa.plainTextPayloadSize;qa.v=Xa.shadowWorkbookPayloadSize;qa.w=Xa.htmlPayloadSize;qa.z=Xa.isClipboardDataContainShadowWorkbook;qa.ba=Xa.isShadowWorkbookParsedSuccessfully;qa.bb=Xa.activeSelectionType;qa.bc=Xa.pasteResult;qa.bh=Xa.encounteredDeploymentErrors;qa.bj=Xa.shadowWorkbookSizeExceedsLimit;qa.bk=aa(Xa);qa.bq=Ga(Xa.clipboardItems);qa.bs=Xa.isSameSession;qa.bn=Xa.payloadOrigin;qa.bo=Xa.payloadType;qa.bu=Xa.externalAppSource;
qa.bx=Xa.indicationDisplayScheduled;qa.by=Xa.pasteIndicationDisplayStatus;qa.ck=Xa.pasteDestinationHasMergedCells;qa.bm=Xa.clipboardItems?Xa.clipboardItems.getItem(J.o4g):null;qa.bi=!Xa.isSameSession&&!Xa.wasLastCopyExternal;y.b().Qe(44,qa,!0)}Oj(){this.$.va.Wf(this.Gh);this.$.va.wNg(this.sqc);this.$.userOperationManager.tr(this.QR);this.$.$k(this.$c);Y.h(this.$).Vb.Zk(this.mHb)}gk(){this.$&&this.$.va&&(this.$.va.Dg(this.Gh),this.$.va.Xij(this.sqc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.oo(this.QR);
this.gridView&&this.gridView.Vb&&this.gridView.Vb.Uk(this.mHb)}$Gb(Xa,qa){var xa=null;let ob=!1;var Ib=null;let Zb="UnknownFailure",zc=-1,Mc=Mb.Utb,hd=Mb.pasteErrorName+Mb.$Ja,id=!1;this.pasteIndicationManager.fnd(Xa.id);this.pasteDestinationHasMergedCells(Xa.expandDestinations)&&(qa.pasteContext.pasteDestinationHasMergedCells=!0);const yd=U(this.YK);(Xa.clearStateOnFinish||Xa.clearSystemClipboard)&&this.zr("Paste/fail/"+m.a[Xa.ribbonCommandInfo.method],!0,void 0,void 0,Xa.copyPasteTargetType).catch(()=>
{});if(qa){zc=qa.reason;hd+=Mb.tLa(qa);qa.message&&(Mc=qa.message);if(xa=Mb.O$g(qa))if(1===xa.pasteErrorName)ob=!0,Zb="CopyPasteLengthTooLongPopup",Mc=Ib="The pasted content is too long. Popup a dialog to the user.",e.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib}, copyPasteTargetType="${Xa.copyPasteTargetType}"`),xa=ua.a.dd(1,0,26,690,0,1306609195,"CopyPasteOversizeError"),r.EwaSettings.Lz()?new ja.a(this.$,xa):(xa=new ca.ErrorDialog(this.$,xa),xa.initialize(),xa.vg());
else if(7===xa.pasteErrorName)ob=!0,Zb="No-Op",Mc=Ib="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",e.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib}, copyPasteTargetType="${Xa.copyPasteTargetType}"`);else if(8===xa.pasteErrorName)ob=!0,Zb="UseShortcutsPopup",Mc=Ib="Unable to paste content from the system clipboard. Popup dialog to the user.",e.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib}, copyPasteTargetType="${Xa.copyPasteTargetType}"`),
this.mOf();else if(18===xa.pasteErrorName){ob=!0;Zb="PasteExternalNotSupportMultipleSelectionPopup";Mc="Paste external not support multiple selection.";Ib="Unknown";var Yd=2186;100!==xa.validationFailureReason&&(Ib=da[xa.validationFailureReason],Yd=Mb.BHe(xa.validationFailureReason));this.Vza(Yd,Ib,!0)}else 20===xa.pasteErrorName||19===xa.pasteErrorName?(ob=!0,20===xa.pasteErrorName?(Zb="PasteAcrossSessionNotSupportMultipleSelectionPopup",Mc="Paste across session does not support multiple selection."):
(Zb="PasteInSameSessionNotSupportMultipleSelectionPopup",Mc="This kind of multiple selection is not supported for same session paste."),Ib="Unknown",Yd=2186,100!==xa.validationFailureReason&&(Ib=da[xa.validationFailureReason],Yd=Mb.BHe(xa.validationFailureReason)),xa=6===xa.validationFailureReason,this.T1c(Xa.commandType,Xa.expandDestinations)&&xa&&this.byc(Xa.expandDestinations),this.Vza(Yd,Ib,!0)):6===xa.pasteErrorName?(ob=!0,Zb="No-Op",Mc=Ib="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",
e.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib}, copyPasteTargetType="${Xa.copyPasteTargetType}"`)):17===xa.pasteErrorName?(ob=!0,Zb="No-Op",Mc=Ib="Paste text on Art is not yet a supported operation",e.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib}, copyPasteTargetType="${Xa.copyPasteTargetType}"`)):16===xa.pasteErrorName?(ob=!0,Zb="No-Op",Mc=Ib="Paste has failed because the previous copy has failed",xa=this.getStringifiedError(xa),e.ULS.sendTraceTag(537167771,
0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib}, copyPasteTargetType="${Xa.copyPasteTargetType}", error=${xa}`)):ua.a.Nq(xa.ewaErrors)?(ua.a.u$(xa.ewaErrors)||ua.a.fh(xa.ewaErrors,ua.a.Wec())?(ob=!0,Zb="CommunicationError",Ib=ua.a.sc(xa.ewaErrors),e.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Mc} copyPasteTargetType="${Xa.copyPasteTargetType}"`)):ua.a.fh(xa.ewaErrors,Mb.Crj)?(ob=!0,Zb="SavingWorkbookError",Ib=ua.a.sc(xa.ewaErrors),e.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Mc} copyPasteTargetType="${Xa.copyPasteTargetType}"`)):
ua.a.fh(xa.ewaErrors,Mb.operationSucceededWithAlert)&&(id=ob=!0,Zb="OperationSucceededWithAlert",Ib=ua.a.sc(xa.ewaErrors),e.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Mc} copyPasteTargetType="${Xa.copyPasteTargetType}"`)),ob||(Mc=this.kdc(xa.ewaErrors),ob=this.Ird(qa))):11===xa.pasteErrorName&&(ob=!0,Zb="No-Op",Mc="Paste has failed because user try copy cross-session oart object");15===qa.reason&&(ob=!0,Zb="No-Op",Mc="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
ka.a.equals(hd,G.E1j,!1)&&(ob=!0,Zb="No-Op",Mc="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}ob||(xa=qa?this.getStringifiedError(qa):"null",e.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${xa}, copyPasteTargetType="${Xa.copyPasteTargetType}"`));this.BCi(Xa,ob,Mc,Zb,hd,zc,id,qa.pasteContext,yd);return Promise.reject(qa)}Sqc(Xa,qa){var xa;e.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${qa.copyPasteTargetType}"`);
this.pasteIndicationManager.fnd(qa.id);if(this.A3i(qa.copyPasteTargetType,Xa)){r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Hz&&Xa.wasLastCopyExternal&&Xa.payloadType===Q.shadowWorkbook&&(this.J8a=!0);var ob=null;(null===(xa=Xa.pastedRange)||void 0===xa?0:xa.Ranges)&&0<Xa.pastedRange.Ranges.length?ob=S.g(Xa.pastedRange.Ranges):Xa.wasLastCopyExternal||(ob=qa.expandDestinations);this.ltj(Xa,ob);if(this.AFj(Xa,ob)){let Ib;this.fed?(xa=S.d(qa.originalDestinations),
Ib=1028===qa.commandType?S.d(qa.expandDestinations):S.d(ob)):(xa=w.a.clone(qa.originalDestinations),Ib=1028===qa.commandType?w.a.clone(qa.expandDestinations):w.a.clone(ob));let Zb=null;Xa.wasLastCopyExternal&&(qa.isKeyboardEvent||qa.isPasteCommandFromRecoveryUI)&&(Zb={[Mb.bNf]:Xa.clipboardItems});this.pasteDestinationHasMergedCells(qa.expandDestinations)&&(Xa.pasteDestinationHasMergedCells=!0);Xa.pasteRecoveryUIDisplayed=!0;const zc=new W(this.$,xa,Ib,Zb),Mc=Z.GetServiceTaskFactory.Na(this.$.da,406,
405,0);Wa.TaskExtensions.za(Mc,()=>{const hd=Mc.result;hd.aWg(zc);hd.LIj(qa.ribbonCommandInfo.method)},this.ka,8)}Xa.pasteRecoveryUIDisplayed||1!==ob.length||(ob=S.K(ob),x.AFrameworkApplication.Hs("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&ob&&(xa=La.d(this.$.va.na),ob=new db.a(ob,xa),this.z0d(ob,"CutAndPaste")))}this.oEe("Paste/success/"+m.a[qa.ribbonCommandInfo.method],Xa);
this.CCi(Xa);this.p9f&&(!qa.isKeyboardEvent||aa(Xa))&&this.$.ea.Mg.get(66)&&(e.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.p9f=!1,this.ubh());return Promise.resolve(!0)}AFj(Xa,qa){return!qa||1!==qa.length||Xa.commandParameters.clearSystemClipboard||Xa.commandParameters.clearStateOnFinish||Xa.commandParameters.skipClipboardAccess?!1:L(Xa)&&(qa=Xa.clipboardItems.getItem(J.plainText),Xa=Xa.clipboardItems.getItem(J.html),void 0===
qa||null===qa||qa.length>this.hGi||void 0===Xa||null===Xa||Xa.length>this.Nya)?(e.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}A3i(Xa,qa){return 1===Xa||qa.payloadType===Q.plainText||r.EwaSettings.oa(158)&&qa.payloadType===Q.html||r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Hz&&qa.payloadType===Q.shadowWorkbook}pasteDestinationHasMergedCells(Xa){const qa=
Y.h(this.$).Da.rD();if(!qa||!qa.length)return!1;for(const xa of qa)if(xa.Gw(Xa[0]))return!0;return!1}oEe(Xa,qa){let xa;({hIa:xa}=this.hmi(qa)).returnValue&&this.zr(Xa,xa,void 0,void 0,qa.commandParameters.copyPasteTargetType).catch(()=>{})}mab(Xa,qa,xa,ob,Ib,Zb){const zc=Xa?this.getStringifiedError(Xa):"null";this.txa||e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${zc}`);let Mc=!1,hd=!1,id=!1,yd=Mb.Utb,Yd=Mb.WOe+Mb.$Ja;Xa&&(Yd+=Mb.tLa(Xa),ua.a.Nq(Xa.ewaErrors)?
(yd=this.kdc(Xa.ewaErrors),ua.a.fh(Xa.ewaErrors,Mb.operationSucceededWithAlert)&&(Mc=!0),ua.a.fh(Xa.ewaErrors,Mb.dragDropNonEmptyRange)&&(hd=id=!0)):Xa.message&&(yd=Xa.message));id||(id=this.Ird(Xa));hd?this.gridView.ha.selectionType=-1:this.fq.pdj(Ib);this.txa&&!id&&e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${zc}, copyPasteTargetType="${qa.copyPasteTargetType}`);this.qBi(qa,xa,ob,Ib,id,yd,Yd,Mc,Zb)}G1c(Xa,qa){let xa=Xa;const ob=this.LXh();if(null===ob||void 0===
ob?0:ob.ranges)xa=this.fq.y0g(qa,ob.ranges,Xa);return xa}LXh(){const Xa=U(this.YK);return Xa&&C(Xa.sourceItem)?Xa.sourceItem:null}xaj(){this.raiseEvent(Mb.IFd,null)}ltj(Xa,qa){const xa=Xa.commandParameters.originalDestinations;qa&&(S.Q(this.gridView.ha.ra.selectedRanges,xa)?(this.byc(qa),Xa=Pa.HelperMethods.Ypb(qa),e.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${Xa}`)):Xa.commandParameters.isPasteCommandFromRecoveryUI?(this.byc(qa,
!0),e.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${qa}, active cell: ${qa[0].topLeft}`)):(Xa=Pa.HelperMethods.Ypb(xa),e.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${Xa}`)))}hmi(Xa){if(Xa.isPlainTextPaste||Xa.isHtmlPaste||P(Xa)||Xa.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,
hIa:!1};var qa=Xa.copyContextSnapshot;if(Xa.commandParameters.clearStateOnFinish)return{returnValue:!0,hIa:!0};if(qa&&C(qa.sourceItem)){var xa=qa.sourceItem;if(!xa.isFromCurrentSession(this.$))return{returnValue:!1,hIa:!0};qa=-1985798686===qa.commandParameters.ribbonCommandInfo.command;if(!(1<xa.ranges.length||1<Xa.commandParameters.expandDestinations.length)){const ob=S.K(xa.ranges);Xa=S.K(Xa.commandParameters.expandDestinations);const Ib=this.$.ea.na.sheetName;xa=xa.sheetName;if(xa===Ib&&Xa.equals(ob))return{returnValue:!1,
hIa:!0};if(xa===Ib&&Xa.He(ob))return{returnValue:!0,hIa:!1}}return{returnValue:qa,hIa:!0}}return{returnValue:!1,hIa:!0}}bKf(){var Xa=U(this.YK);(Xa=this.fq.byb(Xa))&&Xa.isFromCurrentSession(this.$)&&this.zr("OnStartEdit",!1).catch(()=>{})}kdc(Xa){Xa=ua.a.nUh(Xa,Mb.$Ja);return this.uHi+d.a.sw(Xa).toString()}Ird(Xa){Xa=Mb.tLa(Xa);return!!Xa&&ka.a.u3a(Xa,Mb.tHi)}ubh(){const Xa=ua.a.dd(1,2,327,328,h.a.Ep?329:h.a.aI?330:331,530046625,"ActivateLocalStorage"),qa=Z.GetServiceTaskFactory.Na(this.$.da,5,4,
0);Wa.TaskExtensions.za(qa,()=>{qa.result.mh(43,Xa)},this.ka,3)}JHe(Xa){return void 0===Xa||null===Xa?Ca.IKi:Xa?Ca.success:Ca.failed}static O$g(Xa){const qa=Xa.innerError;return qa&&0!==qa.pasteErrorName?Xa.innerError:null}static z$g(Xa){const qa=Xa.innerError;return qa&&0!==qa.copyErrorName?Xa.innerError:null}static tLa(Xa){let qa="";if(!Xa)return Mb.TLe;Xa.errorName&&(qa=Xa.errorName,Xa.innerError&&(qa+=Mb.$Ja+Mb.tLa(Xa.innerError)));qa||(qa=Xa&&Xa.name?Xa.name:Mb.TLe);return qa}static zcc(){Mb.FS||
(Mb.FS=fa.aKj);return Mb.FS}static BHe(Xa){switch(Xa){case 7:case 1:return 2193;case 5:return 2190;case 6:return 2189;case 8:case 3:case 2:case 4:case 9:case 10:return 2186;default:return e.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${Xa}`),2193}}static A$g(Xa){switch(Xa){case 3:return 2187;case 1:return 2188;case 2:case 4:return 2186;default:return e.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${Xa}`),
2193}}z0d(Xa,qa){Wa.TaskExtensions.za(Z.GetServiceTaskFactory.Na(this.$.da,426,427,1),xa=>{void xa.result.Zea(Xa,qa);e.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.ka,3)}}Mb.Pwf="EwaJsMetadataChangeListenerId";Mb.IFd="cpiOSC";Mb.Qkh="cpiDID";Mb.Utb="Unknown";Mb.TLe="UnknownError";Mb.$Ja="_";Mb.WOe="DragAndDropError";Mb.pasteErrorName="PasteError";Mb.D1g="CancelError";Mb.copyErrorName="CopyError";
Mb.tHi="MergedCellOverlap";Mb.bNf="PasteRecoveryCachedClipboardItems";Mb.Crj=[1352631530,1679665408];Mb.operationSucceededWithAlert=[-103190598];Mb.pasteDataLimitHit=[1306609195];Mb.copyThrottlingError=[-386183710];Mb.dragDropNonEmptyRange=[563945982];Mb.FS=null;Object(c.a)(Mb,"CopyPasteInfrastructure",u.a,[848,849,3]);class pb{constructor(){this.r1a=this.AEe=null}}Object(c.a)(pb,"ClipboardPlatformInitializationResult",null,[]);var Qb=a(187),xb=a(641),pa=a(554),Ma=a(121),ya=a(5),Ea=a(60);const Na=
(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd,id=null)=>{hd=Xa.Oa(9,hd);hd.sourceRanges=qa;hd.destinationRanges=xa;hd.flags=ob;return Ea.g(Xa,"PasteRange",hd,Ib,Zb,zc,Mc,64,id)},kb=(Xa,qa,xa,ob,Ib,Zb,zc,Mc=null)=>{zc=Xa.Oa(1,zc);zc.pasteHtmlParameters=qa;return Ea.g(Xa,"PasteHtmlContent",zc,xa,ob,Ib,Zb,64,Mc)},lb=(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd=null)=>{Mc=Xa.Oa(9,Mc);Mc.destinationRange=qa;Mc.source=xa;return Ea.g(Xa,"PasteString",Mc,ob,Ib,Zb,zc,64,hd)},oa=(Xa,qa,xa,ob,Ib,Zb,zc=null,Mc=null)=>{zc=Xa.Oa(1,zc);zc.copyParameters=
qa;return Ea.g(Xa,"Copy",zc,xa,ob,Ib,Zb,0,Mc)},Ba=(Xa,qa,xa,ob,Ib,Zb,zc=null,Mc=null)=>{zc=Xa.Oa(1,zc);zc.copyParameters=qa;return Ea.g(Xa,"Cut",zc,xa,ob,Ib,Zb,0,Mc)},sa=(Xa,qa,xa,ob,Ib,Zb,zc=null,Mc=null)=>{zc=Xa.Oa(1,zc);zc.pasteParameters=qa;return Ea.g(Xa,"Paste",zc,xa,ob,Ib,Zb,64,Mc)};class qb{constructor(Xa,qa,xa){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=Xa;this.destinationRange=qa;this.pasteFlags=xa}}Object(c.a)(qb,"MacroRecorderPasteRangePayload",null,
[145]);class Jb{constructor(Xa,qa){this.content=this.destinationRange=null;this.destinationRange=Xa;this.content=qa}getContent(){return this.content}}Object(c.a)(Jb,"MacroRecorderPasteStringPayload",null,[145]);class Yb{constructor(Xa){this.pasteParameters=null;this.pasteParameters=Xa}}Object(c.a)(Yb,"MacroRecorderPastePayload",null,[145]);var jb=a(585),ab=a(764),vb=a(188),Da=a(33),Fa=a(207),nb=a(116),Ta=a(282);const V=(Xa,qa,xa,ob,Ib,Zb,zc=null)=>{zc=Xa.Oa(41,zc);zc.insertCopiedCutCellsParameters=
qa;return Ea.g(Xa,"InsertCopiedCutCells",zc,xa,ob,Ib,Zb,4)},va=(Xa,qa,xa,ob,Ib,Zb,zc=null)=>{zc=Xa.Oa(41,zc);zc.insertCopiedCutCellsParameters=qa;return Ea.g(Xa,"InsertCopiedCutCellsV2",zc,xa,ob,Ib,Zb,0)};class wb{constructor(Xa){this.parameters=null;this.parameters=Xa}getParameters(){return this.parameters}}Object(c.a)(wb,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[145]);var fc=a(374);class Fc{constructor(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd){this.destinationRange=Xa;this.Nsb=xa;this.t3i=ob;this.Wd=
Ib;this.vRb=Zb;this.pasteContext=zc;this.H4b=Mc;this.$fg=hd}}Object(c.a)(Fc,"PasteHtmlRequestParams",null,[]);class Qa{constructor(Xa,qa){this.Clc=this.wOa=null;this.BQa=Aa.a.BQa;this.aHd=Aa.a.aHd;this.LEb=Aa.a.LEb;this.qic=r.EwaSettings.getBooleanFeatureGate(Aa.a.l7b,!1);this.Dpi=r.EwaSettings.isChangeGateEnabled("OfficeVSO:7316963_InsertCopiedCutCellsV2Enabled");this.dqd=!1;this.Dxa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.Vz=(xa,ob)=>{if(2===
ob.Kr)this.Ov.clear(),this.wOa=null;else if(1===ob.Kr&&this.Ov&&this.Ov.contains(ob.Sf)){xa=Ma.a(ob.Sf.operation.operationName);const Ib=ob.Sf.dequeueUtcTime.getTime()-ob.Sf.enqueueUtcTime.getTime();e.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${xa} returned, it took ${Ib} milliseconds to complete.`);this.Ov.remove(ob.Sf);this.wOa=null}};this.$=Xa;this.gridView=qa;this.dqd&&(this.$.userOperationManager.tr(this.Vz),this.Ov=new Qb.a)}get Nya(){return this.Dxa?r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",
this.$.ya.CopyPasteMaxPayloadLength):v.a.Nya}copy(Xa,qa,xa,ob=null,Ib=null){const Zb=this.$.pa.xa.Wb();this.dqd&&this.KY();this.Clc=Zb.ClientRequestId;var zc=new vb.a(505,0,(Mc,hd,id)=>{const yd={CopyPasteTargetType:1};yd.SourceRanges=Xa;yd.CopyOperationId=qa.id;e.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.Dxa}, CopyOperationId : ${yd.CopyOperationId}`);return this.wOa=this.Dxa?oa(this.$.pa.ww,yd,Ta.b(Mc,xa),ob?Ta.a(hd,ob):hd,id,qa.ribbonCommandInfo,
Zb,Ib):oa(this.$.pa.xa,yd,Ta.b(Mc,xa),ob?Ta.a(hd,ob):hd,id,qa.ribbonCommandInfo,Zb,Ib)},80);zc=this.$.userOperationManager.Ic(zc,qa.ribbonCommandInfo);this.dqd&&this.Ov.add(zc)}aNf(Xa,qa,xa,ob,Ib,Zb){return new Promise((zc,Mc)=>{var hd;const id=Zb.commandParameters.stopwatch.Bc;let yd=2;20===Zb.commandParameters.commandType&&(yd=16);36===Zb.commandParameters.commandType&&(yd=32);68===Zb.commandParameters.commandType&&(yd=64);Da.a.jvd(this.$)&&1028===Zb.commandParameters.commandType&&(yd=1024);let Yd=
null;if(null===(hd=Zb.copyContextSnapshot)||void 0===hd?0:hd.commandParameters)Yd=Zb.copyContextSnapshot.commandParameters.id;Qa.ORd(this.$,Xa,ob,qa,xa,null,cc=>{Qa.vfc(cc,Zb,zc,Mc,id,this.$,null,!0,null,null)},cc=>{Zb.serverRequestTimeInMs=Zb.commandParameters.stopwatch.Bc-id;cc=nb.a.Oe(cc.data);Mc(new ab.a(5,cc))},Ib,yd,Yd,Zb.commandParameters.id)})}pasteRange(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd,id){return new Promise((yd,Yd)=>{const cc=zc.commandParameters.stopwatch.Bc;Qa.quj(this.$,Xa,qa,xa,ob|-5&Ib,Rc=>
{Qa.vfc(Rc,zc,yd,Yd,cc,this.$,null,!0,hd,id)},Rc=>{zc.serverRequestTimeInMs=zc.commandParameters.stopwatch.Bc-cc;Rc=nb.a.Oe(Rc.data);Rc=new ab.a(5,Rc);null===id||void 0===id?void 0:id(Rc);Yd(Rc)},Zb,Mc)})}w8i(Xa,qa,xa,ob,Ib,Zb,zc){return(new Promise((Mc,hd)=>{if(qa)if(qa.length>this.Nya){var id=zc.clipboardItems.getItem(J.plainText);let yd=-1;void 0!==id&&null!==id&&(yd=id.length);Aa.a.zjf&&qa.length<this.aHd&&qa.length>this.BQa&&(this.fOf(qa),this.AW=new Fc(Xa,qa,xa,ob,Ib,Zb,zc,0,this.xsc.length),
window.requestIdleCallback&&window.requestIdleCallback(()=>this.qHd()));e.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${qa.length}, MaxHtmlImportLength: ${this.Nya}, PlainTextLength: ${yd}`);hd(new ab.a(1))}else id=new vb.a(204,0,(yd,Yd,cc)=>{this.$.Py();const Rc=zc.commandParameters.stopwatch.Bc;yd=Ta.b(yd,Qe=>{Qa.vfc(Qe,zc,Mc,hd,Rc,this.$,qa,!1,null,null)});Yd=Ta.a(Yd,Qe=>{zc.serverRequestTimeInMs=zc.commandParameters.stopwatch.Bc-
Rc;Qe=nb.a.Oe(Qe.data);hd(new ab.a(3,Qe))});const vd=this.$.pa.xa.Wb(),Zd=S.v(Xa,this.$),pe={};pe.SourceHtml=qa;pe.DestinationRanges=Zd?S.s(Zd):null;pe.CopyOperationId=xa;pe.PasteId=ob;e.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Dxa}. PasteId : ${pe.PasteId}`);return this.Dxa?kb(this.$.pa.ww,pe,yd,Yd,cc,null,vd,Zb):kb(this.$.pa.xa,pe,yd,Yd,cc,null,vd,Zb)},65),this.$.userOperationManager.Ic(id,Ib);else Mc("")})).then(()=>{Aa.a.zjf&&
qa.length>this.BQa&&(this.fOf(qa),this.AW=new Fc(Xa,qa,xa,ob,Ib,Zb,zc,0,this.xsc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.qHd()))})}fOf(Xa){const qa=this.$.Kb.Cc("Task","pasteHtmlChunkOperation"),xa=Math.floor(Xa.length/this.BQa)+1;this.xsc=Array(xa);let ob=0;for(;ob<xa;)this.xsc[ob]=Xa.substring(ob*this.BQa,(ob+1)*this.BQa),ob++;e.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${qa.Bc}`)}qHd(){this.s3i(this.AW.destinationRange,
this.xsc[this.AW.H4b],this.AW.Nsb,this.AW.t3i,this.AW.Wd,this.AW.vRb,this.AW.pasteContext,this.AW.H4b,this.AW.$fg);this.AW.H4b++;this.AW.H4b<this.AW.$fg&&window.requestIdleCallback(()=>this.qHd())}s3i(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd){const id=new vb.a(204,0,(yd,Yd,cc)=>{const Rc=zc.commandParameters.stopwatch.Bc;yd=Ta.b(yd,()=>{e.ULS.sendTraceTag(512313415,0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${zc.commandParameters.stopwatch.Bc-Rc},
             pasteid:${ob},
             chunkIndex:${Mc},
             totalChunks:${hd}`)});Yd=Ta.a(Yd,()=>{zc.serverRequestTimeInMs=zc.commandParameters.stopwatch.Bc-Rc;e.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${zc.serverRequestTimeInMs},
               pasteid:${ob},
               chunkIndex:${Mc},
               totalChunks:${hd}`)});const vd=this.$.pa.xa.Wb();var Zd=S.v(Xa,this.$);Zd={SourceHtml:qa,DestinationRanges:Zd?S.s(Zd):null,CopyOperationId:xa,PasteId:`${ob}_chunk_${Mc}`,ChunkIndex:Mc,TotalChunks:hd};e.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Dxa}. PasteId : ${Zd.PasteId}`);return kb(this.$.pa.ww,Zd,yd,Yd,cc,null,vd,Zb)},65);this.$.userOperationManager.Ic(id,Ib)}x8i(Xa,qa,xa,ob,Ib){return new Promise((Zb,zc)=>{e.ULS.sendTraceTag(537167754,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${Ib.id}`);qa&&(qa=ka.a.trimEnd(qa,"\n","\r"));e.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${Ib.id}`);if(qa)if(qa.length>this.LEb)e.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",qa.length,this.LEb),zc(new ab.a(1));
else{let hd,id;const yd=S.v(Xa,this.$);e.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${Ib.id}`);var Mc=!this.$.ea.isNamedObjectViewMode&&!qa.includes("\n")&&!qa.includes("\t");e.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${Ib.id}. treatAsLink=${Mc}`);Mc=Mc&&ka.a.Xkf(qa);e.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${Ib.id}. treatAsLink=${Mc}`);
const Yd=this.$.pa.xa.Wb();if(Mc){id=526;e.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${Ib.id}`);const cc=Fa.a.hed(qa);e.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${Ib.id}`);const Rc=S.s(yd);Mc=(vd,Zd,pe)=>{const Qe=Ib.commandParameters.stopwatch.Bc;vd=Ta.b(vd,bf=>{e.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${Ib.id}`);
Ib.requestTelemetryData=bf.RequestTelemetryData;Ib.serverRequestTimeInMs=Ib.commandParameters.stopwatch.Bc-Qe;bf.Errors&&0<bf.Errors.length?zc(new ab.a(2,bf.Errors)):Zb(qa)});Zd=Ta.a(Zd,bf=>{Ib.serverRequestTimeInMs=Ib.commandParameters.stopwatch.Bc-Qe;bf=nb.a.Oe(bf.data);zc(new ab.a(2,bf))});this.$.Py();e.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${Ib.id}`);return Ea.b(this.$.pa.xa,Rc,qa,cc,!1,!1,63,vd,Zd,pe,
Xa,Yd,ob)};hd=()=>new jb.a(Rc,qa,cc)}else id=180,Mc=(cc,Rc,vd)=>{this.$.Py();const Zd=Ib.commandParameters.stopwatch.Bc;cc=Ta.b(cc,pe=>{e.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${Ib.id}`);Qa.vfc(pe,Ib,Zb,zc,Zd,this.$,qa,!1,null,null)});Rc=Ta.a(Rc,pe=>{Ib.serverRequestTimeInMs=Ib.commandParameters.stopwatch.Bc-Zd;pe=nb.a.Oe(pe.data);zc(new ab.a(4,pe))});e.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${Ib.id}`);
return lb(this.$.pa.xa,yd,qa,cc,Rc,vd,null,Yd,ob)},hd=()=>new Jb(yd,qa);e.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserWebMethodOperation. pasteContext.Id=${Ib.id}`);Mc=new vb.a(id,0,Mc,65,hd);e.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${Ib.id}`);this.$.userOperationManager.Ic(Mc,xa)}else Zb("")})}xdf(Xa,qa){qa=[1===qa?4:5];this.gridView.qb.qx(db.a.Sea(La.d(this.$.na),
Xa),qa,!0);this.gridView.qb.Tn(qa);this.gridView.qb.update(!0)}dgc(){const Xa=[4,5];this.gridView.qb.Zg(Xa,!1,!1);this.gridView.qb.Ri(null,Xa,!1);1===this.gridView.ha.Ne&&this.gridView.Tn(!1,!1);this.gridView.qb.update(!1,!1)}y0g(Xa,qa,xa){const ob=[];for(const Ib of xa)ob.push(this.C0g(Xa,qa,Ib));return ob}KY(){if(this.Ov)for(let Xa of this.Ov)if(this.$&&this.$.userOperationManager){if(Xa.operation){const qa=Ma.a(Xa.operation.operationName);e.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${qa}.`)}this.B1g();
this.$.userOperationManager.oua(Xa)}}B1g(){if(this.wOa){const Xa=this.wOa.tt;e.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${Xa}`);nb.a.cu(Xa);!r.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.Clc&&Ea.h(this.$.pa.xa,this.Clc,null,null,null);this.Clc=this.wOa=null}}C0g(Xa,qa,xa){e.ULS.shipAssertTag(537167713,0,!!qa,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");e.ULS.shipAssertTag(537167712,0,0<qa.length,
"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let ob=0,Ib=0;var Zb=new Set;const zc=new Set;for(const Mc of qa){qa=`${Mc.left}_${Mc.right}`;const hd=`${Mc.top}_${Mc.bottom}`;zc.has(qa)||(zc.add(qa),Ib+=Mc.width);Zb.has(hd)||(Zb.add(hd),ob+=Mc.height)}if(36===Xa)return xa.isSingle?Qa.FXe(Ib,ob,xa):xa.clone();516===Xa&&(Xa=ob,ob=Ib,Ib=Xa);Xa=!(xa.width%Ib)&&!(xa.height%ob);Zb=xa.P_&&!(xa.height%ob);xa.V5&&!(xa.width%Ib)||Zb?xa=Qa.FXe(Ib,ob,xa):Xa?xa=xa.clone():
(xa=xa.clone(),xa.bottom=Math.min(v.a.gh,xa.top+ob-1),xa.right=Math.min(v.a.uh,xa.left+Ib-1));return xa}jTg(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd,id,yd){if(!ob||!ob.length)return 1;if(1<ob.length){if(!this.qic&&Zb)return 3;if(id)return 0;if(Mc)return 9;if(hd)return 8;if(yd)return 2;if(1<qa.length)return 4;const Yd=qa[0];if(!zc&&!w.a.all(ob,cc=>cc.isSingle||!(cc.width%Yd.width)&&!(cc.height%Yd.height)))return 5;if((!this.qic||!Zb)&&ka.a.equals(Xa,xa,!0))for(const cc of Ib)if(cc.Fd(Yd)&&!cc.equals(Yd))return 6}else if(qa&&
0<qa.length){if(0!==this.Eif(qa,hd))return 7;if(1<qa.length){if(!this.qic&&Zb)return 3;if((!this.qic||!Zb)&&ka.a.equals(Xa,xa,!0))for(const Yd of qa)if(Xa=Ib[0],Yd.Fd(Xa)&&!Yd.equals(Xa))return 6}}return 0}Eif(Xa,qa){if(!Xa||1>=Xa.length)return 0;if(qa)return 2;if(!S.S(Xa))return 1;qa=new xb.a(pa.a.ak());for(const xa of Xa)for(const ob of Xa){const Ib=xa.top===ob.top&&xa.bottom===ob.bottom,Zb=xa.left===ob.left&&xa.right===ob.right,zc=Math.max(xa.left,ob.left)<Math.min(xa.right,ob.right);if(Math.max(xa.top,
ob.top)<Math.min(xa.bottom,ob.bottom)&&!Ib||zc&&!Zb)return 3;qa.add(`${xa.top}-${xa.bottom}-${ob.left}-${ob.right}`);qa.add(`${ob.top}-${ob.bottom}-${xa.left}-${xa.right}`)}for(const xa of Xa)qa.remove(`${xa.top}-${xa.bottom}-${xa.left}-${xa.right}`);return 0<qa.count?3:0}pdj(Xa){const qa=this.gridView.ha;qa.updateSelection(Xa,Xa.topLeft,0);qa.selectionType=-1}byb(Xa){if(null===Xa||void 0===Xa?0:Xa.sourceItem){if(!C(Xa.sourceItem))return null;if((Xa=Xa.sourceItem)&&S.cb(Xa.ranges,!0))return Xa}return null}Xic(Xa,
qa){e.ULS.shipAssertTag(537167711,0,!!Xa,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return qa&&ya.a.vG in qa||Xa.tabName?!1:1===Xa.method}static quj(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd){const id=Xa.pa.xa.Wb(hd?{Fca:!0,Mba:1}:{Fca:!1,Mba:0});hd=new vb.a(506,0,(yd,Yd,cc)=>{Xa.Py();return Na(Xa.pa.xa,xa,ob,Ib,Ta.b(yd,Zb),Ta.a(Yd,zc),cc,null,id,Mc)},65,()=>new qb(xa,ob,Ib));Xa.userOperationManager.Ic(hd,qa)}static vfc(Xa,qa,xa,ob,Ib,Zb,zc=null,Mc,hd,id){e.ULS.sendTraceTag(537167710,
0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${qa.id}`);qa.requestTelemetryData=Xa.RequestTelemetryData;qa.serverRequestTimeInMs=qa.commandParameters.stopwatch.Bc-Ib;ua.a.dg(Xa.Errors)?ua.a.Dha(Xa.Errors)?(qa&&(qa.encounteredDeploymentErrors=!0),Xa=ua.a.sc(Xa.Errors),e.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Xa}`)):
(Xa=new ab.a(5,Xa.Errors),null===id||void 0===id?void 0:id(Xa),ob(Xa)):Xa.Result?(ob=!!Xa&&!!Xa.RequestTelemetryData,Y.h(Zb).Eh.gma(qa.commandParameters.stopwatch.id,Xa.StateId,ob?Xa.RequestTelemetryData.EcsOperationDuration:0,ob?Xa.RequestTelemetryData.EcsRequestDuration:0,ob?Xa.RequestTelemetryData.WfeRequestDuration:0),qa.pastedRange=Xa.Result.SheetMultiRange,e.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${qa.id}`),
null===hd||void 0===hd?void 0:hd(),xa(!0),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&Mc&&(qa=qa.commandParameters.isDragDrop?9:6,(Zb=Zb.da.Aa(465))&&Zb.x1(qa,Xa))):(e.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${qa.id}`),xa(zc||!0))}static ORd(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd,id,yd,Yd){const cc=Xa.pa.xa.Wb(),Rc=Qa.zfh(xa,
ob,Ib,id,yd,Yd);xa=new vb.a(503,0,(vd,Zd,pe)=>{Xa.Py();return sa(Xa.pa.xa,Rc,Ta.b(vd,zc),Ta.a(Zd,Mc),pe,Zb,cc,hd)},65,()=>new Yb(Rc));Xa.userOperationManager.Ic(xa,qa)}static zfh(Xa,qa,xa,ob,Ib,Zb){const zc={};zc.ShadowWorkbookBase64=Xa.shadowWorkbookBase64;zc.SourceRanges={};zc.SourceRanges.Ranges=Array(1);zc.SourceRanges.Ranges[0]={};zc.SourceRanges.Ranges[0].FirstRow=Xa.rangeRowStart;zc.SourceRanges.Ranges[0].LastRow=Xa.rangeRowEnd;zc.SourceRanges.Ranges[0].FirstColumn=Xa.rangeColumnStart;zc.SourceRanges.Ranges[0].LastColumn=
Xa.rangeColumnEnd;r.EwaSettings.getBooleanFeatureGate(Aa.a.l7b,!1)?xa?zc.DestinationRanges=S.u(xa.SheetName,xa.NamedObjectName,S.g(xa.Ranges)):(e.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),zc.DestinationRanges=null):zc.DestinationRanges=qa?S.s(qa):null;zc.CopyPasteTargetType=1;zc.PasteType=ob;zc.CopyOperationId=Ib;zc.PasteId=Zb;zc.SourceClientPath=Xa.sourceClientPath;zc.SourceSheetName=Xa.sourceSheetName;zc.SourceWorkbookName=Xa.sourceWorkbookName;
if(!Xa.originalSourceRangesCountExceedsLimit&&Xa.originalSourceRanges&&0<Xa.originalSourceRanges.length&&1024===ob){zc.OriginalSourceMultiRange={};qa=Array(Xa.originalSourceRanges.length);for(xa=0;xa<qa.length;++xa)qa[xa]={},qa[xa].FirstRow=Xa.originalSourceRanges[xa][0],qa[xa].FirstColumn=Xa.originalSourceRanges[xa][1],qa[xa].LastRow=Xa.originalSourceRanges[xa][2],qa[xa].LastColumn=Xa.originalSourceRanges[xa][3];zc.OriginalSourceMultiRange.Ranges=qa}return zc}static FXe(Xa,qa,xa){xa=xa.clone();xa.height<
qa&&(xa.bottom=Math.min(v.a.gh,xa.top+qa-1));xa.width<Xa&&(xa.right=Math.min(v.a.uh,xa.left+Xa-1));return xa}executeInsertCopiedCutCellsOperation(Xa,qa,xa,ob,Ib,Zb=null,zc=null){const Mc={};Mc.InsertDirection=ob;Mc.SourceRange=Xa;Mc.DestRange=qa;Mc.CopyCutOperation=xa?0:1;const hd=this.$.pa.xa,id=this.$.pa.xa.Wb(),yd=()=>new wb(Mc);return fc.a(this.$.userOperationManager,(Yd,cc,Rc)=>this.Dpi?va(hd,Mc,Zb?Ta.b(Yd,Zb):Yd,zc?Ta.a(cc,zc):cc,Rc,id):V(hd,Mc,Zb?Ta.b(Yd,Zb):Yd,zc?Ta.a(cc,zc):cc,Rc,null),Yd=>
new vb.a(104,0,Yd,void 0,yd),Ib,r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MoveTaskCompletionToQueueItemLevelByOptingIn",!1))}$Oe(Xa,qa,xa,ob,Ib,Zb,zc,Mc){return new Promise((hd,id)=>{this.executeInsertCopiedCutCellsOperation(qa,xa,ob,Ib,Zb,yd=>{Xa.requestTelemetryData=yd.RequestTelemetryData;if(yd.Errors&&0<yd.Errors.length){const Yd=new ab.a(21,yd.Errors);null===Mc||void 0===Mc?void 0:Mc(Yd);id(new ab.a(21,yd.Errors))}else null===zc||void 0===zc?void 0:zc(),hd(!0)},yd=>{yd=nb.a.Oe(yd.data);
yd=new ab.a(21,yd);null===Mc||void 0===Mc?void 0:Mc(yd);id(yd)})})}}Object(c.a)(Qa,"CopyPasteUtils",null,[847]);var la=a(496),hb;(function(Xa){Xa[Xa.range=0]="range";Xa[Xa.art=1]="art"})(hb||(hb={}));Object(c.b)("SourceItemType",hb);var Kb=a(24),dc=a(92);class sb{constructor(Xa){this.Ncg={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.POb={};this.Jcg={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,
["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.n_c={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",
["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};this.Mcg={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.TPd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.Lcg={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};
this.Wka={};this.Kcg={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.B4a={};this.Ocg={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,
["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Wr={};this.$=Xa;this.Wka.notDefined="InputManager.InputMethod.NotDefined";this.Wka.unknown="InputManager.InputMethod.Unknown";this.Wka.keyboard="InputManager.InputMethod.Keyboard";this.Wka.mouse="InputManager.InputMethod.Mouse";
this.Wka.touch="InputManager.InputMethod.Touch";this.Wka.crossSlide="InputManager.InputMethod.CrossSlide";this.B4a.none="FrameMode.None";this.B4a.reading="FrameMode.Reading";this.B4a.edit="FrameMode.Edit";this.Wr.unknown="UILocation.Unknown";this.Wr.upperRibbon="UILocation.UpperRibbon";this.Wr.ribbon="UILocation.Ribbon";this.Wr.QAT="UILocation.QAT";this.Wr.jewel="UILocation.Jewel";this.Wr.navigationPane="UILocation.NavigationPane";this.Wr.keyboardShortcut="UILocation.KeyboardShortcut";this.Wr.statusBar=
"UILocation.StatusBar";this.Wr.dialog="UILocation.Dialog";this.Wr.floatie="UILocation.Floatie";this.Wr.notificationBar="UILocation.NotificationBar";this.Wr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Wr.taskPane="UILocation.TaskPane";this.Wr.heroDock="UILocation.HeroDock";this.Wr.singleLineRibbon="UILocation.SingleLineRibbon";this.Wr.multilineRibbon="UILocation.MultilineRibbon";this.Wr.overflow="UILocation.Overflow";this.Wr.tellMe="UILocation.TellMe";this.Wr.farPeripheralControls="UILocation.FarPeripheralControls";
this.Wr.header="UILocation.Header";this.Wr.fileMenu="UILocation.FileMenu";this.Wr.contextMenu="UILocation.ContextMenu";this.Wr.dialogMenu="UILocation.DialogMenu";this.Wr.toolbar="UILocation.Toolbar";this.Wr.canvas="UILocation.Canvas";this.POb.range="SourceItemType.Range";this.POb.art="SourceItemType.Art"}serializeSourceItem(Xa){const qa={};if(Xa&&Object.getType(Xa)===H)qa.sheetName=Xa.sheetName,qa.topArray=w.a.map(Xa.ranges,xa=>xa.top),qa.leftArray=w.a.map(Xa.ranges,xa=>xa.left),qa.bottomArray=w.a.map(Xa.ranges,
xa=>xa.bottom),qa.rightArray=w.a.map(Xa.ranges,xa=>xa.right),qa.sessionStateId=Xa.sessionStateId,qa.sessionId=Xa.sessionId,qa.sourceItemType=this.C3f(0);else if(Xa&&Object.getType(Xa)===M)qa.activeFloatingObjectControlId=Xa.activeFloatingObjectControlId,qa.sheetName=Xa.sheetName,qa.sessionStateId=Xa.sessionStateId,qa.sessionId=Xa.sessionId,qa.floatingObjectType=this.Suj(Xa.type),qa.sourceItemType=this.C3f(1);else return e.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),
null;return JSON.stringify(qa)}serializeCommandParameters(Xa){if(!Xa)return e.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const qa={};qa.id=Xa.id;qa.commandType=Xa.commandType;qa.copyPasteTargetType=Xa.copyPasteTargetType;Xa.ribbonCommandInfo&&(qa.ribbonCommandName=this.avj(Xa.ribbonCommandInfo.command),qa.inputMethodName=this.Vuj(Xa.ribbonCommandInfo.method),qa.frameModeName=this.Tuj(Xa.ribbonCommandInfo.mode),qa.uiLocationName=
this.evj(Xa.ribbonCommandInfo.We),qa.tabName=Xa.ribbonCommandInfo.tabName);return JSON.stringify(qa)}deserializeSourceItem(Xa){if(!Xa)return null;try{const qa=JSON.parse(Xa);if(!qa)return e.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let xa=null;switch(this.Xlh(qa.sourceItemType)){case 0:xa=new H(this.$,this.Ulh(qa),qa.sheetName,qa.sessionStateId,qa.sessionId);break;case 1:xa=new M(qa.activeFloatingObjectControlId,qa.sheetName,
qa.sessionStateId,qa.sessionId,this.Rlh(qa.floatingObjectType))}return xa}catch(qa){return e.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${Xa?Xa.length:0}, errror: ${qa}`),null}}deserializeCommandParameters(Xa){if(!Xa)return null;try{const qa=JSON.parse(Xa);if(!qa)return e.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;
const xa=ia.a();xa.id=qa.id;xa.ribbonCommandInfo=this.Wlh(qa);xa.commandType=qa.commandType;xa.copyPasteTargetType=qa.copyPasteTargetType;return xa}catch(qa){return e.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${Xa?Xa.length:0}, errror: ${qa}`),null}}Ulh(Xa){const qa=[];e.ULS.shipAssertTag(537167699,0,!!Xa.topArray&&0<Xa.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${Xa.topArray?
"empty":"null"}.`);e.ULS.shipAssertTag(537167698,0,!!Xa.leftArray&&0<Xa.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${Xa.leftArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167697,0,!!Xa.bottomArray&&0<Xa.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${Xa.bottomArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167696,0,!!Xa.rightArray&&0<Xa.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${Xa.rightArray?
"empty":"null"}.`);if(!(Xa.topArray&&Xa.leftArray&&Xa.bottomArray&&Xa.rightArray))return qa;e.ULS.shipAssertTag(537167695,0,Xa.topArray.length===Xa.bottomArray.length&&Xa.topArray.length===Xa.leftArray.length&&Xa.topArray.length===Xa.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${Xa.topArray.length}), BottomArray(${Xa.bottomArray.length}), LeftArray(${Xa.leftArray.length}), RightArray(${Xa.rightArray.length}) should be the same.`);const xa=Math.min(Xa.topArray.length,
Xa.bottomArray.length,Xa.leftArray.length,Xa.rightArray.length);for(let ob=0;ob<xa;ob++)qa.push(new Kb.Range(Xa.topArray[ob],Xa.leftArray[ob],Xa.bottomArray[ob],Xa.rightArray[ob],!1,!1));return qa}Wlh(Xa){return new dc.a(this.Vlh(Xa.ribbonCommandName),this.Tlh(Xa.inputMethodName),this.Slh(Xa.frameModeName),this.Zlh(Xa.uiLocationName),Xa.tabName)}avj(Xa){return void 0!==Xa&&null!==Xa&&Xa.toString()in this.TPd?this.TPd[Xa.toString()]:(e.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Xa}`),
this.TPd["-911352779"])}Vlh(Xa){return Xa&&Xa in this.Mcg?this.Mcg[Xa]:(e.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Xa}`),-911352779)}Vuj(Xa){return void 0!==Xa&&null!==Xa&&m.a[Xa]in this.Wka?this.Wka[m.a[Xa]]:(e.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${Xa}`),this.Wka.unknown)}Tlh(Xa){return Xa&&
Xa in this.Lcg?this.Lcg[Xa]:(e.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${Xa}`),0)}Tuj(Xa){return void 0!==Xa&&null!==Xa&&la.a[Xa]in this.B4a?this.B4a[la.a[Xa]]:(e.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${Xa}`),this.B4a.edit)}Slh(Xa){return Xa&&Xa in this.Kcg?this.Kcg[Xa]:(e.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${Xa}`),
2)}C3f(Xa){return void 0!==Xa&&null!==Xa&&hb[Xa]in this.POb?this.POb[hb[Xa]]:(e.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${Xa}`),this.POb.range)}Xlh(Xa){return Xa&&Xa in this.Ncg?this.Ncg[Xa]:(e.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${Xa}`),0)}Suj(Xa){return void 0!==Xa&&null!==Xa&&Xa.toString()in this.n_c?this.n_c[Xa.toString()]:(e.ULS.shipAssertTag(537167686,
0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${Xa}`),this.n_c["99"])}Rlh(Xa){return Xa&&Xa in this.Jcg?this.Jcg[Xa]:(e.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${Xa}`),99)}evj(Xa){return void 0!==Xa&&null!==Xa&&n.a[Xa]in this.Wr?this.Wr[n.a[Xa]]:(e.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${Xa}`),this.Wr.ribbon)}Zlh(Xa){return Xa&&
Xa in this.Ocg?this.Ocg[Xa]:(e.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${Xa}`),2)}}Object(c.a)(sb,"EnvironmentSerializationHelper",null,[]);class bb{}bb.T0f="SameSession";bb.PKe="CrossSession";bb.Xqf="LegacyCrossSession";bb.external="External";Object(c.a)(bb,"PayloadOrigin",null,[]);const Ob=Xa=>Xa?Xa.shadowWorkbookSizeExceedsLimit&&void 0!==Xa.shadowWorkbookBlockedSize&&null!==Xa.shadowWorkbookBlockedSize?Xa.shadowWorkbookBlockedSize:
Xa.shadowWorkbookBase64?Xa.shadowWorkbookBase64.length:0:0,gc=Xa=>Xa.shadowWorkbookSizeExceedsLimit?!0:Ob(Xa)>v.a.Fnc;class mb{constructor(Xa,qa){this._name=qa;this.$=Xa;this.im=z.a.instance;this.fq=new Qa(Xa,Y.h(Xa))}get name(){return this._name}get q_c(){return this.im.Ua(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}mVj(Xa){let qa;qa=null;try{const xa=Xa.getItem(J.shadowWorkbook);if(!xa)return{returnValue:!1,f1:qa};qa=JSON.parse(xa);
return{returnValue:this.zvi(qa),f1:qa}}catch(xa){return e.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+xa),{returnValue:!1,f1:qa}}}zvi(Xa){return!!Xa&&(!!Xa.shadowWorkbookBase64||Xa.shadowWorkbookSizeExceedsLimit)&&void 0!==Xa.rangeRowStart&&void 0!==Xa.rangeRowEnd&&void 0!==Xa.rangeColumnStart&&void 0!==Xa.rangeColumnEnd}vsc(Xa){Xa.wasLastCopyExternal=!0;if(r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.Hz&&516!==Xa.commandParameters.commandType&&1028!==Xa.commandParameters.commandType){var qa=null;if(({f1:qa}=this.mVj(Xa.clipboardItems)).returnValue)return Xa.isShadowWorkbookParsedSuccessfully=!0,this.r3i(Xa,qa)}if(516!==Xa.commandParameters.commandType&&36!==Xa.commandParameters.commandType){if(r.EwaSettings.oa(158)&&20!==Xa.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.uic)&&(qa=Xa.clipboardItems.getItem(J.html),void 0!==qa&&null!==qa&&qa&&
qa.trim()!==this.q_c&&(qa.startsWith("<")||h.a.Jf&&qa.startsWith("\n<")))){const xa=Xa.clipboardItems.getItem(J.Nsb);return this.p3i(Xa,qa,void 0===xa?null:xa)}return this.XMf(Xa)}return Promise.reject(new ab.a(6))}r3i(Xa,qa){e.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");Xa.pasteResult="SystemClipboardShadowWorkbookPaste";Xa.payloadType=Q.shadowWorkbook;Xa.payloadOrigin=bb.external;Xa.shadowWorkbookPayloadSize=
Ob(qa);Xa.shadowWorkbookSizeExceedsLimit=gc(qa);let xa=null,ob=null;const Ib=Xa.commandParameters.originalDestinations;r.EwaSettings.getBooleanFeatureGate(Aa.a.l7b,!1)?xa=S.r(Ib,this.$):ob=S.v(S.K(Ib),this.$);qa.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Xa.originalSourceRangesCountExceedsLimit=qa.originalSourceRangesCountExceedsLimit);if(Xa.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${Xa.shadowWorkbookPayloadSize}) is over the limit(${v.a.Fnc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${qa.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new ab.a(1));e.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${Xa.commandParameters.id}`);return this.fq.aNf(Xa.commandParameters.ribbonCommandInfo,ob,xa,qa,[Xa.commandParameters.stopwatch],Xa)}XMf(Xa){var qa=Xa.clipboardItems.getItem(J.plainText);if(void 0!==qa&&null!==qa&&qa.trim()===this.q_c)return Promise.reject(new ab.a(7));void 0!==qa&&null!==qa&&(Xa.plainTextPayloadSize=qa.length);Xa.isPlainTextPaste=
!0;Xa.pasteResult="SystemClipboardPaste";Xa.payloadOrigin=aa(Xa)?bb.Xqf:bb.external;Xa.payloadType=Q.plainText;e.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${Xa.id}, PasteOperationId=${Xa.commandParameters.id}`);qa=this.fq.x8i(S.K(Xa.commandParameters.originalDestinations),qa,Xa.commandParameters.ribbonCommandInfo,[Xa.commandParameters.stopwatch],Xa);e.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${Xa.id}`);
return qa}p3i(Xa,qa,xa){Xa.htmlPayloadSize=qa.length;Xa.isHtmlPaste=!0;Xa.pasteResult="SystemClipboardHtmlPaste";Xa.payloadType=Q.html;Xa.payloadOrigin=aa(Xa)?bb.Xqf:bb.external;e.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${Xa.commandParameters.id}`);return this.fq.w8i(S.K(Xa.commandParameters.originalDestinations),qa,xa,Xa.commandParameters.id,Xa.commandParameters.ribbonCommandInfo,[Xa.commandParameters.stopwatch],Xa)}mKe(Xa){const qa=
{};Xa&&(qa.shadowWorkbookBase64=Xa.ShadowWorkbookBase64,qa.shadowWorkbookSizeExceedsLimit=Xa.ShadowWorkbookSizeExceedsLimit,qa.originalSourceRangesCountExceedsLimit=Xa.OriginalSourceRangesCountExceedsLimit,qa.originalSourceRangesCount=Xa.OriginalSourceRangesCount,qa.shadowWorkbookBlockedSize=Xa.ShadowWorkbookBlockedSize);return qa}pmg(Xa,qa){const xa=L(Xa),ob=32===(Xa.commandParameters.commandType&32),Ib=1024===(Xa.commandParameters.commandType&1024);let Zb=!1,zc=null,Mc=null,hd=!1;if(!xa){Zb=-1985798686===
Xa.commandParameters.ribbonCommandInfo.command;var id=Xa.copyContextSnapshot;if(qa)hd=!id.sourceItem.isFromCurrentSession(this.$);else if(id=this.fq.byb(id))zc=id.ranges,Mc=id.sheetName,hd=!Xa.isSameSession}return this.fq.jTg(Mc,zc,this.$.na.sheetName,Xa.commandParameters.originalDestinations,Xa.commandParameters.expandDestinations,hd,ob,Ib,Zb,qa,xa)}}Object(c.a)(mb,"BaseCopyPasteHandler",null,[899,900,901]);class Nb{constructor(Xa){this.clipboardItems=this.key=null;this.T$=Xa}twa(Xa){return this.key&&
this.key.isEqual(Xa)?this.createClipboardItems(this.clipboardItems):null}setValue(Xa,qa){this.key=Xa;this.clipboardItems=this.createClipboardItems(qa)}createClipboardItems(Xa){const qa=this.T$.create();var xa=Xa.getItem(J.plainText);xa&&qa.setItem(J.plainText,xa);(xa=Xa.getItem(J.shadowWorkbook))&&qa.setItem(J.shadowWorkbook,xa);(Xa=Xa.getItem(J.html))&&qa.setItem(J.html,Xa);return qa}}Object(c.a)(Nb,"CopyCache",null,[]);var ic=a(64);class gb extends mb{constructor(Xa,qa,xa,ob,Ib=null){super(Xa,ob);
this.Bah=qa;this.T$=xa;this.d6c=Ib||new Nb(this.T$);this.gridView=Y.h(Xa);this.ha=this.gridView.ha;this.clipboardRangeFactory=Xa.da.Aa(169)}getSourceItem(){const Xa=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?S.d(this.gridView.ha.ra.selectedRanges):w.a.clone(this.gridView.ha.ra.selectedRanges);return new H(this.$,Xa,this.$.ea.na.sheetName,this.$.ea.ye,this.$.ya.UserSessionId)}beforeSerialize(Xa){Xa.isSelectionAllowed=!1;Xa.isAsyncCopy=!1;Xa.isFromCache=!1;Xa.encounteredDeploymentErrors=
!1;Xa.plainTextPayloadSize=0;Xa.shadowWorkbookPayloadSize=0;Xa.htmlPayloadSize=0;Xa.clientSideCopyTime=0;const qa=new ha.a(this.$.va),xa=Xa.sourceItem;Xa.isSelectionAllowed=w.a.all(xa.ranges,ob=>this.isSelectionAllowed(qa,ob));Xa.isSelectionAllowed&&this.fq.xdf(xa.ranges,Xa.commandParameters.commandType)}RNa(Xa){return this.gridView.Da.r5()&&Y.j(this.gridView,Xa)}P3i(Xa,qa,xa,ob){let Ib=!1,Zb=1===qa.commandParameters.commandType,zc=ob[0].TC;1===xa.ranges.length&&1===ob.length?r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&
Zb&&1!==zc&&zc!==xa.ranges[0].TC?Xa.cseStatus=17:Ib=this.Bah.a$c(Xa,S.K(xa.ranges),xa.sheetName,S.K(Xa.commandParameters.expandDestinations),this.$.ea.na.sheetName,Zb):Xa.cseStatus=5;Ib&&Y.h(this.$).Eh.HS(Xa.commandParameters.stopwatch.id,ic.BasicTelemetryCalculator.jR);return this.y3i(Xa,xa,S.u(this.$.na.sheetName,null,ob),qa.commandParameters.commandType,Ib)}isSelectionAllowed(Xa,qa){return Xa.mCb(qa,this.gridView)}y3i(Xa,qa,xa,ob,Ib){qa=S.u(qa.sheetName,null,qa.ranges);Xa.pasteResult="SameSessionPaste";
Xa.payloadOrigin=bb.T0f;Xa.payloadType=Q.GHg;e.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${Xa.commandParameters.id}`);return this.fq.pasteRange(Xa.commandParameters.ribbonCommandInfo,qa,xa,ob,Xa.commandParameters.commandType,[Xa.commandParameters.stopwatch],Xa,Ib,null,null)}}Object(c.a)(gb,"BaseRangeCopyPasteHandler",mb,[]);var Eb=a(35);class Lc{constructor(Xa){this.OU=new Eb.a(!0);this.$=Xa}onDeferredPasteStarted(Xa){this.OU.kb(Xa.id)||
this.OU.add(Xa.id,!0);if(0<this.OU.count){const qa=Z.GetServiceTaskFactory.Na(this.$.da,5,4,0);Wa.TaskExtensions.za(qa,()=>{qa.result.mh(28,null)},this.$.ka,3)}}onDeferredPasteCompleted(Xa){const qa=0<this.OU.count;this.OU.kb(Xa.id)&&this.OU.remove(Xa.id);if(qa&&!this.OU.count){const xa=Z.GetServiceTaskFactory.Na(this.$.da,5,4,0);Wa.TaskExtensions.za(xa,()=>{xa.result.removeEntry(28)},this.$.ka,3)}}}Object(c.a)(Lc,"DeferredPasteTracker",null,[]);var Ec;(function(Xa){Xa[Xa.none=0]="none";Xa[Xa.loadClipboardFromServerFailed=
1]="loadClipboardFromServerFailed";Xa[Xa.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";Xa[Xa.asyncCopyCanceled=3]="asyncCopyCanceled";Xa[Xa.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(Ec||(Ec={}));Object(c.b)("CopyErrorType",Ec);var Cb=a(927),eb=a(1115);class Sb extends Cb.a{constructor(Xa,qa=null){super(Ec[Xa]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=Xa;this.ewaErrors=qa;if(null===qa||void 0===qa?0:qa.length)this.innerError=
new eb.a(qa,null)}}Object(c.a)(Sb,"CopyInnerError",Cb.a,[]);class ld extends gb{constructor(Xa,qa,xa,ob=null){super(Xa,qa,xa,"AcrossSessionRangeCopyPasteHandler",ob);this.OU=new Lc(Xa)}serialize(Xa){const qa=Xa.sourceItem,xa={};let ob=this.d6c.twa(qa);if(ob)xa.synchronousResult=ob,Xa.isFromCache=!0,Xa.clientSideCopyTime=Xa.commandParameters.stopwatch.Bc;else{let Zb=null;var Ib=S.F(qa.ranges);if(!Da.a.skf()&&this.RNa(Ib)){e.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");
Ib=this.clipboardRangeFactory.create(Ib);try{Zb=Ib.toString(),ob=this.T$.create(),ob.setItem(J.plainText,Zb),this.d6c.setValue(qa,ob),xa.synchronousResult=ob,Xa.clientSideCopyTime=Xa.commandParameters.stopwatch.Bc}finally{Ib&&Ib.dispose()}}else Xa.isAsyncCopy=!0,xa.synchronousResult=this.T$.create(),xa.synchronousResult.setItem(J.plainText,this.q_c);xa.asynchronousResult=this.Tgd(Xa,qa,Zb)}Xa.syncClipboardItemsKeys=Ga(xa.synchronousResult);return xa}shouldWaitForCopyToComplete(Xa){if(!Xa||!Xa.copyContextSnapshot)return e.ULS.sendTraceTag(537167907,
0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;e.ULS.shipAssertTag(537167906,0,!!this.$.ya,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if(Xa.copyContextSnapshot.sessionId===this.$.ya.UserSessionId)return e.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),
!1;e.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Xa){this.OU.onDeferredPasteStarted(Xa)}onDeferredPasteCompleted(Xa){this.OU.onDeferredPasteCompleted(Xa)}deserialize(Xa){Xa.isClipboardDataContainShadowWorkbook=!(void 0===Xa.clipboardItems.getItem(J.shadowWorkbook)||null===Xa.clipboardItems.getItem(J.shadowWorkbook));if(Y.h(this.$).ha.Ne&326)return L(Xa)&&(Xa.wasLastCopyExternal=!0),Promise.reject(new ab.a(17));
var qa=this.pmg(Xa,!1);if(0!==qa)return Promise.reject(new ab.a(L(Xa)?18:Xa.isSameSession?19:20,void 0,void 0,void 0,qa));var xa=Xa.copyContextSnapshot,ob=this.fq.byb(xa);if(L(Xa))return this.vsc(Xa);qa=Xa.commandParameters.originalDestinations;if(ob&&Xa.isSameSession)return this.P3i(Xa,xa,ob,qa);if(516!==Xa.commandParameters.commandType){if(({f1:xa}=this.lVj(Xa.clipboardItems)).returnValue){Xa.isShadowWorkbookParsedSuccessfully=!0;let Ib=ob=null;r.EwaSettings.getBooleanFeatureGate(Aa.a.l7b,!1)?ob=
S.r(qa,this.$):Ib=S.v(S.K(qa),this.$);return this.n3i(Xa,Ib,ob,xa)}if(Xa.isClipboardInaccessible)return Promise.reject(new ab.a(8));if(36!==Xa.commandParameters.commandType)return this.XMf(Xa)}return Promise.reject(new ab.a(6))}beforePaste(Xa){this.$.da.Aa(373).Xrj(Xa);Xa.indicationDisplayScheduled=!0}EUj(Xa){let qa;if(!(Xa&&Xa.SourceRanges&&Xa.SourceRanges.Ranges&&Xa.SourceRanges.Ranges.length&&(Xa.OriginalSourceRangesCountExceedsLimit||Xa.OriginalSourceMultiRange&&Xa.OriginalSourceMultiRange.Ranges&&
Xa.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,f1:null};var xa=Xa.SourceRanges.Ranges[0];if(!Xa.ShadowWorkbookBase64&&!Xa.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,f1:null};qa=this.mKe(Xa);qa.rangeRowStart=xa.FirstRow;qa.rangeRowEnd=xa.LastRow;qa.rangeColumnStart=xa.FirstColumn;qa.rangeColumnEnd=xa.LastColumn;qa.sourceClientPath=Xa.SourceClientPath;qa.sourceSheetName=Xa.SourceSheetName;qa.sourceWorkbookName=Xa.SourceWorkbookName;if(!Xa.OriginalSourceRangesCountExceedsLimit)for(Xa=
Xa.OriginalSourceMultiRange.Ranges,qa.originalSourceRanges=Array(Xa.length),xa=0;xa<Xa.length;++xa)qa.originalSourceRanges[xa]=[Xa[xa].FirstRow,Xa[xa].FirstColumn,Xa[xa].LastRow,Xa[xa].LastColumn];return{returnValue:!0,f1:qa}}lVj(Xa){let qa;qa=null;Xa=Xa.getItem(J.shadowWorkbook);if(!Xa)return{returnValue:!1,f1:qa};qa=JSON.parse(Xa);return{returnValue:this.yvi(qa),f1:qa}}yvi(Xa){return!!Xa&&(!!Xa.shadowWorkbookBase64||Xa.shadowWorkbookSizeExceedsLimit)&&void 0!==Xa.rangeRowStart&&void 0!==Xa.rangeRowEnd&&
void 0!==Xa.rangeColumnStart&&void 0!==Xa.rangeColumnEnd}n3i(Xa,qa,xa,ob){e.ULS.shipAssertTag(537167903,0,!!ob,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");x.AFrameworkApplication.ZN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");Xa.pasteResult="CrossSessionPaste";Xa.payloadOrigin=bb.PKe;Xa.payloadType=Q.shadowWorkbook;Xa.shadowWorkbookPayloadSize=Ob(ob);Xa.shadowWorkbookSizeExceedsLimit=gc(ob);ob.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
(Xa.originalSourceRangesCountExceedsLimit=ob.originalSourceRangesCountExceedsLimit);if(Xa.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${Xa.shadowWorkbookPayloadSize}) is over the limit(${v.a.Fnc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${ob.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new ab.a(1));if(1028===Xa.commandParameters.commandType&&Xa.originalSourceRangesCountExceedsLimit)return e.ULS.sendTraceTag(572617859,
0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${ob.originalSourceRangesCount}) is over the limit(${v.a.iGi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${ob.originalSourceRangesCountExceedsLimit}`),Promise.reject(new ab.a(1));e.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${Xa.commandParameters.id}`);return this.fq.aNf(Xa.commandParameters.ribbonCommandInfo,
qa,xa,ob,[Xa.commandParameters.stopwatch],Xa)}Tgd(Xa,qa,xa){e.ULS.shipAssertTag(537167901,0,!!Xa,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const ob=Xa.commandParameters.stopwatch.Bc;return new Promise((Ib,Zb)=>{e.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${Xa.id}`);const zc=S.u(qa.sheetName,null,qa.ranges);this.fq.copy(zc,Xa.commandParameters,
Mc=>{Xa.requestTelemetryData=Mc.RequestTelemetryData;Xa.serverRequestTimeInMs=Xa.commandParameters.stopwatch.Bc-ob;if(ua.a.dg(Mc.Errors))if(ua.a.Dha(Mc.Errors))Xa.encounteredDeploymentErrors=!0,Mc=ua.a.sc(Mc.Errors),e.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Mc}. copy Id: ${Xa.id}`);else{var hd=ua.a.sc(Mc.Errors);e.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${hd}. copy Id: ${Xa.id}`);
Zb(new Sb(2,Mc.Errors))}else if(e.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${Xa.id}`),Xa.markForCancellation)Zb(new Sb(3,Mc.Errors));else{hd=Mc.Result;var id=hd.PlainTextResult;void 0!==xa&&null!==xa&&(id=xa);void 0!==id&&null!==id&&(Xa.plainTextPayloadSize=id.length);var yd=this.T$.create();if(({f1:Yd}=this.EUj(hd)).returnValue){Xa.shadowWorkbookPayloadSize=Ob(Yd);Xa.shadowWorkbookSizeExceedsLimit=gc(Yd);
Xa.originalSourceRangesCountExceedsLimit=hd.OriginalSourceRangesCountExceedsLimit;var Yd=JSON.stringify(Yd);yd.setItem(J.shadowWorkbook,Yd)}yd.setItem(J.plainText,id);Da.a.skf()&&(id=hd.HtmlResult,Xa.htmlSizeExceedsLimit=hd.HtmlSizeExceedsLimit,void 0!==id&&null!==id&&(Xa.htmlPayloadSize=id.length),yd.setItem(J.html,id));Xa.copyTotalSizeExceedsLimit=hd.CopyTotalSizeExceedsLimit;yd.setItem(J.Nsb,Xa.commandParameters.id);this.d6c.setValue(qa,yd);Xa.asyncClipboardItemsKeys=Ga(yd);Ib(yd);r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",
!1)&&(hd=1===Xa.commandParameters.commandType?8:7,(yd=this.$.da.Aa(465))&&yd.x1(hd,Mc))}},Mc=>{Xa.serverRequestTimeInMs=Xa.commandParameters.stopwatch.Bc-ob;Mc=nb.a.Oe(Mc.data);const hd=ua.a.sc(Mc);e.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${hd}. copy Id: ${Xa.id}`);Zb(new Sb(2,Mc))},[Xa.commandParameters.stopwatch])})}}Object(c.a)(ld,"AcrossSessionRangeCopyPasteHandler",gb,[]);class bd{constructor(Xa,qa,
xa,ob,Ib,Zb=null,zc=null){this.floatingObjectId=Xa;this.commandParameters=qa;this.Zt=xa;this.Zih=ob;this.Naa=Zb;this.vRb=zc;this.rah=Ib}}Object(c.a)(bd,"CopyArtRequest",null,[]);class ec{constructor(Xa,qa,xa,ob,Ib,Zb,zc,Mc,hd){this.promise=null;this.ribbonCommandInfo=Xa;this.destination=qa;this.JMe=xa;this.vRb=Ib;this.f1=Zb;this.item=zc;this.pasteContext=Mc;this.ZOa=xa||qa.FirstRow+"_"+qa.FirstColumn;this.Nkf=!0;this.xEe=hd}}Object(c.a)(ec,"PasteArtRequest",null,[]);class sc{constructor(Xa,qa){this.iLb=
new Ka.a;this.S_a=Xa;this.$=qa;this.Z8i=xa=>Promise.resolve(xa);this.$Gb=xa=>Promise.reject(xa)}l$h(Xa){if(this.jri(Xa.ZOa)){e.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${Xa.ZOa}`);const qa=this.iLb.ma(Xa.ZOa);this.iLb.ia(Xa.ZOa,Xa);const xa=qa.promise;qa.Nkf=!1;return this.Lsh(Xa,xa)}this.iLb.ia(Xa.ZOa,Xa);return this.vyi(Xa)}jri(Xa){return this.iLb.kb(Xa)}vyi(Xa){return new Promise((qa,xa)=>{Xa.promise=
this.S_a.WMf(Xa).then(ob=>{qa(null);return this.Sqc(Xa,ob)},ob=>{xa(null);return this.$Gb(ob)})})}Lsh(Xa,qa){return new Promise((xa,ob)=>{Xa.promise=qa.then(Ib=>{this.C_j(Xa,Ib);return this.S_a.WMf(Xa).then(Zb=>{xa(null);return this.Sqc(Xa,Zb)},Zb=>{ob(null);return this.$Gb(Zb)})},Ib=>this.$Gb(Ib))})}Sqc(Xa,qa){Xa.Nkf&&(this.Y4g(Xa.ZOa),this.qRd(Xa,qa));return this.Z8i(qa)}Y4g(Xa){this.iLb.remove(Xa)}qRd(Xa,qa){const xa=this.v2h();Xa.ZOa===xa&&this.S_a.qRd(Xa.destination,qa,Xa.item.type)}v2h(){var Xa=
Y.h(this.$).ha.Ta.activeFloatingObjectControlId;Xa||(Xa=S.v(Y.h(this.$).ha.ra.activeCell,this.$),Xa=Xa.FirstRow+"_"+Xa.FirstColumn);return Xa}C_j(Xa,qa){Xa.destination=null;Xa.JMe=qa}}Object(c.a)(sc,"PasteArtRequestManager",null,[]);var Dc=a(200),Ud=a(122),Ed=a(104);class $d extends mb{constructor(Xa,qa,xa,ob,Ib=null){super(Xa,"ArtCopyPasteHandler");this.T5g="XLO";this.U5g="3";this.OU=new Lc(Xa);this.T$=qa;this.S_a=xa;this.ha=Y.h(Xa).ha;this.c6c=Ib||new Nb(this.T$);this.o3i=new sc(xa,Xa);this.$pb=
ob}getSourceItem(){e.ULS.shipAssertTag(537167896,0,!!this.ha.Ta.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");e.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Ta.activeFloatingObjectControlId}]`);return new M(this.ha.Ta.activeFloatingObjectControlId,this.$.ea.na.sheetName,this.$.ea.ye,this.$.ya.UserSessionId,this.ha.Ta.$b.floatingObject.type)}beforeSerialize(Xa){Xa&&Xa.commandParameters?
(Xa?(Xa.isAsyncCopy=!1,Xa.isSelectionAllowed=!1,Xa.isFromCache=!1,Xa.plainTextPayloadSize=0,Xa.shadowWorkbookPayloadSize=0,Xa.htmlPayloadSize=0,Xa.htmlSizeExceedsLimit=!1,Xa.clientSideCopyTime=0,Xa.encounteredDeploymentErrors=!1,Xa.shadowWorkbookSizeExceedsLimit=!1,Xa.originalSourceRangesCountExceedsLimit=!1,Xa.copyTotalSizeExceedsLimit=!1):e.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),Xa.commandParameters.copyPasteTargetType=2):e.ULS.sendTraceTag(537167894,
0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(Xa){const qa=Xa.sourceItem,xa={};if(!qa)return e.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),xa;if(!this.iui())return e.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),xa;e.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${qa.activeFloatingObjectControlId}]`);
this.mId();let ob=this.c6c.twa(qa);if(ob)xa.synchronousResult=ob,Xa.isFromCache=!0,Xa.isAsyncCopy=!1,Xa.clientSideCopyTime=Xa.commandParameters.stopwatch.Bc,1===Xa.commandParameters.commandType&&this.$.Xc(2045211913,Xa.commandParameters.ribbonCommandInfo.method,Xa.commandParameters.ribbonCommandInfo.We,null);else{Xa.isFromCache=!1;Xa.isAsyncCopy=!0;ob=this.T$.create();if(Xa.commandParameters.uploadToClipService){const Ib={};Ib["data-clipservice-ccpid"]=Xa.commandParameters.id;Ib["data-pkey"]=Xa.commandParameters.pKey;
Ib["data-clipservice-type"]=Xa.commandParameters.clipServiceDataType;Ib["data-clipservice-count"]=Xa.commandParameters.objectCount.toString();Ib["data-clipservice-dc"]=Xa.commandParameters.clipServiceDataCenter;Ib["data-clipservice-client"]=this.T5g;Ib["data-TimeStamp"]=(new Date).toUTCString();Ib["data-clipservice-version"]=this.U5g;ob.setItem(J.ZPg,JSON.stringify(Ib))}xa.synchronousResult=this.sJg(ob);xa.asynchronousResult=this.Tgd(Xa,qa,ob)}Xa.syncClipboardItemsKeys=Ga(xa.synchronousResult);return xa}sJg(Xa){e.ULS.shipAssertTag(537167891,
0,!!this.ha.Ta.$b,"Expecting a floating object to be currently selected for copy");Xa||(Xa=this.T$.create());const qa=this.ha.Ta.$b.Hwb();qa&&Xa.setItem(J.html,`<img src='${qa}'>`);return Xa}mId(){const Xa=this.ha.Ta.$b;this.$pb.mId(Ud.a.asb(Xa.floatingObject),Ud.a.W5g(Xa.Bu))}shouldWaitForCopyToComplete(){e.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Xa){this.OU.onDeferredPasteStarted(Xa)}onDeferredPasteCompleted(Xa){this.OU.onDeferredPasteCompleted(Xa)}deserialize(Xa){var qa=
L(Xa),xa=null;let ob=null;var Ib=!1;if(!qa){xa=Xa.copyContextSnapshot;ob=xa.sourceItem;if(!ob)return Promise.reject(new ab.a(10));Ib=ob.isFromCurrentSession(this.$)}var Zb=this.pmg(Xa,!0);if(0!==Zb)return Promise.reject(new ab.a(qa?18:Ib?19:20,void 0,void 0,void 0,Zb));if(qa)return this.vsc(Xa);if(!Ib&&!$d.Nmi(ob))return Xa=`User attempted to paste art of type [${ob.type}] between sessions.`,e.ULS.sendTraceTag(537167889,0,50,Xa),Promise.reject(new ab.a(11,void 0,void 0,Xa));if(xa.isAsyncSerializeFailed)return Promise.reject(new ab.a(16,
void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let zc;try{const Mc=Xa.clipboardItems.getItem(J.shadowWorkbook);zc=JSON.parse(Mc)}catch(Mc){return Xa=copyPasteInfra.getStringifiedError(Mc),e.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${Xa}`),Promise.reject(new ab.a(12,void 0,Mc))}zc.floatingObjectId!==ob.activeFloatingObjectControlId?e.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${ob.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${zc.floatingObjectId}]`):
e.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${ob.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${zc.floatingObjectId}]`);if(!zc||!zc.shadowWorkbookBase64)return Promise.reject(new ab.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!zc}`));Xa.isShadowWorkbookParsedSuccessfully=!0;Xa.shadowWorkbookPayloadSize=Ob(zc);Xa.shadowWorkbookSizeExceedsLimit=gc(zc);Xa.payloadOrigin=Ib?bb.T0f:
bb.PKe;Xa.payloadType=Q.$pg;if(gc(zc))return Xa=`Shadow workbook size [${Xa.shadowWorkbookPayloadSize}] is over the limit [${v.a.Fnc}]. ShadowWorkbookSizeExceedsLimit: ${zc.shadowWorkbookSizeExceedsLimit}`,e.ULS.sendTraceTag(36304156,0,15,`ArtCopyPasteHandler.Deserialize: ${Xa}`),Promise.reject(new ab.a(1,void 0,void 0,Xa));xa=qa=null;Y.h(this.$).ha.Ne&326?xa=Y.h(this.$).ha.Ta.activeFloatingObjectControlId:qa=this.$.na&&this.$.na.activeCell?S.v(this.$.na.activeCell,this.$):S.v(S.K(Xa.commandParameters.originalDestinations),
this.$);Ib=null;if(this.$pb.R8f(ob))try{Ib=this.$pb.a$c()}catch(Mc){Zb=copyPasteInfra.getStringifiedError(Mc),e.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${Zb}`)}return this.o3i.l$h(new ec(Xa.commandParameters.ribbonCommandInfo,qa,xa,Xa.commandParameters.commandType,[Xa.commandParameters.stopwatch],zc,ob,Xa,Ib))}vsc(Xa){Xa.wasLastCopyExternal=!0;if(Xa.clipboardItems.getItem("image/png")){const qa=Xa.commandParameters.stopwatch.Bc;
Xa.payloadType=Q.bWg;return ib.b(this.$.Xc(1403967063,Xa.commandParameters.ribbonCommandInfo.method,Xa.commandParameters.ribbonCommandInfo.We,{["dataUrl"]:Xa.clipboardItems.getItem("image/png")})).then(xa=>{Xa.serverRequestTimeInMs=Xa.commandParameters.stopwatch.Bc-qa;return xa?Promise.resolve(null):Promise.reject(new ab.a(15))},()=>{Xa.serverRequestTimeInMs=Xa.commandParameters.stopwatch.Bc-qa;return Promise.reject(new ab.a(15))})}e.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");
return super.vsc(Xa)}iui(){const Xa=Y.h(this.$).ha;return Xa.Ta.activeFloatingObjectControlId&&Xa.Ta.$b&&Xa.Ta.$b.floatingObject?Xa.Ta.$b.floatingObject.YYd():!1}Tgd(Xa,qa,xa){return new Promise((ob,Ib)=>{const Zb=Xa.commandParameters.stopwatch.Bc;e.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.S_a.tah(new bd(qa.activeFloatingObjectControlId,Xa.commandParameters,zc=>{Xa.requestTelemetryData=zc.RequestTelemetryData;
Xa.serverRequestTimeInMs=Xa.commandParameters.stopwatch.Bc-Zb;if(ua.a.dg(zc.Errors))if(ua.a.Dha(zc.Errors))Xa.encounteredDeploymentErrors=!0,zc=ua.a.sc(zc.Errors),e.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${zc}`);else{var Mc=ua.a.sc(zc.Errors);e.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Mc}`);Ib(new Sb(4,
zc.Errors))}else if(e.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${qa.activeFloatingObjectControlId}].`),Xa.markForCancellation)Ib(new Sb(3,zc.Errors));else{if(ua.a.Nq(zc.Errors)){var hd=ua.a.sc(zc.Errors);e.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${hd}`)}if(hd=zc.Result){hd=this.mKe(hd);hd.floatingObjectId=qa.activeFloatingObjectControlId;
Xa.shadowWorkbookPayloadSize=Ob(hd);Xa.shadowWorkbookSizeExceedsLimit=gc(hd);try{Mc=JSON.stringify(hd)}catch(id){Ib(new ab.a(14,void 0,id,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${Xa.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${hd.floatingObjectId}]`));return}e.ULS.shipAssertTag(537167881,0,!!xa,"Expecting syncClipboardItems to be defined");xa.setItem(J.shadowWorkbook,Mc);1===Xa.commandParameters.commandType&&(this.M6i(qa.type,qa.activeFloatingObjectControlId,
zc.StateId),this.deleteFloatingObject(qa.activeFloatingObjectControlId,qa.type));this.c6c.setValue(qa,xa);Xa.asyncClipboardItemsKeys=Ga(xa);ob(xa)}else e.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${qa.activeFloatingObjectControlId}`),ob(this.c6c.twa(qa))}},Xa.commandParameters.commandType,qa.type,zc=>{Xa.serverRequestTimeInMs=Xa.commandParameters.stopwatch.Bc-Zb;zc=nb.a.Oe(zc.data);1===Xa.commandParameters.commandType&&
this.S_a.mWj(qa.type,qa.activeFloatingObjectControlId);const Mc=ua.a.sc(zc);e.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Mc}`);Ib(new Sb(4,zc))},[Xa.commandParameters.stopwatch]))})}deleteFloatingObject(Xa,qa){Xa=Dc.a.zz(qa,Xa);if(Xa=Ed.a(this.$).Gr(Xa))Ed.a(this.$).deleteFloatingObject(Xa,14,!0),Y.h(this.$).ha.Ta.aB=null}M6i(Xa,qa,xa){const ob=this.$.da.Aa(277);if(ob){let Zb=null;Xa=Dc.a.zz(Xa,qa);Xa=Ed.a(this.$).Gr(Xa);
if(null===Xa||void 0===Xa?0:Xa.Yi)Zb=Xa.Yi.block;if(Zb){var Ib=Xa.floatingObject.Ng();ob.k0b(()=>!Zb.Li.kb(Ib),xa,"CutArt")}}}static Nmi(Xa){return 1===Xa.type||5===Xa.type}}Object(c.a)($d,"ArtCopyPasteHandler",mb,[]);var ve=a(58);class ze extends Yb{constructor(Xa,qa,xa,ob){super(Xa);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=qa;this.top=xa;this.left=ob}}Object(c.a)(ze,"MacroRecorderPasteArtPayload",Yb,[]);class We{constructor(Xa,qa){this.$=Xa;this.$pb=qa}Jei(Xa,
qa,xa,ob,Ib,Zb=null,zc=null){const Mc=this.$.pa.xa.Wb();let hd=null;const id={CopyPasteTargetType:2};id.FloatingObjectId=Xa;id.CopyOperationId=xa.id;xa.floatingObjectType=qa;id.UploadToClipService=xa.uploadToClipService;id.PKey=xa.pKey;id.ClipServiceDataCenter=xa.clipServiceDataCenter;let yd=0;2===Ib?(Ib=505,yd=16,hd=(Yd,cc,Rc)=>oa(this.$.pa.xa,id,Ta.b(Yd,ob),Zb?Ta.a(cc,Zb):cc,Rc,xa.ribbonCommandInfo,Mc,zc)):(Ib=179,hd=(Yd,cc,Rc)=>{this.Toh(qa,Xa);this.$.Py();return Ba(this.$.pa.xa,id,Ta.b(Yd,ob),
Zb?Ta.a(cc,Zb):cc,Rc,xa.ribbonCommandInfo,Mc,zc)});this.$.userOperationManager.Ic(new vb.a(Ib,0,hd,yd|64),xa.ribbonCommandInfo)}Toh(Xa,qa){var xa=Dc.a.zz(Xa,qa);(xa=Ed.a(this.$).Gr(xa))?(Y.h(this.$).ha.Ta.yH(xa),xa.isVisible=!1):e.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${Xa}, FloatingObjectId: ${qa}`)}mWj(Xa,qa){Xa=Dc.a.zz(Xa,qa);if(Xa=Ed.a(this.$).Gr(Xa))Xa.isVisible=!0}tah(Xa){this.Jei(Xa.floatingObjectId,Xa.rah,
Xa.commandParameters,Xa.Zt,Xa.Zih,Xa.Naa,Xa.vRb)}jfi(Xa,qa,xa,ob,Ib,Zb,zc,Mc=null,hd=!0){return new Promise((id,yd)=>{const Yd=Zb.commandParameters.stopwatch.Bc;this.ORd(Xa,Ib,qa,xa,cc=>{Zb.requestTelemetryData=cc.RequestTelemetryData;Zb.serverRequestTimeInMs=Zb.commandParameters.stopwatch.Bc-Yd;if(ua.a.Dha(cc.Errors))Zb&&(Zb.encounteredDeploymentErrors=!0),cc=ua.a.sc(cc.Errors),e.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${cc}`);
else if(ua.a.dg(cc.Errors)){var Rc=ua.a.sc(cc.Errors);e.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${Rc}`);yd(new ab.a(9,cc.Errors))}else cc.Result?(Rc=cc.Result,e.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.Z6i(zc,Rc.FloatingObjectId,cc.StateId),id(We.qod(Rc.FloatingObjectId))):(e.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),yd(new ab.a(9,cc.Errors)))},
cc=>{Zb.serverRequestTimeInMs=Zb.commandParameters.stopwatch.Bc-Yd;cc=nb.a.Oe(cc.data);e.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${ua.a.sc(cc)}`);yd(new ab.a(9,cc))},ob,Mc,hd)})}Z6i(Xa,qa,xa){const ob=this.$.da.Aa(277);if(ob){const Ib=Dc.a.zz(Xa,We.qod(qa));ob.k0b(()=>!!Ed.a(this.$).Gr(Ib),xa,"PasteArt")}}g1d(Xa,qa){qa&&this.$pb.g1d(Xa,Dc.a.zz(Xa.type,qa))}WMf(Xa){return this.jfi(Xa.ribbonCommandInfo,Xa.destination,Xa.JMe,Xa.vRb,Xa.f1,Xa.pasteContext,
Xa.item.type,Xa.xEe,Xa.item.isFromCurrentSession(this.$)).then(qa=>qa,qa=>{this.g1d(Xa.item,Xa.xEe);return Promise.reject(qa)})}qRd(Xa,qa,xa){Xa||(Xa=S.v(Y.h(this.$).ha.ra.activeCell,this.$));Y.h(this.$).ikc(S.D(Xa),1)?Ed.a(this.$).Tna(xa,qa,!0):Y.h(this.$).ha.Ta.dIa(Xa,qa,xa).continueWith(ob=>{ob.result?e.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${qa}]`):e.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${qa}]`)})}ORd(Xa,
qa,xa,ob,Ib,Zb,zc,Mc,hd=!0){const id=this.$.pa.xa.Wb(),yd={};yd.ShadowWorkbookBase64=qa.shadowWorkbookBase64;yd.FloatingObjectId=ob;yd.DestinationRanges=xa?S.s(xa):null;yd.CopyPasteTargetType=2;yd.ClientEstimationFloatingObjectId=Mc;xa=new vb.a(503,0,(Yd,cc,Rc)=>{Mc||this.$.Py();return sa(this.$.pa.xa,yd,Ta.b(Yd,Ib),Ta.a(cc,Zb),Rc,null,id,zc)},void 0,()=>{if(hd){let Yd;Yd=ve.a.$h(ve.a.fc(yd));Yd.FloatingObjectId=qa.floatingObjectId;yd.DestinationRanges||(Yd.DestinationRanges=S.p(this.$.va.na.sheetName,
"",0,0,0,0));return new ze(Yd,hd,0,0)}return new ze(yd,hd,0,0)});xa.flags=65;this.$.userOperationManager.Ic(xa,Xa)}static qod(Xa){return`${Xa.length+2}.{${Xa.toUpperCase()}}`}}Object(c.a)(We,"ArtCopyPasteUtils",null,[870]);var md=a(194);class $b{constructor(Xa){this.a6c=this.Lta=null;this.sbb=15;this.$=Xa}mId(Xa,qa){this.Lta=Xa;this.a6c=qa}a$c(){if(!this.Lta||!this.a6c)return e.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const Xa=Ud.a.asb(new Dc.a(this.Lta));Xa.Id=We.qod(l.a.create().toString());Xa.Version=-1;Xa.Name="";Xa.IsClientEstimation=!0;var qa=this.xgi(Xa);if(!qa)return null;const xa=new Dc.a(Xa);qa.block.Li.add(xa);xa.nLb();const ob=Ed.a(this.$);ob.C6b(xa,qa);qa=ob.Gr(Dc.a.lWh(Xa));!qa||qa.floatingObject.ENa||qa.floatingObject.XNa||qa.$Sa(this.a6c);ob.Tna(Xa.Type,Xa.Id,!0);return Xa.Id}R8f(Xa){return r.EwaSettings.oa(218)&&Xa.isFromCurrentSession(this.$)&&!Y.h(this.$).rtl&&!Y.h(this.$).ib.rj}g1d(Xa,qa){this.R8f(Xa)&&
(Xa=Ed.a(this.$).Gr(qa))&&(e.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${qa}] of type [${Xa.floatingObject.type}]`),Ed.a(this.$).deleteFloatingObject(Xa,15,!0),Xa.Yi&&Xa.Pcb(Xa.Yi,!1))}xgi(Xa){if(!Xa)return e.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(Y.h(this.$).ha.Ta.activeFloatingObjectControlId){var qa=
Y.h(this.$).ha.Ta.aB.floatingObject;Xa.OriginDeltaX=qa.offsetX+this.sbb;Xa.OriginDeltaY=qa.offsetY+this.sbb;Xa.AbsoluteLeft+=this.sbb;Xa.AbsoluteTop+=this.sbb;Xa.AbsoluteRight+=this.sbb;Xa.AbsoluteBottom+=this.sbb;Xa.ZOrder=qa.gC+1;return Y.h(this.$).ha.Ta.aB.Yi}if(!this.$.na||!this.$.na.activeCell)return e.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var xa=this.$.na.activeCell;
qa=Y.h(this.$).N1(xa);if(!qa)return e.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${xa.toString()} is null.`),null;const ob=Pa.HelperMethods.Oxb(qa.domElement,qa.Zi.domElement);xa=qa.gridView.fg(xa,2);if(!ob||!xa)return e.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!ob}. cellPositionRelativeToGridOrigin is null: ${!xa} .`),null;Xa.OriginDeltaX=
xa.topLeft.x-ob.x;Xa.OriginDeltaY=xa.topLeft.y-ob.y;Xa.AbsoluteLeft=xa.topLeft.x;Xa.AbsoluteTop=xa.topLeft.y;Xa.AbsoluteRight=Xa.AbsoluteLeft+Math.abs(this.Lta.AbsoluteRight-this.Lta.AbsoluteLeft);Xa.AbsoluteBottom=Xa.AbsoluteTop+Math.abs(this.Lta.AbsoluteBottom-this.Lta.AbsoluteTop);Xa.ZOrder=this.Lta.ZOrder+100;return new md.a(qa.gridView.Da.Gl(qa.hashCode),qa.hashCode)}}Object(c.a)($b,"ArtPasteClientEstimation",null,[869]);class $c{create(){const Xa=window.clipboardPlatform;return Xa?Xa.createClipboardItems():
null}}Object(c.a)($c,"ClipboardItemsFactory",null,[868]);class nd{}nd.undefined="Undefined";Object(c.a)(nd,"CCPTelemetryConsts",null,[]);class Oc{}Oc.cells="Cells";Oc.floatingObject="FloatingObject";Oc.unknown="Unknown";Object(c.a)(Oc,"ActiveSelection",null,[]);class Gd{}Gd.eoh="DisplayNotInvoked";Gd.U9c="Displayed";Gd.i7i="PrerequisitesNotReady";Object(c.a)(Gd,"PasteIndicationDisplayStatus",null,[]);var Qd=a(109);class Ad{constructor(Xa){this.fIc=this.rSc=null;this.$=Xa}get sKd(){if(!this.rSc){const Xa=
this.$.da.Aa(254,!0);Xa&&(this.rSc=new ld(this.$,Xa,new $c))}return this.rSc}get m_c(){if(!this.fIc&&this.$.da.Aa(254,!0)){const Xa=new $b(this.$);this.fIc=new $d(this.$,new $c,new We(this.$,Xa),Xa)}return this.fIc}getCopyFlowHandler(Xa){const qa=this.hSh(Y.h(this.$).Ne);Xa.commandParameters.copyPasteHandlerName=qa.name;return qa}getPasteFlowHandler(Xa){var qa=Xa.copyContextSnapshot;qa=P(Xa)?this.m_c:L(Xa)?this.sKd:(null===qa||void 0===qa?0:qa.sourceItem)&&Object.getType(qa.sourceItem)===M?this.m_c:
this.sKd;Xa.commandParameters.copyPasteHandlerName=qa.name;return qa}initializePasteContext(Xa){if(Xa&&(Xa.isSameSession=!1,Xa.isShadowWorkbookParsedSuccessfully=!1,Xa.pasteResult=nd.undefined,Xa.payloadOrigin=nd.undefined,Xa.payloadType=nd.undefined,Xa.encounteredDeploymentErrors=!1,Xa.shadowWorkbookSizeExceedsLimit=!1,Xa.originalSourceRangesCountExceedsLimit=!1,Xa.activeSelectionType=this.WNh(),Xa.indicationDisplayScheduled=!1,Xa.pasteDestinationHasMergedCells=!1,Xa.pasteIndicationDisplayStatus=
Gd.eoh,Xa.copyContextSnapshot)){var qa=Xa.copyContextSnapshot;const zc=C(qa.sourceItem);var xa=qa.sourceItem;var ob=!!xa&&Object.getType(xa)===M;xa=0;var Ib=!1;zc?(Ib=qa.sourceItem,Xa.isSameSession=Ib.isFromCurrentSession(this.$),xa=1,Ib=this.kri(Ib,Xa)):ob&&(Xa.isSameSession=qa.sourceItem.isFromCurrentSession(this.$),xa=2);if(Xa.copyContextSnapshot.commandParameters){const Mc=-1985798686===qa.commandParameters.ribbonCommandInfo.command;ob=Xa.commandParameters;var Zb=this.$;qa?Zb&&Zb.ya?qa=qa.sessionId===
Zb.ya.UserSessionId:(e.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),qa=!1):(e.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),qa=!1);ob.clearSystemClipboard=qa&&Mc&&zc&&!Ib;Xa.commandParameters.copyPasteTargetType=xa}}}getSessionId(){return this.$.ya.UserSessionId}kri(Xa,qa){const xa=Qd.b(Xa.ranges,ob=>ob.gf)&&Qd.b(qa.commandParameters.originalDestinations,ob=>1!==ob.top);return Qd.b(Xa.ranges,ob=>ob.isRow)&&Qd.b(qa.commandParameters.originalDestinations,ob=>
1!==ob.left)||xa}hSh(Xa){switch(Xa){case 1:return this.sKd;case 64:case 4:case 2:case 256:return this.m_c;default:throw Error.invalidOperation("Unsupported selection");}}WNh(){return Y.h(this.$).ha.Ne&470?Oc.floatingObject:1===Y.h(this.$).ha.Ne?Oc.cells:Oc.unknown}getDialogResponse(){}}Object(c.a)(Ad,"ExcelCopyPasteApplicationHost",null,[846]);var Sd=a(156);class Ce extends B.a{constructor(Xa,qa){super(Xa);this.vp=null;this.pii=(xa,ob)=>{1===xa?(xa=Ce.pnh[ob[Ce.onh]],e.ULS.sendTraceTag(537167683,
0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===xa?"Horizontal":"Vertical"}`),this.vp.setResult(xa)):(e.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.vp.Or())};this.hg(qa)}get pc(){return"InsertCopiedCutCellsDialog"}hg(Xa){this.vp=new Sd.a;const qa=z.a.instance.ga(16);Xa=this.vN(Xa);this.initializeAndShow(qa,this.pii,Xa)}vN(Xa){return{[Ce.yu]:this.pc,
[Ce.Qsi]:Xa}}}Ce.onh="direction";Ce.Qsi="isRtl";Ce.pnh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(Ce,"InsertCopiedCutCellsDialog",B.a,[]);class we{E6b(Xa,qa){return(new Ce(Xa,qa)).vp.task}}Object(c.a)(we,"InsertCopiedCutCellsDialogFactory",null,[780]);var Td=a(89),he=a(47),ee=a(46);class ge{constructor(Xa){this.D7b="";this.T2=this.xt=null;this.stc=!1;this.Ycf=(qa=null,xa=null)=>{this.hide(qa,xa)};this.gridView=Y.h(Xa);this.gridView.ha.hH(this.Ycf)}UOe(){this.stc||(e.ULS.sendTraceTag(537167680,
0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.qy(Xa=>{Xa.bba(0).then(()=>{this.stc=!0})}))}Xrj(Xa){var qa=Xa.commandParameters.id;e.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${qa}, cancelCtx is null = ${!this.xt}, PrerequisitesDownloaded = ${this.stc}`);this.UOe();this.D7b=qa;qa=!this.tyf();if(!this.xt||qa)this.IBe(),this.xt=he.a.instance.create(()=>{this.doh(Xa)},void 0===Xa.timeoutToShowSpinnerInMs||
null===Xa.timeoutToShowSpinnerInMs?100:Xa.timeoutToShowSpinnerInMs,ee.a.u3i);this.T2=Xa.commandParameters.originalDestinations}doh(Xa){this.stc?(this.display(Xa.commandParameters.originalDestinations),Xa.pasteIndicationDisplayStatus=Gd.U9c):(e.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),Xa.pasteIndicationDisplayStatus=Gd.i7i)}display(Xa){e.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");
this.gridView.qb.qx(db.a.Sea(La.d(this.gridView.$.na),Xa),ge.wsc,!0);this.gridView.qb.Tn(ge.wsc)}fnd(Xa){e.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${Xa}, currentPasteCommandId = ${this.D7b}`);Xa&&ka.a.equals(Xa,this.D7b,!1)&&this.hide()}hide(Xa=null){this.T2&&Xa&&this.tyf()&&e.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");
this.D7b="";this.IBe();this.T2=null;this.gridView.qb.Zg(ge.wsc);this.gridView.qb.Ri(null,ge.wsc)}tyf(){return S.Q(this.gridView.ha.ra.selectedRanges,this.T2)}IBe(){this.xt&&(Td.a.Ia(this.xt),this.xt=null)}dispose(){this.hide();this.gridView.ha.kG(this.Ycf)}}ge.wsc=[30];Object(c.a)(ge,"PasteIndicationManager",null,[779,3]);var re=a(981),Be=a(52),Oe=a(698);class gf extends f.a{constructor(Xa){super();this.$=Xa;this.im=z.a.instance;this.Fb()}create(){const Xa=Be.a.YN([74,75],4,this.Ya,void 0,void 0,
void 0,gf.Zna),qa=Z.GetServiceTaskFactory.create(this.$.da,18,this.$.ka,this.Ya);Wa.TaskExtensions.za(Wa.TaskExtensions.Ed([qa,Xa],this.ka),()=>{const xa=new re.a;let ob=null;this.P8g(xa).then(Ib=>{ob=Ib.AEe;const Zb=copyPasteInfra.createCopyPasteInfra(ob,new Ad(this.$),xa,this.$);e.ULS.shipAssertTag(537167762,0,!!this.$.ya,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");e.ULS.shipAssertTag(537167761,0,!!this.$.ya&&!!this.$.ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");
const zc=ob.getMetadataManager();var Mc=Object(Oe.a)(this.$.da,254,()=>new Mb(this.$,zc,qa.result,Zb,new Qa(this.$,Y.h(this.$)),new we,this.$.ya.DocumentHostInfo.UserId,ob.getInitializationError()));this.ob(Mc);if(Ib.r1a){Mc=Mb.zcc();const hd=JSON.stringify(Ib.r1a.dataClipboardCapabilities),id=Ib.r1a.clipboardStrategiesToInitialize[0].clipboardStrategyType===Ib.r1a.dataClipboardStrategyType,yd=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();
e.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${Mc}, StrategyType=${Ib.r1a.dataClipboardStrategyType}, StrategyCapabilities=${hd}, IsBestStrategyTypeInitialized=${id}, InfraLoadTimeMS=${yd}`)}else e.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},Ib=>{const Zb=Mb.zcc();Ib=Ib?copyPasteInfra.getStringifiedError(Ib):"null";e.ULS.shipAssertTag(38847436,
0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${Zb} error: ${Ib}`)})},this.ka,3)}dispose(){super.dispose()}P8g(Xa){let qa=null;var xa=window.clipboardPlatform;xa&&(qa=xa.getClipboardPlatformEnvironment());if(!qa)return e.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);xa=this.$.ya;const ob=[xa.OfficeOnlineChromeExtensionId,xa.ChromeClipboardAccessExtensionId],Ib=this.im.Ua(5);var Zb=this.$.me.get(57);let zc=!Zb&&this.$.me.get(5);const Mc=this.$.ea.dc;Mc&&(Mc.inWebPart||Mc.inViewerFromWebPart||Mc.isDivSyndicated)&&(zc=!1);Zb=this.eRh(zc,!Zb);e.ULS.shipAssertTag(537167758,0,!!xa.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return qa.init(this.$,
Xa,ob,xa.SharedClipboardHostingApp,xa.SharedClipboardHostingApps,xa.SharedClipboardHostingEnvironments,xa.SharedClipboardOverrideOrigin,xa.SharedClipboardSchemaVersion,xa.SharedClipboardExpirationInMinutes,xa.ClipboardPromiseTimeoutInMinutes,Ib,xa.MachineCluster,new sb(this.$),Zb,xa.DocumentHostInfo.UserId,xa.ClipboardTtlInMS,r.EwaSettings.oa(290),xa.UserSessionId).then(hd=>Object(b.a)(new pb,{AEe:qa,r1a:hd}),hd=>Promise.reject(hd))}eRh(Xa,qa){const xa=[];Xa&&qa&&xa.push(this.yhh());qa&&(xa.push(this.K7c(7)),
xa.push(this.K7c(0)));Xa&&xa.push(this.sJe());xa.push({clipboardStrategyType:4});const ob=xa?xa.map(Ib=>JSON.stringify(Ib)).join(","):"[]";e.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${Xa}, isSystemClipboardAllowed=${qa}, result = ${ob}`);return xa}sJe(){const Xa=this.$.ya,qa={clipboardStrategyType:5};qa.sessionId=Xa.UserSessionId;qa.useSharedClipboardIframe=!0;qa.sharedClipboardHostingApp=
Xa.SharedClipboardHostingApp;qa.sharedClipboardHostingApps=Xa.SharedClipboardHostingApps;qa.sharedClipboardHostingEnvironments=Xa.SharedClipboardHostingEnvironments;qa.sharedClipboardOverrideOrigin=Xa.SharedClipboardOverrideOrigin;qa.sharedClipboardSchemaVersion=Xa.SharedClipboardSchemaVersion;qa.sharedClipboardExpirationInMinutes=Xa.SharedClipboardExpirationInMinutes;qa.wacCluster=Xa.MachineCluster;return qa}yhh(){const Xa={clipboardStrategyType:6};Xa.localStorageStrategyParameters=this.sJe();Xa.systemClipboardStrategyParameters=
this.K7c(0);return Xa}K7c(Xa){const qa={};qa.clipboardStrategyType=Xa;qa.skipFilesIfPlainTextExists=!0;return qa}static la(Xa){Xa.da.Ga(373,new ge(Xa));Xa.da.Ga(gf.Zna,new gf(Xa))}}gf.Zna=255;Object(c.a)(gf,"CopyPasteInfrastructureFactory",f.a,[]);var af=a(9);a.d(E,"a",function(){return Ze});const Ze=()=>{af.a.Fa(Xa=>{gf.la(Xa)})}},1156:function(t,E,a){t=a(0);var c=a(15),b=a(685),e=a(554),f=a(84),d=a(83),h;(function(da){da[da.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";da[da.cloudPolicySettings=
1]="cloudPolicySettings";da[da.alternateAuthToken=2]="alternateAuthToken"})(h||(h={}));Object(t.b)("ApplicationFeatureHelperRequestType",h);class m{constructor(){this.message=null;this.K6a=0}}Object(t.a)(m,"HttpRequstToPromiseRejectData",null,[]);var l=a(98),w=a(80),n=a(241),x=a(30);class r{constructor(da,Z){this.nb=da;this.Ah=Z}$6c(da,Z,ha,Wa=null,ca=null,ja=null,ua=null,Za=null){const Pa=h[ha],ka=Pa+"RequestFailure";l.Health.instance.recordKpiUsage(ka,0,"jpittsdirects",null);return new Promise((ra,
ba)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",Pa);const Ua=null!=ua?ua:this.nb.ud("ApplicationFeatureHelperRequestQueueTimeout",15E3),Ka=null!=Za?Za:this.nb.ud("ApplicationFeatureHelperRequestSentTimeout",3E4);this.Ah.pha(da,1,null,this.wWh(ha,Wa),ja,!1,1,Oa=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",Pa);try{if(void 0===Oa||null===Oa||void 0===
Oa.data||null===Oa.data||void 0===Oa.data.fe||null===Oa.data.fe){l.Health.instance.recordKpiFailure(ka,"Invalid RequestSucceededEventArgs",!1,!0,null);let La=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",Pa);ba(this.dyb(La,Oa))}else if(Oa.data.httpStatus!==n.a.wP){l.Health.instance.recordKpiFailure(ka,"HttpStatusCode_"+Oa.data.httpStatus.toString(),!1,!0,null);let La=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",
Oa.data.httpStatus,Pa);ba(this.dyb(La,Oa))}else{void 0!==ca&&null!==ca&&void 0!==Oa.data.responseHeaders&&null!==Oa.data.responseHeaders&&ca(Oa.data.responseHeaders);var ib=Z(Oa.data.fe);if(ib)c.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",Pa),ra(ib);else{l.Health.instance.recordKpiFailure(ka,"Parse Failure",!1,!0,null);let La=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",
Pa);ba(this.dyb(La,Oa))}}}catch(La){l.Health.instance.recordKpiFailure(ka,"Unexpected Failure",!1,!0,null),ib=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",La,Pa),ba(this.dyb(ib,Oa))}},Oa=>{if(Oa.data){l.Health.instance.recordKpiFailure(ka,"HttpStatusCode_"+Oa.data.httpStatus.toString(),!1,!0,null);var ib=x.a.Sjd(Oa.data.fe||"No Data");ib=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",
Oa.data.httpStatus,ib,Pa)}else l.Health.instance.recordKpiFailure(ka,"Invalid RequestFailedEventArgs",!1,!0,null),ib=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",Pa);ba(this.dyb(ib,Oa))},null,void 0,void 0,Ua,Ka)})}dyb(da,Z){const ha=new m;ha.message=da;ha.K6a=Z&&Z.data?Z.data.httpStatus:-1;return ha}wWh(da,Z){const ha={};ha["x-UserDataSignature"]=this.nb.Xa("UserDataSignature");ha["x-LicensingIsEnabled"]=this.nb.qa("LicensingIsEnabled").toString();
ha["x-CacheIsEnabled"]=this.nb.qa("LicensingRedisIsEnabled").toString();ha["x-OcpsIsEnabled"]=this.nb.qa("OcpsIsEnabled").toString();ha["x-LicensingAADIdIsEnabled"]=this.nb.qa("LicensingAadIdIsEnabled").toString();0===da&&(ha["x-LicenseCheckOnTenantEnabled"]="true",ha["x-SupportUserConsentDependentFeatures"]="true",ha["x-AFHUserConsentGroupValue"]="0",ha["x-UseShellServiceForUserConsentGroup"]="true",ha["x-SMBUserLicensingEnabled"]="true",ha["x-AFHPIPLComplianceEnabled"]=w.a.oy(window.location.href,
"wd_afhpipl")||"false");if(Z)for(let Wa of Z.keys)ha[Wa]=Z.ma(Wa);return ha}}Object(t.a)(r,"HttpRequestToPromiseUtility",null,[]);var u=a(4),v;(function(da){da[da.loki=0]="loki";da[da.augloopACLP=1]="augloopACLP"})(v||(v={}));Object(t.b)("AlternateAuthSupportApp",v);var B=a(732),z=a(41);class A{constructor(){this.Token=null;this.ExpirationTime=0}}Object(t.a)(A,"WacAlternateAuthToken",null,[]);class y{constructor(da,Z){this.lSj=3E5;if(void 0===da||null===da||void 0===Z||null===Z)throw Error.argumentNull("appSettingsManager/clientRequestManager");
this.nb=da;this.OSb=new b.a(e.a.ak());this.ukb=new r(da,Z);void 0!==B.a.vyd&&null!==B.a.vyd&&void 0!==B.a.Zmc&&null!==B.a.Zmc&&0<B.a.Zmc&&(da=new A,da.Token=B.a.vyd,da.ExpirationTime=B.a.Zmc,this.OSb.ia("loki",da))}EOh(){let da=null;this.OSb.kb(v[0])&&(da=this.OSb.ma(v[0]));return void 0===da||null===da||this.Iud(da)?this.EFh():Promise.resolve(da.Token)}Iud(da){return da.ExpirationTime-Date.now()<this.lSj}EFh(){const da=new b.a(e.a.ak());da.ia("X-AlternateAuthApp",v[0]);return this.ukb.$6c(this.Vva("/afhs/AlternateAuthHelperHandler.ashx"),
Object(f.a)(this,this.E2i,"parseAlternateAuthTokenResponse"),2,da).then(Z=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",v[0]);this.OSb.ia(v[0],Z);return Z.Token},Z=>{Z=Object(d.a)(m,Z);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",Z.message,Z.K6a);return null})}E2i(da){let Z=null;({Gt:Z}=z.d(da));c.ULS.sendTraceTag(545821457,3004,Z?50:10,
"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",da);return Z}Vva(da){return String.format("{0}{1}?{2}",this.nb.Xa("WebServiceBase"),da,u.AFrameworkApplication.Hi)}}Object(t.a)(y,"AlternateAuthHelper",null,[255]);var D=a(460);class I{constructor(da,Z,ha){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=da;this.isEnabled=Z;this.tierName=ha}}Object(t.a)(I,"FeatureStateChangeArgs",null,[]);var M=a(135),T=a(253),S=a(27),H=a(111),C=a(171),G;(function(da){da[da.Enabled=
0]="Enabled";da[da.Disabled=1]="Disabled"})(G||(G={}));Object(t.b)("FeatureState",G);var J=a(82),L=a(25),P=a(189);class aa{constructor(da,Z,ha=null,Wa=null,ca=null){this.iva=this.lYb=this.Hje=this.bra=this.oZb=null;this.ukb=new r(da,Z);this.nb=da;this.Zzg=da.ud("LicensingMaxRetryAttempts",0);this.SVb=da.qa("IsO365ConsumerHost");this.pOc=da.qa("IsO365CommercialHost");this.NVb=da.qa("PremiumUpsellIsEnabled");this.yPc=0;this.e8d=ha;this.Tne=Wa;this.La=ca;this.ara=da.qa("LicensingIsEnabled");this.pFa=
da.qa("OcpsIsEnabled")&&this.pOc;this.OVc=da.qa("ShowPrivacyDialog")&&!!Wa;this.ENc=da.qa("IsAnonymousUser");this.ddd=new Promise(ja=>{ja(!1)});this.uCa=new Promise(ja=>{ja(!0)});this.hva=new b.a(e.a.ak());this.b_b=!0;this.Vee=this.YXh();this.Rsd()&&!this.ENc?(void 0!==u.AFrameworkApplication.ta&&null!==u.AFrameworkApplication.ta&&(this.oZb=u.AFrameworkApplication.ta.kE,void 0!==this.oZb&&null!==this.oZb&&(this.bra=this.oZb.Qg("WebServiceCall","ApplicationFeatureHelperService"))),this.iva=this.O0d()):
this.iva=new Promise(ja=>{ja({})});this.iva.catch(ja=>{ja=Object(d.a)(m,ja);c.ULS.sendTraceTag(42513088,3004,10,"ApplicationFeatureHelper initialization failed, HttpStatus={0}",ja?ja.K6a.toString():"Unknown")});this.b_b&&(this.NVb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(ja=>{this.NVb=this.nb.qa("PremiumUpsellIsEnabled")&&ja;return null}))}YXh(){const da=this.nb.cq("AllLicensedFeatures")?this.nb.Fw("AllLicensedFeatures"):[],Z=new D.a;for(let ha=0;ha<da.length;ha++)Z.add(da[ha]);return Z}Rsd(){return this.pOc||
this.SVb}O0d(da=0,Z=!1){c.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",Z);const ha=M.a.gs();ha&&(ha.set("retryAttempt",da.toString()),ha.set("forceRefresh",Z.toString()),ha.set("isO365ConsumerHost",this.SVb.toString()),ha.set("isO365CommercialHost",this.pOc.toString()),ha.set("isFreemiumUpsellSettingEnabled",this.NVb.toString()));l.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",ha);l.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",
1,"waclicensing",ha);void 0!==this.bra&&null!==this.bra&&this.bra.start();let Wa=null;Z&&(Wa=new b.a(e.a.ak()),Wa.ia("x-LicensingForceRefresh","true"));this.Hje=new Date;return(this.ara?this.ukb.$6c(this.Vva("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.H2i,"parseApplicationFeatureHelperResponse"),0,Wa,Object(f.a)(this,this.Z7i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(ca=>{const ja=Object.assign(new P.a,{durationMs:this.kcg()});ja.extendedProperties=
ha;ja.extendedProperties&&ca&&(ja.extendedProperties.set("featureCount",H.a.count(ca).toString()),ja.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in ca).toString()),ja.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in ca).toString()),"FreemiumUpsell"in ca&&ja.extendedProperties.set("isFreemiumUpsellEnabled",ca.FreemiumUpsell.toString()),this.lYb&&ja.extendedProperties.set("fromCache",(this.lYb<this.Hje).toString()));l.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
ja);return ca},ca=>{const ja=Object.assign(new P.a,{durationMs:this.kcg()}),ua=Object(d.a)(m,ca);if(!ua)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,ja),new Promise((Za,Pa)=>{Pa(ca)});ja.extendedProperties=ha;ja.extendedProperties&&ja.extendedProperties.set("status",ua.K6a.toString());l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,ja);return 408===ua.K6a&&++da<=this.Zzg?this.O0d(da):new Promise((Za,Pa)=>{Pa(ua)})})}H2i(da){(da=z.b(da))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",da)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return da.Features}Vva(da){var Z=String.format("{0}{1}",this.nb.Xa("WebServiceBase"),
da);this.nb.cq("ApplicationFeatureHelperHttpCachingEnabled")&&this.nb.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(da=aa.Hdc(this.nb))&&0<da.length&&(this.b_b&&(da+="ucbf"),Z=new T.QueryStringBuilder(Z),Z.oj("afhskey",da),Z=Z.toString());return Z}isFeatureEnabled(da,Z){if(!this.pFa&&!this.OVc&&!this.ara)return this.uCa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",da);if("ConnectedServices"===da){var ha=this.pFa?
this.e8d.xF("ControllerConnectedServicesEnabled"):this.uCa;const ja=this.OVc?this.Tne.getSettings().then(ua=>2!==ua.vu,()=>Z):this.uCa;return ha.then(ua=>ua?ja:this.ddd)}ha=null;ha=this.pFa?this.e8d.isFeatureEnabled(da):this.uCa;let Wa=null;Wa=this.ara?this.Xni(da,Z):this.uCa;let ca=null;ca=this.OVc?this.Tne.isFeatureEnabled(da):this.uCa;return ha.then(ja=>ja?ca.then(ua=>ua?Wa:this.ddd):this.ddd).then(ja=>{this.Esf(da,ja,!0);return ja},()=>{this.Esf(da,Z,!1);return Z})}Esf(da,Z,ha){c.ULS.sendTraceTag(526713106,
3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",da,Z,ha)}getFeatureTier(da,Z){if(!this.ara)return new Promise(ha=>{ha(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",da);return this.iva.then(ha=>this.Hec(da,ha,Z),()=>Z)}isFreemiumUpsellEnabled(){const da=this.NVb&&this.SVb&&!this.ENc;if(da&&2!==this.yPc||!da&&1!==this.yPc)c.ULS.sendTraceTag(509728161,3004,20,"ApplicationFeatureHelper_IsFreemiumUpsellEnabled: isO365ConsumerHost={0}, isAnonymousUser={1}, isFreemiumUpsellEnabled={2}",
this.SVb.toString(),this.ENc.toString(),da.toString()),this.yPc=da?2:1;return da}launchUpsellExperience(da,Z=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",da));var ha=M.a.gs();ha&&(ha.set("experienceId",da),Z&&ha.set("campaignId",Z));l.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",ha);if(ha=J.a.instance.yg("Common.IInProductMessagingUIManager")){const Wa=Object(f.a)(this,
this.y8h,"handleDimeTaskComplete");ha.Lqf(da,Wa,Z)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.La.$d(L.a.Tbc,2,{["experience"]:da})}qna(da,Z){if(!this.ara)return null;if(!da||!Z)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;const ha=C.a.create().toString();this.hva.kb(da)||
this.hva.ia(da,new b.a(e.a.ak()));this.hva.ma(da).add(ha,Z);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",ha,da));return ha}zMd(da,Z){this.ara&&(da&&this.hva.kb(da)?Z&&C.a.isValid(Z)?this.hva.ma(da).kb(Z)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",Z,da)),this.hva.ma(da).remove(Z)):c.ULS.sendTraceTag(594564809,
3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",Z,da)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",Z,da)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",da)))}Hec(da,Z,ha){return this.b_b?da in Z?Z[da].LicenseTier:
ha:da in Z?this.d3i(Z[da],ha):ha}d3i(da,Z){switch(da.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return Z}}y8h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.iva.then(da=>{this.fUf(da)}).catch(()=>{this.fUf({})})}fUf(da){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const Z=this.O0d(0,!0);Z.then(ha=>{this.iva=Z;H.a.count(ha)>H.a.count(da)?l.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",
null):l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let Wa of this.hva.keys)if(Wa in ha){const ca=this.Hec(Wa,ha,0);Wa in da?this.Hec(Wa,da,0)!==ca&&this.pCd(Wa,!0,ca):this.pCd(Wa,!0,ca)}else Wa in da&&this.pCd(Wa,!1,this.Hec(Wa,da,0))}).catch(ha=>{l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);c.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(ha))})}pCd(da,Z,ha){c.ULS.sendTraceTag(594051085,
3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",da,Z,ha);Z=new I(da,Z,ha);ha=this.hva.ma(da);for(let Wa of ha)try{Wa.value(Z)}catch(ca){c.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",da,Wa.key,ca.message))}}Qd(da,Z){if(this.ara){const ha=this.Vee.contains(da);let Wa=!0,ca="",
ja=!1;return this.iva.then(ua=>{da in ua?(ua=ua[da],ca=G[ua.FeatureState],Wa=1!==ua.FeatureState):Wa=!ha;this.Nsf(da,ha,ca,ja,Z,Wa);return Wa},()=>{ja=!0;ha&&(Wa=Z);this.Nsf(da,ha,ca,ja,Z,Wa);return Wa})}return this.uCa}Nsf(da,Z,ha,Wa,ca,ja){c.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",da,Z,Wa,ha,ca,ja)}Xni(da,Z){if(this.b_b)return this.Qd(da,Z);if(this.ara){if(this.Vee.contains(da))return this.iva.then(ha=>
da in ha,()=>Z);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",da)}return this.uCa}Z7i(da){try{da&&"Date"in da&&(this.lYb=new Date(da.Date),c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.lYb.toString()))}catch(Z){c.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",Z)}}kcg(){if(void 0!==this.bra&&
null!==this.bra){const da=this.bra.Bc;this.bra.stop();return da}return null}static Hdc(da){try{if(S.a.xOj){const Z=da.Xa("UserDataSignature").split(".");if(1<Z.length){const ha=window.self.atob(Z[1]),Wa=JSON.parse(ha).LocalStorageKey;if(void 0!==Wa&&null!==Wa&&0<Wa.length)return Wa}}}catch(Z){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",Z.toString())}return null}}Object(t.a)(aa,"ApplicationFeatureHelper",null,[256]);var U=a(187);class K{constructor(da,Z){this.PolicySettings=
null;this.ExpirationTime=0;this.PolicySettings=da.PolicySettings;da=new Date;da.setMinutes(da.getMinutes()+Z);this.ExpirationTime=da.getTime()}}Object(t.a)(K,"CloudPolicySettingsCacheData",null,[]);var Y=a(821),na=a(377),W=a(228);class X{static pag(){return u.AFrameworkApplication.fa.qa("SideCarIsEnabled")?X.Oxc&&X.mrd?new Promise(da=>{da(!0)}):new Promise((da,Z)=>{X.Oxc=W.a.create(u.AFrameworkApplication.fa.Xa("SideCarUrl"));na.a.gja(X.Oxc);X.Oxc.g$((ha,Wa)=>{(X.mrd=Wa.succeeded)?da(Wa.succeeded):
Z(Wa.succeeded)})}):new Promise(da=>{da(!1)})}}X.mrd=!1;X.Oxc=null;Object(t.a)(X,"SideCarLoader",null,[]);class Aa{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(t.a)(Aa,"CloudPolicySettingsData",null,[]);class Q{constructor(da,Z){this.iJc=0;this.h5b=null;this.ukb=new r(da,Z);this.nb=da;Z=da.Xa("HostAuthType");this.pFa=da.qa("OcpsIsEnabled")&&da.qa("IsO365CommercialHost")&&!(void 0===Z||null===Z)&&"aad"===Z.toLowerCase();this.che=z.b(da.Xa("OcpsDefaultSettings")||
"{}");this.jlb=this.Hdc();Z=this.nb.cq("ServicesControlsMicrosoftControllerServicesList")?this.nb.Fw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.OTb=new D.a;for(let ha=0;ha<Z.length;ha++)this.OTb.add(Z[ha]);this.pFa&&!da.qa("IsAnonymousUser")&&da.qa("SideCarIsEnabled")?this.h5b=this.cVj():this.h5b=this.fpa(this.pFa,this.Vva("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.I2i,"parseCloudPolicySettingsResponse"));this.h5b.then(()=>null).catch(ha=>{ha=Object(d.a)(m,ha);c.ULS.sendTraceTag(50622685,
3004,10,"CloudPolicySettingsHelper initialization failed, HttpStatus={0}",ha?ha.K6a.toString():"Unknown")})}xF(da,Z=!0){if(!this.pFa){const ja=this;return new Promise(ua=>{ua(ja.Nxb(da))})}let ha=this,Wa=this;const ca=this.h5b.then(ja=>{try{let ua=null;ja.PolicySettings&&"unknown"in ja.PolicySettings&&(ua=ja.PolicySettings.unknown);if(ua){if(da in ua&&void 0!==ua[da]&&null!==ua[da])return new Promise(Pa=>{Pa("0"!==ua[da])});const Za=da.toLowerCase();if(Za in ua&&void 0!==ua[Za]&&null!==ua[Za])return new Promise(Pa=>
{Pa("0"!==ua[Za])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+da+" not found, using default");return new Promise(Pa=>{Pa(ha.Nxb(da))})}return new Promise(Za=>{Za(ha.Nxb(da))})}catch(ua){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+da+" policy value. Error Message: {0}",ua.message),ha.handleError(ua.toString(),Z,ha.Nxb(da))}},ja=>Wa.handleError(ja,Z,Wa.Nxb(da)));ca.then(ja=>{c.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",
da,ja);return null});return ca}isFeatureEnabled(da,Z=!0){if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.Zni(da,Z);let ha=new Promise(ca=>{ca(!0)}),Wa="";this.OTb.contains(da)&&(Wa="ControllerConnectedServicesEnabled",ha=this.xF(Wa,Z));ha.then(ca=>{c.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",da,ca,Wa);return null});return ha}Zni(da,
Z=!0){let ha=new Promise(ca=>{ca(!0)}),Wa="";"mso_sendASmile"===da?Wa="Enabled":"Survey"===da||"FloodgateSurvey"===da?Wa="SurveyEnabled":this.OTb.contains(da)&&(Wa="ControllerConnectedServicesEnabled");""!==Wa&&(ha=this.xF(Wa,Z));ha.then(ca=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",da,ca,Wa);return null});return ha}handleError(da,Z,ha){return Z?new Promise(Wa=>{Wa(ha)}):new Promise((Wa,ca)=>{ca(da)})}fpa(da,
Z,ha){if(!da)return Promise.resolve(new Aa);let Wa=!1,ca=null;l.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let ja=this.w6c("GetCloudPolicySettings");return(new Promise((ua,Za)=>{if(void 0!==this.jlb&&null!==this.jlb&&0<this.jlb.length){const Pa=this.MUj();if(void 0!==Pa&&null!==Pa){Wa=!0;ua(Pa);return}}this.ukb.$6c(Z,ha,1,null,Object(f.a)(this,this.d8i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],this.nb.ud("CloudPolicySettingsRequestQueueTimeout",
15E3),this.nb.ud("CloudPolicySettingsRequestSentTimeout",3E4)).then(Pa=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.CVj(Pa);ua(Pa);return Pa},Pa=>{Za(Pa);return null})})).then(ua=>{({stopwatch:ja,returnValue:ca}=this.MBc(ja));var Za=M.a.gs();Za&&Za.set("FromCache",Wa.toString());Za=Object.assign(new P.a,{durationMs:ca,extendedProperties:Za});l.Health.instance.recordKpiSuccess("GetCloudPolicySettings",Za);return ua})}cVj(){return X.pag().then(()=>{c.ULS.sendTraceTag(593282845,
3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}Vva(da){return String.format("{0}{1}",this.nb.Xa("WebServiceBase"),da)}I2i(da){let Z=null;({Gt:Z}=z.d(da));da=!!Z;c.ULS.sendTraceTag(50622687,3004,da?50:10,"ParseCloudPolicySettingsResponse: Success={0}",da);return Z}d8i(da){try{if(void 0!==da&&null!==da&&"CheckIn-Interval"in da){const Z=parseInt(da["CheckIn-Interval"]);void 0!==Z&&null!==Z&&0<Z&&
(this.iJc=Z)}}catch(Z){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",Z)}}Nxb(da){return da in this.che?"0"!==this.che[da]:!0}MUj(){try{const da=Y.a.instance.getItem(this.jlb);if(void 0===da||null===da)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",da);const Z=JSON.parse(da);
if(void 0===Z||null===Z)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===Z.ExpirationTime||null===Z.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(Z.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),
null;const ha=new Aa;ha.PolicySettings=Z.PolicySettings;ha.ControllerConnectedServicesFeatureNames=new U.a;this.nb.cq("ServicesControlsMicrosoftControllerServicesList")&&this.nb.Fw("ServicesControlsMicrosoftControllerServicesList");for(let Wa of this.OTb)ha.ControllerConnectedServicesFeatureNames.add(Wa);c.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return ha}catch(da){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",
da.toString()),null}}CVj(da){try{if(void 0===da||null===da||void 0===da.PolicySettings||null===da.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.iJc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{const Z=new K(da,this.iJc),ha=JSON.stringify(Z);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",ha);Y.a.instance.setItem(this.jlb,
ha);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(Z){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",Z.toString())}}Hdc(){const da=aa.Hdc(this.nb);return da&&0<da.length?"OCPS"+da:null}w6c(da){const Z=J.a.instance.yg("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==Z&&null!==Z?Z.Cc("WebServiceCall",da):null}MBc(da){if(void 0!==da&&null!==da){const Z=da.Bc;da.stop();return{returnValue:Z,
stopwatch:null}}return{returnValue:null,stopwatch:da}}}Object(t.a)(Q,"CloudPolicySettingsHelper",null,[253]);class fa{constructor(){this.OOe=this.Jlg=this.vu=0;this.POe=this.Klg=this.IIa="";this.zUc=this.kfa=2}clone(){const da=new fa;da.vu=this.vu;da.Jlg=this.Jlg;da.OOe=this.OOe;da.IIa=this.IIa;da.Klg=this.Klg;da.POe=this.POe;da.kfa=this.kfa;da.zUc=this.src;return da}get src(){return this.zUc}serialize(da=null){const Z={};if(!da||da.contains(fa.EPa))Z[fa.EPa]=this.vu;if(!da||da.contains(fa.WFb))Z[fa.WFb]=
this.IIa;if(!da||da.contains(fa.XFb))Z[fa.XFb]=this.kfa;return JSON.stringify(Z)}static create(da,Z=null){const ha=new fa;ha.zUc=da;void 0!==Z&&null!==Z&&(fa.EPa in Z&&(ha.vu=Z[fa.EPa]),fa.WFb in Z&&(ha.IIa=Z[fa.WFb]),fa.XFb in Z&&(ha.kfa=Z[fa.XFb]));return ha}static deserialize(da,Z){try{const ha=JSON.parse(da);if(void 0!==ha&&null!==ha)return fa.create(Z,ha);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",da);throw Error.argument("settingsData");
}catch(ha){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",ha.toString()),ha;}}}fa.EPa="CCS";fa.WFb="CCSTime";fa.XFb="OfficePrivacyRoamedNoticeShown";Object(t.a)(fa,"UserPrivacySettings",null,[]);var Ca=a(129);class ia{constructor(da,Z){if(void 0===da||null===da||void 0===Z||null===Z)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.nb=da;this.Ah=Z;this.RTc=this.re=null}Vva(da){var Z=String.format("{0}RoamingServiceHandler.ashx?action=",
this.nb.appSettings.RoamingServiceHandlerWebServiceBase||"");Z=new Sys.StringBuilder(Z);Z.append(da);Z.append("&");Z.append(u.AFrameworkApplication.Hi);return Z.toString()}executeRequest(da,Z,ha,Wa=null){return this.Ah.Kob(da,Z,Wa,null,ha,"33",!1,null,6E4)}saveSettings(da){return new Promise((Z,ha)=>{try{if(void 0===this.re||null===this.re||void 0===da||null===da)c.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),ha("Can't determine setting changes to save");
else{var Wa=this.re.vu!==da.vu;if(2===this.re.src&&Wa)this.qrj(da),Z(!0);else{var ca=this.bvj(da);if(void 0===ca||null===ca||!ca.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),ha("No changes to save");else if(1===this.re.src)Z(this.yhg(ca));else if(0===this.re.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",ca);const ja=this.executeRequest(this.Vva("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",
ca);ja.continueWith(()=>{if(ja.rh||ja.Of)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),Z(!1);else{var ua=ja.result;void 0!==ua.Jg&&null!==ua.Jg&&void 0!==ua.Jg.data&&null!==ua.Jg.data&&ua.Jg.data.httpStatus===n.a.wP?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),Z(!0)):(c.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),Z(!1))}})}}}}catch(ja){c.ULS.sendTraceTag(50860930,
3004,10,"SaveUserPrivacySettings: Exception = {0}",ja.toString()),Z(!1)}})}bvj(da){if(void 0===this.re||null===this.re||void 0===da||null===da)throw Error.invalidOperation("User Privacy settings have not been initialized");const Z=new U.a;0===da.src?(this.re.vu!==da.vu&&(Z.add(fa.EPa),Z.add(fa.WFb)),this.re.kfa!==da.kfa&&Z.add(fa.XFb)):1===da.src&&this.re.vu!==da.vu&&Z.add(fa.EPa);return Z.count?da.serialize(Z):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),
null)}getSettings(){if(!this.RTc){const da=this;this.RTc=new Promise(Z=>{try{da.re?Z(da.re.clone()):da.VUj().then(ha=>{da.re=ha;Z(da.re.clone());return null},()=>{da.TUj().then(ha=>{da.re=ha;Z(da.re.clone());return null},()=>{da.UUj().then(ha=>{da.re=ha;Z(da.re.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");da.re=new fa;Z(da.re.clone());return null});return null});return null})}catch(ha){c.ULS.sendTraceTag(50860932,
3004,10,"UserPrivacySettings GetSettings: Exception = {0}",ha.toString()),da.re=new fa,Z(da.re.clone())}})}return this.RTc}VUj(){return new Promise((da,Z)=>{try{const Wa=-1!==window.location.href.indexOf("&wd_pn=2");if(this.nb.qa("PrivacyDialogShouldCheckRoaming")||Wa){var ha=this.executeRequest(this.Vva("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");ha.continueWith(()=>{try{if(ha.rh||ha.Of)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");
else{const ca=ha.result;if(ca&&ca.Jg&&ca.Jg.data)if(ca.Jg.data.httpStatus!==n.a.wP)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",ca.Jg.data.httpStatus);else{if(ca.Jg.data.fe){da(ia.parse(ca.Jg.data.fe,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",ca.Jg.data.fe);return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");Z("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(ca){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",ca.toString()),Z("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),Z("Roaming should not be used")}catch(Wa){c.ULS.sendTraceTag(50860939,
3004,10,"TryGetSettingsFromRoaming Exception = {0}",Wa.toString()),Z("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}TUj(){return new Promise((da,Z)=>{try{const ha=Ca.a.get("WacUPToggleState");let Wa=null;void 0!==ha&&null!==ha&&0<ha.length&&(Wa=decodeURIComponent(ha));if(void 0!==Wa&&null!==Wa&&0<Wa.length){const ca=ia.parse(Wa,1);c.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",ca.toString());da(ca)}else{const ca=fa.create(1),
ja=new U.a;ja.add(fa.EPa);const ua=ca.serialize(ja);this.yhg(ua)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",ua),da(ca)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",ua),Z("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(ha){c.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",
ha.toString()),Z("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}UUj(){return new Promise(da=>{try{var Z=-1!==window.location.href.indexOf("&wdccsoff=1");let ha=fa.create(2);Z?(ha.vu=2,u.AFrameworkApplication.uNe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",ha.toString())):(ha.vu=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",ha.toString()));da(ha)}catch(ha){c.ULS.sendTraceTag(50967431,
3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",ha.toString()),Z=fa.create(2),Z.vu=1,da(Z)}})}qrj(da){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===da.vu?u.AFrameworkApplication.uNe():u.AFrameworkApplication.jsh();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",da)}yhg(da){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",da);const Z=
this.nb.Xa("PrivacyCookieDomain")||"";if(!Z||!Z.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",da);return Ca.a.RTd("WacUPToggleState",da,Ca.a.nW,"/",Z)}catch(Z){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",Z.toString()),!1}}isFeatureEnabled(da){return this.getSettings().then(Z=>{const ha=this.nb.cq("ServicesControlsMicrosoftControllerServicesList")?
this.nb.Fw("ServicesControlsMicrosoftControllerServicesList"):[],Wa=new D.a;for(let ca=0;ca<ha.length;ca++)Wa.add(ha[ca]);return Wa.contains(da)?2!==Z.vu:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",da);return!0})}static parse(da,Z){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",da,Z),fa.deserialize(da,Z)}catch(ha){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",ha.toString()),
ha;}}}Object(t.a)(ia,"UserPrivacySettingsHelper",null,[254]);var Ra=a(249);class Ya{constructor(){this.$a=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Oh(da){this.$a=da;this.$a.register(253,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").wc().Ac(()=>new Q(u.AFrameworkApplication.fa,u.AFrameworkApplication.zd));this.$a.register(254,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").wc().Ac(()=>new ia(u.AFrameworkApplication.fa,
u.AFrameworkApplication.zd));this.$a.register(255,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").wc().Ac(()=>new y(u.AFrameworkApplication.fa,u.AFrameworkApplication.zd));this.$a.register(256,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").wc().Ac(()=>new aa(u.AFrameworkApplication.fa,u.AFrameworkApplication.zd,this.$a.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.$a.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
u.AFrameworkApplication.ub))}init(){u.AFrameworkApplication.fa.Iu(()=>{const da=this.$a.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");u.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&(da.isFeatureEnabled("LicensingTestFeature",!1).then(Z=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",Z,u.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}),da.getFeatureTier("LicensingTestFeature",
0).then(Z=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",Z,u.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}));this.$a.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.UPj()})}dispose(){}UPj(){try{u.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&X.pag().then(da=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
da);return da})}catch(da){}}static main(){Ra.a.instance.vi(new Ya)}}Object(t.a)(Ya,"ApplicationFeatureHelperPackage",null,[4,5]);a.d(E,"a",function(){return Ga});const Ga=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");Ya.main()}},1159:function(t,E,a){var c=a(9);t=a(0);var b=a(222),e=a(15),f=a(1363),d=a(637),h=a(550),m=a(27),l=a(89),w=a(30),n=a(156),x=a(235),r=a(8),u=a(58),v=a(154),B=a(348),z=a(47),A=a(46),y=a(29),D=a(1),I=a(22),M=a(13),T=a(104),
S=a(83),H=a(84),C=a(146),G=a(4),J=a(14),L=a(96),P=a(45),aa=a(1077);class U extends C.a{constructor(pb,Qb=!0){super(!1,!1,U.$u);this.wYa=null;this.Z$d=!1;this.qn=[];this.Uj=null;this.WZb=pb;this.EDg=Qb;this.ew=this.Eme=!1;this.$ga=null;this.tLc=!1;this.og=this.Umh;this.Ee="InsertFileDialog";this.qc(1,this.t_b);U.$u?(this.wYa={["id"]:this.Ee,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(H.a)(this,this.M_i,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,
["onFrameReady"]:Object(H.a)(this,this.BRi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(H.a)(this,this.qhc,"insertDialogHandler"),this.wYa),this.oUb=!0):(this.showDialog(this.titleText,Object(H.a)(this,this.qhc,"insertDialogHandler")),Qb&&this.d7f(),(pb=this.rK(1))&&this.qn.push(pb),(pb=this.rK(0))&&this.qn.push(pb),this.ikg(),this.oUb=!1)}get f1j(){return this.WZb}validate(){this.Uj.rF||e.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Uj.rF.value?
!0:(U.iA(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}BRi(pb){this.EDg&&(this.Uj=this.c7f(pb,this.WZb))}M_i(){this.Uj&&this.Uj.rF&&(this.Z$d||(this.Uj.Yej(Object(H.a)(this,this.$Dd,"onFileChosen")),this.Z$d=!0),this.Uj.tYe())}$Dd(pb){this.wYa.uploadStatusLabel=pb;this.kVa(this.titleText,Object(H.a)(this,this.qhc,"insertDialogHandler"),this.wYa)}qhc(pb){1===pb&&this.isEnabled()?U.$u&&this.Uj.rF&&!this.Uj.rF.value?(this.wYa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.kVa(this.titleText,
Object(H.a)(this,this.qhc,"insertDialogHandler"),this.wYa)):(this.vzb(),this.WZb.finalizeUpload(this.Uj,Object(H.a)(this,this.dispose,"dispose"))):0===pb&&this.hide()}d7f(){this.tLc=!1;this.Uj=this.c7f(document.getElementById("uploadFrameContainer"),this.WZb);G.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.$ga=Object(H.a)(this,this.SFd,"onUploadFrameLoad"),P.a.addHandler(this.Uj.iFrame,"load",this.$ga));this.Uj.rF||e.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");
this.eQf()}SFd(){this.eQf()}eQf(){if(this.Uj&&!this.tLc){var pb=this.Uj.rF;pb&&(P.a.addHandler(pb,J.a.Pb,Object(H.a)(this,this.onKeyDown,"onKeyDown")),pb=[pb],this.qn=pb.concat.apply(pb,this.qn),this.ikg(),this.tLc=!0)}}dispose(){if(this.Uj&&!U.$u){const pb=this.Uj.rF;pb&&P.a.removeHandler(pb,J.a.Pb,Object(H.a)(this,this.onKeyDown,"onKeyDown"));this.$ga&&P.a.removeHandler(this.Uj.iFrame,"load",this.$ga)}this.Uj=null;super.dispose()}ikg(){if(0<this.qn.length){const pb=new aa.a(this.qn),Qb=L.FocusManager.instance().TQ();
Qb&&(this.qn[0].focus(),Qb.hf=pb,Qb.c0=!0)}}onKeyDown(pb){4!==L.FocusManager.instance().gQf(pb)&&pb.preventDefault()}static get $u(){return G.AFrameworkApplication.ta.Pa.Lv&&G.AFrameworkApplication.ta.Pa.omf}static iA(pb){const Qb=document.getElementById("errorText");Qb.innerText=pb;Qb.style.display="inline-block"}}Object(t.a)(U,"InsertFileDialog",C.a,[]);class K{static get og(){return C.a.jq(K.nl,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}K.nl="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(t.a)(K,"InsertImageDialogHtml",null,[]);class Y extends U{constructor(pb,Qb=!0){super(pb,Qb)}get t_b(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get Umh(){return K.og}validate(){this.Uj.rF||e.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const pb=Object(S.a)(f.a,this.f1j),Qb=pb.nmg(this.Uj.rF.value);return 0!==Qb?(U.iA(pb.N3e(Qb)),!1):!0}}Object(t.a)(Y,"InsertImageDialog",U,[]);var na=a(555);const W=
(pb,Qb,xb)=>{if(pb){var pa=0;do{try{pb();break}catch(Ma){if(e.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",pa,xb,Ma.message,Ma.stack),pa>=Qb)break}pa++}while(1)}};var X=a(107),Aa=a(87),Q=a(41),fa=a(253),Ca=a(201),ia=a(80),Ra=a(465),Ya=a(171);class Ga{constructor(pb,Qb,xb,pa,Ma,ya,Ea,Na,kb=!0,lb=null,oa=!1){this.AYe="FileUpload.ashx";this.so=null;this._initialized=!1;this.Ig=this.Pjb=this.sLc=this.$ga=this.NUb=this.lr=this.it=
null;this.Km=!1;this.tE=this.OUb=this.KVc=null;this._parent=pb;this.wyg=Qb;this.VCg=xb;this.Eae=Ma;this.OTc=Ea;this.L5d=Na;this.I7d=lb;this.JVc=!1;this.Tyg=pa.qa("CanaryRenewalForFileUploadIsEnabled");this.zlg=!1;(this.rra=oa)||this.obh(ya);kb&&this.dgf()}get k_f(){return this.VCg}get sessionId(){return this.OTc}get iFrame(){return this.so}get rF(){return this.lr}get C$a(){return G.AFrameworkApplication.fa?G.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}get uYe(){return G.AFrameworkApplication.fa?
G.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}get aqi(){return this.rra?!1:Ca.b(this.so.contentWindow.location.pathname,this.AYe,0)}get cRg(){return!m.a.ula&&G.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}dgf(){this.tE=Ya.a.create().toString();this.rra?this.Aad():this.fSg()}obh(pb){this.so=document.createElement("iframe");this.so.className=pb;this.so.id=pb;this.Eae&&(this.so.style.visibility="visible",this.so.style.height="30px",this.so.setAttribute("frameborder",
"0"));this.$ga=Object(H.a)(this,this.SFd,"onUploadFrameLoad");P.a.addHandler(this.so,"load",this.$ga)}l9b(pb=null){G.AFrameworkApplication.ta.ptc();if(!this.lr)return e.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";P.a.addHandler(this.lr,"change",()=>{this.WFh(pb)});W(Object(H.a)(this,this.tYe,"fileInputClick"),1,"DoFileOpenDialog");return this.lr.value}WFh(pb){pb&&pb(this.lr.value)}XFh(){this.NUb&&(this.NUb.innerText=this.f5e())}Yej(pb){P.a.addHandler(this.lr,"change",()=>{pb(this.f5e())})}f5e(){let pb=
null;if(this.lr.value){const Qb=this.lr.value,xb=Qb.lastIndexOf("\\");0<xb&&(pb=Qb.substring(xb+1,Qb.length))}return pb?pb:""}tYe(){try{e.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.lr.click()}catch(pb){throw e.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",pb.message),pb;}}KNj(){this.mti()?this.Zcg():(this.C2d(),this.it.submit())}mti(){return(this.Tyg||this.rra)&&!(void 0===window.self.FormData||null===window.self.FormData)}t3f(pb){if(pb){const Qb=
this.eIe();this.Ig=new XMLHttpRequest;this.Ig.open("POST",Qb);this.Ig.setRequestHeader("X-CorrelationId",this.tE);this.GBi(pb);this.Ig.onreadystatechange=Object(H.a)(this,this.rpa,"uploadResponseReceived");this.Ig.send(pb)}}GBi(pb){if(!m.a.ula&&pb.get){var Qb=pb.get("ImageId");pb=window.self.navigator;Qb={["CorrelationId"]:this.tE,["Canary"]:G.AFrameworkApplication.canary,["ImageNodeId"]:Qb};pb&&(pb=pb.connection?pb.connection:pb.mozConnection?pb.mozConnection:pb.webkitConnection?pb.webkitConnection:
null)&&(Qb.effectiveType=pb.effectiveType,Qb.downlink=pb.downlink,Qb.type=pb.type,Qb.rtt=pb.rtt);e.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",Qb)}}Zcg(){try{this.C2d();e.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const pb=new (Type.parse("FormData"))(this.it);this.t3f(pb)}catch(pb){e.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+pb.message),this.Qab(null)}}Ycg(pb){try{if(this.C2d(),
e.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.Y2j(pb)){this.OUb=pb;this.it.contains(this.lr)&&this.it.removeChild(this.lr);var Qb=new (Type.parse("FormData"))(this.it);Qb.append("applicationfileInput",pb.blob,pb.filename);this.t3f(Qb)}else this.Qab(null)}catch(xb){e.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+xb.message),this.Qab(null)}}Y2j(pb){return pb&&void 0!==pb.blob&&null!==pb.blob&&
void 0!==pb.filename&&null!==pb.filename&&""!==pb.filename?void 0===window.self.FormData||null===window.self.FormData?(e.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(pb=pb?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===pb.blob||null===pb.blob,void 0===pb.filename||null===pb.filename||""===pb.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",e.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
pb)),!1)}rpa(){if(4===this.Ig.readyState)if(200===this.Ig.status){e.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.tE);const pb=this.Ig.getResponseHeader("X-NewKey"),Qb=this.Qli(this.Ig);let xb=!1;if(void 0!==pb&&null!==pb&&Qb&&(xb=this.M2j(pb),!this.JVc&&xb)){e.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.tE);this.JVc=!0;void 0!==this.OUb&&
null!==this.OUb?this.Ycg(this.OUb):this.Zcg();return}e.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.JVc,Qb,!(void 0===pb||null===pb),xb,this.tE);this.Qab(this.Ig.responseText)}else e.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Ig.status,this.Ig.responseText?!1:!0,this.tE),this.Qab(null)}Qli(pb){try{const Qb=
Q.a(pb.responseText).Responses;if(void 0!==Qb&&null!==Qb&&1===Qb.length){const xb=Qb[0];if(void 0!==xb&&null!==xb&&2===xb.length&&28===xb[1].StatusCode)return!0}}catch(Qb){}return!1}M2j(pb){Ra.a.ijg(pb);return G.AFrameworkApplication.canary!==pb?!1:!0}C2d(){this.KVc||(this.KVc=new Date)}dispose(){this.Km||(this.rra?this._parent.removeChild(this.it):(this._parent.removeChild(this.so),P.a.removeHandler(this.so,"load",this.$ga),this.$ga=null),this.sLc&&(P.a.removeHandler(this.lr,"change",this.sLc),this.sLc=
null),this.uYe&&(this.Pjb&&(P.a.removeHandler(this.lr,"change",this.Pjb),this.Pjb=null),this.NUb=null),this.lr=this.it=this._parent=this.so=null,this.Km=!0,this.KVc=null,e.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}Tdh(pb){if(this.it){var Qb;(Qb=this.it.querySelector("input[name=__REQUESTDIGEST]"))?Qb.value=pb:(Qb=this.c7c(),Qb.type="hidden",Qb.id="__REQUESTDIGEST",Qb.name="__REQUESTDIGEST",Qb.value=pb,this.it.appendChild(Qb))}}c7c(){return this.rra?
document.createElement("input"):this.so.contentWindow.document.createElement("input")}SFd(){try{if(!this.so.contentWindow.document.body)return}catch(Qb){this.T$h();return}if(!(this._initialized||this.C$a&&m.a.SF))this.Aad();else if(!this.C$a||!m.a.SF||this.aqi){let Qb;Qb=m.a.Jv?this.so.contentWindow.document.body.innerText:this.zlg?this.so.contentWindow.document.body.firstChild.innerText:this.so.contentWindow.document.body.firstChild.innerHTML;var pb=this.so.contentWindow.document.body.innerText.toLowerCase();
const xb=0<=pb.indexOf("responses")||0<=pb.indexOf("wopisrc");pb=0<=pb.indexOf("http error");!xb&&pb&&e.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.so.contentWindow.document.body.innerText);this.Qab(Qb)}}Aad(){if(!this._initialized){var pb=this.ga("uploadForm");const Qb=this.ga("fileInput"),xb=this.eIe();this.xdh();this.it.id=pb;this.it.method="post";this.it.encoding="multipart/form-data";this.it.action=xb;this.lr.type="file";this.L5d&&(this.lr.accept=
this.L5d,this.I7d&&(this.lr.capture=this.I7d));this.lr.id=Qb;this.lr.name=Qb;this.cRg&&(this.lr.multiple=!0);!this.uYe||m.a.Jv||m.a.aI||(this.Pjb=Object(H.a)(this,this.XFh,"fileInputChangedHandleAccessibility"),P.a.addHandler(this.lr,"change",this.Pjb),this.NUb=Aa.a.zve(this.it,this.lr,"InputFileDescription"));this.Eae&&(this.rra||(pb=this.so.contentWindow.document.body,pb.style.margin="0",pb.style.overflow="hidden"),pb=G.AFrameworkApplication.ta,this.lr.style.fontFamily=pb.B1,this.lr.style.fontSize=
pb.WDc,this.lr.style.margin="0");(pb=document.getElementById("__REQUESTDIGEST"))&&this.Tdh(pb.value);this.it.appendChild(this.lr);this._initialized=!0;this.wyg(this)}}xdh(){if(this.rra)this.it=document.createElement("form"),this._parent.appendChild(this.it),this.lr=document.createElement("input");else{this.it=this.so.contentWindow.document.createElement("form");const pb=this.so.contentWindow.document;pb.body.appendChild(this.it);this.lr=pb.createElement("input")}}fSg(){this._parent.appendChild(this.so);
this.C$a&&m.a.SF&&this.Aad()}eIe(){var pb=new fa.QueryStringBuilder(this.AYe);G.AFrameworkApplication.MZa(pb);this.Svj(pb);pb=pb.toString();if(m.a.Jf||m.a.SF||m.a.aI)pb=ia.a.Z0e(pb);return pb}fqe(){const pb=new X.a(2,1,0,Object(H.a)(this,this.delayedDispose,"delayedDispose"),4);G.AFrameworkApplication.Fi.Eg(pb)}}Object(t.a)(Ga,"UploadFrame",null,[3]);var da=a(40),Z=a(116),ha=a(21);class Wa extends Ga{constructor(pb,Qb,xb,pa,Ma,ya,Ea=!1){super(pb,Qb,xb,pa,Ma,"UploadFrame",ya.ea.sessionId,"image/*",
!1,null,Ea);this.$=ya;this.zlg=!0;this.dgf()}ga(pb){return pb}Svj(pb){e.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");Z.a.JZc(pb,this.$.ya);pb.b$(r.a.sessionId,this.sessionId);var Qb=ha.h(this.$).ha;Qb=da.o(Qb.ra.H4,this.$);pb.b$(r.a.q9i,this.$.va.na.name);pb.b$(r.a.p9i,Qb.FirstRow.toString());pb.b$(r.a.o9i,Qb.FirstColumn.toString())}T$h(){this.k_f("ServerUploadError")}Qab(pb){this.k_f(pb)}static Vni(pb){return!pb||I.a.equals(pb,"ServerUploadError",!1)}}Object(t.a)(Wa,
"UploadFrameWrapper",Ga,[]);class ca extends Y{constructor(pb,Qb,xb,pa){super(pb,!1);this.HQ=null;this.TBa=!1;this.htmlSanitizationHelper=null;this.Rpc=()=>{this.P1d("");this.jEc();return!1};this.$=Qb;this.vFc=pb;this.iR=na.a.instance;this.fa=xb;this.htmlSanitizationHelper=pa;this.d7f();this.gpd();this.$.rb.Mv=!0}c7f(pb,Qb){return new Wa(pb,Object(H.a)(Qb,Qb.vHb,"onUploadFrameInitialized"),Object(H.a)(Qb,Qb.rpa,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.jEc();this.iR=this.vFc=null;
super.dispose()}hide(){super.hide();this.$.rb.Mv=!1}validate(){var pb=this.vFc.j3d(this.Uj.rF.value,this.vFc.ehg(this.Uj));return 0!==pb?(pb=this.vFc.shd(pb).Description,this.P1d(pb),this.MYd(),!1):!0}isEnabled(){return!0}P1d(pb){D.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&D.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")&&this.htmlSanitizationHelper?this.htmlSanitizationHelper.$4f(this.HQ,pb):this.HQ.innerHTML=pb}gpd(){this.HQ=
document.getElementById("errorText");this.HQ.style.display="inline-block";this.TBa=!1;this.P1d("");this.xJa.style.maxWidth=this.xJa.currentStyle.minWidth}MYd(){this.iR.sa(J.a.click,this.Uj.rF,this.Rpc);this.iR.sa(J.a.Pb,this.Uj.rF,this.Rpc);this.TBa=!0}jEc(){this.TBa&&(this.iR.Ba(J.a.click,this.Uj.rF,this.Rpc),this.iR.Ba(J.a.Pb,this.Uj.rF,this.Rpc),this.TBa=!1)}}Object(t.a)(ca,"InsertImageDialogWrapper",Y,[]);var ja=a(51),ua=a(55),Za=a(48),Pa=a(37);class ka extends f.a{constructor(pb,Qb,xb,pa,Ma=
!0){super(null,Qb,xb);this.rja=this.Zt=null;this.T8a=!1;this.xHd=null;this.rpa=ya=>{this.$3d.stop();this.v2b.cancel();if(Wa.Vni(ya))this.jDc?this.qaf(4):(ya=new d.a(0,2,null,null,!1,null,null,null),ya.status=8,this.q0d(new h.a(ya),null,"InsertPictureWebMethod")),e.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.jDc}`);else{const Ea=ka.b3j(ya);0!==Ea?(e.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${ya}`),this.qaf(Ea)):this.G$h(ya)}this.Grc();this.dispose()};
this.UQi=ya=>{this.RCa(ya,this.Uj)&&this.finalizeUpload(this.Uj,null)};this.vHb=ya=>{e.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Uj=ya;if(!this.R2a){if(this.K2d){if(this.sBe()||this.C$a&&m.a.SF){ya.l9b(this.UQi);return}const Ea=ya.l9b(null);if(!this.RCa(Ea,ya))return}this.finalizeUpload(ya,null)}};this.e_i=()=>{this.jDc=!0};this.jb=pb;this.$3d=pb.Kb.Qg("WebServiceCall","InsertPictureOperation");this.v2b=z.a.instance.create(this.e_i,1E5,A.a.AVg,!1);this.jDc=!1;this.Cnc=this.$.ya.InsertPictureMaxFileSizeBytes;
pa&&(this.T8a="TestOnly"in pa);Ma&&this.showDialog()}get $(){return this.jb}get $Fi(){return this.Cnc/1024/1024}dispose(){l.a.Ia(this.v2b);this.Uj&&this.Uj.fqe();this.Uj=this.v2b=this.jb=null}ccj(pb){if(!this.$)return e.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),ua.Task.Ra(!0);if(!this.$.Zba)return ua.Task.Ra(!0);const Qb=new n.a,xb=new FileReader;pb=pb.rF.files[0];const pa=()=>{Qb.tx(!0)};xb.onload=()=>{this.xHd=xb.result;Qb.tx(!0)};xb.onerror=pa;xb.onabort=pa;
xb.readAsDataURL(pb);return Qb.task}ehg(pb){let Qb=-1;pb=pb.rF;(null===pb||void 0===pb?0:pb.files)&&0<pb.files.length&&(Qb=pb.files[0].size);return Qb}j3d(pb,Qb){let xb=ka.jah(f.a.RCa(pb));0===xb?-1!==Qb&&(e.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${Qb}, maxAllowedSize: ${this.Cnc}, remainingWorkbookSize: ${this.$.ea.qqf}`),Qb>this.Cnc?xb=3:Qb>this.$.ea.qqf&&(xb=7)):6===xb&&this.NDi(pb);e.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${xb}`);
return xb}RCa(pb,Qb){pb=this.j3d(pb,this.ehg(Qb));return 0!==pb?(this.R2a||1===pb||this.oWd(pb),!1):!0}ygg(pb){pb.KNj()}shd(pb){let Qb=0,xb=1,pa=-1100324317,Ma="InsertPictureUnknownError",ya=null;switch(pb){case 1:Qb=1749;xb=0;pa=940870981;Ma="InsertPictureNoFileSelected";break;case 3:xb=0;pa=1250467391;Ma="InsertPicturePictureTooBig";ya=String.format(M.a.instance.mb(181),this.$Fi.toLocaleString());break;case 6:Qb=1753;xb=0;pa=1380041209;Ma="InsertPictureUnsupportedFormat";break;case 7:Qb=1750;xb=
0;pa=-903115058;Ma="InsertPictureExceedWorkbookSize";break;case 4:Qb=1751;xb=0;pa=1218352119;Ma="InsertPictureUploadTimeout";break;case 5:Qb=1752,xb=0,pa=1979899005,Ma="InsertPictureServiceNonDeterministicError"}pb=ka.dd(Qb,xb,pa,Ma);ya&&(pb.Description=ya);return pb}showDialog(){if(this.sBe())this.R2a=!1,this.Uj=new Wa(this.$.domElement,this.vHb,this.rpa,this.fa,!1,this.$,!0);else if(e.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.T8a&&(m.a.Lw||m.a.SF&&72>m.a.CDe))this.R2a=
!1,this.Uj=new Wa(this.$.domElement,this.vHb,this.rpa,this.fa,!1,this.$);else{this.R2a=!0;const pb=D.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&D.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")?Za.GetServiceTaskFactory.Na(this.$.da,498,499,0):x.a.Ra(null);Pa.TaskExtensions.za(pb,()=>{this.Uj=(new ca(this,this.$,this.fa,pb.result)).Uj},this.$.ka,3)}}G$h(pb){let Qb={};try{if(Qb=u.a.$h(pb),ja.b().BC(this.$3d.id,Qb.ServerCorrelationId,
"actions","ServerActions"),!y.a.dg(Qb.Errors)&&Qb.Result){this.$.ea.NX(Qb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const xb=Qb.Result;T.a(this.$).Tna(1,xb);const pa=this.$.da.Aa(277);pa&&pa.xXc(this.$,1,Qb.Result,Qb,"InsertPicture");e.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(xb){e.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${pb?pb.length:-1}, errror: ${xb}`)}this.KDc(Qb,
null,"InsertPictureWebMethod")}qaf(pb){pb=this.shd(pb);const Qb={};Qb.Errors=[pb];this.KDc(Qb,null,"InsertPictureWebMethod")}KDc(pb,Qb,xb){this.Zt(pb,Qb,xb)}q0d(pb,Qb,xb){this.rja(pb,Qb,xb)}oWd(pb){pb=this.shd(pb);D.EwaSettings.Lz()?new B.a(this.$,pb):(new v.ErrorDialog(this.$,pb)).vg()}NDi(pb){const Qb=this.$.ya.InsertPicturUnsupportedExtensionsForLogging;pb=w.a.wl(pb);for(let xb=0;xb<Qb.length;++xb)if(pb.endsWith(Qb[xb])){e.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${Qb[xb]}`);
break}}static b3j(pb){return!pb||I.a.equals(pb,r.a.insertPictureUnknownError,!0)?2:I.a.equals(pb,r.a.insertPictureNoFileSelectedError,!0)?1:I.a.equals(pb,r.a.zii,!0)?3:I.a.equals(pb,r.a.Aii,!0)?5:0}static dd(pb,Qb,xb,pa){return y.a.dd(1,0,0,pb,Qb,xb,pa)}static jah(pb){switch(pb){case 1:return 1;case 2:return 6}return 0}sBe(){return this.T8a||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(t.a)(ka,"BasePictureUploaderWrapper",f.a,[3]);class ra extends ka{constructor(pb,Qb,
xb,pa,Ma,ya=!0){super(pb,Qb,xb,pa,!1);this.bGh=Ma;this.Tac=pb.Kb.Qg("LoadResource","FileReaderUploaderLoadResource");ya&&this.showDialog()}qHj(){this.Cnc=28E5;this.oWd(3)}Fdd(pb){e.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const Qb=new FileReader;pb=pb.rF.files;if(0==pb.length)e.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var xb=pb[0];Qb.onload=()=>{this.Tac.stop();this.bGh.zZi(Qb.result,
this);e.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${xb.type}, Size:${xb.size.toString()}`)};Qb.onerror=()=>{this.Tac.stop();e.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${xb.type}, Size:${xb.size.toString()}`)};Qb.onabort=()=>{this.Tac.stop();e.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${xb.type}, Size:${xb.size.toString()}`)};
this.Tac.start();Qb.readAsDataURL(xb)}}finalizeUpload(pb,Qb){this.Fdd(pb,Qb)}}Object(t.a)(ra,"FileReaderUploaderWrapper",ka,[833]);var ba=a(374),Ua=a(188);class Ka{constructor(pb,Qb){this.dataUri=this.sheetName=null;this.sheetName=pb;this.dataUri=Qb}getSheetName(){return this.sheetName}}Object(t.a)(Ka,"MacroRecorderPictureInsertedPayload",null,[145]);class Oa extends ka{constructor(pb,Qb,xb,pa,Ma,ya=!0){super(pb,xb,pa,Ma,!1);this.Wd=Qb;ya&&this.showDialog()}Fdd(pb,Qb){super.finalizeUpload(pb,Qb);
ba.a(this.$.userOperationManager,(xb,pa)=>{this.Zt=xb;this.rja=pa;this.$3d.start();this.v2b.vq();this.jDc=!1;this.ygg(pb);return this.ccj(pb)},xb=>{const pa={};this.$.pk(pa);const Ma=pa.SheetName;xb=new Ua.a(510,0,xb,72,()=>new Ka(Ma,this.xHd?this.xHd:""));xb.qBa(()=>!0);xb.Wd=this.Wd;return xb},this.Wd)}finalizeUpload(pb,Qb){this.Fdd(pb,Qb)}}Object(t.a)(Oa,"PictureUploaderWrapper",ka,[]);class ib{constructor(pb,Qb){this.filename=pb;this.blob=Qb}}Object(t.a)(ib,"UploadBlobParameters",null,[]);class La extends Oa{constructor(pb,
Qb,xb,pa,Ma,ya,Ea){super(pb,Qb,xb,pa,Ma,!1);this.K2d=!1;this.bJ=Ea;this.Mgc=La.WLh(ya);pb=this.j3d(this.Mgc.name,this.Mgc.size);0!==pb?(this.oWd(pb),this.bJ.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Uj=new Wa(this.$.domElement,this.vHb,this.rpa,pa,!1,this.$)}q0d(pb,Qb,xb){super.q0d(pb,Qb,xb);this.bJ.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}KDc(pb,Qb,xb){super.KDc(pb,Qb,xb);y.a.dg(pb.Errors)?
this.bJ.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${y.a.sc(pb.Errors)}`)):this.bJ.setResult(!0)}ygg(pb){const Qb=new ib(this.Mgc.name,this.Mgc);pb.Ycg(Qb)}static WLh(pb){var Qb=pb.split(",");pb=Qb[0].includes("base64")?window.self.atob(Qb[1]):window.self.decodeURI(Qb[1]);Qb=Qb[0].split(":")[1].split(";")[0];const xb=new Uint8Array(pb.length);for(let pa=0;pa<pb.length;pa++)xb[pa]=pb.charCodeAt(pa);pb=new Blob([xb],{type:Qb});
pb.name="Image.png";return pb}}Object(t.a)(La,"DataUrlUploaderWrapper",Oa,[]);class db{constructor(){}jhi(pb,Qb,xb,pa,Ma){new Oa(pb,Qb,xb,pa,Ma,!0)}jgi(pb,Qb,xb,pa,Ma,ya){new La(pb,null,Qb,xb,pa,Ma,ya)}ugi(pb,Qb,xb,pa,Ma){new ra(pb,Qb,xb,pa,Ma,!0)}}Object(t.a)(db,"UploaderCreator",null,[773]);class Ab extends b.a{constructor(pb){super();this.$=pb;this.Fb()}static la(pb){pb.da.Ga(485,new Ab(pb))}create(){var pb;this.ob(null!==(pb=this.$.da.Aa(484))&&void 0!==pb?pb:this.$.da.Ga(484,new db))}}Object(t.a)(Ab,
"UploaderCreatorFactory",b.a,[]);a.d(E,"a",function(){return Mb});const Mb=()=>{c.a.Fa(pb=>{Ab.la(pb)})}},1193:function(t,E,a){var c=a(9);t=a(0);var b=a(695),e=a(156),f=a(103),d=a(4),h=a(184),m=a(15),l=a(1363),w=a(30),n=a(98),x=a(82),r=a(557),u=a(171),v=a(40),B=a(374),z=a(188),A=a(284),y=a(29),D=a(283),I=a(11),M=a(13),T=a(282),S=a(104),H=a(21),C=a(146),G=a(87),J=a(96),L=a(164),P=a(181),aa=a(88),U=a(154),K=a(348),Y=a(1),na=a(1241),W=a(80);class X extends na.a{constructor(ja,ua){super(ja,W.a.nba(ua))}Quc(ja,
ua){this.isEnabled()&&this.CGa(this.targetOrigin)&&(this.vo(ja),this.em(ja,ua))}}Object(t.a)(X,"InsertMediaCrossDocumentMessenger",na.a,[826,294,3]);var Aa=a(7);class Q{}Object(t.a)(Q,"OnlineMediaSearchResult",null,[]);var fa=a(317);class Ca extends C.a{constructor(ja,ua,Za,Pa,ka,ra){super();this.jjc=!1;this.MDb=this.ZR=this.cxa=null;this.PNi=()=>{this.fva(this.y0a)};this.Lvd=ba=>{ba.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==ba.target.id||ba.shiftKey?"KeepFocusStartDiv"===ba.target.id&&ba.shiftKey&&
(ba.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(ba.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};this.ZUi=()=>{this.zpb&&(this.zpb.launchUpsellExperience("stockimages"),m.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.Ql=ra;this.$=ja;this.ugf=ua;this.zpb=Za;this.bBa=[];this.vwf=Pa;this.Vmh=ka;this.uue=this.$.ya.InsertOnlinePictureMaxCountOfImagesToInsert;this.og=this.geh()}QHj(ja){this.jjc=!1;this.showDialog(this.Ql,
null);this.cxa=document.getElementById(this.mi("InsertMediaFrame"));if(!this.cxa)throw this.fva(this.y0a),Error.invalidOperation("Couldn't get InsertMediaIframe.");var ua=document.getElementById(this.mi("WACDialogPanel"));ua&&ua.setAttribute(G.a.Ad,G.a.P_a);ua=document.createElement("div");ua.id="KeepFocusStartDiv";ua.tabIndex=0;ua.className="keep-focus-start";this.cxa.parentNode.insertBefore(ua,this.cxa.parentNode.firstChild);ua=document.createElement("div");ua.id="KeepFocusDiv";ua.tabIndex=0;ua.className=
"keep-focus";this.cxa.parentNode.appendChild(ua);$addHandler(this.xJa,"keydown",this.Lvd);this.cxa.src=this.ugf;this.cxa.frameBorder="0";ua=document.getElementById(this.mi("WACDialogButtonPanel"));if(!ua)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");ua.className="display-none";ua=document.getElementById(this.mi("WACDialogTitleText"));if(!ua)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");ua.className="display-none";2===this.vwf&&(document.getElementById(this.mi("WACDialogTitlePanel")).className=
"display-none",document.getElementById(this.mi("WACDialogBodyPanel")).className="padding-zero");J.FocusManager.instance().TQ().scope.WN=!0;this.ZR=new X(this.cxa.contentWindow,this.ugf);this.ZR.Quc(L.a.yJg,Za=>{this.FMi(Za,ja.rpa)});this.ZR.Quc(L.a.insert,()=>{this.lUi(ja.rpa)});this.ZR.Quc(L.a.a2c,this.PNi);2===this.vwf&&0===this.Vmh&&(this.ZR.Quc(L.a.lyi,this.ZUi),this.MDb=this.zpb.qna("MsoPremiumStockImages",Za=>{m.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");
Za.isEnabled?this.ZR.Sj(L.a.$0j,{["LicenseTier"]:Za.toString()}):m.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.bBa=null;this.zpb&&this.MDb&&this.zpb.zMd("MsoPremiumStockImages",this.MDb);this.ZR&&(this.ZR.dispose(),this.ZR=null);super.dispose()}hide(){super.hide();aa.a.fzc(this.$)}get I4(){return P.a.I8b+"/InsertMediaDialog"}get hZ(){return!1}FMi(ja,ua){ja=ja&&ja.Values?(ja=ja.Values)?Object(Aa.a)(new Q,{Action:ja.action||
"",Caption:ja.caption||"",ContentType:ja.contentType||"",FileExtension:ja.extension||"",PageUrl:ja.pageUrl||"",SourceUrl:ja.sourceUrl||"",ThumbnailUrl:ja.thumbnailUrl||"",LicenseUrl:ja.licenseUrl||"",LicenseDisplayName:ja.licenseDisplayName||"",Height:ja.height||0,Width:ja.width||0}):null:null;ja&&(this.bBa.push(ja),this.jjc&&(m.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),ua(this.bBa),this.jjc=!1,this.fva(this.y0a)))}lUi(ja){this.bBa&&0<this.bBa.length?
this.bBa.length<=this.uue?(ja(this.bBa),this.fva(this.y0a)):(this.iA(),m.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.bBa.length=0):this.jjc=!0}geh(){const ja=document.createElement("div");ja.id="InsertMediaDialog";ja.className=Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const ua=document.createElement("div");ua.id="InsertMediaPanel";
ua.className=Y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":"insert-media-panel-old";const Za=document.createElement("iframe");Za.id="InsertMediaFrame";Za.className="insert-media-frame";ja.appendChild(ua);ua.appendChild(Za);return fa.b(ja)}iA(){const ja=y.a.dd(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");ja.Description=String.format(M.a.instance.mb(206),this.uue.toLocaleString());Y.EwaSettings.Lz()?new K.a(this.$,
ja):(new U.ErrorDialog(this.$,ja)).vg()}}Object(t.a)(Ca,"InsertMediaDialog",C.a,[]);var ia=a(380),Ra=a(290);class Ya extends l.a{constructor(ja,ua,Za,Pa,ka,ra){super(null,Za,Pa);this.Wtf=0;this.rpa=ba=>{if(ba){var Ua=Array(ba.length);for(var Ka=0;Ka<ba.length;Ka++){const La=ba[Ka];Ua[Ka]={};Ua[Ka].SourceUrl=La.SourceUrl;w.a.Fxa(La.LicenseUrl)&&w.a.Fxa(La.PageUrl)&&(Ua[Ka].LicenseUrl=La.LicenseUrl,Ua[Ka].LicenseDisplayName=La.LicenseDisplayName,Ua[Ka].PageUrl=La.PageUrl);Ua[Ka].AltText=-2053056795===
this.Wd.command?La.Caption:""}var Oa=-2009825598===this.Wd.command?"bing":"M365";Ka=H.h(this.$);var ib=v.o(Ka.ha.ra.activeCell,this.$);B.a(this.$.userOperationManager,(La,db,Ab)=>A.s(this.$.pa.xa,ib,Ua,Oa,T.b(La,this.HWi),T.a(db,this.GWi),Ab,null),La=>new z.a(595,0,La),this.Wd);I.HelperMethods.I_?(Ka=new Map,Ka.set("MediaProvider",Oa),Ka.set("ImagesCount",ba.length.toString()),Ka.set("TimeTakenToOpenDialog",this.Wtf.toString()),n.Health.instance.recordKpiUsage(Ra.a.wii,1,ia.a.ueg,Ka)):m.ULS.sendTraceTag(537155805,
0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.Grc()}else m.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};this.HWi=ba=>{D.a(ba)?m.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${y.a.sc(ba.Errors)}`):(m.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),ba.Result?
S.a(this.$).Tna(1,ba.Result):m.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.GWi=()=>{m.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};this.$=ja;this.Wd=ua;this.bJ=ra;this.gve=x.a.instance.Rb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let ja=null;ja=this.$.Kb.Cc("UserAction","showOnlineImagesDialogTimeStopwatch");
switch(this.Wd.command){case -2009825598:this.$Gj();break;case -2053056795:this.gve.execute(ua=>{ua.isFeatureEnabled("MsoPremiumStockImages",!1).catch(Za=>m.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${Za}`)).then(Za=>{this.aHj(Za);return null})})}ja.stop();this.Wtf=ja.Bc}$Gj(){let ja=this.$.ya.BingPictureEndpoint;const ua=r.a.uK(d.AFrameworkApplication.lcid),Za=u.a.create();ja?(ja=0<ja.search(RegExp("insertmedia.bing.office.net",
"gi"))?String.format(ja,1,1):String.format(ja,1,d.AFrameworkApplication.lcid,ua?ua.name:"en-us",d.AFrameworkApplication.buildVersion,Za.toString(),1,this.$.ya.DocumentHostInfo.LoggableUserId),this.E6b(ja,1,-1,M.a.instance.ga(1755))):(m.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),this.bJ.setException(Error.create("Failed to access the Bing service endpoint")))}aHj(ja){var ua=this.$.ya.M365PictureEndpoint,Za=u.a.create();
if(ua){var Pa=this.$.ya.DocumentHostInfo.UserId;Pa=Pa?w.a.sw(Pa).toString():"0";var ka=this.gve.instance.isFreemiumUpsellEnabled();ja=ja?1:ka?0:-1;Za=Za.toString();ka=r.a.uK(d.AFrameworkApplication.lcid).name;ua=String.format(ua,d.AFrameworkApplication.lcid,ka,d.AFrameworkApplication.buildVersion,Za,1,Pa,ja,1);this.E6b(ua,2,ja,M.a.instance.ga(1754))}else m.ULS.sendTraceTag(537155803,0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.bJ.setException(Error.create("Failed to access the M365 service endpoint"))}E6b(ja,
ua,Za,Pa){try{(new Ca(this.$,ja,x.a.instance.yg("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),ua,Za,Pa)).QHj(this),this.bJ.setResult(!0)}catch(ka){m.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${ka}] [MediaProvider : ${ua}] [DialogLicenseTier : ${Za}]`),this.bJ.setException(ka)}}}Object(t.a)(Ya,"OnlinePictureUploaderWrapper",l.a,[3]);var Ga=a(55);class da{constructor(ja,ua){this.$=ja;this.uploaderCreator=ua}executeCommand(ja,
ua,Za){ja=ua.command;switch(ja){case 1403967063:if(Za&&"dataUrl"in Za)return ua=new e.a,this.uploaderCreator&&this.uploaderCreator.jgi(this.$,f.a.instance,d.AFrameworkApplication.fa,Za,Za.dataUrl,ua),ua.task;this.uploaderCreator&&this.uploaderCreator.jhi(this.$,ua,f.a.instance,d.AFrameworkApplication.fa,Za);return Ga.Task.Ra(!0);case -2053056795:case -2009825598:return ja=new e.a,new Ya(this.$,ua,f.a.instance,d.AFrameworkApplication.fa,Za,ja),ja.task;default:return h.a(ja)}}yc(ja,ua){if(ja=this.$.isEditMode)switch(ua.command){case 1403967063:ja=
!0;break;case -2053056795:ja=!0;break;case -2009825598:ja=!0;break;default:ja=!1}return ja}Lc(){return!1}nc(){return!1}}Object(t.a)(da,"PictureCommandHandler",null,[219]);var Z=a(37),ha=a(48);class Wa extends b.a{constructor(ja){super(ja)}ld(){Z.TaskExtensions.za(ha.GetServiceTaskFactory.Na(this.$.da,484,485,1),ja=>{this.Zc([new da(this.$,ja.result)])},this.$.ka,3)}static la(ja){b.a.Nd(90,new Wa(ja))}}Object(t.a)(Wa,"PictureCommandHandlerFactory",b.a,[]);a.d(E,"a",function(){return ca});const ca=
()=>{c.a.Fa(ja=>{Wa.la(ja)})}},1218:function(t,E,a){var c=a(9);t=a(0);var b=a(222),e=a(15),f=a(513),d=a(38),h=a(4),m=a(60);class l{}l.Lhd="GetFontPreviewData";Object(t.a)(l,"FontWebServiceMethods",null,[]);const w=(I,M,T,S,H=null)=>{const C=l.Lhd;H=I.Oa(5,H);H.locale=h.AFrameworkApplication.uiCulture;return m.g(I,C,H,M,T,S,null,644)};var n=a(11),x=a(1),r=a(42),u=a(116),v=a(29);const B={xlyellow:"xlyellow"};class z extends d.a{constructor(I,M){super();this.$=I;this.Bv=M;this.uva={};this.eP={};this.Mwe=
!1;this.styles=null;this.vRi=(T,S,H)=>{e.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${H} has succeeded.`);this.O6i(T);this.Mwe=!0;e.ULS.sendTraceTag(512340116,1,50,"FontServiceManager.onFontPreviewRequestComplete: timeFromAppInteractive to fonts download {0} ms",r.PageLoadTrackingInfo.instance.nwa(new Date));this.J$i()};this.wRi=(T,S,H)=>{T=u.a.Oe(T.data);T=v.a.sc(T);e.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors: ${T} for method: ${H}`)};
this.Mmj=()=>{this.ql&&this.Lhd(this.vRi,this.wRi)};this.ql=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.Mmj()}O6i(I){if(this.rvi(I)){var M=n.HelperMethods.v6(()=>{const T=I.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${T.PreviewUrl}') format('truetype')}`;const S=T.FontFacePropertiesList;let H,C,G;T.FontNameList.forEach((J,L)=>{this.uva[J]=S[L].Codepoint;let P=`https://fs.microsoft.com/fs/${T.CatalogVersion}/rawguids/${S[L].FontGuid}`;
this.styles=this.yve(this.styles,J,P,S[L].FontWeight);this.eP[J]=S[L].LocalizedFontName;"Segoe UI Semibold"===J&&(H=S[L].FontFamily,C=P,G=S[L].FontWeight)});H&&(this.styles=this.yve(this.styles,H,C,G));f.a.Ni(this.styles)});10<M&&e.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${M}`)}}rvi(I){if(!I.Result)return e.ULS.sendTraceTag(520710158,1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),
!1;I=I.Result;return I?I.PreviewUrl?I.FontFacePropertiesList?I.FontNameList?0===I.FontFacePropertiesList.length||I.FontFacePropertiesList.length!==I.FontNameList.length?(e.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(e.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710155,
1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}yve(I,M,T,S){return I+`@font-face{font-family:"${M}";src:url('${T}');font-weight:${S};}`}Lhd(I,M){return w(this.Bv,I,M,null,this.Bv.Wb())}J$i(){this.Ric&&
this.raiseEvent(z.v_e)}get kCc(){return this.eP}get CJh(){return this.uva}get Ric(){return this.Mwe}isFontSupported(I){return this.ql&&this.eP&&(!!this.eP[I]||!!B[I.replace(/\s/g,"").toLowerCase()])}Nse(I){this.addHandler(z.v_e,I)}}z.v_e="fsmFD";Object(t.a)(z,"FontServiceManager",d.a,[740]);var A=a(698);class y extends b.a{constructor(I){super();this.$=I;this.Fb()}static la(I){I.da.Ga(505,new y(I))}create(){this.ob(Object(A.a)(this.$.da,504,()=>new z(this.$,this.$.pa.Bv)))}}Object(t.a)(y,"FontServiceManagerFactory",
b.a,[]);a.d(E,"a",function(){return D});const D=()=>{c.a.Fa(I=>{y.la(I)})}},1255:function(t,E,a){t=a(0);var c=a(108),b=a(222),e=a(15),f=a(14),d=a(38),h=a(174),m=a(92),l=a(1),w=a(21),n=a(5);class x extends d.a{constructor(z,A,y){super();this.statusBarManager=null;this.BNe=()=>{this.T8b()};this.xnh=()=>{this.T8b()};this.ANe=D=>{10===D&&this.T8b()};this.onKeyDown=D=>13===D.Ca.keyCode?(D=new m.a(237279923,1,2,6,null),this.$.Ka.Lb(D,{[n.a.skipClipboardAccess]:!0,[n.a.yRe]:!0}),!0):!1;this.$=z;this.Ko=
A;this.Fm=y;this.Oad=!1;(this.q9f=l.EwaSettings.getBooleanFeatureGate(h.a.TQa,!1))&&this.$.da.fb(29,D=>{this.statusBarManager=D;D.KJ(this)})}dispose(){this.gk();this.Fm=this.Ko=this.$=null;this.statusBarManager&&(this.statusBarManager.iG(this),this.statusBarManager=null)}Fn(){return this.q9f}ps(z,A){if("QueryPasteShortcutEnabledLabel"!==z&&!x.ZMj.includes(z))return!1;const y=this.Io();"QueryPasteShortcutEnabledLabel"===z?(A.Visible=y,e.ULS.sendTraceTag(537167636,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${y} for commandId ${z}`)):
(A.Visible=!y,e.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!y} for commandId ${z}`));return!0}osh(){this.Oj();this.raiseEvent("pasteShortcutStatusChanged")}T8b(){this.gk();this.raiseEvent("pasteShortcutStatusChanged")}Io(){return this.Oad}Lq(z){this.addHandler("pasteShortcutStatusChanged",z)}er(z){this.removeHandler("pasteShortcutStatusChanged",z)}Oj(){if(!this.Io()){this.Oad=!0;w.h(this.$).Ai.Zk(this.BNe);this.Fm.la("blur",this.xnh);const z=this.$.da.Aa(65);
z&&z.K3&&z.K3.registerForCommentEvents(this.ANe);this.Ko.Rs(f.a.Pb,this.$.uu,this.onKeyDown,!0)}}gk(){if(this.Io()){this.Oad=!1;w.h(this.$).Ai.Uk(this.BNe);this.Fm.detach("blur");const z=this.$.da.Aa(65);z&&z.K3&&z.K3.unregisterForCommentEvents(this.ANe);this.Ko.Ys(f.a.Pb,this.$.uu,this.onKeyDown,!0)}}}x.ZMj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(t.a)(x,"PasteShortcutManager",d.a,[777,214,215,3]);var r=a(128);class u extends b.a{constructor(z){super();this.$=z;this.Fb()}create(){const z=
this.$;this.ob(z.da.Aa(478)||this.$.da.Ga(478,new x(z,c.KeyInputManager.instance,r.a.instance.vH())))}static la(z){z.da.Ga(479,new u(z))}}Object(t.a)(u,"PasteShortcutManagerFactory",b.a,[]);var v=a(9);a.d(E,"a",function(){return B});const B=()=>{v.a.Fa(z=>{u.la(z)})}},1256:function(t,E,a){var c=a(9);t=a(0);var b=a(108),e=a(222),f=a(128),d=a(7),h=a(15),m=a(4),l=a(1401),w=a(14),n=a(5),x=a(904),r=a(47),u=a(28),v=a(21),B=a(1),z=a(40),A=a(66),y=a(346),D=a(37),I=a(48),M=a(33);class T{constructor(C,G,J,
L){this.recoveryUI=null;this.zgg=(P="Paste")=>{var aa=A.d(this.$.va.na);aa=new y.a(this.pasteRange,aa);this.z0d(aa,P)};this.zkg=()=>{this.recoveryUI&&(this.N3d=u.a.Sa.ve.m,this.hide(),r.a.instance.create(()=>{this.K_j()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.ONe=P=>{10===P&&this.vua()};this.Pnh=()=>{if(this.recoveryUI){const P=document.getElementById("PasteRecoveryUI");P&&n.a.Ak===P.getAttribute(n.a.hU)&&P.click();this.documentHidden=!0;this.vua()}};this.PNe=()=>{this.vua()};
this.QNe=()=>{this.vua()};this.onKeyUp=P=>{if(this.recoveryUI){if(this.Y_)return!1;if(17===P.Ca.keyCode&&this.vac){P=document.getElementById("PasteRecoveryUI");if(!P)return h.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;const aa=P.getAttribute(n.a.hU)||"";if(n.a.vr===aa)return P.click(),!0}}return!1};this.onKeyDown=P=>{if(this.recoveryUI){this.vac=!1;this.Y_=P.ctrlKey;P=P.Ca.keyCode;if(27===P)return this.vua(),B.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&
(P=this.$.da.Aa(254))&&P.zr("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===P)return this.vac=!0}return!1};this.KR=(P,aa)=>{this.dDb=P=aa.Wd;if(B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)){switch(P.command){case -1027730316:case -1059615499:if(aa.properties&&aa.properties.launcherId===this.z5e())return;break;case -847286761:if(aa.properties&&(13===aa.properties.CalloutName||18===aa.properties.CalloutName))return}this.vua()}else-1027730316!==
P.command&&-1059615499!==P.command?this.vua():(aa=aa.properties)&&aa.launcherId!==this.z5e()&&this.vua()};this.$=C;this.muc=G;this.Ko=J;this.Fm=L;this.Rlc=this.dDb=this.Tvd=null;this.Y_=this.vac=this.X8b=this.egc=!1;this.N3d=0;this.documentHidden=!1;this.grid=v.h(this.$);this.pasteRange=null;B.EwaSettings.ll()||this.$.da.Ga(406,this)}dispose(){this.tig();this.zig();this.Rlc=this.Tvd=this.recoveryUI=this.Fm=this.Ko=this.muc=this.$=null;this.N3d=0}aWg(C){this.recoveryUI=C;this.Tvd=C.YPg;this.Rlc=C.mdj}vua(){this.recoveryUI&&
(this.pasteRange=z.K(this.recoveryUI.IXe),this.MKj(),this.hide(),this.tig(),this.recoveryUI=null)}MKj(){const C=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];m.AFrameworkApplication.Hs("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&
(h.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.dDb&&C.includes(this.dDb.command)?(h.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${x.a[this.dDb.command]}`),this.dDb=null):B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.PasteCoOccurence",!1)?h.ULS.sendTraceTag(509723927,306,50,"RecoveryUIController:smartViewOnPaste Format as table prompt already triggered with the paste recovery UI."):
this.documentHidden?(h.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.iab(()=>{this.zgg("Paste")}))}Axa(){return this.grid.Da.qR(4,this.$.na)}iab(C){if(this.Axa())C();else{h.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state.");const G=()=>{this.Axa()&&(C(),this.grid.Gvc(G))};this.grid.L0b(G)}}lsi(){return!!this.recoveryUI&&
this.muc.koi}LIj(C){m.AFrameworkApplication.Hs("XLS-SmartView-PasteCoOccurence-Treatment;XLS-SmartView-PasteCoOccurence-Control");M.a.Oti()&&(this.pasteRange=z.K(this.recoveryUI.IXe),this.iab(()=>{this.zgg("PasteCoOccurence")}));this.recoveryUI?this.show(C):h.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}z5e(){return this.recoveryUI?this.recoveryUI.Cyi:null}show(C){const G=this.recoveryUI.zTh();G?(this.muc.showFloatie(Object(d.a)(new l.a,{x:G.x,y:G.y}),
this.recoveryUI.lLa(),C),this.Oj()):h.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.lsi()&&this.muc.kD();this.zig()}Oj(){if(!this.X8b){var C=v.h(this.$);C.view.qt(this.zkg);C.Ai.Zk(this.PNe);this.Fm.la("blur",this.Pnh);this.$.Ka.LGa(this.KR);this.$.va.Wf(this.QNe);(C=this.$.da.Aa(65))&&C.K3&&C.K3.registerForCommentEvents(this.ONe);this.X8b=!0}this.egc||(this.Ko.Rs(w.a.Pb,this.$.domElement,this.onKeyDown,!0),this.Ko.Rs(w.a.Gd,this.$.domElement,this.onKeyUp,
!0),this.egc=!0)}tig(){if(this.X8b){var C=v.h(this.$);C.view.fr(this.zkg);C.Ai.Uk(this.PNe);this.Fm.detach("blur");this.$.Ka.GAa(this.KR);this.$.va.Dg(this.QNe);(C=this.$.da.Aa(65))&&C.K3&&C.K3.unregisterForCommentEvents(this.ONe);this.X8b=!1}}zig(){this.egc&&(this.Ko.Ys(w.a.Pb,this.$.domElement,this.onKeyDown,!0),this.Ko.Ys(w.a.Gd,this.$.domElement,this.onKeyUp,!0),this.egc=this.Y_=this.vac=!1)}K_j(){this.recoveryUI&&250<=u.a.Sa.ve.m-this.N3d&&this.show(-1)}z0d(C,G){D.TaskExtensions.za(I.GetServiceTaskFactory.Na(this.$.da,
426,427,1),J=>{void J.result.Zea(C,G);h.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.ka,3)}}Object(t.a)(T,"RecoveryUIController",null,[273,3]);class S extends e.a{constructor(C){super();this.$=C;this.Fb()}create(){if(B.EwaSettings.ll())this.YJi();else{const C=this.$;C.qy(G=>{G.Ygc().then(J=>{this.ob(this.$.da.Aa(406)||new T(C,J,b.KeyInputManager.instance,f.a.instance.vH()))})})}}YJi(){const C=this.$;
let G=this.$.da.Aa(406);G?this.ob(G):C.qy(J=>{J.Ygc().then(L=>{G=new T(C,L,b.KeyInputManager.instance,f.a.instance.vH());this.$.da.Ga(406,G);this.ob(G)})})}static la(C){C.da.Ga(405,new S(C))}}Object(t.a)(S,"RecoveryUIControllerFactory",e.a,[]);a.d(E,"a",function(){return H});const H=()=>{c.a.Fa(C=>{S.la(C)})}},1266:function(t,E,a){t=a(0);var c=a(58),b=a(15),e=a(253);class f{constructor(l,w){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=
null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=l;this.caller=w;this.reset()}reset(){this.isSuccess=!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(t.a)(f,"NetworkTestResult",null,[]);var d=a(581);class h{constructor(l,w,n,x,r){this.url="";this.Z6a=!1;this.i8=-1;this.testIteration=0;this.baseUrl=n;this.bCf=x;this.Hnd=w;this.result=new f(w,r)}runTest(){try{if(this.Z6a)return b.ULS.sendTraceTag(537155206,
0,50,`NetworkTestReq.RunTest: a test for the host ${this.Hnd} is already mid way, not starting a new one.`),!1;this.reset();this.Z6a=!0;this.result.startTimeMs=Date.now();const l=new e.QueryStringBuilder(this.baseUrl);l.b$("tid",this.result.startTimeMs.toString());this.url=l.toString();this.Mtj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(l){return this.Qvb("Exeption: "+l.message),!1}}reset(){this.url="";this.result.reset();this.Z6a=!1;this.i8=-1}clearTimeout(){-1!==
this.i8&&(window.clearTimeout(this.i8),this.i8=-1)}Mtj(){try{const l=new XMLHttpRequest;l.onreadystatechange=()=>{4===l.readyState&&(200===l.status?this.SHh():this.Qvb(`Error when downloading resource. status code: ${l.status}, status text: ${l.statusText}`,l.status.toString()))};l.onerror=()=>{this.Qvb(`Client error when attempting to download resource. status code: ${l.status}, response: ${l.statusText}`)};this.i8=window.setTimeout(()=>{this.i8=-1;this.Qvb("Request timeout")},1E4);l.open("GET",
this.url,!0);l.send(null)}catch(l){this.Qvb("Exeption: "+l.message)}}SHh(){this.Z6a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=d.a(this.url),this.result.isSuccess=!0,this.B5b())}Qvb(l,w=null){this.Z6a&&(this.clearTimeout(),this.result.errorMessage=l,this.result.isSuccess=!1,this.result.errorStatusCode=w,this.B5b())}B5b(){this.Z6a=!1;this.bCf&&this.bCf(this.result,this.Hnd)}}Object(t.a)(h,"NetworkTestReq",null,[]);a.d(E,
"a",function(){return m});class m{static Jfd(l,w,n,x=null){m.xoc||(m.xoc=Array.isArray(c.a.$h(n.ya.NetworkMeasurementUrlList))?c.a.$h(n.ya.NetworkMeasurementUrlList):null);const r=[];for(let u=0;u<m.xoc.length;u++){const v=m.xoc[u];let B=v.key;B||(B=v.Key);if(x&&!x.includes(B))continue;let z=v.value;z||(z=v.Value);B&&z&&r.push(new h(n,B,z,l,w))}return r}}m.xoc=null;Object(t.a)(m,"NetworkConnectionHelpers",null,[])},1363:function(t,E,a){t=a(0);var c=a(15),b=a(84);a(107);var e=a(27);class f{constructor(x,
r,u){this.Uj=this.RFd=null;this.KFa=this.K9=0;this.PUb=null;this.jT=x;this.ke=r;this.nb=u;this.R2a=!1;this.K2d=!0;this.Fnj();this.C$a=this.fa.qa("NativeFileOpenDialogIsEnabled")}get context(){return this.jT}get fa(){return this.nb}get retryCount(){return this.K9}get OPd(){return this.KFa}vHb(x){this.Uj=x;if(!this.R2a){if(this.K2d){if(this.C$a&&e.a.SF){this.PUb=x.l9b(Object(b.a)(this,this.$Dd,"onFileChosen"));return}this.PUb=x.l9b(null);if(!this.RCa(this.PUb,x))return}this.finalizeUpload(x,null)}}$Dd(x){if(this.RCa(x,
this.Uj)){if(e.a.SF||e.a.Jf)this.PUb=x;this.finalizeUpload(this.Uj,null)}}Grc(){this.RFd&&this.RFd()}Fnj(){this.K9=0;this.KFa=this.fa.ud("Box4UploadRetryDelayStart",200);this.Uj&&(this.Uj.dispose(),this.Uj=null)}}Object(t.a)(f,"FileUploader",null,[]);var d=a(4),h=a(322),m=a(786),l=a(133),w=a(30);a.d(E,"a",function(){return n});class n extends f{constructor(x,r,u){super(x,r,u);this.zXb=this.$ra=null}get dP(){return d.AFrameworkApplication.ta.kE}N3e(x){switch(x){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;
case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}nmg(x){return n.RCa(x,this.Z5h())}Z5h(){return n.Wne}RCa(x,r=null){x=this.nmg(x);return 0!==x?(r&&r.fqe(),2===x&&this.uj(0,this.N3e(x)),!1):!0}finalizeUpload(x,r){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.RFd=r;this.YHj();h.a.mark(5576);this.zXb=this.dP.Cc("LoadResource","PictureUploadTime")}uj(x,r){const u=new l.StandardDialog;u.Tb=0;u.iA(x,CommonUIStrings.l_ImageUploadFailedTitle,r,null)}Grc(){c.ULS.sendTraceTag(36783361,
322,50,"PictureUploader.OnUploadComplete");super.Grc();this.zXb&&(this.zXb.stop(),this.zXb=null);this.e6g()}YHj(){this.$ra=(new m.a).create();this.$ra.message=CommonUIStrings.l_ImageUploadWait;this.$ra.Tb=5;this.$ra.Lt=!1;this.$ra.HBa(null,null,null)}e6g(){this.$ra&&(this.$ra.close(),this.$ra=null)}static dbi(x,r){x=w.a.wl(x);for(let u=0;u<r.length;++u)if(x.endsWith(r[u]))return!0;return!1}static RCa(x,r=null){r||(r=n.Wne);return x?n.dbi(x,r)?0:2:1}}n.Wne=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");
Object(t.a)(n,"PictureUploader",f,[])},1436:function(t,E,a){a.r(E);var c=a(1156),b=a(0),e=a(15),f=a(4),d=a(119),h=a(400);class m extends h.a{constructor(cc){super(cc)}get t6b(){return!1}createElement(){const cc=document.createElement("link");cc.setAttribute("rel","stylesheet");cc.setAttribute("type","text/css");cc.setAttribute("href",this.Vt);return cc}Y6c(){return null}avc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.cA.Vt)}}Object(b.a)(m,"CssResource",h.a,[]);var l=
a(377),w=a(228),n=a(30),x=a(55);class r{constructor(){this.FXb=this.TUb=null}Jzi(){this.TUb||(e.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.TUb=x.Task.WAA(r.Ozi(),r.Gzi()),this.TUb.continueWith(cc=>{e.ULS.sendTraceTag(21030599,324,10,"{0}",n.a.thd(cc.exception))},5));return this.TUb}Lzi(){if(!this.FXb)try{e.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.FXb=x.Task.WAA(r.tad(w.a.create(f.AFrameworkApplication.fa.Xa("DimeUrl"),
null,null))),this.FXb.continueWith(cc=>{e.ULS.sendTraceTag(39978391,324,10,"{0}",n.a.thd(cc.exception))},5)}catch(cc){e.ULS.sendTraceTag(594874951,324,10,"{0}",n.a.thd(cc))}return this.FXb}static Ozi(){var cc=r.Jec("inproductmessaging.js");cc=w.a.create(cc,null,null);return r.tad(cc)}static Gzi(){var cc=r.Jec("inproductmessaging.css");cc=new m(cc);return r.tad(cc)}static Jec(cc){return d.a.y5b(String.format("ipm/{0}",cc))}static tad(cc){l.a.gja(cc);return cc.O9a}}Object(b.a)(r,"DependencyDownloader",
null,[845]);class u{}u.Q1i="inProductMessagingOverlayDiv";u.I4i="PlayButtonImage";u.Clj="ReplayButtonImage";Object(b.a)(u,"Constants",null,[]);class v{constructor(){this.Kle=this.gge=this.L6d=!0;this.Dlj=this.J4i=null;this.$Ii=!1;this.locale=null;this.Phg={}}get hye(){return this.L6d}set hye(cc){this.L6d=cc}get fxf(){return this.gge}set fxf(cc){this.gge=cc}get r$f(){return this.Kle}set r$f(cc){(this.Kle=cc)&&this.uzj()}uzj(){this.yre(u.I4i,this.J4i);this.yre(u.Clj,this.Dlj)}yre(cc,Rc){Rc&&(this.Phg[cc]=
Rc)}}Object(b.a)(v,"FirstRunExperienceUISettings",null,[844]);class B{constructor(){this.completed=this.fgj=!1}}Object(b.a)(B,"FirstRunExperienceViewData",null,[843]);var z=a(84),A=a(176),y=a(106),D=a(25);class I{constructor(cc,Rc,vd){this.La=cc;this.df=Rc;this.wVb=vd}Hg(){this.La.Me(D.a.oIh,y.a.frame,Object(z.a)(this,this.mIh,"firstRunExperienceHandler"),64);this.La.Nb(D.a.FZe,y.a.frame,Object(z.a)(this,this.Wdi,"inProductMessagingTabHandler"));this.La.Nb(D.a.EZe,y.a.frame,Object(z.a)(this,this.Vdi,
"inProductMessagingShiftTabHandler"));this.La.Nb(D.a.knh,y.a.frame,Object(z.a)(this,this.lnh,"dimeLaunchHandler"));this.La.Nb(D.a.AYf,y.a.frame,A.ActionManager.pg);this.La.Nb(D.a.amj,y.a.frame,A.ActionManager.pg);this.La.Nb(D.a.bmj,y.a.frame,A.ActionManager.pg);this.df&&this.df.updateCommandUI()}mIh(cc,Rc,vd,Zd,pe){2===vd&&this.wVb.iyi(pe);return 32}lnh(cc,Rc,vd,Zd,pe){2===vd&&this.wVb.fyi(pe);return 32}Wdi(cc,Rc,vd){return 2===vd?this.wVb.MAd():32}Vdi(cc,Rc,vd){return 2===vd?this.wVb.KAd():32}}Object(b.a)(I,
"InProductMessagingActor",null,[]);var M=a(83);class T{constructor(){this.bVf=this.b_f=this.feg=this.gmc=this.instance=null}}Object(b.a)(T,"DimeExperienceUISettings",null,[]);var S=a(137),H=a(467);class C{constructor(cc,Rc,vd,Zd,pe){this.Sbc=!1;this.jub=null;this.La=cc;this.dGa=Rc;this.iYb=vd;this.T1=Zd;this.YHc=pe}Jgi(cc){S.b("getHeaderApi")?cc.isFeatureEnabled("MsoPremiumBadge",!0).then(Rc=>{const vd=cc.isFreemiumUpsellEnabled();vd&&(appChrome.getHeaderApi().then(Zd=>{Zd.updatePremiumStatus(Rc,
vd);return null}),cc.qna("MsoPremiumBadge",Zd=>{appChrome.getHeaderApi().then(pe=>{pe.updatePremiumStatus(Zd.isEnabled,vd);return null})}));return null}):e.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}iyi(cc){this.iYb.Jzi().continueWith(()=>{this.dGa.kJj(cc)})}fyi(cc){let Rc="gopremium",vd=null,Zd=()=>{};cc?(cc.experience&&""!==Object(M.a)(String,cc.experience)&&(Rc=Object(M.a)(String,cc.experience)),cc.onTaskComplete&&(Zd=cc.onTaskComplete),cc.campaignId&&""!==Object(M.a)(String,
cc.campaignId)&&(vd=Object(M.a)(String,cc.campaignId))):e.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.Lqf(Rc,Zd,vd)}Lqf(cc,Rc,vd=null){if(this.Sbc&&this.jub){const Zd={};Zd.experience=cc||"gopremium";Zd.campaignId=vd||H.b(this.T1,this.YHc,Object(M.a)(String,Zd.experience),!0);this.La.processAction(D.a.AYf,2);e.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+Zd.experience);try{const pe=Object.assign(new T,{instance:this.jub,gmc:Zd,feg:Rc||
(()=>{}),b_f:Qe=>{e.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+Qe.status)},bVf:()=>{e.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.Sbc=!1;this.jub=null}});this.dGa.BHj(pe)}catch(pe){e.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+pe.message),this.Sbc=!1,this.jub=null,this.La.$d(D.a.Tbc,2,{["experience"]:Zd.experience})}}else e.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.La.$d(D.a.Tbc,2,{["experience"]:cc})}Brf(){this.iYb.Lzi().continueWith(()=>
{try{var cc=n.a.wl(f.AFrameworkApplication.uiCulture);const Zd=H.c(this.T1);if(Zd){var Rc={};Rc.partnerId=Zd;Rc.language=cc;Rc.sessionId=f.AFrameworkApplication.userSessionId;Rc.authHint=f.AFrameworkApplication.fa.Xa("UserPrincipalName");var vd=f.AFrameworkApplication.fa.Xa("Puid")||"";""!==vd&&(cc={},cc.puid=vd,Rc.userInfo=cc);this.jub=new Dime(Rc);this.Sbc=!0;e.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else e.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(Zd){e.ULS.sendTraceTag(51675410,
324,10,"FreemiumUpsellDialogDependencies failed: "+Zd.message)}},3)}MAd(){return this.dGa.MAd()}KAd(){return this.dGa.KAd()}}Object(b.a)(C,"InProductMessagingUIManager",null,[841]);class G{constructor(){this.kne=0;this.WXa=Array(5);this.WXa[0]=10;this.WXa[1]=15;this.WXa[2]=50;this.WXa[3]=100;this.WXa[4]=200}Init(cc){this.kne=cc}SendTrace(cc,Rc){e.ULS.sendTraceTag(34182235,this.kne,this.WXa[cc],"{0}",Rc)}}Object(b.a)(G,"DefaultNetworkingManager",null,[860]);var J=a(261),L=a(318),P=a(96);class aa{constructor(cc){this.Yb=
cc}kJj(cc){cc&&(InProductMessaging.Networking.NetworkingMgr=new G,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(cc.r$f,cc.fxf,cc.hye,cc.$Ii,cc.locale,Object(z.a)(this,this.$Pi,"onDismissFirstRunExperience"),cc.Phg),this.eTa(u.Q1i,!0))}BHj(cc){if(cc&&cc.instance&&cc.gmc){let Rc=document.getElementById("wacDimeContainer");Rc||(Rc=document.createElement("div"),Rc.id="wacDimeContainer",document.body.appendChild(Rc));f.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&
this.eTa("wacDimeContainer",!1);cc.gmc.parentElementId="wacDimeContainer";cc.instance.launch(cc.gmc,cc.feg).then(vd=>{this.gKb();document.body.removeChild(Rc);cc.b_f(vd)}).catch(vd=>{this.gKb();document.body.removeChild(Rc);cc.bVf(vd)})}else throw Error.argument("DimeExperienceUISettings");}eTa(cc,Rc){if(this.Yb&&cc&&(cc=document.getElementById(cc),this.Bgi(cc),cc=this.Yb.wN("InProductMessagingFocusId"))){const vd=this.Yb.hi;vd&&"InProductMessagingFocusId"===vd.name||this.Yb.aS("InProductMessagingFocusId",
!1);Rc&&this.jTf(cc.scope)}}Bgi(cc){var Rc=this.Yb.Ci("InProductMessagingFocusId");Rc.parent=J.AFrame.gU;const vd=new L.DOMFocusListing(()=>cc);vd.Ocb=!1;vd.wo(3);vd.wo(2);vd.wo(4);Rc=this.Yb.Zsa(()=>cc,Rc,vd);Rc.ZJb();Rc.c0=!0;Rc.BIa=!0}jTf(cc){cc.Hk(P.FocusManager.instance().I2);cc.Hk(P.FocusManager.instance().J2);cc.bindAction(P.FocusManager.instance().I2,D.a.FZe);cc.bindAction(P.FocusManager.instance().J2,D.a.EZe)}gKb(){this.Yb&&(this.Yb.wda("InProductMessagingFocusId"),this.Yb.GRa("InProductMessagingFocusId"))}$Pi(cc,
Rc){this.gKb();cc=Object.assign(new B,{completed:cc,fgj:Rc});f.AFrameworkApplication.ub.$d(D.a.lIh,2,cc)}MAd(){const cc=document.activeElement,Rc=this.Yb.TQ();return cc&&Rc&&Rc.hf&&cc===Rc.hf.Pw?(Rc.hf.Ml(cc),Rc.Sya()?32:8):4}KAd(){const cc=document.activeElement,Rc=this.Yb.TQ();return cc&&Rc&&Rc.hf&&cc===Rc.hf.firstElement?(Rc.hf.Ml(cc),Rc.uPa()?32:8):4}}Object(b.a)(aa,"InProductMessagingUIWrapper",null,[842]);var U=a(134),K=a(249),Y=a(27);class na{constructor(){this.$a=null}get name(){return"Common.App.InProductMessaging"}Oh(cc){cc.register(r,
"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").wc().Ac(()=>new r);cc.register(aa,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").wc().Ac(()=>new aa(P.FocusManager.instance()));cc.register(C,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").wc().Ac(()=>new C(f.AFrameworkApplication.ub,cc.resolve("Common.IInProductMessagingUIWrapper"),
cc.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.ta.Pa.Ij,f.AFrameworkApplication.ta.Pa.E6));cc.register(I,"Common.App.InProductMessaging.InProductMessagingActor").wc().Ac(()=>new I(f.AFrameworkApplication.ub,f.AFrameworkApplication.ta,cc.resolve("Common.IInProductMessagingUIManager")));cc.register(v,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").wc().Ac(()=>new v);cc.register(B,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").wc().Ac(()=>
new B);this.$a=cc}init(){this.$a.resolve("Common.App.InProductMessaging.InProductMessagingActor").Hg();f.AFrameworkApplication.fa.Iu(()=>{f.AFrameworkApplication.ta.Pa.Gs&&U.a.get_instance().Zj(15,()=>{this.$a.Rb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(cc=>{this.$a.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Jgi(cc)})});f.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&H.a()&&!Y.a.ula&&1!==f.AFrameworkApplication.ta.Pa.Ij&&
this.$a.Rb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(cc=>{cc.isFeatureEnabled("MsoPremiumBadge",!0).then(Rc=>{!Rc&&cc.isFreemiumUpsellEnabled()&&this.$a.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Brf();return null})})})}dispose(){}static main(){K.a.instance.vi(new na)}}Object(b.a)(na,"InProductMessagingPackage",null,[4,5]);var W=a(187),X=a(41);class Aa{constructor(cc,Rc,vd,Zd=null,pe=null){this.hw=cc;this.CEa=Rc;this.fkb=vd;this.Eie=Zd;this.omb=
pe}oac(cc){const Rc=new Sys.StringBuilder(this.hw.GLb);Rc.append("RoamingServiceHandler.ashx?action=");Rc.append("getFirstRunExperienceSettings");Rc.append("&");Rc.append(this.xjd(cc));Rc.append("&");Rc.append(f.AFrameworkApplication.Hi);f.AFrameworkApplication.zd.Om(Rc.toString(),1,null,null,!0,2,Object(z.a)(this,this.R4,"getRequestSuccessCallback"),Object(z.a)(this,this.xN,"getRequestFailureCallback"),null)}X3a(cc){var Rc=new Sys.StringBuilder(this.hw.GLb);Rc.append("RoamingServiceHandler.ashx?action=");
Rc.append("saveFirstRunExperienceSettings");Rc.append("&");Rc.append(f.AFrameworkApplication.Hi);Rc=Rc.toString();cc=X.c(cc);f.AFrameworkApplication.zd.Om(Rc,2,cc,null,!0,4,Object(z.a)(this,this.h6i,"postRequestSuccessCallback"),Object(z.a)(this,this.yO,"postRequestFailureCallback"),null)}R4(cc){let Rc=!1,vd=null;try{if(0<cc.data.fe.length){const Zd=Object(M.a)(Object,X.a(cc.data.fe)),pe=Zd?Zd[this.hw.EZc]:null;pe&&(vd=Object(M.a)(Object,X.a(pe.toString())))}Rc=!0}catch(Zd){this.xN(null)}Rc&&this.CEa&&
this.CEa(cc.data,vd)}xN(cc){this.fkb&&this.fkb(cc?cc.data:null)}h6i(cc){this.Eie&&this.Eie(cc?cc.data:null)}yO(cc){this.omb&&this.omb(cc?cc.data:null)}xjd(cc){const Rc=new Sys.StringBuilder("requestedsettings=");for(let vd=0;vd<cc.count;vd++)Rc.append(cc.ma(vd)),vd<cc.count-1&&Rc.append(";");return Rc.toString()}}Object(b.a)(Aa,"FirstRunExperienceRequestHandler",null,[]);var Q=a(232),fa=a(82);class Ca{constructor(){this.Xjb=this.UUb=this.hw=null}iWd(cc){cc?(this.hw=cc,this.pqi()&&(e.ULS.sendTraceTag(51675532,
306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),cc=new W.a,cc.add(this.hw.EZc),this.UUb=new Aa(this.hw,Object(z.a)(this,this.R4,"getRequestSuccessCallback"),Object(z.a)(this,this.xN,"getRequestFailureCallback"),null,Object(z.a)(this,this.yO,"postRequestFailureCallback")),this.UUb.oac(cc)),(this.hw.T8a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.jWd()):e.ULS.sendTraceTag(51675531,306,
10,"Invalid launcherSettings")}pqi(){try{if(this.hw.T8a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",!0)||f.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.hw.$mi||this.hw.V8a||f.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;const cc=f.AFrameworkApplication.fa.Xa("FlightId");return-1!==(cc?cc.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(cc){e.ULS.sendTraceTag(576582624,306,
10,"Error checking setting {0}",cc?cc.toString():null)}return!1}k1f(cc){const Rc={},vd={};vd.FREDisplayedDate=(new Date).toUTCString();vd.VersionDisplayed=cc;vd.RemindMeLater=!1;Rc[this.hw.EZc]=X.c(vd);e.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.UUb&&this.UUb.X3a(Rc)}R4(cc,Rc){cc=cc?+cc.N3-+cc.MF:-1;cc>this.hw.Z_f?e.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",
cc,this.hw.Z_f):Rc?this.oGj(Rc)?(e.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",this.hw.Xwf),this.jWd()):(this.P9c(!1),e.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(e.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.jWd())}xN(cc){this.P9c(!1);
e.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",cc?cc.httpStatus:-1)}yO(cc){e.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",cc?cc.httpStatus:-1)}jWd(){this.P9c(!0);var cc=fa.a.instance.yg("Common.ISystemInitiatedFeedback");cc?this.f$f(cc):(e.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",
!0)&&((cc=fa.a.instance.Rb("Common.ISystemInitiatedFeedback"))?cc.execute(Rc=>{this.f$f(Rc)}):e.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}f$f(cc){if(cc){var Rc=this.hw.BIh;Rc&&(f.AFrameworkApplication.vya(Rc),f.AFrameworkApplication.Hs(Rc));e.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Rc);cc.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.Xjb=Object(z.a)(this,this.cRi,"onFirstRunExperienceCampaignEvent"),
window.addEventListener("FGWebSurfaceEvent",this.Xjb,!0),window.addEventListener("FRELaunchedEvent",this.Xjb,!0)):(e.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.k1f(this.hw.currentVersion))}else e.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}cRi(cc){if(cc){var Rc=cc.detail;cc=cc.type;var vd=this.hw&&this.hw.campaignId?this.hw.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===cc||vd&&Rc&&Rc.id&&-1!==Rc.id.indexOf(vd))Rc.success&&
(e.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.k1f(this.hw.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.Xjb,!0),window.removeEventListener("FRELaunchedEvent",this.Xjb,!0))}}oGj(cc){if("RemindMeLater"in cc&&"FREDisplayedDate"in cc){if("true"===cc.RemindMeLater.toString()&&(+new Date-+new Date(cc.FREDisplayedDate.toString()))/36E5>this.hw.Xwf)return!0}else if(f.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&
"VersionDisplayed"in cc&&cc.VersionDisplayed<this.hw.currentVersion)return e.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),!0;return!1}P9c(cc){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&Q.a.dispatch("FREDecisionEvent",{["show"]:cc})}}Object(b.a)(Ca,"FirstRunExperienceLauncher",null,[734]);class ia{constructor(){this.$a=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Oh(cc){this.$a=
cc;this.$a.register(734,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").wc().Ac(()=>new Ca)}init(){}dispose(){}static main(){K.a.instance.vi(new ia)}}Object(b.a)(ia,"FirstRunExperienceLauncherPackage",null,[4,5]);var Ra=a(1113),Ya=a(1114),Ga=a(1139),da=a(1255),Z=a(9),ha=a(222);class Wa{constructor(cc){this.$=cc}get EZc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get $mi(){return this.isEnabled()&&
this.$.oa(313)}get V8a(){return this.isEnabled()&&this.$.oa(315)}get T8a(){return this.$.oa(314)}get BIh(){return null}get Xwf(){return 24}get Z_f(){return 4E3}get GLb(){return this.$.ya.WebServiceBase||""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;const cc=f.AFrameworkApplication.Qb?Object(M.a)(String,f.AFrameworkApplication.Qb.AudienceGroup):"";return"Unknown"!==cc&&"Automation"!==cc}}Object(b.a)(Wa,"FirstRunExperienceLauncherSettings",
null,[778]);class ca{constructor(cc,Rc){this.GZe=cc;this.nIh=Rc}iWd(){this.GZe&&this.GZe.iWd(this.nIh)}}Object(b.a)(ca,"FirstRunExperienceManager",null,[775]);var ja=a(698);class ua extends ha.a{constructor(cc){super();this.$=cc;this.Fb()}create(){const cc=Object(ja.a)(this.$.da,311,()=>this.rdh());this.ob(cc)}rdh(){var cc=new Wa(this.$);cc=new ca(fa.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),cc);cc.iWd();return cc}static la(cc){cc.da.Ga(312,new ua(cc))}}
Object(b.a)(ua,"FirstRunExperienceManagerFactory",ha.a,[]);var Za=a(59);class Pa extends ha.a{constructor(cc){super();this.zod=null;this.$=cc;this.Fb()}create(){const cc=Object(ja.a)(this.$.da,361,()=>this.eeh());this.ob(cc)}eeh(){this.zod=fa.a.instance.yg("Common.IInProductMessagingUIManager");Za.a.Ag.Gs?U.a.get_instance().Zj(16,()=>{this.ggf()}):this.ggf();return this.zod}ggf(){fa.a.instance.Rb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(cc=>{cc.isFeatureEnabled("MsoPremiumBadge",
!0).then(Rc=>{!Rc&&cc.isFreemiumUpsellEnabled()&&this.zod.Brf();return null})})}static la(cc){cc.da.Ga(362,new Pa(cc))}}Object(b.a)(Pa,"InProductMessagingManagerFactory",ha.a,[]);var ka=a(1193),ra=a(1116),ba=a(47),Ua=a(419),Ka=a(78),Oa=a(1),ib=a(530),La=a(21),db=a(575);class Ab extends ib.a{constructor(cc){super(1);this.fga=!1;this.sBf=()=>{this.refresh()};this.tBf=()=>{this.refresh()};this.gridView=La.h(cc);this.gridView.Vb.Zk(this.tBf);this.gridView.Vb.Qm(this.sBf);this.refresh()}get uI(){return this.Tnc(this.fga)}WTd(cc){this.fga!==
cc&&(this.fga=cc,this.iJb())}get name(){return db.a.cellEdit}dispose(){this.gridView.Vb.Uk(this.tBf);this.gridView.Vb.fm(this.sBf);this.gridView=null;super.dispose()}iJb(){this.oKd(this.fga)}refresh(){this.WTd(!this.gridView.gb)}}Object(b.a)(Ab,"CellEditSafeStatePublisher",ib.a,[]);var Mb=a(38),pb=a(109);class Qb{constructor(cc,Rc){this.handler=null;this.publisher=cc;this.uI=Rc}}Object(b.a)(Qb,"SafeStatePublisherState",null,[]);var xb=a(611);const pa=cc=>cc?`${cc.Current} / ${cc.Pending} @${cc.SuspensionStartTimestamp}`:
null,Ma=cc=>(null===cc||void 0===cc?void 0:cc.SuspensionStartTimestamp)&&cc.Pending>cc.Current;class ya extends Mb.a{constructor(cc,Rc){super();this.sqf=null;this.w9a=!1;this.OGb=(vd,Zd)=>{3===Zd.Jwf&&this.w9a&&e.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.w9a=!0;this.ncb()};this.uSa=new W.a;this.Oya=cc;this.ana=Rc;this.UAb=Oa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);
this.B8a=Oa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.UAb&&(this.ana.c_a(this.sza.bind(this)),this.B8a?this.Oya.Dse(this.OGb):this.Oya.QNg(this.lGf.bind(this)))}get pXj(){return pb.f(pb.c(this.uSa.toArray(),cc=>0!=cc.uI),cc=>cc.publisher.name)}b1b(cc){this.addHandler(ya.tSa,cc)}Uvc(cc){this.removeHandler(ya.tSa,cc)}BAa(cc,Rc){const vd=new Qb(cc,Rc);this.uSa.add(vd);Rc=(Zd,pe)=>{vd.uI=pe.uI;this.ncb()};cc.b1b(Rc);vd.handler=Rc;this.ncb()}u1d(cc){let Rc=
null;for(let vd of this.uSa)if(vd.publisher===cc){this.Pig(vd);Rc=vd;break}Rc&&(this.uSa.remove(Rc),this.ncb())}dispose(){for(let cc of this.uSa)this.Pig(cc);this.uSa.clear();this.UAb&&(this.ana.ddb(this.sza.bind(this)),this.B8a?this.Oya.iXf(this.OGb):this.Oya.qjj(this.lGf.bind(this)));super.dispose()}rcc(){let cc=eb.rcc(this.uSa.toArray().map(Rc=>Rc.uI));return this.w9a&&1===cc?2:cc}Pig(cc){cc.publisher.Uvc(cc.handler)}ncb(){const cc=this.rcc();cc!==this.sqf&&(this.raiseEvent(ya.tSa,new xb.a(cc)),
this.sqf=cc)}lGf(){this.w9a&&e.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.w9a=!0;this.ncb()}sza(cc,Rc){cc=Rc.Kca;(Rc=!Ma(cc))||(Rc=this.Bxi,Rc=(null===cc||void 0===cc?void 0:cc.SuspensionStartTimestamp)!==(null===Rc||void 0===Rc?void 0:Rc.SuspensionStartTimestamp));Rc&&(this.w9a=!1);this.Bxi=cc;this.ncb()}}ya.tSa="SSC";Object(b.a)(ya,"ClientStateMonitor",Mb.a,[]);var Ea=a(6),Na=a(70);class kb extends ib.a{constructor(cc,
Rc=null){super(1);this.fga=!1;this.kO=()=>{this.refresh()};this.xCf=()=>{this.refresh()};this.$=cc;this.Dbe=Rc||Na.a(cc).RQ(Ea.a.idle);Na.a(cc).bYc(this.xCf);this.P6a.Lq(this.kO);this.refresh()}get uI(){return this.Tnc(this.fga)}WTd(cc){cc!==this.fga&&(this.fga=cc,this.iJb())}get name(){return db.a.P6a}get P6a(){return this.Dbe}dispose(){Na.a(this.$).zvc(this.xCf);this.P6a.er(this.kO);this.Dbe=null;super.dispose()}iJb(){this.oKd(this.fga)}refresh(){this.WTd(1===this.P6a.Cu||Na.a(this.$).gi===this.P6a)}}
Object(b.a)(kb,"IdleActivitySafeStatePublisher",ib.a,[]);var lb=a(319),oa=a(3),Ba=a(22);class sa extends Ka.a{constructor(){super()}nc(){return!1}executeCommand(){return x.Task.Ra(!0)}yc(cc,Rc){return 1905775613===Rc.command}Lc(){return!1}}Object(b.a)(sa,"ToggleMergeSuspensionSafeState",Ka.a,[219]);class qb extends Mb.a{constructor(cc,Rc){super();this.statusBarManager=null;this.PBd=!1;this.sza=(vd,Zd)=>{vd=`${Zd.Kca.Current===Zd.Kca.Pending?"\u26ad":"\u26ae"}${Zd.Kca.Current}`;Ba.a.equals(this.Aoc,
vd,!1)||(this.Aoc=vd,this.Rz())};this.fQa=(vd,Zd)=>{vd=0==Zd.uI;this.PBd!==vd&&(this.PBd=vd,this.Rz())};this.mergeSuspensionManager=Rc;this.mergeSuspensionManager.ana.c_a(this.sza);this.Aoc="";lb.a.Z9(1905775613,oa.a.ic,0,1);this.Ka=cc.Ka;this.dQb=new sa;cc.da.fb(29,vd=>{this.mergeSuspensionManager&&(this.statusBarManager=vd,vd.KJ(this),this.mergeSuspensionManager.mia.b1b(this.fQa))});this.Ka.X2(this.dQb)}Lq(cc){this.addHandler(qb.pAd,cc)}er(cc){this.removeHandler(qb.pAd,cc)}Rz(){this.raiseEvent(qb.pAd)}Fn(cc){return cc===
qb.y9i&&!!this.mergeSuspensionManager}ps(cc,Rc){if(!this.Fn(cc))return!1;this.mergeSuspensionManager&&(Rc.LabelText=this.Aoc,Rc.On=this.PBd);return!0}dispose(){this.dQb&&(this.Ka.Rcb(this.dQb),this.dQb.dispose(),this.dQb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.ana.ddb(this.sza),this.mergeSuspensionManager.mia.Uvc(this.fQa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.iG(this),this.statusBarManager=null);this.Aoc=null;super.dispose()}}qb.pAd=
"MSMSC";qb.y9i="QueryMergeSuspensionStatus";Object(b.a)(qb,"MergeSuspensionIndicatorManager",Mb.a,[214,215,3]);var Jb=a(7),Yb=a(879);class jb extends Sys.EventArgs{constructor(cc){super();this.Kxa=cc}}Object(b.a)(jb,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class ab{}Object(b.a)(ab,"SuspensionState",null,[]);class vb extends ab{constructor(cc){super();this.sue=!1;this.sue=cc}}Object(b.a)(vb,"ReadyForPendingMergeState",ab,[]);const Da=new ab,Fa=new ab,nb=new vb(!1),Ta=new vb(!0);
var V=a(880);class va extends V.a{constructor(cc,Rc,vd){super(cc);this.dRg=Rc;this.UJj=vd}}Object(b.a)(va,"ReadyForPendingMergesUpdatedEventArgs",V.a,[]);class wb extends Mb.a{constructor(cc,Rc,vd){super();this.sza=(Zd,pe)=>{Zd=this.getState();const Qe=this.g0;this.g0=pe.Kca;pe=this.getState();this.ECi(Zd,pe,Qe);this.raiseEvent(wb.kAd);this.qZe(Zd,pe)};this.fQa=(Zd,pe)=>{Zd=this.getState();this.uI=pe.uI;pe=this.getState();this.qZe(Zd,pe)};this.OGb=(Zd,pe)=>{this.B8a&&4===pe.Jwf&&(e.ULS.sendTraceTag(520480203,
0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",pa(this.g0),pa(pe.g0)),this.FRf(this.getState(),!0))};this.UAb=Oa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.B8a=Oa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.mia=cc;this.mia.b1b(this.fQa);this.ana=Rc;this.ana.c_a(this.sza);this.B8a&&(this.Oya=vd,this.Oya.Dse(this.OGb));
this.g0=Object(Jb.a)(new Yb.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.uI=this.Zei()}Zei(){return Object(Ua.a)(ya,this.mia)?Object(M.a)(ya,this.mia).rcc():1}g1b(cc){this.addHandler(wb.C_d,cc)}Yvc(cc){this.removeHandler(wb.C_d,cc)}COg(cc){this.addHandler(wb.$Kd,cc)}Tjj(cc){this.removeHandler(wb.$Kd,cc)}PNg(cc){this.addHandler(wb.kAd,cc)}pjj(cc){this.removeHandler(wb.kAd,cc)}yaj(){this.lKd(this.getState()===Fa)}dispose(){this.mia.Uvc(this.fQa);this.mia=null;this.ana.ddb(this.sza);this.ana=
null;this.B8a&&(this.Oya.iXf(this.OGb),this.Oya=null);super.dispose()}Lid(){return Object(Jb.a)(new Yb.a,{Current:this.g0.Current,Pending:this.g0.Pending,SuspensionStartTimestamp:this.g0.SuspensionStartTimestamp})}getState(){return Ma(this.g0)?0==this.uI?Ta:this.UAb&&1==this.uI?nb:Fa:Da}qZe(cc,Rc){cc!==Rc&&(Rc===Fa?this.lKd(!0):cc===Fa&&this.lKd(!1));this.FRf(Rc)}FRf(cc,Rc=!1){cc instanceof vb&&this.raiseEvent(wb.$Kd,new va(this.g0,cc.sue||!this.UAb,Rc))}ECi(cc,Rc,vd){cc===Da&&Rc!==Da?(cc=Rc===Fa,
Rc=Rc===nb,e.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Rc} publisher: ${Rc||cc?this.mia.pXj.join(","):""} counter: ${pa(this.g0)} isBlockingAllMerges: ${cc}`)):cc!==Da&&Rc===Da&&e.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${pa(vd)}`)}lKd(cc){this.raiseEvent(wb.C_d,new jb(cc))}}wb.C_d="TPMBBC";wb.$Kd="RFPMU";wb.kAd="MCC";Object(b.a)(wb,
"MergeSuspensionStateHandler",Mb.a,[]);class fc extends Mb.a{constructor(cc){super();this.v2=null;this.Mlc=0;this.REb=(Rc,vd)=>{(null===vd||void 0===vd?0:vd.Kca)&&this.$Pa(vd.Kca,fc.c4d)};this.Hyc=()=>{this.QZf();this.vRf(this.v2,fc.wnj)};this.oab=(Rc,vd)=>{vd.rsb&&this.v2.SuspensionStartTimestamp&&e.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${pa(this.v2)}`)};this.QZf();this.$=cc;this.$.ea.Xj(this.Hyc);this.$.ea.EM(this.Hyc);La.h(this.$).Vb.Qm(this.oab);
this.$.da.fb(292,Rc=>{Rc.c_a(this.REb);e.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}c_a(cc){this.addHandler("MCU",cc)}ddb(cc){this.removeHandler("MCU",cc)}get g0(){return this.v2}$Pa(cc,Rc=""){const vd=this.v2.Current<cc.Current||this.v2.Pending<cc.Pending;if(cc.SuspensionStartTimestamp&&this.Mlc!==cc.SuspensionStartTimestamp){if(this.Mlc>cc.SuspensionStartTimestamp){vd&&e.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Rc}. S: ${fc.QEb(cc)}, C: ${fc.QEb(this.v2)}`);
return}vd||e.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${fc.QEb(cc)}, C: ${fc.QEb(this.v2)}`)}else if(!vd)return;this.v2=cc;this.vRf(cc,Rc)}dispose(){this.$.ea.tk(this.Hyc);this.$.ea.gS(this.Hyc);La.h(this.$).Vb.fm(this.oab);const cc=this.$.da.Aa(292);cc&&cc.ddb(this.REb);super.dispose()}vRf(cc,Rc=""){Ma(cc)&&cc.SuspensionStartTimestamp>this.Mlc&&(e.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${pa(cc)}, Origin: ${Rc}`),
this.Mlc=cc.SuspensionStartTimestamp);this.raiseEvent("MCU",new V.a(cc))}QZf(){e.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${fc.QEb(this.v2)}`);this.v2=Object(Jb.a)(new Yb.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static QEb(cc){return cc?`(${cc.Current}/${cc.Pending} @${cc.SuspensionStartTimestamp})`:"null"}}fc.c4d="PMM.RTC";fc.K9b="PMM.EwaResult";fc.wnj="PMM.resetMergeCounter";Object(b.a)(fc,"PendingMergeMonitor",Mb.a,[]);class Fc{}Object(b.a)(Fc,
"ClientRevisions",null,[]);var Qa=a(46),la=a(60);const hb=(cc,Rc,vd,Zd,pe,Qe,bf,$e=null)=>{$e=cc.Oa(1,$e);$e.viewportState=Rc;$e.allowViewAdjustment=vd;return la.g(cc,"DoPendingMerge",$e,Zd,pe,Qe,bf,0)},Kb=(cc,Rc,vd,Zd,pe,Qe,bf=null)=>{bf=cc.Oa(1,bf);bf.suspensionStartTimestamp=Rc;return la.g(cc,"KeepBlockingPendingMerges",bf,vd,Zd,pe,Qe,0)};class dc extends Mb.a{constructor(cc,Rc,vd,Zd){super();this.FJa=null;this.SCb=0;this.TCb=this.k9a=null;this.WHf=(pe,Qe)=>{this.FJa.AUg(Qe.Kca,Qe.dRg,Qe.UJj)};
this.rHb=(pe,Qe)=>{Qe.Kxa?this.jMj():this.QBc()};this.kGf=()=>{this.SCb=0};this.i3f=()=>{const pe=this.x6.Lid();Kb(this.xa,null!=pe.SuspensionStartTimestamp?pe.SuspensionStartTimestamp:0,null,()=>{this.LUi(pe)},null,null,this.xa.Wb())};this.$Ca=(pe,Qe)=>{if(Qe){Qe.ppb.MergeCount=this.x6.Lid();let bf;({min:pe,max:bf}=La.h(this.$).KHi());Oa.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?Qe.ppb.ClientRevisions=Object(Jb.a)(new Fc,{Min:pe,Max:bf,MaxFromBlockCache:La.h(this.$).Da.iwf}):
Qe.ppb.ClientRevisions=Object(Jb.a)(new Fc,{Min:pe,Max:bf})}};this.$=cc;this.V_a=vd;this.x6=Rc;this.x6.COg(this.WHf);this.x6.g1b(this.rHb);this.x6.PNg(this.kGf);this.$.pa.vha(this.$Ca);this.xa=this.$.pa.xa;this.MOd=this.$.ya.MergeSuspensionRequestThrottlingTimeInMs;this.Uwi=this.$.ya.KeepBlockingPendingMergesRequestIntervalMs;this.FJa=Zd;e.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.pa.Ana(this.$Ca);this.QBc();this.x6.Tjj(this.WHf);this.x6.Yvc(this.rHb);this.x6.pjj(this.kGf);
this.x6=null;super.dispose()}jMj(){this.QBc();if(this.nNe()){const cc=this.x6.Lid();e.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${pa(cc)} fail count: ${this.SCb}`)}else this.TCb=this.V_a.create(this.i3f,this.MOd,Qa.a.TCb),this.k9a=this.V_a.dD(this.i3f,this.Uwi,Qa.a.k9a)}QBc(){this.k9a&&(this.TCb.cancel(),this.k9a.cancel(),this.k9a=this.TCb=null)}LUi(cc){let Rc;
Rc=" fail count: "+this.SCb;this.SCb++;this.nNe()&&this.QBc();e.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${pa(cc)}${Rc}`)}nNe(){return this.SCb>dc.qGi}}dc.qGi=5;Object(b.a)(dc,"RequestController",Mb.a,[]);var sb=a(156),bb=a(197),Ob=a(28),gc=a(282);class mb extends Sys.EventArgs{constructor(cc,Rc){super();this.Jwf=cc;this.g0=Rc}}Object(b.a)(mb,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class Nb extends Mb.a{constructor(cc,Rc,vd=null,
Zd=null,pe=null){super();this.Llc=null;this.YFd=0;this.documentVisibilityObserver=null;this.Ipf=!1;this.Rnc=null;this.xa=cc;this.MOd=Rc.ya.MergeSuspensionRequestThrottlingTimeInMs;const Qe=Rc.ya.GetRangeContentPrefetchDelayForMergeInMs;this.Py=()=>{Rc.R1f(Qe)};this.Nh=vd||Ob.a.Sa;this.Slg=0;this.TL=Zd;this.cBa=pe;Rc.da.fb(291,bf=>{this.documentVisibilityObserver=bf})}get cNa(){return 0<this.YFd}QNg(cc){this.addHandler(Nb.qAd,cc)}qjj(cc){this.removeHandler(Nb.qAd,cc)}Dse(cc){this.addHandler(Nb.lAd,
cc)}iXf(cc){this.removeHandler(Nb.lAd,cc)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.ki}AUg(cc,Rc,vd=!1){this.cOb(cc,Rc,vd)?(new sb.a).setResult(!0):(Rc=this.M3i(cc,Rc),this.Llc=cc,this.YFd++,Rc.continueWith(()=>{this.dQi()},0,bb.a.none,this.TL))}M3i(cc,Rc){this.Slg=this.Nh.lfa;this.Ipf=Rc;e.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${cc.Current} / ${cc.Pending} @${cc.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Rc}`);
this.isDocumentHidden||this.Py();return this.Vtj(Rc,cc)}cOb(cc,Rc,vd=!1){if(this.cBa&&!Rc&&!this.cBa.Yti())return e.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.Llc||cc.SuspensionStartTimestamp>this.Llc.SuspensionStartTimestamp)return this.cNa&&e.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${cc.Current} / ${cc.Pending} @${cc.SuspensionStartTimestamp}`),
!1;if(this.cNa)return!0;if(vd)return!1;vd=this.Llc;const Zd=this.Nh.lfa-this.Slg<this.MOd;Rc=this.Ipf===Rc;return(cc||vd?cc&&vd?cc.Current===vd.Current&&cc.Pending===vd.Pending&&cc.SuspensionStartTimestamp===vd.SuspensionStartTimestamp:!1:!0)&&Zd&&Rc}Vtj(cc,Rc){const vd=this.xa.Wb(),Zd=()=>{e.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Rc.Current} / ${Rc.Pending} @${Rc.SuspensionStartTimestamp}`)};return this.cBa?this.cBa.Dqj(this.CTh(cc,Zd,vd)):
this.dBe(null,!0,void 0,Zd,vd)}CTh(cc,Rc,vd){return(Zd,pe,Qe)=>{let bf=void 0;e.ULS.shipAssertTag(523317955,0,null!=Zd||cc,"!allowSelectionAdjustment requires a non-null initialViewportState.");bf=this.eQi.bind(this);pe&&(bf=gc.b.call(null,$e=>{const tf=$e.Result;let oe=null===tf||void 0===tf?void 0:tf.AdjustedViewportState;3===(null===tf||void 0===tf?void 0:tf.MergeResultState)&&(oe=void 0);pe(oe,$e.StateId)},bf));Qe&&(Rc=gc.a.call(null,Qe,Rc));return this.dBe(Zd,cc,bf,Rc,vd)}}dBe(cc,Rc,vd,Zd,pe){return hb(this.xa,
cc,Rc,vd,Zd,null,null,pe)}eQi(cc){var Rc=cc.Result;void 0!=Rc&&(Rc=Rc.MergeResultState,Oa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1)&&2!==Rc?this.Rnc=[Rc,cc.MergeCount]:3===Rc&&(e.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.Y$i()))}Y$i(){this.raiseEvent(Nb.qAd,new Sys.EventArgs)}X$i(cc,Rc){this.raiseEvent(Nb.lAd,new mb(cc,Rc))}dQi(){this.YFd--;if(this.Rnc){const cc=this.Rnc;this.Rnc=null;
this.X$i(...cc)}}}Nb.qAd="MWA";Nb.lAd="MDO";Object(b.a)(Nb,"DoPendingMergeSender",Mb.a,[794,795]);class ic{constructor(cc=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.Tdi=cc}get reportName(){return this.Tdi?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(ic,"SelectionAdjustSessionEndsReport",
null,[525]);var gb=a(40);class Eb{constructor(cc,Rc,vd,Zd,pe,Qe){this.jb=cc;this.LG=Rc;this.N9=vd;this.QYb=Zd;this.V5d=pe;this.pM=Qe}get activeCell(){return this.LG}get selectedRanges(){return this.N9}get Ds(){let cc=!1;if(null===this.pM||void 0===this.pM)cc=!0;else if(this.pM>=this.selectedRanges.length||!this.selectedRanges[this.pM].contains(this.activeCell))e.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.pM}, selectedRangesLength: ${this.selectedRanges.length}`),
cc=!0;cc&&(this.pM=this.r0g());return this.pM}get activeRange(){return 0>this.Ds?this.activeCell:this.selectedRanges[this.Ds]}get sheetName(){return this.QYb}get activeItemName(){return this.V5d}get kqg(){return 1===this.selectedRanges.length}$mg(cc){let Rc=this.selectedRanges.map(vd=>this.KUj(vd,this.V5d));for(let vd of Rc)if(vd)for(let Zd of vd)if(Zd.Qk&&Zd.ae.Revision<cc)return!1;return!0}PRj(){var cc;return{SheetName:this.sheetName,ActiveCell:null===(cc=this.activeCell)||void 0===cc?void 0:cc.toString(),
TopLeft:void 0,SelectedRanges:gb.r(this.selectedRanges,this.jb)}}toString(){var cc,Rc;return`active cell: ${null!==(Rc=null===(cc=this.activeCell)||void 0===cc?void 0:cc.toString())&&void 0!==Rc?Rc:"null"} selection: ${pb.f(this.selectedRanges,vd=>{var Zd;return null!==(Zd=null===vd||void 0===vd?void 0:vd.toString())&&void 0!==Zd?Zd:"null"}).join(",")}`}equals(cc){return cc?this.activeCell.equals(cc.activeCell)&&gb.Q(this.selectedRanges,cc.selectedRanges)&&this.sheetName===cc.sheetName:!1}r0g(){for(let [cc,
Rc]of this.selectedRanges.entries())if(null===Rc||void 0===Rc?0:Rc.contains(this.activeCell))return cc;return-1}KUj(cc,Rc){var vd;const Zd=La.h(this.jb).Da.X4a(cc,Rc);Zd||e.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(vd=null===cc||void 0===cc?void 0:cc.toString())&&void 0!==vd?vd:"null"} ; activeItemNameIsDefined: ${!!Rc}`);return Zd}}Object(b.a)(Eb,"SelectionState",null,[]);var Lc=a(213),Ec=a(740);class Cb{constructor(cc){this.KBc=
0;this.iH=this.JF=null;this.k6d=new ic;this.l6d=new ic(!0);this.kI=0;this.ZPj=!1;this.OHi=1E4;this.$c=()=>{this.jKe()};this.Jj=()=>{this.F_c(!0,!1)};this.fab=()=>{this.F_c(!1,!1)};this.$=cc;this.gridView=La.h(this.$);this.gridView.Da.lw(this.Jj);this.gridView.Da.pt(this.fab);this.gridView.Da.Kre(this.fab);this.gridView.Da.d$(this.fab);this.$.$k(this.$c);this.jKe()}Dqj(cc){let Rc=null,vd=null,Zd=()=>{this.HMi()};this.Bhf()?(this.XP.parallel++,e.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.iH}`)):
(Rc=(pe,Qe)=>{this.IMi(pe,Qe)},vd=this.Azj());return null===cc||void 0===cc?void 0:cc(vd,Rc,Zd)}Yti(){return!this.Bhf()&&this.fba().kqg}Azj(){var cc;e.ULS.shipAssertTag(525135961,0,0===this.kI,"SelectionAdjustManager.setPreRequestState: unexpected state");this.iH&&(this.XP.errors++,e.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.iH.toString()}`));this.iH=null;this.JF=this.fba();let Rc=null;const vd=null===(cc=this.JF)||
void 0===cc?void 0:cc.PRj();vd&&(Rc={ActiveSheetName:this.JF.sheetName,SheetViewportStateChanges:[vd]});this.kI=1;return Rc}HMi(){e.ULS.shipAssertTag(525135960,0,1===this.kI,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.XP.errors++;this.kI=2;this.zr()}IMi(cc,Rc){try{e.ULS.shipAssertTag(525135959,0,1===this.kI,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.KBc=Rc,Rc=2,this.JF?cc?(this.iH=this.$Cj(cc))?(Rc=7,this.JF.equals(this.iH)?this.JF.equals(this.fba())?
(this.XP.adjustedDidntChange++,Rc=4):(this.XP.adjustedDidntChangeWithDivergence++,Rc=5):this.JF.sheetName!=this.iH.sheetName?(this.XP.differentSheetAdjust++,Rc=10):this.JF.equals(this.fba())||(this.XP.divergenceOnResponse++,Rc=6,this.vYf())):this.XP.errors++:(this.XP.errors++,e.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.JF.toString()}`)):(this.XP.errors++,e.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===
cc||void 0===cc?void 0:cc.ActiveCell}`)),this.kI=Rc}catch(vd){this.kI=12,e.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${vd}`)}finally{7!=this.kI?this.zr():this.F_c(!1,!0)}}dispose(){this.gridView.Da.jx(this.Jj);this.gridView.Da.dr(this.fab);this.gridView.Da.wWf(this.fab);this.gridView.Da.IRa(this.fab);this.$.ul(this.$c)}Bhf(){return 1===this.kI||7===this.kI}$Cj(cc){let Rc;if(!({range:Rc}=gb.Z(cc.ActiveCell,this.$.va)).returnValue)return e.ULS.sendTraceTag(537155411,
0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${cc.ActiveCell}`),null;let vd=[];const Zd=this.$.na,pe=!!Zd&&2===Zd.uG;if(cc.SelectedRanges)vd=gb.g(cc.SelectedRanges.Ranges);else if(!pe)return e.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!Zd}`),null;return new Eb(this.$,Rc,vd,cc.SheetName,this.JF.activeItemName,this.JF.Ds)}fba(){const cc=this.$.na;if((null===
cc||void 0===cc?0:cc.activeCell)&&cc.selectedRanges&&cc.sheetName)return new Eb(this.$,cc.activeCell,cc.selectedRanges,cc.sheetName,this.$.activeItemName,cc.Ds);e.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!cc}, activeCell null: ${!(null===cc||void 0===cc?0:cc.activeCell)}, selectedRanges null: ${!(null===cc||void 0===cc?0:cc.selectedRanges)}, sheetName null: ${!(null===cc||void 0===cc?0:cc.sheetName)}`);return null}jKe(){this.$.da.fb(276,
()=>{const cc=Lc.a(this.$);cc.TY(this.k6d);cc.TY(this.l6d)})}F_c(cc,Rc){var vd;if(this.gsi(cc))if(8===this.kI)e.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Rc&&e.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{e.ULS.shipAssertTag(525135956,0,7===this.kI,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.JF.equals(this.fba())?(null===(vd=
this.gridView)||void 0===vd?0:vd.gb)?(this.XP.editBoxDivergence++,this.kI=11):(cc=0,cc=this.iH.Ds,-1==cc?(this.XP.errors++,e.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.XP.adjusted++,this.kI=8,this.gridView.ha.rx(this.iH.selectedRanges,cc,this.iH.activeCell,0,void 0,"SelectionAdjust"))):(this.XP.divergenceOnViewportReady++,this.vYf(),this.kI=9)}catch(Zd){this.kI=12,e.ULS.sendTraceTag(525135955,0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${Zd}`)}finally{this.zr()}}}gsi(cc){if(!this.iH)return!1;
if(!this.JF)return e.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.iH.toString()}`),!1;if(La.h(this.$).Da.iwf<this.KBc)return!1;if(cc||this.ZPj)e.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");else if(!this.JF.$mg(this.KBc)||!this.iH.$mg(this.KBc))return!1;return!0}zr(){this.JF=this.iH=
null;this.kI=0}vYf(){const cc=this.fba();e.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.JF.toString()} current: ${cc?cc.toString():""} adjusted: ${this.iH.toString()} sheetSameBetweenInitialAndAdjusted: ${this.JF.sheetName===this.iH.sheetName} sheetSameBetweenInitialAndCurrent: ${this.JF.sheetName===(cc?cc.sheetName:null)}`)}get XP(){return Ec.a.AD(this.OHi)?this.l6d:this.k6d}}Object(b.a)(Cb,"SelectionAdjustManager",null,[796,3]);class eb extends Ka.a{constructor(cc,
Rc,vd=null){super();this.JDa=this.Vgc=this.Q6a=this.a1a=null;e.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=cc;this.oYa=new fc(cc);this.cBa=new Cb(this.$);this.FJa=new Nb(this.$.pa.xa,this.$,void 0,void 0,this.cBa);this.tfi(cc,vd);this.oga=new wb(this.JDa,this.oYa,this.FJa);this.HOd=new dc(cc,this.oga,Rc,this.FJa);Oa.EwaSettings.oa(244)&&(this.Vgc=new qb(cc,this));e.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}g1b(cc){this.oga.g1b(cc)}Yvc(cc){this.oga&&
this.oga.Yvc(cc)}get mia(){return this.JDa}get ana(){return this.oYa}get x6(){return this.oga}BAa(cc,Rc){this.JDa.BAa(cc,Rc)}u1d(cc){this.JDa.u1d(cc)}$Pa(cc,Rc=""){this.oYa.$Pa(cc,Rc)}dispose(){this.Vgc&&(this.Vgc.dispose(),this.Vgc=null);this.cBa&&this.cBa.dispose();this.FJa.dispose();this.HOd&&(this.HOd.dispose(),this.HOd=null);this.oga&&(this.oga.dispose(),this.oga=null);this.oYa.dispose();this.oYa=null;this.JDa.dispose();this.JDa=null;this.a1a&&(this.a1a.dispose(),this.a1a=null);this.Q6a&&(this.Q6a.dispose(),
this.Q6a=null);this.$=null;super.dispose()}iJb(){this.oga.yaj()}static rcc(cc){let Rc=0;for(let vd of cc){if(2==vd)return 2;1==vd&&(Rc=1)}return Rc}tfi(cc,Rc){this.JDa=new ya(this.FJa,this.oYa);Rc?Object(Ua.a)(kb,Rc)?this.BAa(Rc,Object(M.a)(kb,Rc).uI):Object(Ua.a)(Ab,Rc)?this.BAa(Rc,Object(M.a)(Ab,Rc).uI):this.BAa(Rc,0):(this.a1a=new Ab(cc),this.Q6a=new kb(cc),this.BAa(this.a1a,this.a1a.uI),this.BAa(this.Q6a,this.Q6a.uI))}}Object(b.a)(eb,"MergeSuspensionManager",Ka.a,[771,3]);class Sb extends ha.a{constructor(cc){super();
this.Mc=cc;this.Fb()}create(){e.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.ob(this.Mc.da.Aa(343)||this.Mc.da.Ga(343,new eb(this.Mc,ba.a.instance)))}static la(cc){e.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");cc.da.Ga(344,new Sb(cc))}}Object(b.a)(Sb,"MergeSuspensionFactory",ha.a,[]);var ld=a(48),bd=a(37),ec=a(89),sc=a(98),Dc=a(58),Ud=a(13);class Ed{}Ed.xzi=3;Ed.connected=0;Object(b.a)(Ed,"ConnectionStateConstants",null,[]);var $d=a(110),ve=a(118),ze=
a(44);class We{constructor(cc,Rc,vd){var Zd;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.cBf=(pe,Qe)=>{this.blockedOperationsCount++;pe=`${Qe.componentName}_${Qe.actionName}_${Qe.details})`;
this.blockedActions[pe]=this.blockedActions[pe]?this.blockedActions[pe]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.UFd=pe=>{this.durationUntilUserInactive=$d.getElapsedSeconds(this.startTime,Ob.a.Sa.zb);pe.PNd(this.UFd)};this.rW=()=>{this.hasTabbedOut=!0};this.jda=(pe,Qe)=>{Qe.QMf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=ve.a(Ob.a.Sa,this.startTime),this.toastRaiser=Qe.toastRaiser,this.isToastShown=!0)};this.startTime=cc;this.durationUntilToastShownMs=
0;this.blockedActions={};this.isToastShown=vd;if(null===(Zd=Rc.ea)||void 0===Zd?0:Zd.Re)this.wasUserActiveOnPIStart=Rc.ea.Re.Hr;this.Oj(Rc);this.isDialogShown=0<Rc.rb.WR;cc=Rc.da.Aa(183);this.isTaskPaneShown=!!cc&&cc.isVisible&&!cc.isCollapsed;this.isTaskPaneCollapsed=!!cc&&cc.isVisible&&cc.isCollapsed}Z4f(){this.durationMs=ve.a(Ob.a.Sa,this.startTime)}aFd(cc){var Rc;this.Z4f();ze.a(cc).Svc(this.cBf);ze.a(cc).Zf.Tvc(this.jda);cc.da.fb(291,vd=>{vd.Ycb(this.rW)});if(null===(Rc=cc.ea)||void 0===Rc?0:
Rc.Re)cc.ea.Re.PNd(this.UFd),this.wasUserActiveOnPIEnd=cc.ea.Re.Hr}Oj(cc){ze.a(cc).X0b(this.cBf);this.isToastShown?this.toastRaiser="Immediate":ze.a(cc).Zf.uYc(this.jda);cc.da.fb(291,Rc=>{this.hasTabbedOut=Rc.ki;Rc.MGa(this.rW)});this.wasUserActiveOnPIStart&&cc.ea.Re.ste(this.UFd)}}Object(b.a)(We,"PartialInteractivityData",null,[]);var md=a(1118);class $b extends We{constructor(cc,Rc,vd,Zd,pe,Qe){super(cc,Rc,Zd);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=
this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=vd;this.disconnectionSource=Enum.toString(md.a,pe);this.triggeringRequest=Qe}bPi(cc,Rc){this.swappedByOffline=Rc;this.aFd(cc)}nxj(cc){this.errorDataDuringConnectivityIssuesMode=cc}Kcj(cc){10>this.failedRequests.length&&(cc=cc+"_"+$d.getElapsedSeconds(this.startTime,
Ob.a.Sa.zb).toString(),this.failedRequests.push(cc))}}Object(b.a)($b,"ConnectivityIssuesData",We,[]);var $c=a(159),nd=a(124),Oc=a(112);class Gd{}Gd.oqh="DuringWork";Gd.connectivityIssues="ConnectivityIssues";Gd.offline="Offline";Object(b.a)(Gd,"UnavailabilityTypes",null,[]);var Qd=a(51);class Ad{constructor(cc){this.Flc=this.data=null;this.$cd=0;this.VGe=null;this.lCf=(Rc,vd)=>{vd.zM?(this.data=new $b(Ob.a.Sa.zb,this.$,5===vd.Noa,0!==vd.Noa,this.$.Te.disconnectionSource,this.VGe),this.Flc=this.$.Te.Aqf,
this.$cd=1,this.$.pa.Te.FPg(this.zm),$c.a(this.$).cYc(this.i1f)):(this.data.bPi(this.$,5===vd.Noa),this.$.pa.Te.EXf(this.zm),this.data.lastFailedRequestToOnlineTimeGapSec=$d.getElapsedSeconds(this.Flc,Ob.a.Sa.zb),Oa.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?Qd.b().IMb(557682689,0,50,Gd.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",Dc.a.fc(this.data)):
e.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${Dc.a.fc(this.data)}`),this.data&&this.data.isToastShown&&sc.Health.instance.recordQosError(nd.a.z5g,[Oc.a.qmc],!0,!1,!1,!1,null),$c.a(this.$).gNd(this.i1f),this.data=null)};this.i1f=(Rc,vd)=>{this.data.nxj(vd.fV)};this.zm=(Rc,vd)=>{this.data.Kcj(vd.context.methodName);Rc=Ob.a.Sa.zb;vd=$d.getElapsedSeconds(this.Flc,Rc);this.Flc=Rc;vd>this.data.longestDurationBetweenFailedRequestsSec&&
(this.data.longestDurationBetweenFailedRequestsSec=vd);this.$cd++;this.data.averageDurationBetweenFailedRequestsSec=this.f0g(vd)};this.iCf=(Rc,vd)=>{this.VGe=vd.iUj};this.$=cc;ze.a(this.$).Zf.Ure(this.lCf);this.$.Te.Tre(this.iCf)}dispose(){this.$&&(ze.a(this.$).Zf.HWf(this.lCf),this.$.Te&&this.$.Te.GWf(this.iCf));this.data&&this.$.pa.Te.EXf(this.zm);this.$=null}f0g(cc){const Rc=this.$cd-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Rc-1)+cc)/Rc}}Object(b.a)(Ad,"ConnectivityIssuesTelemetryManager",
null,[3]);var Sd=a(853),Ce=a(8),we=a(1266),Td=a(1117);class he{constructor(cc){this.k0f=null;this.$vd=this.yAd=this.QFb=this.RFb=0;this.qVd=!1;this.f5c=this.$Ta=this.nBc=this.I$a=null;this.t5c=0;this.Qtj=()=>{if(12E4>this.$.ea.Re.ggb)for(let Rc of this.nBc)Rc.runTest();else this.oYd("UserInactive")};this.xmj=Rc=>{Rc=Sys.Serialization.JavaScriptSerializer.serialize(Rc);e.ULS.sendTraceTag(388821830,0,50,Rc)};this.Plj=Rc=>{if(Rc){var vd=this.f5c[Rc.testIteration.toString()];vd?vd.push(Rc):(vd=[Rc],this.f5c[Rc.testIteration.toString()]=
vd);if(vd.length===this.k0f.length){vd=Sys.Serialization.JavaScriptSerializer.serialize(vd);if(this.$&&this.$.Te){if(Rc.EstimatedLatency=this.$.Te.mye,this.$.Te.mye>this.$.sv.ExcelRountripThresholdMs){e.ULS.sendTraceTag(570712144,0,50,`Periodic ping tests results when network is slow: ${vd}, consequtive slow ping iteration #: ${this.t5c++}`);return}}else e.ULS.sendTraceTag(537155209,0,50,"EwaControl/ConnectivityObserver is null when conducting slow connection speed tests");e.ULS.sendTraceTag(570712142,
0,50,`Periodic ping tests results: ${vd}`);this.t5c=1}}};this.hh=(Rc,vd)=>{Rc=vd.context.methodName;if(Rc===Ce.a.Zxb||Rc===Ce.a.mwa)this.QFb++,Rc=Date.now(),this.DEj(Rc)&&(this.QFb=0,this.$vd=Rc,this.BMj())};this.ida=()=>{this.SXd("OnThrottledUserActivity")};this.rW=()=>{this.oYd("OnDocumentHidden")};this.LR=()=>{this.SXd("OnDocumentUnhidden")};this.$=cc;if(this.rVd=this.M3g())this.k0f=[Td.a.KGc],this.t5c=1,this.f5c={},this.$.ea.Re.uha(this.ida),this.$.da.fb(291,Rc=>{Rc.MGa(this.rW);Rc.NGa(this.LR)})}dispose(){this.$&&
(this.qVd&&this.$.pa&&0<this.I$a.count&&this.$.pa.Lr(this.hh),this.rVd&&(this.oYd("Dispose"),this.$.ea.Re.IAa(this.ida)))}Yei(){Oa.EwaSettings.oa(208)&&this.C6i();this.rVd&&this.D6i()}ufi(){this.QFb=this.RFb;this.$vd=0;var cc={};if(!this.I$a){this.I$a=new W.a;const Rc=we.a.Jfd(this.xmj,"InitSampleMeasurement",this.$);for(const vd of Rc)cc[vd.Hnd]=vd.baseUrl,this.I$a.add(vd)}cc=Sys.Serialization.JavaScriptSerializer.serialize(cc);e.ULS.sendTraceTag(537155210,0,50,`Init Network measurement: numberOfRequestToWaitPerNetworkMeasurement: ${this.RFb}, numberOfRequestFromTheLastNetworkMeasurement: ${this.QFb}, testParams: ${cc} `);
0<this.I$a.count&&this.$.pa.Mq(this.hh)}BMj(){for(let cc of this.I$a)cc.runTest()}SXd(cc){this.$Ta&&this.$Ta.qq||(e.ULS.sendTraceTag(537155208,0,50,`NetworkMeasurement.StartConnectionSpeedTest: starting ping tests. caller: ${cc}`),this.$Ta=ba.a.instance.dD(this.Qtj,5E3,Qa.a.vKj),this.$Ta.RV())}oYd(cc){this.$Ta&&this.$Ta.qq&&(e.ULS.sendTraceTag(537155207,0,50,`NetworkMeasurement.StopConnectionSpeedTest: stopping ping tests. caller: ${cc}`),this.$Ta.cancel())}DEj(cc){return this.QFb>=this.RFb&&cc-this.$vd>
this.yAd}M3g(){return he.a0f(this.$.ya.SlowNetworkMeasurementsSamplePercentage)}C6i(){this.RFb=this.$.ya.NumberOfRequestToWaitPerNetworkMeasurement;this.yAd=1E3*this.$.ya.MinTimeBetweenNetworkMeasurementInSec;const cc=this.$.ya.NetworkMeasurementsSamplePercentage;0<this.RFb&&0<this.yAd&&(this.qVd=he.a0f(cc))&&this.ufi()}D6i(){if(!this.nBc){this.nBc=new W.a;const cc=we.a.Jfd(this.Plj,"PrepareAndInitSlowNetworkTests.ConnectionSpeedTest",this.$,[Td.a.KGc]);for(const Rc of cc)this.nBc.add(Rc);this.$.ea.Re.Hr&&
this.SXd("PrepareAndInitSlowNetworkTests")}}static a0f(cc){return 100*Math.random()<cc}}Object(b.a)(he,"NetworkMeasurement",null,[3]);var ee=a(128),ge=a(753);class re{constructor(cc){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=cc}get count(){return this._count}get HU(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}LYj(){this.HU&&
this.HU.Z4f()}bKg(cc){this.allOfflinePartialInteractivitiesDataInSession.push(cc);this._count++}}Object(b.a)(re,"OfflinePartialInteractivitiesDataForLog",null,[]);class Be extends We{constructor(cc,Rc,vd){super(cc,Rc,vd);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}UAj(cc){this.timeFromLastOffline=cc}oxj(cc){this._errorDataDuringOfflineMode=cc}}Object(b.a)(Be,"OfflinePartialInteractivityData",We,[]);class Oe{constructor(cc,Rc){this.FPa=this.HU=
null;this.VId=-1;this.hwb=null;this.uqf=x.Task.delay(0);this.Fab=(vd,Zd)=>{Zd.zM?this.mWi(Zd.Noa):this.nWi()};this.jda=(vd,Zd)=>{5===Zd.QMf&&this.p4a()};this.j1f=(vd,Zd)=>{this.HU.oxj(Zd.fV)};this.p4a=()=>{this.FPa.LYj();this.vrj(Oe.YGd,Sys.Serialization.JavaScriptSerializer.serialize(this.FPa))};this.nmj=vd=>{if(vd=vd.result)this.sng=!0,e.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${vd}`)};
this.Cgj=()=>{this.sng&&(this.$?bd.TaskExtensions.za(this.indexedDB.u8b(Oe.YGd),()=>{e.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.ka):e.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.KPa=()=>{if(this.FPa&&0<this.FPa.count){const vd=Sys.Serialization.JavaScriptSerializer.serialize(this.FPa);
e.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${vd}`)}};this.$=cc;this.indexedDB=Rc;this.sng=!1;this.indexedDB.Zd()&&(this.indexedDB.initialize(Oe.Wzb,Oe.Xzb),this.Klj(),this.FPa=new re(this.$.ya.UserSessionId),ze.a(this.$).Zf.mYc(this.Fab));this.Fm=ee.a.instance.vH();this.Fm.la("beforeunload",this.KPa)}dispose(){this.$&&ze.a(this.$)&&ze.a(this.$).Zf.sNd(this.Fab);ec.a.Ia(this.hwb);this.$=this.hwb=null}mWi(cc){this.HU=
new Be(Ob.a.Sa.zb,this.$,0!==cc);this.HU.UAj(-1!==this.VId?window.performance.now()-this.VId:-1);this.FPa.bKg(this.HU);ze.a(this.$).Zf.uYc(this.jda);this.p4a();this.hwb=ba.a.instance.dD(this.p4a,Oe.WIh,Qa.a.p4a);$c.a(this.$).cYc(this.j1f)}nWi(){this.HU.aFd(this.$);this.p4a();ec.a.Ia(this.hwb);this.hwb=null;this.VId=window.performance.now();ze.a(this.$).Zf.Tvc(this.jda);$c.a(this.$).gNd(this.j1f);this.Qlj()}vrj(cc,Rc){this.$?this.uqf=bd.TaskExtensions.za(this.uqf,()=>{this.indexedDB.Ona(new ge.a(cc,
Rc))},this.$.ka):e.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}Klj(){const cc=this.$.ka;bd.TaskExtensions.za(bd.TaskExtensions.za(this.indexedDB.jba(Oe.YGd),this.nmj,cc),this.Cgj,cc)}Qlj(){if(this.HU){const cc=Sys.Serialization.JavaScriptSerializer.serialize(this.HU);Oa.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?Qd.b().IMb(560791645,0,50,Gd.offline,this.HU.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",cc):e.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${cc}`)}this.HU&&this.HU.isToastShown&&sc.Health.instance.recordQosError(nd.a.G1j,[Oc.a.qmc],!0,!1,!1,!1,null)}}Oe.Wzb="NetworkAvailability";Oe.Xzb="NetworkAvailabilityData";Oe.YGd="partialInteractivityData";Oe.WIh=3E3;Object(b.a)(Oe,
"OfflineModeTelemetryManager",null,[3]);class gf{constructor(cc,Rc){this.mma=this.BBd=this.Wzf=null;this.$=cc;Oa.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&Y.a.Jf||(this.Wzf=new Oe(cc,Rc));Oa.EwaSettings.oa(208)&&(this.BBd=new he(this.$),this.BBd.Yei());!Oa.EwaSettings.oa(520)||Oa.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&Y.a.Jf||(this.mma=new Sd.NetworkConnectionHealthChecker(this.$));this.m9g=new Ad(this.$)}dispose(){ec.a.Ia(this.Wzf);
ec.a.Ia(this.BBd);ec.a.Ia(this.mma);ec.a.Ia(this.m9g);this.$=null}}Object(b.a)(gf,"NetworkConnectionTelemetryManager",null,[3]);class af extends We{constructor(cc,Rc,vd,Zd){super(cc,Rc,vd);this.wasInteruptedByOfflineMode=!1;this.type=Zd;this.wasInteruptedByOfflineMode=!1}Fab(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(af,"SilentReopenData",We,[]);class Ze{constructor(cc){this.Y7=null;this.RJf=(Rc,vd)=>{this.OJf(vd,3)};this.eGf=(Rc,vd)=>{this.OJf(vd,2)};this.$=cc;this.Zf=ze.a(this.$).Zf;this.Zf.Ase(this.eGf);
this.Zf.gPg(this.RJf)}dispose(){this.Zf.gXf(this.eGf);this.Zf.tkj(this.RJf);this.Y7=this.Zf=this.$=null}OJf(cc,Rc){cc.zM?this.Y7=new af(Ob.a.Sa.zb,this.$,0!==cc.Noa,Rc):(5===cc.Noa&&(this.Y7.wasInteruptedByOfflineMode=!0),3!==cc.Noa&&2!==cc.Noa||e.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.Y7.aFd(this.$),2===Rc?Oa.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?
Qd.b().JMb(571289604,0,50,Gd.offline,this.Y7.durationMs,this.Y7):e.ULS.sendTraceTag(571289604,0,50,Dc.a.fc(this.Y7)):Oa.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?Qd.b().JMb(542782150,0,50,Gd.oqh,this.Y7.durationMs,this.Y7):e.ULS.sendTraceTag(542782150,0,50,Dc.a.fc(this.Y7)),this.Y7=null)}}Object(b.a)(Ze,"SilentReopenPartialInteractivityTelemetryManager",null,[3]);class Xa extends Mb.a{constructor(cc,Rc,vd=!0){super();this.j1=this.O5b=this.GPa=
this.yoa=this.VTa=null;this.hyf=0;this.Xuc=this.Lcb=this.Mcb=!1;this.iyf=this.documentVisibilityObserver=null;this.Qqa=!1;this.Bod=this.g8=0;this.YBb=!1;this.Aag=0;this.iVd=!1;this.v1=null;this.QGf=()=>{e.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.coc(1,!1)};this.LR=()=>{this.ola||this.mEb?window.setTimeout(()=>{this.B_d()},this.hyf):this.B_d();this.documentVisibilityObserver.JRa(this.LR);this.YBb=!1};this.jg=()=>{e.ULS.sendTraceTag(537155218,
0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.mEb}, IsInDuringWorkSilentReopenMode:${this.$mc&&!this.Qqa}`);this.mEb&&this.Toe();this.$mc&&!this.Qqa&&this.Qoe();La.h(this.$).jc.fm(this.jg);this.Mcb=this.Lcb=!1};this.RGf=()=>{e.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.coc(1,!0);this.Lcb&&!this.Mcb&&La.h(this.$).jc.fm(this.jg);this.Lcb=!1};this.ida=(Zd,pe)=>{this.Bod=this.g8;this.g8=pe.eDc};
this.QJf=()=>{this.$&&(this.Xuc||(Na.a(this.$).RQ(Ea.a.qQa).PMg(this.$Gf),this.$.$k(this.$c),this.Xuc=!0),this.Qqa=this.nli(),this.coc(2,!1))};this.$Gf=()=>{var Zd=Na.a(this.$).gi;const pe=Zd.XSg();Zd=pb.f(Zd.ft.hd.errors,Qe=>Qe.MessageIdName);e.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${pe}, IsB2W:${this.Qqa}, Errors: ${Dc.a.fc(Zd)}`);pe&&(this.VTa?(this.Qqa=!1,this.ELe(),this.gEc()):this.yoa&&(this.FLe(),this.gEc()))};
this.$c=()=>{this.$?(e.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.Qqa=!1,this.j1&&this.j1.qq&&(ec.a.Ia(this.j1),this.j1=null),this.v1&&this.v1.qq&&(ec.a.Ia(this.v1),this.v1=null),this.coc(2,!0),this.gEc()):e.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.jCf=()=>{this.gxf(!0)};this.kCf=()=>{this.gxf(!1)};this.IYb=Ed.xzi;this.p5c=Ed.connected;this.$=cc;this.Te=
cc.pa.Te;vd&&(this.iyf=new gf(cc,Rc));this.$.da.fb(291,Zd=>{this.documentVisibilityObserver=Zd});this.hyf=this.$.ya.ExcelNetworkCheckAfterTabActivationDelayMs;this.Te.Gse(this.QGf);this.Te.Wob(this.RGf);this.Te.Tre(this.jCf);this.Te.uMg(this.kCf);new Ze(this.$,this);this.Otf=this.$.ya.LongInactivityTimePeriodSeconds;this.$.ea.JYc(this.QJf);this.$.ea.Re.uha(this.ida);this.Aag=this.$.ya.SilentReopenDuringWorkDelayMs}get rni(){return this.Qqa}get mEb(){return!(this.IYb&1)}get $mc(){return!(this.IYb&
2)}get ola(){return!!(this.p5c&2)}dispose(){this.Te&&(this.Te.lXf(this.QGf),this.Te.DKb(this.RGf),this.Te.GWf(this.jCf),this.Te.hij(this.kCf));this.YBb&&this.documentVisibilityObserver&&(this.documentVisibilityObserver.JRa(this.LR),this.YBb=!1);this.$&&(this.Xuc&&this.gEc(),this.$.ea&&(this.$.ea.xXf(this.QJf),this.$.ea.Re&&this.$.ea.Re.IAa(this.ida)));this.v1&&(this.v1.dispose(),this.v1=null);ec.a.Ia(this.iyf);this.$=null;super.dispose()}NFi(){this.iVd=!0}Qoe(){this.yoa||(this.yoa=ze.a(this.$).Zf.DZa(3,
"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}nli(){if(this.iVd)return this.iVd=!1,!0;const cc=this.g8>this.Otf||this.Bod>this.Otf&&10>this.g8;e.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.g8}, Time gap between last two activities: ${this.Bod}. return value:${cc}`);return cc}Amj(){this.v1=ba.a.instance.create(()=>{sc.Health.instance.recordQosError(nd.a.AKj,[Oc.a.qmc],
!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}AHg(){this.yoa||this.j1?e.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):this.j1=ba.a.instance.create(()=>{this.$?this.yoa?e.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):
La.h(this.$).gb?(this.Lcb||(La.h(this.$).jc.Qm(this.jg),e.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),this.Mcb=!0,e.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.Qoe():e.ULS.sendTraceTag(537155222,
0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.Aag,Qa.a.yJj,void 0,!0)}gxf(cc){this.p5c=this.KAe(2,cc,!0);this.Pte()}coc(cc,Rc){this.IYb=this.KAe(cc,Rc,!1);this.Pte()}KAe(cc,Rc,vd){vd=vd?this.p5c:this.IYb;return Rc?vd|cc:vd&~cc}B_d(){const cc=!!this.GPa,Rc=!!this.VTa,vd=!!this.yoa,Zd=!!this.O5b;this.mEb&&!cc?this.zHg():!this.mEb&&cc&&this.Tjh();!this.$mc||Rc||vd?this.$mc||(Rc?this.ELe():(vd||this.j1&&this.j1.qq)&&this.FLe()):this.Qqa?this.xHg():
this.j1||this.AHg();this.ola&&!Zd?this.Efg(!0):!this.ola&&Zd&&this.Efg(!1)}zHg(){this.$?this.GPa?e.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):La.h(this.$).gb?(this.Mcb||(La.h(this.$).jc.Qm(this.jg),e.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),
this.Lcb=!0,e.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.Toe():e.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}Toe(){this.GPa||(this.GPa=ze.a(this.$).Zf.DZa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}Tjh(){this.GPa&&(ec.a.Ia(this.GPa),this.GPa=
null)}ELe(){this.VTa&&(ec.a.Ia(this.VTa),this.VTa=null);this.v1&&this.v1.qq&&this.v1.cancel();this.v1=null}FLe(){this.yoa&&(ec.a.Ia(this.yoa),this.yoa=null);this.j1&&(ec.a.Ia(this.j1),this.j1=null);this.Mcb&&!this.Lcb&&La.h(this.$).jc.fm(this.jg);this.Mcb=!1}xHg(){this.VTa||(this.VTa=ze.a(this.$).Zf.DZa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",void 0,Ud.a.instance.ga(2184)));this.Amj()}Efg(cc){cc?(this.O5b=ze.a(this.$).Zf.DZa(4,"NetworkConnectionStateManager.ConnectivityIssues"),
this.z9i()):(ec.a.Ia(this.O5b),this.O5b=null)}z9i(){if(this.$&&this.$.pa){const cc=this.$.pa.xa.Wb();la.I(this.$.pa.xa,null,null,null,cc)}}gEc(){Na.a(this.$).RQ(Ea.a.qQa).er(this.$Gf);this.$.ul(this.$c);this.Xuc=!1}Pte(){this.documentVisibilityObserver||e.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");this.documentVisibilityObserver&&this.documentVisibilityObserver.ki?this.YBb||
(this.documentVisibilityObserver.NGa(this.LR),this.YBb=!0,e.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.B_d()}}Object(b.a)(Xa,"NetworkConnectionStateManager",Mb.a,[774,3]);class qa extends ha.a{constructor(cc){super();this.$=cc;this.Fb()}create(){bd.TaskExtensions.za(ld.GetServiceTaskFactory.Na(this.$.da,395,396,this.Ya),cc=>{let Rc=Object(ja.a)(this.$.da,
400,()=>new Xa(this.$,cc.result));this.ob(Rc)},this.$.ka,3)}static la(cc){cc.da.Ga(401,new qa(cc))}}Object(b.a)(qa,"NetworkConnectionStateManagerFactory",ha.a,[]);var xa=a(1256),ob=a(1159),Ib=a(1218),Zb=a(120),zc=a(107),Mc=a(147),hd=a(325);class id{constructor(cc){this.aPa=this.ezd=this.ePa=this.lnc=0;this.Yyd=this.Zuf=null;cc?(this.unc=cc,this.Stb=Date.now,this.Cfh(),this.efj()):e.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}nzj(){this.Zuf=
"Office.Excel.Online.Data.Activity.PenMinutes"}efj(){window.document.body.addEventListener("pointerenter",Object(z.a)(this,this.Wqc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(z.a)(this,this.fda,"onPointerLeave"));fa.a.instance.Rb("Common.App.VisibilityManagement.IVisibilityManager").execute(cc=>{cc.Use(Object(z.a)(this,this.Jyb,"handleVisibilityChange"))})}Wqc(cc){"pen"!==cc.pointerType||this.ePa||(this.ePa=Math.floor(this.Stb()/1E3),this.ePa<=this.lnc&&(this.ePa=
this.lnc),this.ezd=0)}fda(){this.$af()}$af(){const cc=Math.ceil(this.Stb()/1E3);this.ePa&&cc>this.lnc&&(this.ezd=cc,this.aPa+=this.ezd-this.ePa);this.lnc=cc;this.ePa=0}Jyb(cc,Rc){0!==Rc.newState&&this.$af()}Cfh(){this.Yyd=new zc.a(4,2,6E4,Object(z.a)(this,this.DCi,"logPenUsage"));this.unc.Eg(this.Yyd)}DCi(){0<this.aPa&&this.q3f(this.aPa);this.aPa=0}q3f(cc){const Rc=new hd.a;Rc.name=this.Zuf;const vd=[];(cc=Zb.a.qh("PenInputSec",cc.toString(),3))&&Array.add(vd,cc);Rc.dataFields=vd;Mc.a.sendActivityEvent(Rc)}dispose(){0<
this.aPa&&this.q3f(this.aPa);this.unc.rp(this.Yyd)}}Object(b.a)(id,"PenMinutesManager",null,[316]);class yd{constructor(){this.IRc=this.$a=null}get name(){return"Common.App.PenMinutesManager"}Oh(cc){this.$a=cc;const Rc=f.AFrameworkApplication.Fi;this.$a.register(316,"Common.App.PenMinutesManager.IPenMinutesManager").wc().Ac(()=>new id(Rc))}init(){this.IRc=this.$a.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.IRc&&this.IRc.dispose()}static main(){K.a.instance.vi(new yd)}}
Object(b.a)(yd,"PenMinutesManagerPackage",null,[4,5]);class Yd extends ha.a{constructor(cc){super();this.$=cc;this.Fb()}static la(cc){cc.da.Ga(514,new Yd(cc))}create(){this.ob(Object(ja.a)(this.$.da,513,()=>{Type.registerNamespace("Common.App.PenMinutesManager");yd.main();const cc=fa.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");cc.nzj();return cc}))}}Object(b.a)(Yd,"PenMinutesFactory",ha.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");
Object(c.a)();Object(Ra.a)();Object(Ya.a)();Object(Ga.a)();Object(da.a)();Object(ka.a)();Object(ra.a)();Object(Ib.a)();Type.registerNamespace("Common.App.InProductMessaging");na.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");ia.main();(()=>{Z.a.Fa(()=>{Z.a.Fa(ua.la)})})();(()=>{Z.a.Fa(()=>{Z.a.Fa(Pa.la)})})();Z.a.Fa(Sb.la);Z.a.Fa(qa.la);(()=>{Z.a.Fa(cc=>{Yd.la(cc)})})();Object(xa.a)();Object(ob.a)()},853:function(t,E,a){a.r(E);t=a(0);var c=a(7),b=a(15),e=a(323),f=a(29),d=a(11),
h=a(239);class m{constructor(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(t.a)(m,"ConnectionErrorLogInfo",null,[]);var l=a(1117),w=a(1266);class n{constructor(r){this.Pnd=[l.a.Qog,l.a.KGc];this.Xn=(u,v)=>{this.LO[v]=u;this.Sai()&&this.smj("OnNetworkDownImmediatePing"===u.caller)};this.mma=r;this.$=r.$;this.LO={}}Uxi(){const r=w.a.Jfd(this.Xn,"OnNetworkDownImmediatePing",this.$,this.Pnd);for(const u of r)u.runTest()}Sai(){for(const r of this.Pnd)if(void 0===
this.LO[r]||null===this.LO[r])return!1;return!0}smj(r){const u=this.$.Te.K5;r&&this.yNj(u);for(var v of this.Pnd)this.LO[v]=Sys.Serialization.JavaScriptSerializer.serialize(this.LO[v]);r=Date.now();v=this.mma.Ekd(a(853).NetworkConnectionHealthChecker.uFb).returnValue;const B=this.mma.Ekd(a(853).NetworkConnectionHealthChecker.LMb).returnValue;this.LO.isOfflineMode=u;this.LO.networkDownBBAge=-1===v?v:r-v;this.LO.transientServerCommunicationFailuresBBAge=-1===B?B:r-B;this.mma.businessBar?(this.LO.isNetworkDownBBShown=
this.mma.businessBar.qH(56).toString(),this.LO.isServerErrorBBShown=this.mma.businessBar.qH(21).toString()):(this.LO.isNetworkDownBBShown="unknown",this.LO.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.LO)}`)}yNj(r){const {NetworkConnectionHealthChecker:u}=a(853),v={};for(const B of Object.keys(this.LO)){const z=this.LO[B];v[z.testName]=z.isSuccess}v.isOfflineMode=r;this.mma.CYd(u.o5c,
Sys.Serialization.JavaScriptSerializer.serialize(v))}}Object(t.a)(n,"ConnectionHealthTestsRunner",null,[]);a.d(E,"NetworkConnectionHealthChecker",function(){return x});class x{constructor(r){this.businessBar=this.u9a=null;this.ANi=(u,v)=>{v.U9c?this.CNi(v):this.BNi(v)};this.hh=(u,v)=>{u=v.context.methodName;this.u9a&&u===this.u9a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.u9a}" has now succeeded. Querying local storage for BB showings.`),
this.T9a(x.LMb,!0),this.u9a=null);this.atf(!1);this.N5b=!1};this.zm=(u,v)=>{f.a.fh(v.errors,[-1387426400])&&!this.N5b&&(this.N5b=!0,this.O8f()&&window.performance.mark(x.Vzf),(new n(this)).Uxi())};this.sg=()=>{this.atf(!0);this.T9a(x.uFb,!1);this.T9a(x.LMb,!1)};this.tza=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.T9a(x.uFb,!0)};this.$=r;this.pa=this.$.pa;this.localStorage=new h.a;
this.N5b=!1;this.$.ea.Lk(this.sg);this.pa.Te.Wob(this.tza);this.pa.Mq(this.hh);this.$.da.fb(5,u=>{this.businessBar=u;u.aMg(this.ANi)});this.pa.mw(this.zm)}dispose(){this.$&&(this.$.ea&&this.$.ea.Pn(this.sg),this.pa&&(this.pa.Te.DKb(this.tza),this.pa.kx(this.zm),this.pa.Lr(this.hh)))}CNi(r){const u={};u.Timestamp=Date.now().toString();switch(r.H0a){case 21:this.u9a=r.data.FailedMethod;u.FailedMethod=this.u9a;this.CYd(x.LMb,JSON.stringify(u));break;case 56:this.CYd(x.uFb,JSON.stringify(u))}}BNi(r){switch(r.H0a){case 21:this.T9a(x.LMb,
!0);break;case 56:this.T9a(x.uFb,!0)}}CYd(r,u){try{this.localStorage.Zd()&&this.localStorage.setItem(r,u)}catch(v){b.ULS.sendTraceTag(537155231,0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${v.message||"Unknown"}`)}}Ekd(r){if(this.localStorage.Zd()&&(r=this.localStorage.zLa(r))&&"null"!==r){var u=JSON.parse(r);r=parseInt(u.Timestamp,10);u=Sys.Serialization.JavaScriptSerializer.serialize(u);return{returnValue:r,rawData:u}}return{returnValue:-1,
rawData:null}}atf(r){if(this.localStorage.Zd()){const u=this.localStorage.zLa(x.o5c);if(u&&"null"!==u){let v=-1;this.N5b&&(v=this.OTh(x.Vzf,x.mMi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(u)}, Period offline: ${v}, New session: ${r}`);this.localStorage.removeItem(x.o5c)}}}OTh(r,u){if(!this.O8f())return-1;window.performance.measure(u,r);r=window.performance.getEntriesByName(u);
return r.length&&r[r.length-1]?r[r.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${u} returned no measures.`),-1)}T9a(r,u){try{let v;const B=({rawData:v}=this.Ekd(r)).returnValue;if(-1!==B){const z=Object(c.a)(new m,{timeElapsed:Date.now()-B,scenario:r,isNewSession:!u,rawData:v});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(z)}`)}this.localStorage.removeItem(r)}catch(v){b.ULS.sendTraceTag(537155226,
0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${v.message||"Unknown"}`)}}O8f(){return d.HelperMethods.Q0c&&e.a.Oqb}}x.uFb="NetworkDownBBShown";x.LMb="ServerCommunicationFailureBBShown";x.o5c="ConnectionHealthPingRsults";x.Vzf="offMoStMa";x.mMi="offMoDuMea";Object(t.a)(x,"NetworkConnectionHealthChecker",null,[3])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/1f46e4c8ffb764cb1e29dc6dd958f840/EwaDSEsNext.pi.js.map